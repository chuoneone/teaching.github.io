<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£è² æ•¸å­¸ç¿’å–®åœ–å½¢ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .fade-out {
            animation: fadeOut 0.8s ease-out forwards;
        }
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        .move-to-center {
            transition: all 0.8s ease-in-out;
        }
        @keyframes explosion {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-purple-800 mb-2">æ­£è² æ•¸å­¸ç¿’å–®</h1>
            <p class="text-xl text-gray-700">ç”¨é¡è‰²å’Œåœ–ç¤ºå­¸ç¿’æ­£è² æ•¸é‹ç®—</p>
        </div>

        <!-- èªªæ˜å€åŸŸ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-center mb-4 text-gray-800">å­¸ç¿’æ­¥é©Ÿ</h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="text-center p-4 bg-blue-50 rounded-xl">
                    <div class="text-3xl mb-2">1ï¸âƒ£</div>
                    <p class="font-semibold text-blue-800">çœ‹çœ‹æ­£æ•¸é‚„æ˜¯è² æ•¸æ¯”è¼ƒå¤š</p>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-xl">
                    <div class="text-3xl mb-2">2ï¸âƒ£</div>
                    <p class="font-semibold text-green-800">ç›¸åŒç¬¦è™Ÿï¼šç›¸åŠ </p>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded-xl">
                    <div class="text-3xl mb-2">3ï¸âƒ£</div>
                    <p class="font-semibold text-orange-800">ä¸åŒç¬¦è™Ÿï¼šäº’ç›¸æŠµæ¶ˆ</p>
                </div>
            </div>
        </div>

        <!-- åœ–ç¤ºèªªæ˜ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h3 class="text-xl font-bold text-center mb-4 text-gray-800">åœ–ç¤ºèªªæ˜</h3>
            <div class="flex justify-center gap-8">
                <div class="text-center">
                    <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-2">+</div>
                    <p class="font-semibold text-green-700">æ­£æ•¸ï¼ˆç¶ è‰²åœ“åœˆï¼‰</p>
                </div>
                <div class="text-center">
                    <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-2">-</div>
                    <p class="font-semibold text-red-700">è² æ•¸ï¼ˆç´…è‰²åœ“åœˆï¼‰</p>
                </div>
            </div>
        </div>

        <!-- ç·´ç¿’å€åŸŸ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h3 class="text-2xl font-bold text-center mb-6 text-gray-800">é–‹å§‹ç·´ç¿’</h3>
            
            <!-- é¡Œå‹åˆ‡æ›æ¬„ -->
            <div class="mb-6">
                <h4 class="text-lg font-bold text-center mb-4 text-gray-700">é¸æ“‡é¡Œå‹</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
                    <button onclick="selectType(0)" id="typeBtn0" class="type-btn bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">æ­£æ•¸æ¸›æ­£æ•¸</button>
                    <button onclick="selectType(1)" id="typeBtn1" class="type-btn bg-green-100 hover:bg-green-200 text-green-800 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">è² æ•¸åŠ æ­£æ•¸</button>
                    <button onclick="selectType(2)" id="typeBtn2" class="type-btn bg-red-100 hover:bg-red-200 text-red-800 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">è² æ•¸æ¸›æ­£æ•¸</button>
                    <button onclick="selectType(3)" id="typeBtn3" class="type-btn bg-purple-100 hover:bg-purple-200 text-purple-800 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">æ­£æ•¸æ¸›è² æ•¸</button>
                    <button onclick="selectType(4)" id="typeBtn4" class="type-btn bg-orange-100 hover:bg-orange-200 text-orange-800 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">æ­£æ•¸åŠ è² æ•¸</button>
                    <button onclick="selectType(5)" id="typeBtn5" class="type-btn bg-pink-100 hover:bg-pink-200 text-pink-800 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">è² æ•¸åŠ è² æ•¸</button>
                    <button onclick="selectType(6)" id="typeBtn6" class="type-btn bg-indigo-100 hover:bg-indigo-200 text-indigo-800 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">è² æ•¸æ¸›è² æ•¸</button>
                    <button onclick="selectRandomType()" class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-2 px-3 rounded-lg text-sm transition-colors">ğŸ² éš¨æ©Ÿ</button>
                </div>
            </div>
            
            <!-- é¡Œç›®ç”ŸæˆæŒ‰éˆ• -->
            <div class="text-center mb-6">
                <button onclick="generateProblem()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full text-xl transition-colors">
                    ğŸ¯ ç”¢ç”Ÿé¡Œç›®
                </button>
            </div>

            <!-- é¡Œç›®é¡¯ç¤ºå€ -->
            <div id="problemArea" class="text-center mb-8">
                <p class="text-gray-500 text-lg">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹ç·´ç¿’</p>
            </div>

            <!-- è¦–è¦ºåŒ–å€åŸŸ -->
            <div id="visualArea" class="mb-8"></div>



            <!-- ç­”æ¡ˆå€åŸŸ -->
            <div id="answerArea" class="text-center"></div>
        </div>
    </div>

    <script>
        let currentProblem = null;
        let currentQuestionIndex = 0;
        let currentTypeIndex = 0;
        
        // å®šç¾©é¡Œå‹æ¨¡æ¿å’Œå°æ‡‰çš„é¡Œç›®
        const questionTypes = [
            { type: "æ­£æ•¸æ¸›æ­£æ•¸", template: "a - b", examples: [[10, 8], [9, 3], [7, 5]] },
            { type: "è² æ•¸åŠ æ­£æ•¸", template: "-a + b", examples: [[-8, 10], [-5, 9], [-3, 7]] },
            { type: "è² æ•¸æ¸›æ­£æ•¸", template: "-a - b", examples: [[-8, 10], [-6, 4], [-9, 2]] },
            { type: "æ­£æ•¸æ¸›è² æ•¸", template: "a - (-b)", examples: [[10, -8], [7, -3], [5, -6]] },
            { type: "æ­£æ•¸åŠ è² æ•¸", template: "a + (-b)", examples: [[10, -8], [8, -5], [6, -9]] },
            { type: "è² æ•¸åŠ è² æ•¸", template: "-a + (-b)", examples: [[-8, -10], [-4, -6], [-3, -7]] },
            { type: "è² æ•¸æ¸›è² æ•¸", template: "-a - (-b)", examples: [[-8, -10], [-5, -3], [-9, -4]] }
        ];

        function generateProblem() {
            // é‡ç½®è¦–è¦ºå€åŸŸ
            document.getElementById('visualArea').innerHTML = '';
            
            // ç²å–ç•¶å‰é¡Œå‹å’Œé¡Œç›®
            const currentType = questionTypes[currentTypeIndex];
            const currentExample = currentType.examples[currentQuestionIndex];
            
            let num1, num2, operator, displayText;
            
            switch(currentTypeIndex) {
                case 0: // æ­£æ•¸æ¸›æ­£æ•¸
                    num1 = currentExample[0];
                    num2 = currentExample[1];
                    operator = '-';
                    displayText = `${num1} - ${num2} = ?`;
                    break;
                case 1: // è² æ•¸åŠ æ­£æ•¸
                    num1 = currentExample[0];
                    num2 = currentExample[1];
                    operator = '+';
                    displayText = `${num1} + ${num2} = ?`;
                    break;
                case 2: // è² æ•¸æ¸›æ­£æ•¸
                    num1 = currentExample[0];
                    num2 = currentExample[1];
                    operator = '-';
                    displayText = `${num1} - ${num2} = ?`;
                    break;
                case 3: // æ­£æ•¸æ¸›è² æ•¸
                    num1 = currentExample[0];
                    num2 = currentExample[1];
                    operator = '-';
                    displayText = `${num1} - (${num2}) = ?`;
                    break;
                case 4: // æ­£æ•¸åŠ è² æ•¸
                    num1 = currentExample[0];
                    num2 = currentExample[1];
                    operator = '+';
                    displayText = `${num1} + (${num2}) = ?`;
                    break;
                case 5: // è² æ•¸åŠ è² æ•¸
                    num1 = currentExample[0];
                    num2 = currentExample[1];
                    operator = '+';
                    displayText = `${num1} + (${num2}) = ?`;
                    break;
                case 6: // è² æ•¸æ¸›è² æ•¸
                    num1 = currentExample[0];
                    num2 = currentExample[1];
                    operator = '-';
                    displayText = `${num1} - (${num2}) = ?`;
                    break;
            }
            
            // è¨ˆç®—ç­”æ¡ˆ
            let answer;
            switch(currentTypeIndex) {
                case 0: // æ­£æ•¸æ¸›æ­£æ•¸: a - b
                    answer = num1 - num2;
                    break;
                case 1: // è² æ•¸åŠ æ­£æ•¸: -a + b
                    answer = num1 + num2;
                    break;
                case 2: // è² æ•¸æ¸›æ­£æ•¸: -a - b
                    answer = num1 - num2;
                    break;
                case 3: // æ­£æ•¸æ¸›è² æ•¸: a - (-b) = a + b
                    answer = num1 + Math.abs(num2);
                    break;
                case 4: // æ­£æ•¸åŠ è² æ•¸: a + (-b) = a - b
                    answer = num1 + num2;
                    break;
                case 5: // è² æ•¸åŠ è² æ•¸: -a + (-b)
                    answer = num1 + num2;
                    break;
                case 6: // è² æ•¸æ¸›è² æ•¸: -a - (-b) = -a + b
                    answer = num1 + Math.abs(num2);
                    break;
            }
            
            currentProblem = { 
                num1, 
                num2, 
                operator, 
                answer, 
                displayText,
                typeIndex: currentTypeIndex,
                typeName: currentType.type
            };
            
            displayProblem();
            createVisualization();
            
            // æ›´æ–°é¡Œç›®è¨ˆæ•¸å™¨
            updateQuestionCounter();
        }

        function displayProblem() {
            const problemArea = document.getElementById('problemArea');
            const { displayText, typeName } = currentProblem;
            
            problemArea.innerHTML = `
                <div class="mb-2 text-lg font-semibold text-purple-600">${typeName}</div>
                <div class="text-4xl font-bold text-gray-800 mb-4">${displayText}</div>
            `;
        }

        function createVisualization() {
            const visualArea = document.getElementById('visualArea');
            const { num1, num2, typeIndex } = currentProblem;
            
            // æª¢æŸ¥æ˜¯å¦æœ‰æ‹¬è™Ÿéœ€è¦å»é™¤ï¼ˆå¾Œå››ç¨®é¡Œå‹éƒ½æœ‰æ‹¬è™Ÿï¼‰
            if (typeIndex >= 3) { // æœ‰æ‹¬è™Ÿçš„é¡Œå‹
                // å…ˆé¡¯ç¤ºå»æ‹¬è™Ÿæ­¥é©Ÿï¼Œä¸é¡¯ç¤ºåœ“åœˆ
                showBracketRemoval();
                return;
            }
            
            let html = '<div class="text-center">';
            html += '<h4 class="text-xl font-bold mb-4 text-gray-700">è¦–è¦ºåŒ–è¡¨ç¤º</h4>';
            html += '<div id="circleContainer" class="flex flex-wrap justify-center gap-2 mb-6 min-h-[120px]">';
            
            let circleId = 0;
            
            // ç¬¬ä¸€çµ„æ•¸å­—
            html += '<div class="flex flex-wrap justify-center gap-2" id="group1">';
            for (let i = 0; i < Math.abs(num1); i++) {
                const color = num1 > 0 ? 'bg-green-500' : 'bg-red-500';
                const sign = num1 > 0 ? '+' : '-';
                html += `<div id="circle${circleId}" class="w-10 h-10 ${color} rounded-full flex items-center justify-center text-white font-bold bounce-in circle" style="animation-delay: ${i * 0.1}s" data-value="${num1 > 0 ? 1 : -1}">${sign}</div>`;
                circleId++;
            }
            html += '</div>';
            
            // é‹ç®—ç¬¦è™Ÿé¡¯ç¤º
            html += '<div class="w-full flex justify-center my-4">';
            html += `<div class="text-3xl font-bold text-gray-600">${currentProblem.operator}</div>`;
            html += '</div>';
            
            // ç¬¬äºŒçµ„æ•¸å­—
            html += '<div class="flex flex-wrap justify-center gap-2" id="group2">';
            
            // æ ¹æ“šé¡Œå‹æ±ºå®šç¬¬äºŒçµ„çš„é¡¯ç¤ºæ–¹å¼
            let secondGroupValue, secondGroupColor, secondGroupSign, secondGroupDataValue;
            
            if (typeIndex === 0) { // æ­£æ•¸æ¸›æ­£æ•¸: a - b (é¡¯ç¤ºè¦è¢«æ¸›æ‰çš„æ­£æ•¸ï¼Œç”¨ç´…è‰²è¡¨ç¤ºæœƒè¢«æ‹¿èµ°)
                secondGroupValue = num2;
                secondGroupColor = 'bg-red-500'; // ç”¨ç´…è‰²è¡¨ç¤ºæœƒè¢«æ¸›æ‰
                secondGroupSign = '-';
                secondGroupDataValue = -1; // æ¨™è¨˜ç‚ºè² å€¼ç”¨æ–¼æŠµæ¶ˆ
            } else if (typeIndex === 2) { // è² æ•¸æ¸›æ­£æ•¸: -a - b
                secondGroupValue = num2;
                secondGroupColor = 'bg-red-500'; // æ¸›æ³•è®“æ­£æ•¸è®Šæˆè² æ•¸
                secondGroupSign = '-';
                secondGroupDataValue = -1;
            } else {
                secondGroupValue = Math.abs(num2);
                secondGroupColor = num2 > 0 ? 'bg-green-500' : 'bg-red-500';
                secondGroupSign = num2 > 0 ? '+' : '-';
                secondGroupDataValue = num2 > 0 ? 1 : -1;
            }
            
            for (let i = 0; i < secondGroupValue; i++) {
                html += `<div id="circle${circleId}" class="w-10 h-10 ${secondGroupColor} rounded-full flex items-center justify-center text-white font-bold bounce-in circle" style="animation-delay: ${(Math.abs(num1) + i) * 0.1}s" data-value="${secondGroupDataValue}">${secondGroupSign}</div>`;
                circleId++;
            }
            html += '</div>';
            
            html += '</div>';
            
            // æŠµæ¶ˆæŒ‰éˆ•
            html += '<button onclick="showCancellation()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full mb-4 text-lg">ğŸ¬ çœ‹å‹•ç•«</button>';
            
            html += '</div>';
            visualArea.innerHTML = html;
        }

        function showCancellation() {
            const circles = document.querySelectorAll('.circle');
            const positiveCircles = Array.from(circles).filter(c => c.dataset.value === '1');
            const negativeCircles = Array.from(circles).filter(c => c.dataset.value === '-1');
            
            // åˆ¤æ–·æ˜¯åŒè™Ÿåˆä½µé‚„æ˜¯ç•°è™ŸæŠµæ¶ˆ
            if (positiveCircles.length > 0 && negativeCircles.length > 0) {
                // ç•°è™ŸæŠµæ¶ˆ
                const minCount = Math.min(positiveCircles.length, negativeCircles.length);
                
                // åŸ·è¡ŒæŠµæ¶ˆå‹•ç•«
                for (let i = 0; i < minCount; i++) {
                    setTimeout(() => {
                        animateCancellation(positiveCircles[i], negativeCircles[i]);
                    }, i * 300);
                }
                
                // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
                setTimeout(() => {
                    showNextQuestionButton();
                }, minCount * 300 + 1000);
            } else {
                // åŒè™Ÿåˆä½µ
                const allCircles = positiveCircles.length > 0 ? positiveCircles : negativeCircles;
                animateMerging(allCircles);
                
                // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
                setTimeout(() => {
                    showNextQuestionButton();
                }, 1500);
            }
        }
        
        function showNextQuestionButton() {
            const visualArea = document.getElementById('visualArea');
            const buttonHtml = '<div class="text-center mt-6"><button onclick="nextQuestion()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg">â¡ï¸ ä¸‹ä¸€é¡Œ</button></div>';
            visualArea.insertAdjacentHTML('beforeend', buttonHtml);
        }

        function showBracketRemoval() {
            const { displayText, typeIndex } = currentProblem;
            const problemArea = document.getElementById('problemArea');
            const visualArea = document.getElementById('visualArea');
            
            // é¡¯ç¤ºå»æ‹¬è™Ÿæ­¥é©Ÿ
            let stepHtml = '<div class="mb-4 p-4 bg-yellow-50 rounded-lg border-2 border-yellow-300">';
            stepHtml += '<h4 class="text-lg font-bold text-yellow-800 mb-2">æ­¥é©Ÿ1ï¼šå»æ‹¬è™Ÿ</h4>';
            stepHtml += '<div class="text-2xl font-bold text-gray-800 mb-2">';
            
            if (typeIndex === 3) { // æ­£æ•¸æ¸›è² æ•¸
                stepHtml += `= ${currentProblem.num1} + ${Math.abs(currentProblem.num2)}`;
            } else if (typeIndex === 4) { // æ­£æ•¸åŠ è² æ•¸
                stepHtml += `= ${currentProblem.num1} - ${Math.abs(currentProblem.num2)}`;
            } else if (typeIndex === 5) { // è² æ•¸åŠ è² æ•¸
                stepHtml += `= ${currentProblem.num1} - ${Math.abs(currentProblem.num2)}`;
            } else if (typeIndex === 6) { // è² æ•¸æ¸›è² æ•¸
                stepHtml += `= ${currentProblem.num1} + ${Math.abs(currentProblem.num2)}`;
            }
            
            stepHtml += '</div>';
            if (typeIndex === 3 || typeIndex === 6) {
                stepHtml += '<div class="text-sm text-yellow-700">æ¸›è² æ•¸ = åŠ æ­£æ•¸</div>';
            } else {
                stepHtml += '<div class="text-sm text-yellow-700">åŠ è² æ•¸ = æ¸›æ­£æ•¸</div>';
            }
            stepHtml += '</div>';
            
            // åœ¨é¡Œç›®å€åŸŸä¸‹æ–¹æ’å…¥å»æ‹¬è™Ÿèªªæ˜
            const existingContent = problemArea.innerHTML;
            problemArea.innerHTML = existingContent + stepHtml;
            
            // é¡¯ç¤ºæŒ‰éˆ•è®“ä½¿ç”¨è€…æ§åˆ¶ä¸‹ä¸€æ­¥
            visualArea.innerHTML = '<div class="text-center"><button onclick="showCirclesAfterBracket()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg">ğŸ¬ çœ‹å‹•ç•«</button></div>';
        }
        
        function showCirclesAfterBracket() {
            // é¡¯ç¤ºåœ“åœˆ
            createCirclesAfterBracketRemoval();
            
            // é¡¯ç¤ºå‹•ç•«æŒ‰éˆ•
            const visualArea = document.getElementById('visualArea');
            const buttonHtml = '<div class="text-center mt-6"><button onclick="startCancellationAnimation()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full text-lg">ğŸ¬ çœ‹å‹•ç•«</button></div>';
            visualArea.insertAdjacentHTML('beforeend', buttonHtml);
        }
        
        function startCancellationAnimation() {
            const circles = document.querySelectorAll('.circle');
            const positiveCircles = Array.from(circles).filter(c => c.dataset.value === '1');
            const negativeCircles = Array.from(circles).filter(c => c.dataset.value === '-1');
            
            // ç§»é™¤æŒ‰éˆ•
            const button = document.querySelector('button[onclick="startCancellationAnimation()"]');
            if (button) button.parentElement.remove();
            
            // åˆ¤æ–·æ˜¯åŒè™Ÿåˆä½µé‚„æ˜¯ç•°è™ŸæŠµæ¶ˆ
            if (positiveCircles.length > 0 && negativeCircles.length > 0) {
                // ç•°è™ŸæŠµæ¶ˆ
                const minCount = Math.min(positiveCircles.length, negativeCircles.length);
                
                // åŸ·è¡ŒæŠµæ¶ˆå‹•ç•«
                for (let i = 0; i < minCount; i++) {
                    setTimeout(() => {
                        animateCancellation(positiveCircles[i], negativeCircles[i]);
                    }, i * 300);
                }
                
                // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
                setTimeout(() => {
                    showNextQuestionButton();
                }, minCount * 300 + 1000);
            } else {
                // åŒè™Ÿåˆä½µ
                const allCircles = positiveCircles.length > 0 ? positiveCircles : negativeCircles;
                animateMerging(allCircles);
                
                // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
                setTimeout(() => {
                    showNextQuestionButton();
                }, 1500);
            }
        }
        
        function createCirclesAfterBracketRemoval() {
            const visualArea = document.getElementById('visualArea');
            const { num1, num2, typeIndex } = currentProblem;
            
            let html = '<div class="text-center">';
            html += '<h4 class="text-xl font-bold mb-4 text-gray-700">è¦–è¦ºåŒ–è¡¨ç¤º</h4>';
            html += '<div id="circleContainer" class="flex flex-wrap justify-center gap-2 mb-6 min-h-[120px]">';
            
            let circleId = 0;
            
            // ç¬¬ä¸€çµ„æ•¸å­—
            html += '<div class="flex flex-wrap justify-center gap-2" id="group1">';
            for (let i = 0; i < Math.abs(num1); i++) {
                const color = num1 > 0 ? 'bg-green-500' : 'bg-red-500';
                const sign = num1 > 0 ? '+' : '-';
                html += `<div id="circle${circleId}" class="w-10 h-10 ${color} rounded-full flex items-center justify-center text-white font-bold bounce-in circle" style="animation-delay: ${i * 0.1}s" data-value="${num1 > 0 ? 1 : -1}">${sign}</div>`;
                circleId++;
            }
            html += '</div>';
            
            // é‹ç®—ç¬¦è™Ÿé¡¯ç¤ºï¼ˆæ ¹æ“šå»æ‹¬è™Ÿå¾Œçš„çµæœï¼‰
            html += '<div class="w-full flex justify-center my-4">';
            let operatorSymbol = '+';
            if (typeIndex === 4 || typeIndex === 5) { // åŠ è² æ•¸è®Šæ¸›æ­£æ•¸
                operatorSymbol = '-';
            }
            html += `<div class="text-3xl font-bold text-gray-600">${operatorSymbol}</div>`;
            html += '</div>';
            
            // ç¬¬äºŒçµ„æ•¸å­—ï¼ˆæ ¹æ“šå»æ‹¬è™Ÿå¾Œçš„çµæœï¼‰
            html += '<div class="flex flex-wrap justify-center gap-2" id="group2">';
            
            let secondGroupColor, secondGroupSign, secondGroupDataValue;
            if (typeIndex === 3 || typeIndex === 6) { // æ¸›è² æ•¸è®ŠåŠ æ­£æ•¸
                secondGroupColor = 'bg-green-500';
                secondGroupSign = '+';
                secondGroupDataValue = 1;
            } else { // åŠ è² æ•¸è®Šæ¸›æ­£æ•¸
                secondGroupColor = 'bg-red-500';
                secondGroupSign = '-';
                secondGroupDataValue = -1;
            }
            
            for (let i = 0; i < Math.abs(num2); i++) {
                html += `<div id="circle${circleId}" class="w-10 h-10 ${secondGroupColor} rounded-full flex items-center justify-center text-white font-bold bounce-in circle" style="animation-delay: ${(Math.abs(num1) + i) * 0.1}s" data-value="${secondGroupDataValue}">${secondGroupSign}</div>`;
                circleId++;
            }
            html += '</div>';
            
            html += '</div>';
            html += '</div>';
            
            visualArea.innerHTML = html;
        }

        function animateCancellation(circle1, circle2) {
            // ç²å–å…©å€‹åœ“åœˆçš„ä½ç½®
            const rect1 = circle1.getBoundingClientRect();
            const rect2 = circle2.getBoundingClientRect();
            
            // è¨ˆç®—ä¸­é»
            const midX = (rect1.left + rect2.left) / 2;
            const midY = (rect1.top + rect2.top) / 2;
            
            // è®“å…©å€‹åœ“åœˆç§»å‹•åˆ°ä¸­é»
            circle1.style.transition = 'all 0.8s ease-in-out';
            circle2.style.transition = 'all 0.8s ease-in-out';
            circle1.style.transform = `translate(${midX - rect1.left - rect1.width/2}px, ${midY - rect1.top - rect1.height/2}px) scale(0.5)`;
            circle2.style.transform = `translate(${midX - rect2.left - rect2.width/2}px, ${midY - rect2.top - rect2.height/2}px) scale(0.5)`;
            
            // åœ¨ä¸­é»ç¢°æ’å¾Œæ¶ˆå¤±
            setTimeout(() => {
                circle1.style.opacity = '0';
                circle2.style.opacity = '0';
                
                // æ·»åŠ çˆ†ç‚¸æ•ˆæœ
                const explosion = document.createElement('div');
                explosion.innerHTML = 'ğŸ’¥';
                explosion.style.position = 'absolute';
                explosion.style.left = midX + 'px';
                explosion.style.top = midY + 'px';
                explosion.style.fontSize = '24px';
                explosion.style.transform = 'translate(-50%, -50%)';
                explosion.style.animation = 'explosion 0.8s ease-out';
                document.body.appendChild(explosion);
                
                setTimeout(() => {
                    explosion.remove();
                }, 500);
            }, 800);
        }

        function animateMerging(circles) {
            if (circles.length === 0) return;
            
            // è¨ˆç®—å®¹å™¨çš„ä¸­å¿ƒä½ç½®
            const container = document.getElementById('circleContainer');
            const containerRect = container.getBoundingClientRect();
            const centerX = containerRect.left + containerRect.width / 2;
            const centerY = containerRect.top + containerRect.height / 2;
            
            // è¨ˆç®—æ’åˆ—ä½ç½®ï¼ˆæ¯æ’æœ€å¤š10å€‹ï¼‰
            const spacing = 45; // åœ“åœˆé–“è·
            const rowSpacing = 50; // è¡Œé–“è·
            const maxPerRow = 10; // æ¯æ’æœ€å¤š10å€‹
            const totalRows = Math.ceil(circles.length / maxPerRow);
            
            // è®“æ‰€æœ‰åœ“åœˆç§»å‹•åˆ°æ’åˆ—ä½ç½®
            circles.forEach((circle, index) => {
                const rect = circle.getBoundingClientRect();
                
                // è¨ˆç®—ç•¶å‰åœ“åœˆåœ¨ç¬¬å¹¾æ’ã€ç¬¬å¹¾å€‹
                const rowIndex = Math.floor(index / maxPerRow);
                const colIndex = index % maxPerRow;
                const circlesInThisRow = Math.min(maxPerRow, circles.length - rowIndex * maxPerRow);
                
                // è¨ˆç®—é€™ä¸€æ’çš„èµ·å§‹Xä½ç½®ï¼ˆå±…ä¸­ï¼‰
                const rowWidth = (circlesInThisRow - 1) * spacing;
                const rowStartX = centerX - rowWidth / 2;
                
                // è¨ˆç®—ç›®æ¨™ä½ç½®
                const targetX = rowStartX + colIndex * spacing;
                const targetY = centerY - (totalRows - 1) * rowSpacing / 2 + rowIndex * rowSpacing;
                
                circle.style.transition = 'all 1s ease-in-out';
                circle.style.transform = `translate(${targetX - rect.left - rect.width/2}px, ${targetY - rect.top - rect.height/2}px)`;
                circle.style.zIndex = '10';
            });
            
            // åˆä½µå¾Œç”¢ç”Ÿé–ƒå…‰æ•ˆæœ
            setTimeout(() => {
                // æ·»åŠ åˆä½µæ•ˆæœ
                const mergeEffect = document.createElement('div');
                mergeEffect.innerHTML = 'âœ¨';
                mergeEffect.style.position = 'absolute';
                mergeEffect.style.left = centerX + 'px';
                mergeEffect.style.top = centerY + 'px';
                mergeEffect.style.fontSize = '32px';
                mergeEffect.style.transform = 'translate(-50%, -50%)';
                mergeEffect.style.animation = 'explosion 1s ease-out';
                document.body.appendChild(mergeEffect);
                
                setTimeout(() => {
                    mergeEffect.remove();
                }, 1000);
            }, 1000);
        }



        function nextQuestion() {
            currentQuestionIndex++;
            
            // å¦‚æœç•¶å‰é¡Œå‹çš„3é¡Œéƒ½åšå®Œäº†ï¼Œæ›ä¸‹ä¸€å€‹é¡Œå‹
            if (currentQuestionIndex >= 3) {
                currentQuestionIndex = 0;
                currentTypeIndex++;
                
                // å¦‚æœæ‰€æœ‰é¡Œå‹éƒ½åšå®Œäº†ï¼Œé‡æ–°é–‹å§‹
                if (currentTypeIndex >= questionTypes.length) {
                    currentTypeIndex = 0;
                }
            }
            
            generateProblem();
        }

        function updateQuestionCounter() {
            const totalQuestions = currentTypeIndex * 3 + currentQuestionIndex + 1;
            const counterHtml = `<div class="text-center mb-4 text-lg font-semibold text-gray-600">
                é¡Œå‹ï¼š${questionTypes[currentTypeIndex].type} | ç¬¬ ${currentQuestionIndex + 1}/3 é¡Œ | ç¸½é€²åº¦ï¼š${totalQuestions}/21
            </div>`;
            
            document.getElementById('problemArea').insertAdjacentHTML('afterbegin', counterHtml);
        }



        function selectType(typeIndex) {
            currentTypeIndex = typeIndex;
            currentQuestionIndex = 0;
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('bg-yellow-300', 'ring-2', 'ring-yellow-400');
            });
            document.getElementById(`typeBtn${typeIndex}`).classList.add('bg-yellow-300', 'ring-2', 'ring-yellow-400');
            
            generateProblem();
        }

        function selectRandomType() {
            const randomIndex = Math.floor(Math.random() * questionTypes.length);
            selectType(randomIndex);
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            selectType(0); // é è¨­é¸æ“‡ç¬¬ä¸€å€‹é¡Œå‹
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98173c8fb7cd0758',t:'MTc1ODI2NTU0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
