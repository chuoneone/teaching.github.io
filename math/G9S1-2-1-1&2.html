<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動學習：2-1 點、線、圓</title> <!-- [更新] 網頁標題 -->
    <!-- 引入 Tailwind CSS -->
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入字型 Chiron GoRound TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&display=swap" rel="stylesheet">
    
    <!-- [修正] 引入 KaTeX 數學公式函式庫 (修正 integrity 拼寫) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" xintegrity="sha384-Ld2+S9GfA/sdyOeC7R5O/SwC/NPfK/2S+sB/eXJjlA/tq/hSdV2QhR/1T/cRTcSB" crossorigin="anonymous">
    <!-- [修正] 將 xintegrity 改為 integrity，並加上 defer -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" xintegrity="sha384-hNlLflKaM0Yv3jT1Rba3lCW+nBqDHWb/iA+1QfOMjQ+jM/mB/DaP/T2bxoU+qM/H" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" xintegrity="sha384-48SVGFYoG/cOKr+n+BwCyPaY/1HotfwRABEo/YAp/C/n1iK2E4fV4BpT/t1/zi+N" crossorigin="anonymous"></script>
    
    <style>
        /* 應用全域字型 */
        body {
            font-family: "Chiron GoRound TC", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        
        /* 關鍵字螢光筆效果 */
        .highlight {
            background: linear-gradient(to top, transparent 10%, #fef9c3 10% 80%, transparent 80%); /* bg-yellow-100 */
        }
        
        /* [新] 概念切換按鈕 */
        .concept-btn {
            padding: 0.5rem 1.5rem; /* py-2 px-6 */
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            border-radius: 0.5rem; /* rounded-lg */
            border: 2px solid #d1d5db; /* border-gray-300 */
            background-color: #f9fafb; /* bg-gray-50 */
            color: #4b5563; /* text-gray-600 */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .concept-btn.active {
            background-color: #3b82f6; /* bg-blue-500 */
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3); /* shadow-lg */
        }
        .concept-btn:not(.active):hover {
            background-color: #ffffff;
            border-color: #9ca3af; /* border-gray-400 */
        }

        /* SVG 圖形樣式 */
        .svg-circle {
            fill: none;
            stroke: #9ca3af; /* stroke-gray-400 */
            stroke-width: 2;
        }
        .svg-point {
            fill: #ef4444; /* fill-red-500 */
            stroke: none;
        }
        .svg-line {
            fill: none;
            stroke: #3b82f6; /* stroke-blue-500 */
            stroke-width: 2.5;
            stroke-linecap: round;
        }
        .svg-angle-fill {
            fill: #bfdbfe; /* fill-blue-200 */
            stroke: #3b82f6; /* stroke-blue-500 */
            stroke-width: 1;
            opacity: 0.7;
        }
        .svg-arc-minor {
            fill: none;
            stroke: #1d4ed8; /* stroke-blue-800 */
            stroke-width: 3;
        }
        .svg-arc-major {
            fill: none;
            stroke: #60a5fa; /* stroke-blue-400 */
            stroke-width: 3;
        }
        
        /* 答案輸入框樣式 (下拉選單) */
        .answer-select {
            width: 200px; 
            text-align: left;
            font-size: 1.125rem; /* text-lg */
            border: 2px solid #cbd5e1; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem; /* p-2 */
            background-color: white;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path stroke="%236B7280" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 8l4 4 4-4"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem; /* 預留箭頭空間 */
            cursor: pointer;
        }
        .answer-select:focus {
            outline: none;
            border-color: #3b82f6; /* border-blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* ring-2 ring-blue-500 */
        }
        .answer-select:disabled {
            background-color: #f3f4f6; /* bg-gray-100 */
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        /* 頁籤按鈕樣式 */
        .tab-btn {
            padding: 0.5rem 1rem; /* py-2 px-4 */
            font-weight: 600; /* font-semibold */
            border-radius: 0.5rem 0.5rem 0 0; /* rounded-t-lg */
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-bottom: none;
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #6b7280; /* text-gray-500 */
            cursor: not-allowed;
            opacity: 0.6;
        }
        .tab-btn.active {
            background-color: #ffffff; /* bg-white */
            color: #1d4ed8; /* text-blue-700 */
            border-bottom: 1px solid #ffffff;
            margin-bottom: -1px; /* 蓋掉下方的 border */
            opacity: 1;
            cursor: pointer;
        }
        .tab-btn:not(:disabled):not(.active):hover {
            background-color: #e5e7eb; /* bg-gray-200 */
        }
        .tab-btn:disabled:not(.active) {
            color: #9ca3af; /* text-gray-400 */
        }

        /* --- 
           第二部分：計算題的輸入框樣式
        --- */
        .calc-input {
            width: 3rem; /* w-12 */
            text-align: center;
            font-size: 1.125rem; /* text-lg */
            border: 2px solid #cbd5e1; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.25rem; /* p-1 */
            background-color: white;
            transition: border-color 0.2s;
        }
        .calc-input:focus {
            outline: none;
            border-color: #3b82f6; /* border-blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* ring-2 ring-blue-500 */
        }
        .calc-input:disabled {
            background-color: #f3f4f6; /* bg-gray-100 */
            opacity: 1; 
            color: #1f2937; /* text-gray-800 */
            border-style: dashed; 
        }
        /* 答對時的樣式 (由 JS 控制) */
        .calc-input.correct {
            border-color: #22c55e; /* border-green-500 */
            color: #166534; /* text-green-800 */
            font-weight: 600;
        }
        .calc-input:disabled.correct {
            color: #166534; /* text-green-800 */
            font-weight: 600;
            border-color: #22c55e;
            border-style: solid; /* 實線 */
        }
        /* 答錯時的樣式 (由 JS 控制) */
        .calc-input.incorrect {
            border-color: #ef4444; /* border-red-500 */
            color: #b91c1c; /* text-red-800 */
            font-weight: 600;
        }

        /* KaTeX 數學公式樣式 */
        .katex {
            font-size: 1.1em; 
            display: inline-block;
            vertical-align: middle;
        }

        /* 分數顯示樣式 */
        .fraction {
            display: inline-flex;
            flex-direction: column;
            vertical-align: middle;
            margin: 0 0.25rem; /* mx-1 */
            text-align: center;
        }
        .fraction-bar {
            height: 2px;
            background-color: #1f2937; /* gray-800 */
            width: 100%; 
            margin: 2px 0;
        }
        .fraction input.calc-input {
            margin: 0.1rem 0;
        }

        /* 步驟化計算的樣式 */
        .calc-step.hidden {
            display: none;
        }
        .step-check-btn {
            padding: 0.25rem 0.75rem; /* py-1 px-3 */
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            transition: background-color 0.2s;
        }
        .step-check-btn:disabled {
            background-color: #d1d5db; /* bg-gray-300 */
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen pb-24"> <!-- 預留 footer 空間 -->

    <div class="container max-w-3xl mx-auto p-4 md:p-8">
        <header class="text-center mb-6">
            <!-- [更新] 標題 -->
            <h1 class="text-3xl font-bold text-blue-800">2-1 點、線、圓</h1>
        </header>

        <!-- [新] 概念切換導覽列 -->
        <nav class="flex justify-center gap-4 mb-8">
            <button id="concept-btn-1" class="concept-btn active" onclick="switchConcept(1)">
                (一) 圓的定義
            </button>
            <button id="concept-btn-2" class="concept-btn" onclick="switchConcept(2)">
                (二) 扇形計算
            </button>
        </nav>

        <!-- [新] 概念一 (定義) 內容 -->
        <div id="concept-1-content">
            <!-- 
            ==========================
            (一) 圓、圓弧與扇形 (定義)
            ==========================
            -->
            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">一、圓、圓弧與扇形</h2>
                
                <!-- 頁籤導覽 -->
                <nav id="tabs" class="flex border-b border-gray-300 -mb-px">
                    <button id="tab-1" data-tab="1" class="tab-btn active">第 1 題</button>
                    <button id="tab-2" data-tab="2" class="tab-btn" disabled>第 2 題</button>
                    <button id="tab-3" data-tab="3" class="tab-btn" disabled>第 3 題</button>
                    <button id="tab-4" data-tab="4" class="tab-btn" disabled>第 4 題</button>
                    <button id="tab-5" data-tab="5" class="tab-btn" disabled>第 5 題</button>
                </nav>

                <!-- 題目內容區 -->
                <div id="tab-content" class="pt-6 pb-4">

                    <!-- 題目 1 -->
                    <div id="content-1" data-step="1" class="space-y-4">
                        <p class="text-gray-600 font-semibold">進度：第 1 題 / 共 5 題</p>
                        <p class="text-xl leading-relaxed">
                            (1) <span class="highlight">圓周上任兩點連線</span>且<span class="highlight">通過圓心</span>的線段，稱為_______。
                        </p>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-6">
                            <div class="w-full md:w-1/2 text-center">
                                <svg class="w-48 h-48 mx-auto" viewBox="0 0 100 100">
                                    <circle class="svg-circle" cx="50" cy="50" r="40"/>
                                    <circle class="svg-point" cx="50" cy="50" r="2.5"/>
                                    <line class="svg-line" x1="10" y1="50" x2="90" y2="50"/>
                                </svg>
                            </div>
                            <div class="w-full md:w-1/2 flex flex-col items-center justify-center gap-4">
                                <select id="q1-select" class="answer-select"></select>
                                <button id="q1-check" onclick="checkAnswer(1)" class="py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg text-lg shadow hover:bg-blue-700 transition duration-200">
                                    檢查答案
                                </button>
                            </div>
                        </div>
                        <div id="q1-feedback" class="text-center h-6 text-lg"></div>
                    </div>

                    <!-- 題目 2 -->
                    <div id="content-2" data-step="2" class="space-y-4 hidden">
                        <p class="text-gray-600 font-semibold">進度：第 2 題 / 共 5 題</p>
                        <p class="text-xl leading-relaxed">
                            (2) 以<span class="highlight">圓心為頂點</span>，<span class="highlight">半徑為兩邊</span>所成的角，稱為_______。
                        </p>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-6">
                            <div class="w-full md:w-1/2 text-center">
                                <svg class="w-48 h-48 mx-auto" viewBox="0 0 100 100">
                                    <circle class="svg-circle" cx="50" cy="50" r="40"/>
                                    <path class="svg-angle-fill" d="M 50 50 L 50 10 A 40 40 0 0 1 84.6 30.8 Z"/>
                                    <line class="svg-line" x1="50" y1="50" x2="50" y2="10"/>
                                    <line class="svg-line" x1="50" y1="50" x2="84.6" y2="30.8"/>
                                    <circle class="svg-point" cx="50" cy="50" r="2.5"/>
                                </svg>
                            </div>
                            <div class="w-full md:w-1/2 flex flex-col items-center justify-center gap-4">
                                <select id="q2-select" class="answer-select"></select>
                                <button id="q2-check" onclick="checkAnswer(2)" class="py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg text-lg shadow hover:bg-blue-700 transition duration-200">
                                    檢查答案
                                </button>
                            </div>
                        </div>
                        <div id="q2-feedback" class="text-center h-6 text-lg"></div>
                    </div>

                    <!-- 題目 3 -->
                    <div id="content-3" data-step="3" class="space-y-4 hidden">
                        <p class="text-gray-600 font-semibold">進度：第 3 題 / 共 5 題</p>
                        <p class="text-xl leading-relaxed">
                            (3) 從<span class="highlight">圓心</span>到<span class="highlight">圓周上任何一點</span>所連成的線段，稱為這個圓的_______。
                        </p>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-6">
                            <div class="w-full md:w-1/2 text-center">
                                <svg class="w-48 h-48 mx-auto" viewBox="0 0 100 100">
                                    <circle class="svg-circle" cx="50" cy="50" r="40"/>
                                    <circle class="svg-point" cx="50" cy="50" r="2.5"/>
                                    <line class="svg-line" x1="50" y1="50" x2="84.6" y2="30.8"/>
                                </svg>
                            </div>
                            <div class="w-full md:w-1/2 flex flex-col items-center justify-center gap-4">
                                <select id="q3-select" class="answer-select"></select>
                                <button id="q3-check" onclick="checkAnswer(3)" class="py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg text-lg shadow hover:bg-blue-700 transition duration-200">
                                    檢查答案
                                </button>
                            </div>
                        </div>
                        <div id="q3-feedback" class="text-center h-6 text-lg"></div>
                    </div>

                    <!-- 題目 4 -->
                    <div id="content-4" data-step="4" class="space-y-4 hidden">
                        <p class="text-gray-600 font-semibold">進度：第 4 題 / 共 5 題</p>
                        <p class="text-xl leading-relaxed">
                            (4) 一條<span class="highlight">弦</span>將圓周分成兩個_______。
                        </p>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-6">
                            <div class="w-full md:w-1/2 text-center">
                                <svg class="w-48 h-48 mx-auto" viewBox="0 0 100 100">
                                    <circle class="svg-circle" cx="50" cy="50" r="40"/>
                                    <path class="svg-arc-minor" d="M 78.3 21.7 A 40 40 0 0 0 21.7 78.3" />
                                    <path class="svg-arc-major" d="M 78.3 21.7 A 40 40 0 1 0 21.7 78.3" />
                                    <line class="svg-line" opacity="0.5" stroke-dasharray="4 4" x1="78.3" y1="21.7" x2="21.7" y2="78.3"/>
                                </svg>
                            </div>
                            <div class="w-full md:w-1/2 flex flex-col items-center justify-center gap-4">
                                <div class="space-y-4 text-center">
                                    <div class="flex items-center justify-center gap-3">
                                        <label for="q4a-select" class="text-lg">第一個答案：</label>
                                        <select id="q4a-select" class="answer-select"></select>
                                    </div>
                                    <div class="flex items-center justify-center gap-3">
                                        <label for="q4b-select" class="text-lg">較大的稱為：</label>
                                        <select id="q4b-select" class="answer-select"></select>
                                    </div>
                                    <div class="flex items-center justify-center gap-3">
                                        <label for="q4c-select" class="text-lg">較小的稱為：</label>
                                        <select id="q4c-select" class="answer-select"></select>
                                    </div>
                                </div>
                                <button id="q4-check" onclick="checkAnswer(4)" class="py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg text-lg shadow hover:bg-blue-700 transition duration-200">
                                    檢查答案
                                </button>
                            </div>
                        </div>
                        <div id="q4-feedback" class="text-center h-6 text-lg"></div>
                    </div>

                    <!-- 題目 5 -->
                    <div id="content-5" data-step="5" class="space-y-4 hidden">
                        <p class="text-gray-600 font-semibold">進度：第 5 題 / 共 5 題</p>
                        <p class="text-xl leading-relaxed">
                            (5) 在一個圓中，<span class="highlight">圓周上任兩點連線</span>的線段，稱為_______。
                        </p>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-6">
                            <div class="w-full md:w-1/2 text-center">
                                <svg class="w-48 h-48 mx-auto" viewBox="0 0 100 100">
                                    <circle class="svg-circle" cx="50" cy="50" r="40"/>
                                    <line class="svg-line" x1="20.6" y1="62.1" x2="84.6" y2="30.8"/>
                                </svg>
                            </div>
                            <div class="w-full md:w-1/2 flex flex-col items-center justify-center gap-4">
                                <select id="q5-select" class="answer-select"></select>
                                <button id="q5-check" onclick="checkAnswer(5)" class="py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg text-lg shadow hover:bg-blue-700 transition duration-200">
                                    檢查答案
                                </button>
                            </div>
                        </div>
                        <div id="q5-feedback" class="text-center h-6 text-lg"></div>
                        
                        <!-- 完成訊息 -->
                        <div id="completion-message" class="hidden text-center p-6 bg-green-100 border border-green-300 rounded-lg">
                            <h3 class="text-2xl font-bold text-green-700">全部完成！</h3>
                            <p class="text-lg text-green-600 mt-2">你真是太棒了，所有關於圓的定義都答對了！</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- [新] 概念二 (計算) 內容 -->
        <div id="concept-2-content" class="hidden">
            <!-- 
            ==================================
            (二) 扇形圓心角和面積 (計算)
            ==================================
            -->
            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg mt-8">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">二、 扇形圓心角和面積</h2>
                
                <!-- 提示公式 -->
                <div class="flex flex-col sm:flex-row justify-center items-center gap-4 my-4 text-center">
                    <span class="text-lg text-blue-600 bg-blue-100 px-4 py-2 rounded-lg font-semibold">圓周長 = $2 \times r \times \pi$</span>
                    <span class="text-lg text-red-600 bg-red-100 px-4 py-2 rounded-lg font-semibold">面積 = $r^2 \times \pi$</span>
                </div>

                <!--
                  =================
                  計算題 1
                  =================
                -->
                <div class="pt-4">
                    <!-- [更新] 移除 "如圖" -->
                    <p class="text-xl leading-relaxed font-semibold">
                        1. 扇形 $AOB$ 中，$\overline{OA} = 4$ 公分，圓心角 $\angle AOB$ 為 $135^\circ$。
                    </p>
                    
                    <!-- [移除] SVG 圖形 1 -->

                    <!-- 計算題填空區 -->
                    <div class="flex flex-col md:flex-row gap-6 mt-6">
                        <!-- (1) 弧長 -->
                        <div class="w-full md:w-1/2 p-4 border border-gray-300 rounded-lg bg-gray-50 space-y-3">
                            <h3 class="text-xl font-semibold text-blue-700 text-center">
                                (1) 扇形弧長
                            </h3>
                            
                            <!-- 步驟 1: 列式 -->
                            <div id="calc-arc-q1-step-1" class="calc-step space-y-2">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：列出算式</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-arc-q1-1" class="calc-input" aria-label="圓周長"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-arc-q1-2" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-arc-q1-3" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q1-btn-1" onclick="checkCalcStep(1, 'arc', 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查列式
                                    </button>
                                    <div id="q-calc-arc-q1-feedback-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 2: 化簡 -->
                            <div id="calc-arc-q1-step-2" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：化簡分數</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-arc-q1-4" class="calc-input" aria-label="圓周長(化簡)"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-arc-q1-5" class="calc-input" aria-label="分子(化簡)">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-arc-q1-6" class="calc-input" aria-label="分母(化簡)">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q1-btn-2" onclick="checkCalcStep(1, 'arc', 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查化簡
                                    </button>
                                    <div id="q-calc-arc-q1-feedback-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 3: 答案 -->
                            <div id="calc-arc-q1-step-3" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-arc-q1-7" class="calc-input w-16" aria-label="弧長答案"> $\pi$ 公分
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q1-btn-3" onclick="checkCalcStep(1, 'arc', 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">
                                        檢查答案
                                    </button>
                                    <div id="q-calc-arc-q1-feedback-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                        </div>

                        <!-- (2) 面積 -->
                        <div class="w-full md:w-1/2 p-4 border border-gray-300 rounded-lg bg-gray-50 space-y-3">
                            <h3 class="text-xl font-semibold text-red-700 text-center">(2) 扇形面積</h3>
                            
                            <!-- 步驟 1: 列式 -->
                            <div id="calc-area-q1-step-1" class="calc-step space-y-2">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：列出算式</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-area-q1-1" class="calc-input" aria-label="圓面積"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-area-q1-2" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-area-q1-3" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q1-btn-1" onclick="checkCalcStep(1, 'area', 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查列式
                                    </button>
                                    <div id="q-calc-area-q1-feedback-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 2: 化簡 -->
                            <div id="calc-area-q1-step-2" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：化簡分數</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-area-q1-4" class="calc-input" aria-label="圓面積(化簡)"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-area-q1-5" class="calc-input" aria-label="分子(化簡)">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-area-q1-6" class="calc-input" aria-label="分母(化簡)">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q1-btn-2" onclick="checkCalcStep(1, 'area', 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查化簡
                                    </button>
                                    <div id="q-calc-area-q1-feedback-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 3: 答案 -->
                            <div id="calc-area-q1-step-3" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-area-q1-7" class="calc-input w-16" aria-label="面積答案"> $\pi$ 平方公分
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q1-btn-3" onclick="checkCalcStep(1, 'area', 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">
                                        檢查答案
                                    </button>
                                    <div id="q-calc-area-q1-feedback-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--
                  =================
                  [新] 計算題 2
                  =================
                -->
                <div class="pt-8 mt-8 border-t border-gray-300">
                    <!-- [更新] 移除 "如圖" -->
                    <p class="text-xl leading-relaxed font-semibold">
                        2. 扇形 $AOB$ 中，$\overline{OA} = 6$ 公分，圓心角 $\angle AOB$ 為 $120^\circ$。
                    </p>
                    
                    <!-- [移除] SVG 圖形 2 -->

                    <!-- 計算題填空區 -->
                    <div class="flex flex-col md:flex-row gap-6 mt-6">
                        <!-- (1) 弧長 -->
                        <div class="w-full md:w-1/2 p-4 border border-gray-300 rounded-lg bg-gray-50 space-y-3">
                            <h3 class="text-xl font-semibold text-blue-700 text-center">
                                (1) 扇形弧長
                            </h3>
                            
                            <!-- 步驟 1: 列式 -->
                            <div id="calc-arc-q2-step-1" class="calc-step space-y-2">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：列出算式</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-arc-q2-1" class="calc-input" aria-label="圓周長"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-arc-q2-2" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-arc-q2-3" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q2-btn-1" onclick="checkCalcStep(2, 'arc', 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查列式
                                    </button>
                                    <div id="q-calc-arc-q2-feedback-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 2: 化簡 -->
                            <div id="calc-arc-q2-step-2" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：化簡分數</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-arc-q2-4" class="calc-input" aria-label="圓周長(化簡)"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-arc-q2-5" class="calc-input" aria-label="分子(化)">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-arc-q2-6" class="calc-input" aria-label="分母(化簡)">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q2-btn-2" onclick="checkCalcStep(2, 'arc', 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查化簡
                                    </button>
                                    <div id="q-calc-arc-q2-feedback-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 3: 答案 -->
                            <div id="calc-arc-q2-step-3" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-arc-q2-7" class="calc-input w-16" aria-label="弧長答案"> $\pi$ 公分
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q2-btn-3" onclick="checkCalcStep(2, 'arc', 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">
                                        檢查答案
                                    </button>
                                    <div id="q-calc-arc-q2-feedback-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                        </div>

                        <!-- (2) 面積 -->
                        <div class="w-full md:w-1/2 p-4 border border-gray-300 rounded-lg bg-gray-50 space-y-3">
                            <h3 class="text-xl font-semibold text-red-700 text-center">(2) 扇形面積</h3>
                            
                            <!-- 步驟 1: 列式 -->
                            <div id="calc-area-q2-step-1" class="calc-step space-y-2">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：列出算式</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-area-q2-1" class="calc-input" aria-label="圓面積"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-area-q2-2" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-area-q2-3" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q2-btn-1" onclick="checkCalcStep(2, 'area', 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查列式
                                    </button>
                                    <div id="q-calc-area-q2-feedback-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 2: 化簡 -->
                            <div id="calc-area-q2-step-2" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：化簡分數</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-area-q2-4" class="calc-input" aria-label="圓面積(化簡)"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-area-q2-5" class="calc-input" aria-label="分子(化簡)">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-area-q2-6" class="calc-input" aria-label="分母(化簡)">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q2-btn-2" onclick="checkCalcStep(2, 'area', 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查化簡
                                    </button>
                                    <div id="q-calc-area-q2-feedback-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 3: 答案 -->
                            <div id="calc-area-q2-step-3" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-area-q2-7" class="calc-input w-16" aria-label="面積答案"> $\pi$ 平方公分
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q2-btn-3" onclick="checkCalcStep(2, 'area', 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">
                                        檢查答案
                                    </button>
                                    <div id="q-calc-area-q2-feedback-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!--
                  =================
                  [新] 計算題 3
                  =================
                -->
                <div class="pt-8 mt-8 border-t border-gray-300">
                    <!-- [更新] 移除 "如圖" -->
                    <p class="text-xl leading-relaxed font-semibold">
                        3. 扇形 $AOB$ 中，$\overline{OA} = 18$ 公分，圓心角 $\angle AOB$ 為 $100^\circ$。
                    </p>
                    
                    <!-- [移除] SVG 圖形 3 -->

                    <!-- 計算題填空區 -->
                    <div class="flex flex-col md:flex-row gap-6 mt-6">
                        <!-- (1) 弧長 -->
                        <div class="w-full md:w-1/2 p-4 border border-gray-300 rounded-lg bg-gray-50 space-y-3">
                            <h3 class="text-xl font-semibold text-blue-700 text-center">
                                (1) 扇形弧長
                            </h3>
                            
                            <!-- 步驟 1: 列式 -->
                            <div id="calc-arc-q3-step-1" class="calc-step space-y-2">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：列出算式</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-arc-q3-1" class="calc-input" aria-label="圓周長"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-arc-q3-2" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-arc-q3-3" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q3-btn-1" onclick="checkCalcStep(3, 'arc', 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查列式
                                    </button>
                                    <div id="q-calc-arc-q3-feedback-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 2: 化簡 -->
                            <div id="calc-arc-q3-step-2" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：化簡分數</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-arc-q3-4" class="calc-input" aria-label="圓周長(化簡)"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-arc-q3-5" class="calc-input" aria-label="分子(化簡)">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-arc-q3-6" class="calc-input" aria-label="分母(化簡)">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q3-btn-2" onclick="checkCalcStep(3, 'arc', 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查化簡
                                    </button>
                                    <div id="q-calc-arc-q3-feedback-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 3: 答案 -->
                            <div id="calc-arc-q3-step-3" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-arc-q3-7" class="calc-input w-16" aria-label="弧長答案"> $\pi$ 公分
                                </div>
                                <div class="text-center">
                                    <button id="calc-arc-q3-btn-3" onclick="checkCalcStep(3, 'arc', 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">
                                        檢查答案
                                    </button>
                                    <div id="q-calc-arc-q3-feedback-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                        </div>

                        <!-- (2) 面積 -->
                        <div class="w-full md:w-1/2 p-4 border border-gray-300 rounded-lg bg-gray-50 space-y-3">
                            <h3 class="text-xl font-semibold text-red-700 text-center">(2) 扇形面積</h3>
                            
                            <!-- 步驟 1: 列式 -->
                            <div id="calc-area-q3-step-1" class="calc-step space-y-2">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：列出算式</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-area-q3-1" class="calc-input" aria-label="圓面積"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-area-q3-2" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-area-q3-3" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q3-btn-1" onclick="checkCalcStep(3, 'area', 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查列式
                                    </button>
                                    <div id="q-calc-area-q3-feedback-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 2: 化簡 -->
                            <div id="calc-area-q3-step-2" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：化簡分數</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-area-q3-4" class="calc-input" aria-label="圓面積(化簡)"> ) $\times \pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-area-q3-5" class="calc-input" aria-label="分子(化簡)">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-area-q3-6" class="calc-input" aria-label="分母(化簡)">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q3-btn-2" onclick="checkCalcStep(3, 'area', 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">
                                        檢查化簡
                                    </button>
                                    <div id="q-calc-area-q3-feedback-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- 步驟 3: 答案 -->
                            <div id="calc-area-q3-step-3" class="calc-step hidden space-y-2 border-t pt-2">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-area-q3-7" class="calc-input w-16" aria-label="面積答案"> $\pi$ 平方公分
                                </div>
                                <div class="text-center">
                                    <button id="calc-area-q3-btn-3" onclick="checkCalcStep(3, 'area', 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">
                                        檢查答案
                                    </button>
                                    <div id="q-calc-area-q3-feedback-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <!-- 頁尾固定區塊 -->
    <footer class="fixed bottom-0 left-0 w-full text-center text-gray-400 text-sm bg-white bg-opacity-80 py-2 border-t border-gray-200 backdrop-blur-sm">
        © 2025 特教米克師｜採用
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="text-sky-600 hover:underline">
            CC BY-NC-SA 4.0 創用CC授權
        </a>｜非商業用途歡迎轉載或改編，請保留署名並附上原始連結。
    </footer>

    <script>
        // === (一) 定義題 ===
        
        // 正確答案
        const correctAnswers = {
            1: 'A',
            2: 'C',
            3: 'E',
            4: { a: 'D', b: 'G', c: 'F' },
            5: 'B'
        };

        // 下拉選單的選項
        const answerOptions = [
            { value: "", text: "請選擇代號..." },
            { value: "A", text: "(A) 直徑" },
            { value: "B", text: "(B) 弦" },
            { value: "C", text: "(C) 圓心角" },
            { value: "D", text: "(D) 弧" },
            { value: "E", text: "(E) 半徑" },
            { value: "F", text: "(F) 劣弧" },
            { value: "G", text: "(G) 優弧" }
        ];

        let currentStep = 1;

        // 頁籤切換邏輯
        function switchTab(tabNumber) {
            document.querySelectorAll('#tab-content > div').forEach(content => {
                content.classList.add('hidden');
            });
            document.querySelectorAll('#tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`content-${tabNumber}`).classList.remove('hidden');
            document.getElementById(`tab-${tabNumber}`).classList.add('active');
            currentStep = tabNumber;
        }

        // 檢查答案邏輯
        function checkAnswer(step) {
            const feedbackEl = document.getElementById(`q${step}-feedback`);
            let isCorrect = false;

            if (step === 4) {
                const ansA = document.getElementById('q4a-select').value;
                const ansB = document.getElementById('q4b-select').value;
                const ansC = document.getElementById('q4c-select').value;
                if (ansA === correctAnswers[4].a && ansB === correctAnswers[4].b && ansC === correctAnswers[4].c) {
                    isCorrect = true;
                }
            } else {
                const ans = document.getElementById(`q${step}-select`).value;
                if (ans === correctAnswers[step]) {
                    isCorrect = true;
                }
            }

            if (isCorrect) {
                feedbackEl.textContent = '太棒了！繼續加油～';
                feedbackEl.className = 'text-center h-6 text-lg text-green-600 font-semibold';
                document.getElementById(`q${step}-check`).disabled = true;
                document.getElementById(`q${step}-check`).classList.add('bg-gray-400', 'cursor-not-allowed');
                
                if (step === 4) {
                    document.getElementById('q4a-select').disabled = true;
                    document.getElementById('q4b-select').disabled = true;
                    document.getElementById('q4c-select').disabled = true;
                } else {
                    document.getElementById(`q${step}-select`).disabled = true;
                }

                const nextStep = step + 1;
                if (nextStep <= 5) {
                    document.getElementById(`tab-${nextStep}`).disabled = false;
                    document.getElementById(`tab-${nextStep}`).classList.remove('cursor-not-allowed', 'opacity-60');
                    setTimeout(() => {
                        switchTab(nextStep);
                    }, 1000);
                } else {
                    document.getElementById('completion-message').classList.remove('hidden');
                }
            } else {
                feedbackEl.textContent = '再想一想喔！提示：看看選項區和圖形。';
                feedbackEl.className = 'text-center h-6 text-lg text-red-500 font-semibold';
            }
        } 

        // 幫已啟用的頁籤加上點擊事件 (用於複習)
        document.querySelectorAll('#tabs .tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (!btn.disabled) {
                    switchTab(btn.dataset.tab);
                }
            });
        });

        // === [新] (一) 和 (二) 共用 ===

        // [新] 概念切換邏輯
        function switchConcept(conceptNumber) {
            if (conceptNumber === 1) {
                document.getElementById('concept-1-content').classList.remove('hidden');
                document.getElementById('concept-2-content').classList.add('hidden');
                document.getElementById('concept-btn-1').classList.add('active');
                document.getElementById('concept-btn-2').classList.remove('active');
            } else if (conceptNumber === 2) {
                document.getElementById('concept-1-content').classList.add('hidden');
                document.getElementById('concept-2-content').classList.remove('hidden');
                document.getElementById('concept-btn-1').classList.remove('active');
                document.getElementById('concept-btn-2').classList.add('active');
            }
        }

        // === (二) 計算題 ===

        // [擴充] 第二部分：計算題的正確 *列式* 答案 (字串)
        const correctFormulaAnswers = {
            // 弧長 Q1 (r=4, a=135)
            'calc-arc-q1-1': '8',     // 2 * 4
            'calc-arc-q1-2': '135',
            'calc-arc-q1-3': '360',
            'calc-arc-q1-4': '8',     // 8
            'calc-arc-q1-5': '3',     // 135/360 = 3/8
            'calc-arc-q1-6': '8',
            'calc-arc-q1-7': '3',     // 8 * 3/8 = 3
            
            // 面積 Q1 (r=4, a=135)
            'calc-area-q1-1': '16',   // 4 * 4
            'calc-area-q1-2': '135',
            'calc-area-q1-3': '360',
            'calc-area-q1-4': '16',   // 16
            'calc-area-q1-5': '3',    // 3/8
            'calc-area-q1-6': '8',
            'calc-area-q1-7': '6',    // 16 * 3/8 = 6

            // [新] 弧長 Q2 (r=6, a=120)
            'calc-arc-q2-1': '12',    // 2 * 6
            'calc-arc-q2-2': '120',
            'calc-arc-q2-3': '360',
            'calc-arc-q2-4': '12',    // 12
            'calc-arc-q2-5': '1',     // 120/360 = 1/3
            'calc-arc-q2-6': '3',
            'calc-arc-q2-7': '4',     // 12 * 1/3 = 4
            
            // [新] 面積 Q2 (r=6, a=120)
            'calc-area-q2-1': '36',   // 6 * 6
            'calc-area-q2-2': '120',
            'calc-area-q2-3': '360',
            'calc-area-q2-4': '36',   // 36
            'calc-area-q2-5': '1',    // 1/3
            'calc-area-q2-6': '3',
            'calc-area-q2-7': '12',   // 36 * 1/3 = 12

            // [新] 弧長 Q3 (r=18, a=100)
            'calc-arc-q3-1': '36',    // 2 * 18
            'calc-arc-q3-2': '100',
            'calc-arc-q3-3': '360',
            'calc-arc-q3-4': '36',    // 36
            'calc-arc-q3-5': '5',     // 100/360 = 10/36 = 5/18
            'calc-arc-q3-6': '18',
            'calc-arc-q3-7': '10',    // 36 * 5/18 = 10
            
            // [新] 面積 Q3 (r=18, a=100)
            'calc-area-q3-1': '324',  // 18 * 18
            'calc-area-q3-2': '100',
            'calc-area-q3-3': '360',
            'calc-area-q3-4': '324',  // 324
            'calc-area-q3-5': '5',    // 5/18
            'calc-area-q3-6': '18',
            'calc-area-q3-7': '90'    // 324 * 5/18 = 18 * 5 = 90
        };

        // [擴充] 追蹤計算進度
        let calcProgress = {
            'arc-q1': 1, 'area-q1': 1,
            'arc-q2': 1, 'area-q2': 1,
            'arc-q3': 1, 'area-q3': 1,
        };
        
        // [升級] 第二部分：分步驟檢查計算題
        function checkCalcStep(qNum, type, step) {
            // qNum: 1, 2, or 3
            // type: 'arc' or 'area'
            // step: 1, 2, or 3
            
            const fullType = `${type}-q${qNum}`; // e.g., "arc-q2"
            
            let fieldsToCheck = [];
            let isStepCorrect = true;
            
            // 1. 決定要檢查哪些欄位
            if (step === 1) {
                fieldsToCheck = [`calc-${fullType}-1`, `calc-${fullType}-2`, `calc-${fullType}-3`];
            } else if (step === 2) {
                fieldsToCheck = [`calc-${fullType}-4`, `calc-${fullType}-5`, `calc-${fullType}-6`];
            } else if (step === 3) {
                fieldsToCheck = [`calc-${fullType}-7`];
            }
            
            const feedbackEl = document.getElementById(`q-calc-${fullType}-feedback-${step}`);
            
            // 2. 檢查欄位
            fieldsToCheck.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                el.classList.remove('correct', 'incorrect');
                
                const answerKey = id.replace(`calc-${type}-q${qNum}-`, `calc-${type}-q${qNum}-`);
                
                if (el.value.trim() === correctFormulaAnswers[id]) {
                    el.classList.add('correct');
                } else {
                    el.classList.add('incorrect');
                    isStepCorrect = false;
                }
            });

            // 3. 處理檢查結果
            if (isStepCorrect) {
                feedbackEl.textContent = '太棒了！答對了！';
                feedbackEl.className = 'h-4 text-sm mt-1 text-green-600 font-semibold';
                
                // 鎖定本步驟的輸入框和按鈕
                fieldsToCheck.forEach(id => document.getElementById(id).disabled = true);
                document.getElementById(`calc-${fullType}-btn-${step}`).disabled = true;

                // 更新進度
                calcProgress[fullType] = step + 1;

                // 解鎖下一步
                const nextStep = step + 1;
                if (nextStep <= 3) {
                    document.getElementById(`calc-${fullType}-step-${nextStep}`).classList.remove('hidden');
                }
                
                // 檢查是否兩邊都完成了
                if (calcProgress['arc-q1'] > 3 && calcProgress['area-q1'] > 3 &&
                    calcProgress['arc-q2'] > 3 && calcProgress['area-q2'] > 3 &&
                    calcProgress['arc-q3'] > 3 && calcProgress['area-q3'] > 3) {
                    // (可以考慮在這裡加入一個"全部計算完成"的訊息)
                }

            } else {
                feedbackEl.textContent = '噢！再檢查看看紅色的格子！';
                feedbackEl.className = 'h-4 text-sm mt-1 text-red-500 font-semibold';
            }
        }
        

        // === 頁面載入時執行 ===
        document.addEventListener('DOMContentLoaded', () => {
            // (一) 動態填入所有下拉選單的選項
            const allSelects = document.querySelectorAll('.answer-select');
            allSelects.forEach(select => {
                answerOptions.forEach(opt => {
                    const optionEl = document.createElement('option');
                    optionEl.value = opt.value;
                    optionEl.textContent = opt.text;
                    select.appendChild(optionEl);
                });
            });

            // (二) 執行 KaTeX 渲染
            try {
                if (typeof renderMathInElement === 'function') {
                    renderMathInElement(document.body, {
                        delimiters: [
                            {left: '$', right: '$', display: false},
                            {left: '$$', right: '$$', display: true}
                        ],
                        throwOnError: false
                    });
                } else {
                    // [修正] 如果 renderMathInElement 尚未載入，稍後重試
                    setTimeout(() => {
                        try {
                            renderMathInElement(document.body, {
                                delimiters: [
                                    {left: '$', right: '$', display: false},
                                    {left: '$$', right: '$$', display: true}
                                ],
                                throwOnError: false
                            });
                        } catch (e) { console.error("KaTeX 重試渲染失敗:", e); }
                    }, 100);
                }
            } catch (error) {
                console.error("KaTeX 渲染失敗:", error);
            }
        });

    </script>
</body>
</html>