<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三、同類項</title>
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 1024px;
        }
        .term-item {
            cursor: pointer;
            padding: 0.5rem 1rem;
            background-color: #fff;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
            user-select: none;
        }
        .term-item:not(.matched):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .term-item.selected {
            background-color: #d1e2ff;
            border-color: #3b82f6;
        }
        .term-item.matched {
            background-color: #dcfce7;
            border-color: #22c55e;
            cursor: not-allowed;
        }
        .button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: all 0.2s;
            cursor: pointer;
        }
        .next-button {
            background-color: #3b82f6;
            color: white;
        }
        .next-button:hover {
            background-color: #2563eb;
        }
        #lines-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* --- 響應式設計 (Responsive Design) --- */
@media (max-width: 767px) {
    /* 1. 維持兩欄佈局 */
    .flex.flex-col.md\:flex-row {
        flex-direction: row !important; /* 強制橫向排列 */
        gap: 0.5rem; /* 設定欄位間距 */
    }
    .w-full.md\:w-1\/2 {
        width: 50%; /* 設定每欄寬度為 50% */
    }
    .space-y-8 > :not([hidden]) ~ :not([hidden]) {
        margin-top: 0; /* 移除原本垂直堆疊的間距 */
    }

    /* 2. 縮小內容以適應窄欄位 */
    .term-item {
        padding: 0.5rem 0.25rem; /* 縮小方塊內部邊距 */
        font-size: 0.8rem;      /* 縮小字體 */
        margin: 0.4rem auto;    /* 修改為 auto 以水平置中 */
        width: 15%;             /* 【修改處】設定寬度，讓按鈕變窄 */
    }
    #left-terms, #right-terms {
        max-width: 100%;
    }

    /* 3. 縮小按鈕 */
    .next-button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }

    /* 4. 調整整體間距與字體 */
    .container {
        padding: 0.1rem;
    }
    h1.text-3xl {
        font-size: 1.25rem;
    }
    .text-xl {
        font-size: 1rem;
    }
    p#message.text-lg {
        font-size: 0.875rem;
    }
}
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="container bg-white p-8 md:p-12 rounded-xl shadow-2xl space-y-8 relative">
        <canvas id="lines-canvas"></canvas>
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 z-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">多項式連連看</h1>
            <div class="mt-4 md:mt-0 text-xl font-bold text-gray-700">分數: <span id="score">0</span> / <span id="total-problems">0</span></div>
        </div>

        <p id="message" class="text-center text-lg font-bold text-gray-700 mt-2 md:mt-0 z-10">將左側與右側的同類項連起來。</p>

        <div class="flex flex-col md:flex-row space-y-8 md:space-y-0 md:space-x-8 mt-8 z-10">
            
            <div class="w-full md:w-1/2 flex flex-col space-y-4 items-end">
                <div id="left-terms" class="flex flex-col w-full max-w-sm"></div>
            </div>

            <div class="w-full md:w-1/2 flex flex-col space-y-4 items-start">
                <div id="right-terms" class="flex flex-col w-full max-w-sm"></div>
            </div>
        </div>
        
        <div class="flex justify-center mt-8 z-10">
            <button id="next-button" class="button next-button">重新開始</button>
        </div>

    </div>

    <script>
        const problems = [
            {
                left: [
                    { term: "5x²", kind: "x²" },
                    { term: "½x", kind: "x" },
                    { term: "2x³", kind: "x³" },
                    { term: "-17", kind: "constant" }
                ],
                right: [
                    { term: "13x³", kind: "x³" },
                    { term: "5", kind: "constant" },
                    { term: "-x²", kind: "x²" },
                    { term: "8x", kind: "x" }
                ]
            },
            {
                left: [
                    { term: "9x", kind: "x" },
                    { term: "3x³", kind: "x³" },
                    { term: "-x²", kind: "x²" },
                    { term: "3/7", kind: "constant" }
                ],
                right: [
                    { term: "x³", kind: "x³" },
                    { term: "5x", kind: "x" },
                    { term: "-1", kind: "constant" },
                    { term: "2/3x²", kind: "x²" }
                ]
            },
            {
                left: [
                    { term: "-23", kind: "constant" },
                    { term: "17x", kind: "x" },
                    { term: "0.5x³", kind: "x³" },
                    { term: "8/11x²", kind: "x²" }
                ],
                right: [
                    { term: "71x", kind: "x" },
                    { term: "-x³", kind: "x³" },
                    { term: "0.8x²", kind: "x²" },
                    { term: "0", kind: "constant" }
                ]
            }
        ];

        const leftTermsContainer = document.getElementById('left-terms');
        const rightTermsContainer = document.getElementById('right-terms');
        const nextButton = document.getElementById('next-button');
        const messageDisplay = document.getElementById('message');
        const scoreDisplay = document.getElementById('score');
        const totalProblemsDisplay = document.getElementById('total-problems');
        const canvas = document.getElementById('lines-canvas');
        const ctx = canvas.getContext('2d');
        
        let currentProblemIndex = -1;
        let score = 0;
        let selectedTerm = null;
        let matchedPairs = 0;
        let matched = [];

        // Function to create a term element
        function createTermElement(termObj, side) {
            const div = document.createElement('div');
            div.className = 'term-item rounded-lg w-full ' + side;
            div.textContent = termObj.term;
            div.dataset.kind = termObj.kind;
            div.dataset.id = termObj.term;
            div.addEventListener('click', () => handleTermClick(div));
            return div;
        }

        // Handle clicks on term items
        function handleTermClick(element) {
            if (element.classList.contains('matched')) {
                return;
            }

            if (selectedTerm) {
                // If a term is already selected, check for a match
                const leftSideTerm = selectedTerm.classList.contains('left-side') ? selectedTerm : element;
                const rightSideTerm = element.classList.contains('right-side') ? element : selectedTerm;

                if (leftSideTerm.dataset.kind === rightSideTerm.dataset.kind) {
                    // Correct match
                    leftSideTerm.classList.add('matched');
                    rightSideTerm.classList.add('matched');
                    
                    matched.push({
                        left: leftSideTerm,
                        right: rightSideTerm
                    });
                    matchedPairs++;
                    drawLines();
                    messageDisplay.textContent = '配對成功！';

                    if (matchedPairs === problems[currentProblemIndex].left.length) {
                        score++;
                        scoreDisplay.textContent = score;
                        messageDisplay.textContent = '恭喜您！本題全部配對正確！';
                        setTimeout(loadProblem, 1500); // Automatically move to next problem
                    }
                } else {
                    messageDisplay.textContent = '配對錯誤，請再試一次。';
                }

                selectedTerm.classList.remove('selected');
                selectedTerm = null;

            } else {
                // Select the term
                messageDisplay.textContent = '請選擇另一側的同類項。';
                element.classList.add('selected');
                selectedTerm = element;
            }
        }
        
        // Function to load a new problem
        function loadProblem() {
            if (currentProblemIndex >= problems.length - 1) {
                endQuiz();
                return;
            }
            
            currentProblemIndex++;
            matchedPairs = 0;
            matched = [];
            selectedTerm = null;
            messageDisplay.textContent = '將左側與右側的同類項連起來。';

            leftTermsContainer.innerHTML = '';
            rightTermsContainer.innerHTML = '';
            
            const currentProblem = problems[currentProblemIndex];
            totalProblemsDisplay.textContent = problems.length;

            // Shuffle terms to make it a new challenge each time
            const shuffledLeft = [...currentProblem.left].sort(() => Math.random() - 0.5);
            const shuffledRight = [...currentProblem.right].sort(() => Math.random() - 0.5);

            shuffledLeft.forEach(term => {
                leftTermsContainer.appendChild(createTermElement(term, 'left-side'));
            });
            shuffledRight.forEach(term => {
                rightTermsContainer.appendChild(createTermElement(term, 'right-side'));
            });

            drawLines(); // Initial drawing
        }

        // Draw connecting lines on the canvas
        function drawLines() {
            // A short delay to allow the DOM to update before getting element positions
            setTimeout(() => {
                if (!canvas.offsetParent) return; // Don't draw if canvas is not visible
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                const canvasRect = canvas.getBoundingClientRect();

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.lineWidth = 4;
                ctx.strokeStyle = '#22c55e';
                ctx.lineCap = 'round';
                
                matched.forEach(pair => {
                    const leftRect = pair.left.getBoundingClientRect();
                    const rightRect = pair.right.getBoundingClientRect();
                    
                    const startX = leftRect.right - canvasRect.left;
                    const startY = leftRect.top + leftRect.height / 2 - canvasRect.top;
                    const endX = rightRect.left - canvasRect.left;
                    const endY = rightRect.top + rightRect.height / 2 - canvasRect.top;

                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                });
            }, 50); // 50ms delay
        }
        
        // Handle window resize to redraw canvas
        window.addEventListener('resize', drawLines);
        
        // Handle end of quiz
        function endQuiz() {
            messageDisplay.innerHTML = `挑戰完成！<br>您的總分是：<span class="text-blue-600">${score} / ${problems.length}</span>`;
            leftTermsContainer.innerHTML = '';
            rightTermsContainer.innerHTML = '';
            nextButton.textContent = '重新開始';
            nextButton.style.display = 'block';
        }

        // Handle button click
        nextButton.addEventListener('click', () => {
            if (currentProblemIndex >= problems.length - 1) {
                currentProblemIndex = -1;
                score = 0;
                scoreDisplay.textContent = score;
                nextButton.textContent = '下一題';
            }
            loadProblem();
        });

        // Initialize on page load
        window.onload = () => {
            loadProblem();
        };

    </script>
</body>
</html>