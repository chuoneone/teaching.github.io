<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WMNZ6FESH7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WMNZ6FESH7');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四、 平行線截比例線段性質的應用</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .step-container {
            transition: all 0.5s ease-in-out;
        }
        .step-locked {
            opacity: 0.4;
            pointer-events: none;
        }
        .feedback-message {
            transition: opacity 0.3s;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 500;
        }
        .feedback-correct {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .feedback-incorrect {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .diagram-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin: 1rem auto;
            aspect-ratio: 4 / 3;
            background: linear-gradient(180deg, #e0f2fe 0%, #f0f9ff 100%);
            border-radius: 1rem;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }
        .parallel-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background-color: #94a3b8;
            left: 0;
        }
        .transversal {
            position: absolute;
            width: 4px;
            background-color: #334155;
            border-radius: 2px;
        }
        .diagram-label {
            position: absolute;
            font-weight: bold;
            color: #1f2937;
            font-size: 1.1rem;
        }
        .diagram-input {
            position: absolute;
            width: 65px;
            height: 40px;
            padding: 4px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            text-align: center;
            font-size: 1.1rem;
            transition: all 0.3s ease-in-out;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .highlight {
            background: linear-gradient(to top, #fef08a 60%, transparent 60%);
            padding: 0 0.2rem;
        }
        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .nav-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .nav-btn:not(.active) {
            background-color: #e5e7eb;
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        <!-- 題庫導覽 -->
        <div id="question-nav" class="flex justify-center items-center flex-wrap gap-2 mb-6 border-b pb-4">
            <!-- Nav buttons will be inserted by JS -->
        </div>

        <!-- 標題部分 -->
        <div class="text-center mb-8">
            <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-slate-800">四、 平行線截比例線段性質的應用</h1>
            <p class="text-slate-500 mt-2 text-lg">互動式練習</p>
        </div>

        <div class="flex flex-col md:flex-row md:space-x-8">
            <!-- 左半部: 題目與圖形 -->
            <div class="md:w-1/2">
                <div id="prompt-container" class="bg-slate-100 p-5 rounded-lg mb-6">
                    <p id="prompt-text" class="text-slate-700 leading-relaxed text-lg">
                        <!-- Prompt will be inserted by JS -->
                    </p>
                </div>

                <div id="diagram-step" class="step-container">
                    <h3 class="font-bold text-center text-xl text-slate-700 mb-2">🚀 步驟一：標示線段長度</h3>
                    <div class="diagram-container">
                        <!-- Parallel Lines -->
                        <div class="parallel-line" style="top: 15%;"></div>
                        <div class="parallel-line" style="top: 50%;"></div>
                        <div class="parallel-line" style="top: 85%;"></div>
                        
                        <!-- Transversals -->
                        <div class="transversal" style="height: 110%; top: -5%; left: 30%; transform: rotate(-10deg);"></div>
                        <div class="transversal" style="height: 110%; top: -5%; left: 70%; transform: rotate(10deg);"></div>

                        <!-- Labels -->
                        <div class="diagram-label" style="top: 8%; left: 24%;">A</div>
                        <div class="diagram-label" style="top: 43%; left: 27%;">B</div>
                        <div class="diagram-label" style="top: 78%; left: 30%;">C</div>
                        <div class="diagram-label" style="top: 8%; left: 74%;">D</div>
                        <div class="diagram-label" style="top: 43%; left: 71%;">E</div>
                        <div class="diagram-label" style="top: 78%; left: 68%;">F</div>
                        <div class="diagram-label text-slate-500" style="top: 10%; left: 5%;">L₁</div>
                        <div class="diagram-label text-slate-500" style="top: 45%; left: 5%;">L₂</div>
                        <div class="diagram-label text-slate-500" style="top: 80%; left: 5%;">L₃</div>

                        <!-- Input Fields -->
                        <input id="input-ab" type="text" placeholder="AB" class="diagram-input" style="left: 28%; top: 28%; transform: rotate(-10deg);">
                        <input id="input-bc" type="number" placeholder="BC" class="diagram-input" style="left: 31%; top: 63%; transform: rotate(-10deg);">
                        <input id="input-de" type="number" placeholder="DE" class="diagram-input" style="left: 63%; top: 28%; transform: rotate(10deg);">
                        <input id="input-ef" type="text" placeholder="EF" class="diagram-input" style="left: 60%; top: 63%; transform: rotate(10deg);">
                    </div>
                    <div class="text-center mt-4">
                         <button id="check-diagram-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">確認圖形</button>
                    </div>
                </div>
            </div>

            <!-- 右半部: 解題步驟 -->
            <div class="md:w-1/2 mt-8 md:mt-0 space-y-4">
                <div id="global-feedback" class="text-center h-12"></div>
                <div id="step1" class="step-container p-5 border rounded-lg step-locked">
                    <h3 class="font-bold text-xl text-slate-700 mb-2">🚀 步驟二：列出比例式</h3>
                    <p class="text-base text-slate-500 mb-4">口訣：<span class="font-bold text-red-500">左上:左下 = 右上:右下</span></p>
                    <div class="flex items-center justify-center space-x-2">
                        <input id="s1_1" type="text" placeholder="AB" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">:</span>
                        <input id="s1_2" type="number" placeholder="BC" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">=</span>
                        <input id="s1_3" type="number" placeholder="DE" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">:</span>
                        <input id="s1_4" type="text" placeholder="EF" class="w-20 p-2 border rounded text-center text-lg">
                    </div>
                     <div class="text-center mt-4"><button id="check-s1-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">檢查答案</button></div>
                </div>

                <div id="step2" class="step-container p-5 border rounded-lg step-locked">
                    <h3 class="font-bold text-xl text-slate-700 mb-2">🚀 步驟三：列出方程式</h3>
                    <p id="s2-hint" class="text-base text-slate-500 mb-4">利用「內項積 = 外項積」。</p>
                    <div class="flex items-center justify-center space-x-2">
                        <input id="s2_1" type="number" placeholder="?" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">x</span>
                        <span class="font-bold text-lg">=</span>
                        <input id="s2_2" type="number" placeholder="?" class="w-24 p-2 border rounded text-center text-lg">
                    </div>
                     <div class="text-center mt-4"><button id="check-s2-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">檢查答案</button></div>
                </div>
                
                <div id="step3" class="step-container p-5 border rounded-lg step-locked">
                    <h3 class="font-bold text-xl text-slate-700 mb-2">🚀 步驟四：解出 x</h3>
                    <p id="s3-hint" class="text-base text-slate-500 mb-4">化簡算式，求出 x 的值。</p>
                    <div class="flex flex-col items-center justify-center space-y-2 bg-slate-100 p-3 rounded">
                        <span id="s3-equation" class="font-mono text-xl"></span>
                        <div class="flex items-center space-x-2">
                            <span class="font-mono text-xl">x =</span>
                            <input id="s3_1" type="number" class="w-28 p-2 border rounded text-center font-bold text-lg" placeholder="最終答案">
                        </div>
                    </div>
                     <div class="text-center mt-4"><button id="check-s3-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">提交最終答案</button></div>
                </div>
            </div>
        </div>

        <div id="completion-message" class="text-center mt-8 p-6 bg-green-100 border-2 border-green-400 rounded-lg" style="display: none;">
            <h2 class="text-3xl font-bold text-green-700">恭喜你，完成練習！</h2>
            <p class="mt-2 text-green-600 text-lg">你已經掌握了這個概念！</p>
            <button id="reset-btn" class="mt-4 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">再做一次</button>
        </div>
    </div>

    <script>
        const questions = [
            {
                prompt: "如圖，L₁ // L₂ // L₃，若 <span class='highlight font-mono'>DE = 14</span>，<span class='highlight font-mono'>EF = 12</span>，<span class='highlight font-mono'>BC = 18</span>，求 <span class='font-mono'>AB</span>。",
                unknown: "ab",
                diagram: { de: "14", ef: "12", bc: "18" },
                step1: ["x", "18", "14", "12"],
                step2: ["12", "252"],
                step3: ["21"]
            },
            {
                prompt: "如圖，L₁ // L₂ // L₃，若 <span class='highlight font-mono'>AB = 16</span>，<span class='highlight font-mono'>BC = 28</span>，<span class='highlight font-mono'>DE = 24</span>，求 <span class='font-mono'>EF</span>。",
                unknown: "ef",
                diagram: { ab: "16", bc: "28", de: "24" },
                step1: ["16", "28", "24", "x"],
                step2: ["16", "672"],
                step3: ["42"]
            },
            {
                prompt: "如圖，L₁ // L₂ // L₃，若 <span class='highlight font-mono'>AB = 6</span>，<span class='highlight font-mono'>BC = 8</span>，<span class='highlight font-mono'>DE = 12</span>，求 <span class='font-mono'>EF</span>。",
                unknown: "ef",
                diagram: { ab: "6", bc: "8", de: "12" },
                step1: ["6", "8", "12", "x"],
                step2: ["6", "96"],
                step3: ["16"]
            },
            {
                prompt: "如圖，L₁ // L₂ // L₃，若 <span class='highlight font-mono'>AB = 7</span>，<span class='highlight font-mono'>BC = 14</span>，<span class='highlight font-mono'>DE = 28</span>，求 <span class='font-mono'>EF</span>。",
                unknown: "ef",
                diagram: { ab: "7", bc: "14", de: "28" },
                step1: ["7", "14", "28", "x"],
                step2: ["7", "392"],
                step3: ["56"]
            }
        ];
        let currentQuestionIndex = 0;

        const feedbackEl = document.getElementById('global-feedback');
        const diagramInputs = {
            ab: document.getElementById('input-ab'),
            bc: document.getElementById('input-bc'),
            de: document.getElementById('input-de'),
            ef: document.getElementById('input-ef')
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            const navContainer = document.getElementById('question-nav');
            questions.forEach((q, i) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.innerText = `第 ${i + 1} 題`;
                btn.onclick = () => loadQuestion(i);
                navContainer.appendChild(btn);
            });
            
            document.getElementById('check-diagram-btn').onclick = checkDiagram;
            document.getElementById('check-s1-btn').onclick = () => checkStep(1);
            document.getElementById('check-s2-btn').onclick = () => checkStep(2);
            document.getElementById('check-s3-btn').onclick = () => checkStep(3);
            document.getElementById('reset-btn').onclick = () => loadQuestion(currentQuestionIndex);
            
            document.querySelectorAll('input').forEach(input => {
                input.onkeydown = (event) => {
                    if (event.key === 'Enter') {
                        const parentButton = input.closest('.step-container, #diagram-step').querySelector('button');
                        if (parentButton && !parentButton.disabled) {
                           parentButton.click();
                        }
                    }
                };
            });
            loadQuestion(0);
        });

        function showFeedback(message, isCorrect) {
            feedbackEl.innerHTML = `<div class="feedback-message ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}">${message}</div>`;
            setTimeout(() => { feedbackEl.innerHTML = ''; }, 2500);
        }

        function setStepLock(stepId, locked) {
            const step = document.getElementById(stepId);
            step.classList.toggle('step-locked', locked);
            step.querySelectorAll('input, button').forEach(el => el.disabled = locked);
            if (!locked) {
                const firstInput = step.querySelector('input:not([readonly])');
                if (firstInput) firstInput.focus();
            }
        }
        
        function loadQuestion(index) {
            currentQuestionIndex = index;
            const q = questions[index];
            document.querySelectorAll('#question-nav .nav-btn').forEach((btn, i) => btn.classList.toggle('active', i === index));
            document.getElementById('prompt-text').innerHTML = `<strong>題目：</strong>${q.prompt}(令未知數為 x)`;
            
            // Update step hints
            const s1_text = `${q.step1[0]} : ${q.step1[1]} = ${q.step1[2]} : ${q.step1[3]}`;
            document.getElementById('s2-hint').innerHTML = `根據 <span class="font-mono">${s1_text}</span>，利用「內項積 = 外項積」。`;
            const s2_text = `${q.step2[0]}x = ${q.step2[1]}`;
            document.getElementById('s3-hint').innerHTML = `化簡算式 <span class="font-mono">${s2_text}</span>，求出 x 的值。`;
            document.getElementById('s3-equation').innerText = s2_text;
            
            resetExercise();
        }

        function resetExercise() {
            ['diagram-step', 'step1', 'step2', 'step3'].forEach((id, i) => setStepLock(id, i !== 0));
            document.getElementById('completion-message').style.display = 'none';
            
            // Clear ALL inputs from all sections
            document.querySelectorAll('#diagram-step input, #step1 input, #step2 input, #step3 input').forEach(input => {
                input.value = '';
                input.classList.remove('border-2', 'border-green-500', 'bg-green-100');
            });

            const q = questions[currentQuestionIndex];
            Object.keys(diagramInputs).forEach(key => {
                const input = diagramInputs[key];
                input.readOnly = false;
                input.classList.remove('font-bold', 'text-blue-600');
                input.placeholder = key.toUpperCase();
                
                if(q.unknown === key) {
                    input.type = "text";
                    input.classList.add('font-bold', 'text-blue-600');
                } else {
                    input.type = "number";
                }
            });
            
            showFeedback(`第 ${currentQuestionIndex + 1} 題載入完成`, true);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function checkDiagram() {
            const q = questions[currentQuestionIndex];
            let isCorrect = true;
            // Check known values
            for (const key in q.diagram) {
                if (diagramInputs[key].value.trim() !== q.diagram[key]) {
                    isCorrect = false;
                    break;
                }
            }
            // Check if user correctly entered 'x' for the unknown value
            if (isCorrect && diagramInputs[q.unknown].value.trim().toLowerCase() !== 'x') {
                isCorrect = false;
            }

            if (isCorrect) {
                showFeedback('圖形標示正確！請開始計算。', true);
                setStepLock('diagram-step', true);
                document.getElementById('diagram-step').classList.remove('step-locked');
                setStepLock('step1', false);
            } else {
                showFeedback('圖形中的數字或變數(x)不對喔，請再對照一次題目。', false);
            }
        }
        
        function checkStep(stepNum) {
            const stepId = `step${stepNum}`;
            const q = questions[currentQuestionIndex];
            const correct = q[`step${stepNum}`];
            const inputs = document.querySelectorAll(`#${stepId} input`);
            const userValues = Array.from(inputs).map(el => el.value.trim().toLowerCase());

            if (JSON.stringify(userValues) === JSON.stringify(correct)) {
                showFeedback(`步驟 ${stepNum + 1} 正確！`, true);
                setStepLock(stepId, true);
                document.getElementById(stepId).classList.remove('step-locked');

                if (stepNum < 3) {
                   setStepLock(`step${stepNum + 1}`, false);
                } else { 
                   document.getElementById('completion-message').style.display = 'block';
                   const finalAnswer = q.step3[0];
                   const unknownInput = diagramInputs[q.unknown];
                   unknownInput.value = finalAnswer;
                   unknownInput.classList.add('border-2', 'border-green-500', 'bg-green-100');
                   document.getElementById('completion-message').scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            } else {
                showFeedback('答案有誤，請再檢查一次。', false);
            }
        }
    </script>
</body>
</html>

