<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´è§’ä¸‰è§’å½¢å…§åˆ‡åœ“äº’å‹•è§£é¡Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ğŸ¨ å…¨åŸŸè¨­å®š */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            /* é˜²æ­¢ iOS å½ˆæ€§æ²å‹•æ•ˆæœå¹²æ“¾æ“ä½œ */
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™æ²å‹•åŠŸèƒ½ (Chrome/Safari/Opera) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* (IE, Edge and Firefox) */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* ğŸ”¢ æ•¸å­¸å¼æ¨£å¼ */
        .math-text {
            font-size: 1.35rem;
            font-weight: 700;
            color: #1e3a8a;
            display: inline-flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            line-height: 2.5rem;
        }

        /* ğŸ”² å¡«ç­”æ ¼ Slot */
        .slot {
            width: 3.5rem;
            height: 3.5rem;
            border: 3px dashed #94a3b8;
            background-color: #ffffff;
            border-radius: 0.75rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #334155;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            margin: 0 2px;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
        }

        .slot:hover {
            border-color: #60a5fa;
            background-color: #f8fafc;
        }

        .slot.filled {
            border-style: solid;
            border-color: #3b82f6;
            background-color: #eff6ff;
            color: #1d4ed8;
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2);
        }

        .slot.correct {
            border-color: #22c55e;
            background-color: #dcfce7;
            color: #15803d;
            border-style: solid;
        }

        /* ğŸ”˜ é¸é …æŒ‰éˆ• */
        .option-btn {
            background-color: #ffffff;
            border: 2px solid #3b82f6;
            color: #1d4ed8;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.1s active;
            user-select: none;
            min-width: 4rem;
            text-align: center;
            touch-action: manipulation;
        }

        .option-btn:active {
            transform: scale(0.95);
            background-color: #eff6ff;
        }

        .option-btn:disabled {
            background-color: #f1f5f9;
            border-color: #cbd5e1;
            color: #94a3b8;
            cursor: default;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }

        /* ğŸ“„ æ­¥é©Ÿå¡ç‰‡ */
        .step-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem; /* å¢åŠ é–“è· */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 6px solid #cbd5e1;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.4;
            filter: grayscale(0.8);
            pointer-events: none;
            transform: translateY(20px);
        }

        .step-card.active {
            border-left-color: #3b82f6;
            opacity: 1;
            filter: grayscale(0);
            pointer-events: auto;
            transform: translateY(0);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .step-card.completed {
            border-left-color: #22c55e;
            opacity: 0.9;
            background-color: #f0fdf4;
            transform: translateY(0);
        }

        .step-card.completed .options-wrapper {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            margin-top: 0;
            transition: all 0.5s ease;
        }

        /* ğŸ‰ å‹•ç•«æ•ˆæœ */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes tada {
            0% { transform: scale(1); }
            10%, 20% { transform: scale(0.9) rotate(-3deg); }
            30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
            40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
            100% { transform: scale(1) rotate(0); }
        }
        
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-tada { animation: tada 1s ease-in-out; }

        /* ğŸ“± å°è¦½åˆ—å„ªåŒ– */
        .nav-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .nav-scroll::-webkit-scrollbar {
            display: none;
        }

        /* SVG æ¨£å¼ */
        .svg-text {
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 700;
            paint-order: stroke;
            stroke: white;
            stroke-width: 3px;
        }
    </style>
</head>
<body class="h-[100dvh] flex flex-col text-slate-800 overflow-hidden">

    <!-- é ‚éƒ¨å°è¦½åˆ— -->
    <nav class="bg-white shadow-sm z-30 flex-none relative">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center h-16 px-4">
                <div class="flex-shrink-0 mr-4 flex items-center gap-2">
                    <span class="bg-blue-600 text-white p-1.5 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    </span>
                    <span class="font-bold text-lg text-slate-700 hidden sm:block">å¹¾ä½•è§£é¡Œ</span>
                </div>
                
                <!-- å¯æ»‘å‹•çš„é¡Œç›®æŒ‰éˆ•å€ -->
                <div class="flex-1 overflow-x-auto nav-scroll">
                    <div id="nav-buttons" class="flex gap-2 py-2 pr-4 min-w-max">
                        <!-- JS ç”ŸæˆæŒ‰éˆ• -->
                    </div>
                </div>
            </div>
        </div>
        <!-- é™°å½±é®ç½©ï¼Œæç¤ºå¯æ»‘å‹• -->
        <div class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white to-transparent pointer-events-none sm:hidden"></div>
    </nav>

    <!-- ä¸»å…§å®¹å€ -->
    <main class="flex-1 overflow-hidden relative w-full max-w-7xl mx-auto flex flex-col md:flex-row">
        
        <!-- å·¦å´ï¼šé¡Œç›®èˆ‡åœ–å½¢ (æ‰‹æ©Ÿç½®é ‚ï¼Œæ¡Œæ©Ÿé å·¦) -->
        <section class="
            flex-none z-20 bg-slate-50 border-b md:border-b-0 md:border-r border-slate-200 shadow-sm
            h-auto max-h-[45vh] md:h-full md:max-h-none md:w-5/12 lg:w-4/12
            flex flex-col
        ">
            <div class="flex-1 overflow-y-auto custom-scrollbar p-5">
                <div class="mb-4">
                    <h2 class="text-xl font-bold text-slate-800 flex items-center mb-2">
                        <span class="w-2 h-8 bg-blue-500 rounded-full mr-3"></span>
                        <span id="problem-title">é¡Œç›®è¼‰å…¥ä¸­...</span>
                    </h2>
                    <p id="problem-desc" class="text-lg text-slate-600 leading-relaxed font-medium pl-5">
                        <!-- é¡Œç›®æ•˜è¿° -->
                    </p>
                </div>

                <!-- SVG å®¹å™¨ -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4 mb-4 flex justify-center items-center relative overflow-hidden group">
                    <!-- èƒŒæ™¯è£é£¾ -->
                    <div class="absolute inset-0 bg-grid-slate-50 [mask-image:linear-gradient(0deg,white,rgba(255,255,255,0.6))]"></div>
                    
                    <svg width="260" height="220" viewBox="0 0 260 220" class="relative z-10 transition-transform duration-500 group-hover:scale-105">
                        <defs>
                            <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#94a3b8" />
                            </marker>
                        </defs>
                        <!-- ç›´è§’ä¸‰è§’å½¢ -->
                        <path d="M50,190 L210,190 L50,30 Z" fill="#f1f5f9" stroke="#334155" stroke-width="4" stroke-linejoin="round" class="drop-shadow-md"/>
                        <!-- ç›´è§’ç¬¦è™Ÿ -->
                        <path d="M50,170 L70,170 L70,190" fill="none" stroke="#64748b" stroke-width="2"/>
                        
                        <!-- é‚Šé•·æ¨™ç±¤ (å‹•æ…‹) -->
                        <text id="label-h" x="35" y="110" text-anchor="end" class="svg-text" font-size="22" fill="#e11d48">AB</text>
                        <text id="label-w" x="130" y="215" text-anchor="middle" class="svg-text" font-size="22" fill="#e11d48">BC</text>
                        <text id="label-hyp" x="140" y="100" text-anchor="start" class="svg-text" font-size="22" fill="#059669">AC</text>
                    </svg>
                </div>

                <!-- é‡é»æç¤ºå¡ç‰‡ -->
                <div class="bg-amber-50 border border-amber-200 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="text-sm font-bold text-amber-800">è§£é¡Œå…¬å¼æç¤º</span>
                    </div>
                    <div class="text-center">
                        <div class="inline-block bg-white px-4 py-2 rounded-lg border border-amber-100 shadow-sm">
                            <span class="font-bold text-slate-700 text-lg">
                                (<span class="text-blue-600">è‚¡</span>ï¼‹<span class="text-blue-600">è‚¡</span>ï¼<span class="text-green-600">æ–œé‚Š</span>) Ã· 2 ï¼ <span class="text-red-600">åŠå¾‘</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å³å´ï¼šäº’å‹•æ­¥é©Ÿå€ -->
        <section class="flex-1 bg-white relative h-full overflow-hidden flex flex-col">
            <!-- æ¼¸å±¤é®ç½© (ä¸Šæ–¹) -->
            <div class="absolute top-0 left-0 right-0 h-4 bg-gradient-to-b from-white to-transparent z-10"></div>
            
            <div id="steps-container" class="flex-1 overflow-y-auto scroll-smooth custom-scrollbar p-4 md:p-8 pb-32">
                <div id="steps-wrapper" class="max-w-2xl mx-auto space-y-6">
                    <!-- æ­¥é©Ÿå¡ç‰‡å°‡ç”±æ­¤è™•å‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <!-- åº•éƒ¨ç•™ç™½ï¼Œç¢ºä¿æœ€å¾Œä¸€æ­¥ä¸è¢«é®æ“‹ -->
                <div class="h-24"></div>
            </div>
        </section>

    </main>

    <!-- âœ… å®Œæˆè¦–çª— -->
    <div id="completion-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- èƒŒæ™¯é®ç½© -->
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity opacity-0" id="modal-backdrop"></div>
        
        <!-- å…§å®¹å¡ç‰‡ -->
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full mx-4 shadow-2xl transform scale-90 opacity-0 transition-all duration-300 relative z-10 flex flex-col items-center text-center" id="modal-content">
            
            <!-- è£é£¾èƒŒæ™¯ -->
            <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-blue-50 to-transparent rounded-t-3xl -z-10"></div>

            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 shadow-inner animate-tada">
                <svg class="w-14 h-14 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
            </div>
            
            <h3 class="text-3xl font-bold text-slate-800 mb-3" id="modal-title">å¤ªæ£’äº†ï¼ğŸ‰</h3>
            <p class="text-slate-600 mb-8 text-lg font-medium">ä½ å·²ç¶“æˆåŠŸç®—å‡ºå…§åˆ‡åœ“çš„åŠå¾‘å›‰ï¼</p>
            
            <div class="flex flex-col gap-3 w-full">
                <button onclick="resetCurrentProblem()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 px-6 rounded-2xl transition-all shadow-lg shadow-blue-200 active:scale-95 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    å†åšä¸€æ¬¡
                </button>
                <button onclick="closeModal()" class="w-full bg-white border-2 border-slate-200 hover:bg-slate-50 text-slate-700 font-bold py-3.5 px-6 rounded-2xl transition-all active:scale-95">
                    é—œé–‰è¦–çª—ï¼ŒæŸ¥çœ‹çµæœ
                </button>
            </div>
        </div>
    </div>

    <!-- ğŸµ éŸ³æ•ˆ (ä½¿ç”¨ Base64 Data URI é¿å…å¤–éƒ¨ä¾è³´) -->
    <!-- ç‚ºäº†ä¿æŒå–®ä¸€æª”æ¡ˆï¼Œé€™è£¡çœç•¥å¯¦éš›éŸ³æª”ï¼Œæ”¹ç”¨è¦–è¦ºå›é¥‹ -->

    <script>
        /**
         * ğŸ“š é¡Œç›®è³‡æ–™åº«
         * åŒ…å«é¡Œç›®æ•˜è¿°ã€æ•¸å€¼èˆ‡è§£é¡Œæ­¥é©Ÿé‚è¼¯
         */
        const problems = [
            {
                id: 1,
                title: "é¡Œç›®ä¸€",
                desc: "ç›´è§’ä¸‰è§’å½¢ ABC ä¸­ï¼ŒAB=6ï¼ŒBC=8ï¼ŒAC=10ï¼Œæ±‚å…§åˆ‡åœ“åŠå¾‘ï¼Ÿ",
                labels: { h: 6, w: 8, hyp: 10 },
                steps: [
                    {
                        instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºå…©è‚¡ï¼ˆç›´è§’é‚Šï¼‰çš„é•·åº¦",
                        template: `<div class="math-text">å…©è‚¡æ˜¯ <div class="slot" data-idx="0"></div> å’Œ <div class="slot" data-idx="1"></div></div>`,
                        options: [6, 8, 10],
                        correctSet: [6, 8], // é †åºä¸æ‹˜
                        slots: 2
                    },
                    {
                        instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾å‡ºæ–œé‚Šï¼ˆæœ€é•·é‚Šï¼‰çš„é•·åº¦",
                        template: `<div class="math-text">æ–œé‚Šæ˜¯ <div class="slot" data-idx="0"></div></div>`,
                        options: [6, 8, 10],
                        correct: [10],
                        slots: 1
                    },
                    {
                        instruction: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— ( å…©è‚¡å’Œ - æ–œé‚Š )",
                        template: `<div class="math-text">( <div class="slot" data-idx="0"></div> + <div class="slot" data-idx="1"></div> ) - <div class="slot" data-idx="2"></div> = <div class="slot" data-idx="3"></div></div>`,
                        options: [6, 8, 10, 4, 14],
                        // è‡ªè¨‚é‚è¼¯ï¼šå‰å…©å€‹å¿…é ˆæ˜¯è‚¡ï¼Œç¬¬ä¸‰å€‹æ˜¯æ–œé‚Šï¼Œç¬¬å››å€‹æ˜¯é‹ç®—çµæœ
                        logicCheck: (inputs) => {
                            const legs = [inputs[0], inputs[1]].sort((a,b)=>a-b);
                            return (legs[0] == 6 && legs[1] == 8 && inputs[2] == 10 && inputs[3] == 4);
                        },
                        slots: 4
                    },
                    {
                        instruction: "æ­¥é©Ÿ 4ï¼šç®—å‡ºåŠå¾‘ ( ä¸Šä¸€æ­¥çµæœ Ã· 2 )",
                        template: `<div class="math-text"><div class="slot" data-idx="0"></div> Ã· 2 = <div class="slot" data-idx="1"></div></div>`,
                        options: [4, 2, 8],
                        correct: [4, 2],
                        slots: 2
                    }
                ]
            },
            {
                id: 2,
                title: "é¡Œç›®äºŒ",
                desc: "ç›´è§’ä¸‰è§’å½¢ ABC ä¸­ï¼ŒAB=8ï¼ŒBC=15ï¼ŒAC=17ï¼Œæ±‚å…§åˆ‡åœ“åŠå¾‘ï¼Ÿ",
                labels: { h: 8, w: 15, hyp: 17 },
                steps: [
                    {
                        instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºå…©è‚¡ï¼ˆç›´è§’é‚Šï¼‰",
                        template: `<div class="math-text">å…©è‚¡ï¼š <div class="slot" data-idx="0"></div> , <div class="slot" data-idx="1"></div></div>`,
                        options: [8, 15, 17],
                        correctSet: [8, 15],
                        slots: 2
                    },
                    {
                        instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾å‡ºæ–œé‚Š",
                        template: `<div class="math-text">æ–œé‚Šï¼š <div class="slot" data-idx="0"></div></div>`,
                        options: [8, 15, 17],
                        correct: [17],
                        slots: 1
                    },
                    {
                        instruction: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— ( å…©è‚¡å’Œ - æ–œé‚Š )",
                        template: `<div class="math-text">( <div class="slot" data-idx="0"></div> + <div class="slot" data-idx="1"></div> ) - <div class="slot" data-idx="2"></div> = <div class="slot" data-idx="3"></div></div>`,
                        options: [8, 15, 17, 6, 23],
                        logicCheck: (inputs) => {
                            const legs = [inputs[0], inputs[1]].sort((a,b)=>a-b);
                            return (legs[0] == 8 && legs[1] == 15 && inputs[2] == 17 && inputs[3] == 6);
                        },
                        slots: 4
                    },
                    {
                        instruction: "æ­¥é©Ÿ 4ï¼šç®—å‡ºåŠå¾‘",
                        template: `<div class="math-text"><div class="slot" data-idx="0"></div> Ã· 2 = <div class="slot" data-idx="1"></div></div>`,
                        options: [6, 3, 12],
                        correct: [6, 3],
                        slots: 2
                    }
                ]
            },
            {
                id: 3,
                title: "é¡Œç›®ä¸‰",
                desc: "ç›´è§’ä¸‰è§’å½¢ PQR ä¸­ï¼ŒPQ=7ï¼ŒQR=24ï¼ŒPR=25ï¼Œæ±‚å…§åˆ‡åœ“åŠå¾‘ï¼Ÿ",
                labels: { h: 7, w: 24, hyp: 25 },
                steps: [
                    {
                        instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºå…©è‚¡",
                        template: `<div class="math-text">å…©è‚¡ï¼š <div class="slot" data-idx="0"></div> , <div class="slot" data-idx="1"></div></div>`,
                        options: [7, 24, 25],
                        correctSet: [7, 24],
                        slots: 2
                    },
                    {
                        instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾å‡ºæ–œé‚Š",
                        template: `<div class="math-text">æ–œé‚Šï¼š <div class="slot" data-idx="0"></div></div>`,
                        options: [7, 24, 25],
                        correct: [25],
                        slots: 1
                    },
                    {
                        instruction: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— ( å…©è‚¡å’Œ - æ–œé‚Š )",
                        template: `<div class="math-text">( <div class="slot" data-idx="0"></div> + <div class="slot" data-idx="1"></div> ) - <div class="slot" data-idx="2"></div> = <div class="slot" data-idx="3"></div></div>`,
                        options: [7, 24, 25, 6, 31],
                        logicCheck: (inputs) => {
                            const legs = [inputs[0], inputs[1]].sort((a,b)=>a-b);
                            return (legs[0] == 7 && legs[1] == 24 && inputs[2] == 25 && inputs[3] == 6);
                        },
                        slots: 4
                    },
                    {
                        instruction: "æ­¥é©Ÿ 4ï¼šç®—å‡ºåŠå¾‘",
                        template: `<div class="math-text"><div class="slot" data-idx="0"></div> Ã· 2 = <div class="slot" data-idx="1"></div></div>`,
                        options: [6, 3, 12],
                        correct: [6, 3],
                        slots: 2
                    }
                ]
            }
        ];

        // ğŸŸ¢ ç‹€æ…‹ç®¡ç†
        let currentProblemIdx = 0;
        let currentStepIdx = 0;
        // å„²å­˜æ¯å€‹æ­¥é©Ÿçš„ slot è¼¸å…¥å€¼ { "stepIdx-slotIdx": value }
        let userInputs = {}; 

        // ğŸš€ åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderNav();
            loadProblem(0);
        });

        // ğŸ› ï¸ æ¸²æŸ“å°è¦½åˆ—
        function renderNav() {
            const nav = document.getElementById('nav-buttons');
            nav.innerHTML = problems.map((p, idx) => `
                <button onclick="switchProblem(${idx})" 
                    class="px-5 py-2 rounded-xl font-bold transition-all whitespace-nowrap border-2
                    ${idx === currentProblemIdx 
                        ? 'bg-blue-600 border-blue-600 text-white shadow-md' 
                        : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'}">
                    ${p.title}
                </button>
            `).join('');
        }

        // ğŸ”„ åˆ‡æ›é¡Œç›®
        function switchProblem(idx) {
            if (idx === currentProblemIdx) return;
            currentProblemIdx = idx;
            currentStepIdx = 0;
            userInputs = {};
            renderNav();
            
            // åŠ ä¸Šæ·¡å‡ºå‹•ç•«æ•ˆæœ
            const content = document.querySelector('main');
            content.style.opacity = '0.5';
            setTimeout(() => {
                loadProblem(idx);
                content.style.opacity = '1';
            }, 200);
        }

        // ğŸ“¥ è¼‰å…¥é¡Œç›®å…§å®¹
        function loadProblem(idx) {
            const p = problems[idx];
            
            // æ›´æ–°æ–‡å­—èˆ‡ SVG æ¨™ç±¤
            document.getElementById('problem-title').textContent = p.title;
            document.getElementById('problem-desc').textContent = p.desc;
            document.getElementById('label-h').textContent = p.labels.h;
            document.getElementById('label-w').textContent = p.labels.w;
            document.getElementById('label-hyp').textContent = p.labels.hyp;

            // ç”Ÿæˆæ­¥é©Ÿ
            const container = document.getElementById('steps-wrapper');
            container.innerHTML = '';
            
            p.steps.forEach((step, sIdx) => {
                // æ­¥é©Ÿå®¹å™¨
                const stepEl = document.createElement('div');
                stepEl.className = `step-card ${sIdx === 0 ? 'active' : ''}`;
                stepEl.id = `step-${sIdx}`;
                
                stepEl.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-xl text-slate-800 flex items-center gap-2">
                            <span class="bg-slate-200 text-slate-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">${sIdx + 1}</span>
                            ${step.instruction.split('ï¼š')[1] || step.instruction}
                        </h3>
                        <span class="status-icon hidden flex items-center gap-1 text-green-600 font-bold bg-green-100 px-3 py-1 rounded-full text-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            å®Œæˆ
                        </span>
                    </div>
                    
                    <div class="mb-6 bg-slate-50 p-6 rounded-2xl border border-slate-200 flex justify-center items-center min-h-[5rem] shadow-inner">
                        ${step.template}
                    </div>

                    <div class="options-wrapper transition-all duration-300">
                        <div class="border-t border-slate-100 pt-4 mb-2">
                            <p class="text-sm text-slate-500 mb-3 font-bold flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg>
                                é»æ“Šä¸‹æ–¹é¸é …å¡«å…¥ï¼š
                            </p>
                            <div class="flex flex-wrap gap-3 justify-center" id="options-${sIdx}">
                                ${step.options.map(opt => `
                                    <button class="option-btn" onclick="handleOptionClick(${sIdx}, ${opt}, this)">${opt}</button>
                                `).join('')}
                            </div>
                        </div>

                        <div class="mt-6 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div id="msg-${sIdx}" class="text-center md:text-left font-bold min-h-[1.5rem] flex-1"></div>
                            <button onclick="checkAnswer(${sIdx})" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2">
                                æª¢æŸ¥ç­”æ¡ˆ
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(stepEl);
            });

            // ç¶å®š Slot é»æ“Šäº‹ä»¶ (ç”¨æ–¼æ¸…é™¤)
            bindSlotEvents();
        }

        // ğŸ”— ç¶å®š Slot æ¸…é™¤äº‹ä»¶
        function bindSlotEvents() {
            document.querySelectorAll('.slot').forEach(slot => {
                slot.addEventListener('click', function() {
                    const stepDiv = this.closest('.step-card');
                    if (!stepDiv.classList.contains('active') || stepDiv.classList.contains('completed')) return;
                    
                    const stepIdx = parseInt(stepDiv.id.split('-')[1]);
                    
                    if (this.classList.contains('filled')) {
                        const val = parseInt(this.textContent);
                        const btns = stepDiv.querySelectorAll('.option-btn');
                        
                        // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                        for(let btn of btns) {
                            if (parseInt(btn.textContent) === val && btn.disabled) {
                                btn.disabled = false;
                                break; 
                            }
                        }
                        
                        // æ¸…é™¤ Slot
                        this.textContent = '';
                        this.classList.remove('filled', 'correct', 'animate-pop');
                        delete userInputs[`${stepIdx}-${this.dataset.idx}`];
                        
                        // æ¸…é™¤è¨Šæ¯
                        const msgEl = document.getElementById(`msg-${stepIdx}`);
                        msgEl.textContent = '';
                        msgEl.className = '';
                    }
                });
            });
        }

        // ğŸ–±ï¸ è™•ç†é¸é …é»æ“Š
        function handleOptionClick(stepIdx, value, btn) {
            if (stepIdx !== currentStepIdx) return;
            
            const stepDiv = document.getElementById(`step-${stepIdx}`);
            const slots = stepDiv.querySelectorAll('.slot');
            
            // å°‹æ‰¾ç¬¬ä¸€å€‹ç©ºæ ¼
            let targetSlot = null;
            for (let slot of slots) {
                if (!slot.classList.contains('filled')) {
                    targetSlot = slot;
                    break;
                }
            }

            if (targetSlot) {
                targetSlot.textContent = value;
                targetSlot.classList.add('filled', 'animate-pop');
                btn.disabled = true;
                
                // è¨˜éŒ„ç­”æ¡ˆ
                userInputs[`${stepIdx}-${targetSlot.dataset.idx}`] = value;
                
                // æ¸…é™¤éŒ¯èª¤æç¤º
                const msgEl = document.getElementById(`msg-${stepIdx}`);
                msgEl.textContent = '';
            } else {
                // å¦‚æœæ»¿äº†ï¼Œæç¤ºä½¿ç”¨è€…
                const msgEl = document.getElementById(`msg-${stepIdx}`);
                msgEl.textContent = "æ ¼å­å·²ç¶“æ»¿å›‰ï¼è«‹å…ˆé»æ“Šæ ¼å­æ¸…é™¤å†é‡æ–°é¸æ“‡ã€‚";
                msgEl.className = "text-orange-500 text-sm animate-pulse";
            }
        }

        // âœ… æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer(stepIdx) {
            const stepData = problems[currentProblemIdx].steps[stepIdx];
            const stepDiv = document.getElementById(`step-${stepIdx}`);
            const slots = stepDiv.querySelectorAll('.slot');
            const msgEl = document.getElementById(`msg-${stepIdx}`);
            
            // 1. æª¢æŸ¥æ˜¯å¦å¡«æ»¿
            let currentValues = [];
            let isFull = true;
            slots.forEach(s => {
                if (!s.classList.contains('filled')) isFull = false;
                currentValues.push(parseInt(s.textContent));
            });

            if (!isFull) {
                msgEl.innerHTML = `<span class="flex items-center gap-1 justify-center md:justify-start text-orange-500"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> é‚„æœ‰æ ¼å­æ²’å¡«å–”ï¼</span>`;
                return;
            }

            // 2. é©—è­‰ç­”æ¡ˆ
            let isCorrect = false;
            if (stepData.logicCheck) {
                isCorrect = stepData.logicCheck(currentValues);
            } else if (stepData.correctSet) {
                const inputSet = [...currentValues].sort();
                const ansSet = [...stepData.correctSet].sort();
                isCorrect = JSON.stringify(inputSet) === JSON.stringify(ansSet);
            } else {
                isCorrect = JSON.stringify(currentValues) === JSON.stringify(stepData.correct);
            }

            // 3. çµæœè™•ç†
            if (isCorrect) {
                msgEl.innerHTML = `<span class="flex items-center gap-1 justify-center md:justify-start text-green-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> ç­”å°äº†ï¼å¤ªæ£’äº†ï¼</span>`;
                stepDiv.classList.add('completed');
                stepDiv.querySelector('.status-icon').classList.remove('hidden');
                stepDiv.querySelector('.status-icon').classList.add('flex');
                
                slots.forEach(s => s.classList.add('correct'));

                // è‡ªå‹•æ»¾å‹•ä¸¦è§£é–ä¸‹ä¸€æ­¥
                if (stepIdx < problems[currentProblemIdx].steps.length - 1) {
                    currentStepIdx++;
                    const nextStep = document.getElementById(`step-${currentStepIdx}`);
                    nextStep.classList.add('active');
                    
                    // å»¶é²æ»¾å‹•ï¼Œè®“è¦–è¦ºè·Ÿä¸Š
                    setTimeout(() => {
                        const container = document.getElementById('steps-container');
                        // è¨ˆç®—æ»¾å‹•ä½ç½®ï¼Œè®“ä¸‹ä¸€æ­¥é©Ÿç½®ä¸­
                        const targetPos = nextStep.offsetTop - container.offsetTop - 20; 
                        container.scrollTo({ top: targetPos, behavior: 'smooth' });
                    }, 400);
                } else {
                    // å…¨éƒ¨å®Œæˆ
                    setTimeout(showCompletionModal, 600);
                }

            } else {
                msgEl.innerHTML = `<span class="flex items-center gap-1 justify-center md:justify-start text-red-500"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> ç­”æ¡ˆä¸å¤ªå°ï¼Œå†æª¢æŸ¥ä¸€ä¸‹æ•¸å­—é †åºï¼Ÿ</span>`;
                // éœ‡å‹•æ•ˆæœ
                stepDiv.classList.add('animate-[pulse_0.2s_ease-in-out_2]');
                setTimeout(() => stepDiv.classList.remove('animate-[pulse_0.2s_ease-in-out_2]'), 500);
            }
        }

        // ğŸ† å®Œæˆè¦–çª—æ§åˆ¶
        function showCompletionModal() {
            const modal = document.getElementById('completion-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const content = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            // å¼·åˆ¶é‡ç¹ªä»¥è§¸ç™¼éæ¸¡
            void modal.offsetWidth;
            
            backdrop.classList.remove('opacity-0');
            content.classList.remove('scale-90', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
        }

        function closeModal() {
            const modal = document.getElementById('completion-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const content = document.getElementById('modal-content');
            
            backdrop.classList.add('opacity-0');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-90', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function resetCurrentProblem() {
            closeModal();
            setTimeout(() => {
                loadProblem(currentProblemIdx);
                currentStepIdx = 0;
                userInputs = {};
                document.getElementById('steps-container').scrollTo({ top: 0, behavior: 'smooth' });
            }, 300);
        }

    </script>
</body>
</html>