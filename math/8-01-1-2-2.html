<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>二、多項式升降冪</title>
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .container {
            max-width: 1024px;
        }
        .term-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
            min-height: 50px;
            background-color: #e2e8f0;
            border: 2px dashed #94a3b8;
        }
        .term-item {
            cursor: pointer;
            padding: 0.5rem 1rem;
            background-color: #fff;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .term-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .target-box {
            min-height: 5rem;
            border: 2px dashed #4b5563;
            background-color: #f8fafc;
        }
        .button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: all 0.2s;
            cursor: pointer;
        }
        .check-button {
            background-color: #3b82f6;
            color: white;
        }
        .check-button:hover {
            background-color: #2563eb;
        }
        .reset-button {
            background-color: #dc2626;
            color: white;
            padding: 0.5rem 1rem; /* Smaller padding */
        }
        .reset-button:hover {
            background-color: #b91c1c;
        }

        /* --- 響應式設計 (Responsive Design) --- */
        @media (max-width: 767px) {
            .container {
                padding: 1.5rem; /* from p-8 */
            }
            h1.text-3xl {
                font-size: 1.875rem; /* ~text-3xl */
            }
            .space-y-8 > :not([hidden]) ~ :not([hidden]) {
                --tw-space-y-reverse: 0;
                margin-top: calc(2rem * calc(1 - var(--tw-space-y-reverse))); /* reduce vertical gap */
                margin-bottom: calc(2rem * var(--tw-space-y-reverse));
            }
            .space-y-6 > :not([hidden]) ~ :not([hidden]) {
                --tw-space-y-reverse: 0;
                margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse))); /* reduce vertical gap */
                margin-bottom: calc(1rem * var(--tw-space-y-reverse));
            }
            .bg-gray-50.p-6 {
                padding: 1rem;
            }
            .term-container, .target-box {
                gap: 0.5rem;
                padding: 0.75rem;
            }
            #check-button, #reset-button {
                width: 100%;
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="container bg-white p-8 md:p-12 rounded-xl shadow-2xl space-y-8">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">多項式升降冪練習</h1>
            <div class="mt-4 md:mt-0 text-xl font-bold text-gray-700">分數: <span id="score">0</span> / <span id="total-problems">3</span></div>
        </div>

        <p class="text-center text-gray-600 mt-2 md:mt-0">請將下方的項目依序點選來排列。</p>
        
        <div class="flex flex-col md:flex-row space-y-8 md:space-y-0 md:space-x-8">
            
            <div class="w-full md:w-1/2 flex flex-col space-y-6">
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <div class="text-xl md:text-2xl font-bold text-gray-700 mb-4">題目：</div>
                    <div id="terms-to-sort" class="term-container rounded-lg p-4"></div>
                </div>
            </div>

            <div class="w-full md:w-1/2 flex flex-col space-y-6">
                <div id="ascending-section">
                    <label class="text-lg font-semibold text-gray-700 block mb-2">升冪 (由小到大)：</label>
                    <div id="ascending-box" class="target-box rounded-lg p-4 flex flex-wrap gap-2"></div>
                    <div id="ascending-result" class="text-center text-lg font-bold mt-4"></div>
                </div>
                
                <div id="descending-section" class="hidden">
                    <label class="text-lg font-semibold text-gray-700 block mb-2">降冪 (由大到小)：</label>
                    <div id="descending-box" class="target-box rounded-lg p-4 flex flex-wrap gap-2"></div>
                    <div id="descending-result" class="text-center text-lg font-bold mt-4"></div>
                </div>
            </div>
        </div>
        
        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mt-6">
            <button id="check-button" class="button check-button flex-grow">檢查升冪</button>
            <button id="reset-button" class="button reset-button">重設</button>
        </div>

        <div id="correct-answers" class="text-sm text-center text-gray-500 mt-2 hidden"></div>

    </div>

    <script>
        const problems = [
            {
                polynomial: "5 + 6x² + 3x",
                ascending: "5 + 3x + 6x²",
                descending: "6x² + 3x + 5"
            },
            {
                polynomial: "8x - 2x² + 9",
                ascending: "9 + 8x - 2x²",
                descending: "-2x² + 8x + 9"
            },
            {
                polynomial: "3x - 2x² + 5",
                ascending: "5 + 3x - 2x²",
                descending: "-2x² + 3x + 5"
            }
        ];

        let currentProblemIndex = -1;
        let currentTask;
        let score = 0;
        let quizCompleted = false;

        const termsToSort = document.getElementById('terms-to-sort');
        const ascendingBox = document.getElementById('ascending-box');
        const descendingBox = document.getElementById('descending-box');
        const ascendingResult = document.getElementById('ascending-result');
        const descendingResult = document.getElementById('descending-result');
        const checkButton = document.getElementById('check-button');
        const resetButton = document.getElementById('reset-button');
        const correctAnswersDisplay = document.getElementById('correct-answers');
        const ascendingSection = document.getElementById('ascending-section');
        const descendingSection = document.getElementById('descending-section');
        const scoreDisplay = document.getElementById('score');
        const totalProblemsDisplay = document.getElementById('total-problems');
        totalProblemsDisplay.textContent = problems.length;

        // Function to split polynomial into terms with signs
        function getTerms(polynomial) {
            const parts = polynomial.split(/([+-])/g).filter(part => part.trim() !== '');
            
            const terms = [];
            if (parts.length > 0) {
                // The first term is a special case, it might not have a leading sign
                terms.push(parts[0].trim());
                
                for (let i = 1; i < parts.length; i += 2) {
                    if (parts[i+1]) { 
                        terms.push(parts[i].trim() + parts[i+1].trim());
                    }
                }
            }
            return terms;
        }

        // Function to create a clickable term element
        function createTermElement(term) {
            const div = document.createElement('div');
            div.className = 'term-item rounded-lg';
            div.textContent = term;
            div.addEventListener('click', () => {
                if (div.parentElement.id !== 'terms-to-sort') {
                    return;
                }
                const termClone = div.cloneNode(true);
                termClone.replaceWith(termClone.cloneNode(true));

                if (currentTask === 'ascending') {
                    ascendingBox.appendChild(termClone);
                } else if (currentTask === 'descending') {
                    descendingBox.appendChild(termClone);
                }
            });
            return div;
        }

        // Function to load a new problem
        function loadProblem() {
            if (currentProblemIndex >= problems.length - 1) {
                endQuiz();
                return;
            }

            currentProblemIndex++;
            currentTask = 'ascending';
            const currentProblem = problems[currentProblemIndex];
            
            termsToSort.innerHTML = '';
            ascendingBox.innerHTML = '';
            descendingBox.innerHTML = '';
            ascendingResult.textContent = '';
            descendingResult.textContent = '';
            
            const terms = getTerms(currentProblem.polynomial);
            terms.forEach(term => {
                termsToSort.appendChild(createTermElement(term));
            });
            
            checkButton.textContent = '檢查升冪';
            checkButton.disabled = false;
            resetButton.disabled = false;
            ascendingSection.classList.remove('hidden');
            descendingSection.classList.add('hidden');
            correctAnswersDisplay.classList.add('hidden');
            
            scoreDisplay.textContent = score;
        }
        
        // Helper function to normalize the string for comparison
        function normalizeString(str) {
            return str.replace(/\s+/g, '').replace(/\+/g, '');
        }

        // Function to check the ascending answer
        function checkAscending() {
            const userAscending = Array.from(ascendingBox.children).map(el => el.textContent.trim()).join('');
            const normalizedUser = normalizeString(userAscending);
            const normalizedCorrect = normalizeString(problems[currentProblemIndex].ascending);

            if (normalizedUser === normalizedCorrect) {
                ascendingResult.textContent = '升冪排序正確！請繼續降冪排序。';
                ascendingResult.className = 'text-center text-lg font-bold mt-4 text-green-600';
                
                currentTask = 'descending';
                checkButton.textContent = '檢查降冪';
                
                termsToSort.innerHTML = '';
                const terms = getTerms(problems[currentProblemIndex].polynomial);
                terms.forEach(term => {
                    termsToSort.appendChild(createTermElement(term));
                });

                descendingSection.classList.remove('hidden');
            } else {
                ascendingResult.textContent = '升冪排序有誤，請再試一次。';
                ascendingResult.className = 'text-center text-lg font-bold mt-4 text-red-600';
            }
        }
        
        // Function to check the descending answer
        function checkDescending() {
            const userDescending = Array.from(descendingBox.children).map(el => el.textContent.trim()).join('');
            const normalizedUser = normalizeString(userDescending);
            const normalizedCorrect = normalizeString(problems[currentProblemIndex].descending);

            if (normalizedUser === normalizedCorrect) {
                descendingResult.textContent = '降冪排序也正確！恭喜您完成！';
                descendingResult.className = 'text-center text-lg font-bold mt-4 text-green-600';
                
                score++;
                scoreDisplay.textContent = score;

                correctAnswersDisplay.innerHTML = `
                    <div class="mt-4">
                        <p class="font-bold">完整答案：</p>
                        <p>升冪：${problems[currentProblemIndex].ascending}</p>
                        <p>降冪：${problems[currentProblemIndex].descending}</p>
                    </div>
                `;
                correctAnswersDisplay.classList.remove('hidden');
                
                // Automatically move to the next problem after a short delay
                setTimeout(() => {
                    loadProblem();
                }, 1500);
            } else {
                descendingResult.textContent = '降冪排序有誤，請再試一次。';
                descendingResult.className = 'text-center text-lg font-bold mt-4 text-red-600';
            }
        }

        // Function to handle the end of the quiz
        function endQuiz() {
            quizCompleted = true;
            checkButton.textContent = '重新開始';
            checkButton.disabled = false;
            resetButton.disabled = true;

            termsToSort.innerHTML = '<div class="text-2xl font-bold text-center text-green-700">挑戰完成！</div>';
            ascendingSection.classList.add('hidden');
            descendingSection.classList.add('hidden');
            correctAnswersDisplay.classList.remove('hidden');

            correctAnswersDisplay.innerHTML = `
                <div class="mt-4 text-center">
                    <p class="font-bold text-xl text-gray-800">所有題目都完成了！</p>
                    <p class="font-bold text-2xl text-blue-600 mt-2">您的總分是：<span id="final-score-display">${score} / ${problems.length}</span></p>
                </div>
            `;
        }
        
        // Function to restart the quiz
        function restartQuiz() {
            currentProblemIndex = -1;
            score = 0;
            quizCompleted = false;
            scoreDisplay.textContent = score;
            loadProblem();
        }

        // Function to reset the current sorting phase
        function resetSorting() {
            if (currentTask === 'ascending') {
                ascendingBox.innerHTML = '';
                ascendingResult.textContent = '';
            } else if (currentTask === 'descending') {
                descendingBox.innerHTML = '';
                descendingResult.textContent = '';
            }
            termsToSort.innerHTML = '';
            const terms = getTerms(problems[currentProblemIndex].polynomial);
            terms.forEach(term => {
                termsToSort.appendChild(createTermElement(term));
            });
        }

        // Event listeners for buttons
        checkButton.addEventListener('click', () => {
            if (quizCompleted) {
                restartQuiz();
            } else if (currentTask === 'ascending') {
                checkAscending();
            } else {
                checkDescending();
            }
        });

        resetButton.addEventListener('click', resetSorting);

        window.onload = loadProblem;
    </script>
</body>
</html>