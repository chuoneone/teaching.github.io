<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¾ä½•äº’å‹•è§£é¡Œï¼šå¤–å¿ƒèˆ‡è§’åº¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* åŸºç¤å­—é«”èˆ‡æ’ç‰ˆ */
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', system-ui, sans-serif; background-color: #f8fafc; overflow: hidden; touch-action: manipulation; }
        
        /* æ•¸å­¸å¼æ¨£å¼ (ä¾è¦ç¯„) */
        .math { font-size: 1.5rem; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; vertical-align: middle; color: #1e293b; }
        .slot { 
            display: inline-flex; align-items: center; justify-content: center;
            min-width: 60px; height: 50px; 
            border: 3px solid #cbd5e1; border-radius: 12px; 
            background-color: #ffffff; color: #334155;
            font-size: 1.5rem; font-weight: bold; cursor: pointer;
            margin: 0 4px; padding: 0 10px; transition: all 0.2s;
        }
        .slot.active { border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2); }
        .slot.filled { border-color: #3b82f6; background-color: #eff6ff; color: #1d4ed8; }
        .slot.correct { border-color: #22c55e; background-color: #f0fdf4; color: #15803d; pointer-events: none; }
        .slot.error { animation: shake 0.4s ease-in-out; border-color: #ef4444; }

        /* é¸é …æŒ‰éˆ• */
        .option-btn {
            background-color: #ffffff; border: 2px solid #e2e8f0; border-bottom-width: 4px;
            color: #1e293b; font-size: 1.5rem; font-weight: bold;
            padding: 12px 24px; border-radius: 16px; cursor: pointer;
            transition: transform 0.1s, border-color 0.2s;
            user-select: none; min-width: 80px; text-align: center;
        }
        .option-btn:active:not(:disabled) { transform: translateY(2px); border-bottom-width: 2px; }
        .option-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; border-bottom-width: 2px; background-color: #f1f5f9; }
        .option-btn:hover:not(:disabled) { border-color: #94a3b8; background-color: #f8fafc; }

        /* å°è¦½åˆ—èˆ‡æŒ‰éˆ• */
        .nav-btn { white-space: nowrap; padding: 8px 16px; border-radius: 99px; font-weight: 600; transition: all 0.2s; opacity: 0.7; }
        .nav-btn.active { background-color: white; color: #2563eb; opacity: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* å‹•ç•« */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes tada { 0% { transform: scale(1); } 10%, 20% { transform: scale(0.9) rotate(-3deg); } 30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); } 40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); } 100% { transform: scale(1) rotate(0); } }
        .animate-tada { animation: tada 1s; }
        
        /* æ­¥é©Ÿå®¹å™¨ */
        .step-container { opacity: 0.5; pointer-events: none; filter: grayscale(1); transition: all 0.4s ease; margin-bottom: 2rem; }
        .step-container.active { opacity: 1; pointer-events: auto; filter: grayscale(0); }
        .step-container.done .options-area { display: none; } /* å®Œæˆå¾Œéš±è—é¸é …ï¼Œä¿æŒæ•´æ½” */

        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    </style>
</head>
<body class="h-screen flex flex-col">

    <header class="bg-blue-600 text-white p-3 shadow-md z-20 shrink-0">
        <div class="max-w-7xl mx-auto flex items-center gap-4 overflow-x-auto no-scrollbar pb-1">
            <h1 class="text-xl font-bold shrink-0 mr-2 flex items-center gap-2">
                <span class="text-2xl">ğŸ“</span> å¤–å¿ƒèˆ‡è§’åº¦
            </h1>
            <div id="nav-buttons" class="flex gap-2">
                </div>
        </div>
    </header>

    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <section class="md:w-5/12 bg-slate-50 border-r border-slate-200 flex flex-col shrink-0 md:h-full h-auto max-h-[40vh] md:max-h-full overflow-y-auto z-10 shadow-sm">
            <div class="p-6 sticky top-0">
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                    <span class="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-bold mb-3">
                        <span id="q-type">å¹¾ä½•</span>
                    </span>
                    <h2 id="q-text" class="text-xl md:text-2xl font-bold text-slate-800 leading-relaxed mb-4">
                        </h2>
                    <div id="q-svg" class="w-full flex justify-center py-2">
                        </div>
                </div>
            </div>
        </section>

        <section class="flex-1 bg-white relative overflow-hidden flex flex-col">
            <div id="steps-area" class="flex-1 overflow-y-auto p-6 scroll-smooth pb-32">
                </div>
            
            <div id="completion-modal" class="absolute inset-0 bg-white/90 backdrop-blur-sm z-50 flex items-center justify-center hidden">
                <div class="bg-white p-8 rounded-3xl shadow-2xl border-4 border-green-100 text-center max-w-sm mx-4 transform transition-all scale-100">
                    <div class="text-6xl mb-4 animate-tada">ğŸ‰</div>
                    <h3 class="text-3xl font-black text-slate-800 mb-2">å¤ªæ£’äº†ï¼</h3>
                    <p class="text-slate-600 mb-8 text-lg">ä½ å®Œæˆäº†é€™ä¸€é¡Œï¼</p>
                    <div class="flex flex-col gap-3">
                        <button onclick="resetCurrentProblem()" class="w-full py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-blue-200 transition-all">
                            å†åšä¸€æ¬¡
                        </button>
                        <button onclick="closeModal()" class="w-full py-3 px-6 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-xl font-bold text-lg transition-all">
                            é—œé–‰è¦–çª—
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- é¡Œç›®è³‡æ–™ ---
        const problems = [
            {
                id: 1,
                title: "é¡Œç›® 1",
                type: "å¹¾ä½•ï¼šå¤–å¿ƒæ€§è³ª",
                text: "å¦‚åœ–ï¼Œ<span class='math'>â–³ABC</span> ä¸­ï¼Œ<span class='math'>âˆ A = 75Â°</span>ï¼Œ<span class='math'>O</span> é»ç‚º <span class='math'>â–³ABC</span> çš„å¤–å¿ƒï¼Œæ±‚ <span class='math'>âˆ BOC</span>ã€‚",
                svg: `
                <svg width="240" height="200" viewBox="0 0 240 200" xmlns="http://www.w3.org/2000/svg">
                    <polygon points="60,30 20,150 220,150" fill="#fde2e9" stroke="#333" stroke-width="2"/>
                    <circle cx="120" cy="110" r="3" fill="#333"/>
                    <text x="120" y="130" text-anchor="middle" font-size="16" font-style="italic">O</text>
                    <text x="55" y="25" font-size="16" font-style="italic">A</text>
                    <text x="10" y="160" font-size="16" font-style="italic">B</text>
                    <text x="225" y="160" font-size="16" font-style="italic">C</text>
                    <line x1="20" y1="150" x2="120" y2="110" stroke="#333" stroke-width="1.5"/>
                    <line x1="220" y1="150" x2="120" y2="110" stroke="#333" stroke-width="1.5"/>
                </svg>`,
                steps: [
                    {
                        instruction: "é¡Œç›®å·²çŸ¥ âˆ A æ˜¯å¹¾åº¦ï¼Ÿ",
                        template: "<span class='math'>âˆ A = <div class='slot' data-ans='75'></div>Â°</span>",
                        options: ["60", "75", "90"]
                    },
                    {
                        instruction: "æ ¹æ“šå¤–å¿ƒæ€§è³ªï¼Œâˆ BOC æ˜¯ âˆ A çš„å¹¾å€ï¼Ÿ",
                        template: "<span class='math'>âˆ BOC = <div class='slot' data-ans='2'></div> Ã— âˆ A</span>",
                        options: ["2", "3", "0.5"]
                    },
                    {
                        instruction: "è¨ˆç®— âˆ BOC çš„è§’åº¦ï¼š",
                        template: "<span class='math'>= <div class='slot' data-ans='2'></div> Ã— <div class='slot' data-ans='75'></div>Â°</span>",
                        options: ["2", "75", "60"]
                    },
                    {
                        instruction: "æœ€å¾Œç®—å‡ºç­”æ¡ˆï¼š",
                        template: "<span class='math'>= <div class='slot' data-ans='150'></div>Â°</span>",
                        options: ["140", "150", "120"]
                    }
                ]
            },
            {
                id: 2,
                title: "é¡Œç›® 2",
                type: "å¹¾ä½•ï¼šå¤–å¿ƒæ€§è³ª",
                text: "å¦‚åœ–ï¼Œ<span class='math'>â–³ABC</span> ä¸­ï¼Œ<span class='math'>âˆ B = 60Â°</span>ï¼Œ<span class='math'>O</span> é»ç‚º <span class='math'>â–³ABC</span> çš„å¤–å¿ƒï¼Œæ±‚ <span class='math'>âˆ AOC</span>ã€‚",
                svg: `
                <svg width="240" height="180" viewBox="0 0 240 180" xmlns="http://www.w3.org/2000/svg">
                    <polygon points="60,40 40,140 200,140" fill="none" stroke="#333" stroke-width="2"/>
                    <circle cx="100" cy="110" r="3" fill="#333"/>
                    <text x="100" y="100" text-anchor="middle" font-size="16" font-style="italic">O</text>
                    <text x="60" y="30" font-size="16" font-style="italic">B</text>
                    <text x="30" y="155" font-size="16" font-style="italic">A</text>
                    <text x="210" y="155" font-size="16" font-style="italic">C</text>
                    <line x1="40" y1="140" x2="100" y2="110" stroke="#333" stroke-width="1.5"/>
                    <line x1="200" y1="140" x2="100" y2="110" stroke="#333" stroke-width="1.5"/>
                </svg>`,
                steps: [
                    {
                        instruction: "é¡Œç›®å·²çŸ¥ âˆ B æ˜¯å¹¾åº¦ï¼Ÿ",
                        template: "<span class='math'>âˆ B = <div class='slot' data-ans='60'></div>Â°</span>",
                        options: ["60", "30", "120"]
                    },
                    {
                        instruction: "æ ¹æ“šå¤–å¿ƒæ€§è³ªï¼Œâˆ AOC æ˜¯ âˆ B çš„å¹¾å€ï¼Ÿ",
                        template: "<span class='math'>âˆ AOC = <div class='slot' data-ans='2'></div> Ã— âˆ B</span>",
                        options: ["2", "60", "3"]
                    },
                    {
                        instruction: "ç®—å‡º âˆ AOC çš„è§’åº¦ï¼š",
                        template: "<span class='math'>= <div class='slot' data-ans='2'></div> Ã— <div class='slot' data-ans='60'></div>Â° = <div class='slot' data-ans='120'></div>Â°</span>",
                        options: ["2", "60", "120", "180"]
                    }
                ]
            },
            {
                id: 3,
                title: "é¡Œç›® 3",
                type: "å¹¾ä½•ï¼šè§’åº¦è¨ˆç®—",
                text: "å¦‚åœ–ï¼Œ<span class='math'>O</span> ç‚ºéŠ³è§’ <span class='math'>â–³ABC</span> å¤–å¿ƒï¼Œ<span class='math'>âˆ BAC=40Â°</span>ï¼Œ<span class='math'>âˆ ABC=82Â°</span>ï¼Œæ±‚ <span class='math'>âˆ AOB</span>ã€‚",
                svg: `
                <svg width="240" height="200" viewBox="0 0 240 200" xmlns="http://www.w3.org/2000/svg">
                    <polygon points="100,20 40,160 200,160" fill="#dbeafe" stroke="#333" stroke-width="2"/>
                    <circle cx="120" cy="110" r="3" fill="#333"/>
                    <text x="120" y="135" text-anchor="middle" font-size="16" font-style="italic">O</text>
                    <text x="100" y="15" font-size="16" font-style="italic">A</text>
                    <text x="25" y="170" font-size="16" font-style="italic">B</text>
                    <text x="210" y="170" font-size="16" font-style="italic">C</text>
                    <line x1="100" y1="20" x2="120" y2="110" stroke="#555" stroke-dasharray="4" stroke-width="1.5"/>
                    <line x1="40" y1="160" x2="120" y2="110" stroke="#555" stroke-dasharray="4" stroke-width="1.5"/>
                    <line x1="200" y1="160" x2="120" y2="110" stroke="#555" stroke-dasharray="4" stroke-width="1.5"/>
                </svg>`,
                steps: [
                    {
                        instruction: "å…ˆç®—å‡º âˆ ACB (ä¸‰è§’å½¢å…§è§’å’Œ 180Â°)ï¼š",
                        template: "<span class='math'>âˆ ACB = 180Â° - <div class='slot' data-ans='40'></div>Â° - <div class='slot' data-ans='82'></div>Â°</span>",
                        options: ["40", "82", "180"]
                    },
                    {
                        instruction: "ç®—å‡º âˆ ACB çš„çµæœï¼š",
                        template: "<span class='math'>= <div class='slot' data-ans='58'></div>Â°</span>",
                        options: ["58", "48", "60"]
                    },
                    {
                        instruction: "å› ç‚º âˆ AOB å°æ‡‰å¼§ ABï¼Œè§’åº¦æ˜¯ âˆ ACB çš„å…©å€ï¼š",
                        template: "<span class='math'>âˆ AOB = <div class='slot' data-ans='2'></div> Ã— âˆ ACB</span>",
                        options: ["2", "3", "58"]
                    },
                    {
                        instruction: "å¸¶å…¥æ•¸å€¼è¨ˆç®—ï¼š",
                        template: "<span class='math'>= <div class='slot' data-ans='2'></div> Ã— <div class='slot' data-ans='58'></div>Â°</span>",
                        options: ["2", "58", "116"]
                    },
                    {
                        instruction: "æœ€å¾Œç­”æ¡ˆï¼š",
                        template: "<span class='math'>= <div class='slot' data-ans='116'></div>Â°</span>",
                        options: ["116", "106", "126"]
                    }
                ]
            },
            {
                id: 4,
                title: "é¡Œç›® 4",
                type: "å¹¾ä½•ï¼šç­‰è…°èˆ‡å¤–å¿ƒ",
                text: "å¦‚åœ–ï¼Œ<span class='math'>O</span> é»ç‚ºéŠ³è§’ <span class='math'>â–³ABC</span> å¤–å¿ƒï¼Œ<span class='math'>âˆ BAO=40Â°</span>ï¼Œ<span class='math'>âˆ OAC=26Â°</span>ï¼Œæ±‚ <span class='math'>âˆ OBC</span>ã€‚",
                svg: `
                <svg width="200" height="220" viewBox="0 0 200 220" xmlns="http://www.w3.org/2000/svg">
                    <polygon points="100,20 40,180 160,180" fill="none" stroke="#333" stroke-width="2"/>
                    <circle cx="100" cy="130" r="3" fill="#333"/>
                    <text x="100" y="155" text-anchor="middle" font-size="16" font-style="italic">O</text>
                    <text x="100" y="15" font-size="16" font-style="italic">A</text>
                    <text x="30" y="190" font-size="16" font-style="italic">B</text>
                    <text x="170" y="190" font-size="16" font-style="italic">C</text>
                    <line x1="100" y1="20" x2="100" y2="130" stroke="#555" stroke-dasharray="4" stroke-width="1.5"/>
                    <line x1="40" y1="180" x2="100" y2="130" stroke="#555" stroke-dasharray="4" stroke-width="1.5"/>
                    <line x1="160" y1="180" x2="100" y2="130" stroke="#555" stroke-dasharray="4" stroke-width="1.5"/>
                </svg>`,
                steps: [
                    {
                        instruction: "ç®—å‡º âˆ BAC (å°‡å…©å€‹è§’åº¦ç›¸åŠ )ï¼š",
                        template: "<span class='math'>âˆ BAC = <div class='slot' data-ans='40'></div> + <div class='slot' data-ans='26'></div> = <div class='slot' data-ans='66'></div>Â°</span>",
                        options: ["40", "26", "66"]
                    },
                    {
                        instruction: "ç®—å‡ºä¸­å¿ƒè§’ âˆ BOC (å¤–å¿ƒæ€§è³ªæ˜¯ 2 å€)ï¼š",
                        template: "<span class='math'>âˆ BOC = 2 Ã— <div class='slot' data-ans='66'></div> = <div class='slot' data-ans='132'></div>Â°</span>",
                        options: ["66", "132", "2"]
                    },
                    {
                        instruction: "â–³OBC æ˜¯ç­‰è…°ä¸‰è§’å½¢ï¼Œç®—å‡ºå…©å€‹åº•è§’çš„ç¸½å’Œï¼š",
                        template: "<span class='math'>180 - <div class='slot' data-ans='132'></div> = <div class='slot' data-ans='48'></div>Â°</span>",
                        options: ["132", "180", "48"]
                    },
                    {
                        instruction: "æœ€å¾Œç®—å‡ºä¸€å€‹åº•è§’ âˆ OBCï¼š",
                        template: "<span class='math'>âˆ OBC = <div class='slot' data-ans='48'></div> Ã· 2 = <div class='slot' data-ans='24'></div>Â°</span>",
                        options: ["48", "24", "2"]
                    }
                ]
            }
        ];

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let currentProblemIndex = 0;
        let currentStepIndex = 0;

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            renderNav();
            loadProblem(0);
        });

        // --- æ¸²æŸ“å°è¦½åˆ— ---
        function renderNav() {
            const container = document.getElementById('nav-buttons');
            container.innerHTML = problems.map((p, idx) => `
                <button onclick="loadProblem(${idx})" 
                    class="nav-btn ${idx === currentProblemIndex ? 'active' : 'text-blue-100 hover:bg-blue-500'}">
                    ${p.title}
                </button>
            `).join('');
        }

        // --- è¼‰å…¥é¡Œç›® ---
        function loadProblem(index) {
            currentProblemIndex = index;
            currentStepIndex = 0;
            renderNav();
            closeModal();

            const p = problems[index];
            document.getElementById('q-type').textContent = p.type;
            document.getElementById('q-text').innerHTML = p.text;
            document.getElementById('q-svg').innerHTML = p.svg;

            const stepsArea = document.getElementById('steps-area');
            stepsArea.innerHTML = ''; // æ¸…ç©º
            
            // é å…ˆå»ºç«‹æ‰€æœ‰æ­¥é©Ÿçš„å®¹å™¨
            p.steps.forEach((step, sIdx) => {
                const stepDiv = document.createElement('div');
                stepDiv.id = `step-${sIdx}`;
                stepDiv.className = `step-container p-4 bg-white rounded-2xl border-2 border-slate-100 shadow-sm ${sIdx === 0 ? 'active' : ''}`;
                
                // æ¨™é¡Œèˆ‡å®Œæˆå‹¾å‹¾
                const headerHtml = `
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-slate-500 font-bold text-sm tracking-wider uppercase">Step ${sIdx + 1}</span>
                        <span class="check-icon text-green-500 font-bold opacity-0 transition-opacity">âœ” å®Œæˆ</span>
                    </div>
                `;

                // æŒ‡ä»¤
                const instructionHtml = `<p class="text-lg text-slate-700 font-medium mb-3">${step.instruction}</p>`;
                
                // å¡«ç©ºå€
                const slotAreaHtml = `<div class="mb-4 text-xl flex flex-wrap items-center gap-2">${step.template}</div>`;

                // é¸é …æŒ‰éˆ•å€
                const optionsHtml = `
                    <div class="options-area flex flex-wrap gap-3 mt-2">
                        ${step.options.map(opt => `
                            <button class="option-btn" onclick="handleOptionClick(this, '${opt}')">${opt}</button>
                        `).join('')}
                        <button class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold ml-auto hover:bg-blue-700 transition-colors shadow-lg shadow-blue-200" onclick="checkStep(${sIdx})">
                            æª¢æŸ¥
                        </button>
                    </div>
                `;

                stepDiv.innerHTML = headerHtml + instructionHtml + slotAreaHtml + optionsHtml;
                stepsArea.appendChild(stepDiv);

                // ç¶å®š slot é»æ“Šæ¸…é™¤äº‹ä»¶
                stepDiv.querySelectorAll('.slot').forEach(slot => {
                    slot.addEventListener('click', () => clearSlot(slot));
                });
            });
        }

        // --- äº’å‹•é‚è¼¯ ---
        function handleOptionClick(btn, value) {
            const stepDiv = document.getElementById(`step-${currentStepIndex}`);
            const emptySlots = Array.from(stepDiv.querySelectorAll('.slot')).filter(s => !s.classList.contains('filled'));
            
            if (emptySlots.length > 0) {
                const targetSlot = emptySlots[0];
                targetSlot.textContent = value;
                targetSlot.dataset.value = value;
                targetSlot.classList.add('filled');
                
                // ç¦ç”¨æŒ‰éˆ•
                btn.disabled = true;
                targetSlot.dataset.linkedBtn = btn.textContent; // ç°¡å–®é—œè¯ï¼Œè‹¥æœ‰é‡è¤‡é¸é …å€¼å¯èƒ½éœ€æ›´åš´è¬¹ ID
                
                // æ’­æ”¾è¼•å¾®éŸ³æ•ˆ (å¯é¸)
            }
        }

        function clearSlot(slot) {
            if (!slot.classList.contains('filled') || slot.classList.contains('correct')) return;
            
            const val = slot.textContent;
            slot.textContent = '';
            slot.classList.remove('filled', 'error');
            delete slot.dataset.value;

            // æ¢å¾©å°æ‡‰æŒ‰éˆ•
            const stepDiv = document.getElementById(`step-${currentStepIndex}`);
            const buttons = stepDiv.querySelectorAll('.option-btn');
            // æ‰¾åˆ°ç¬¬ä¸€å€‹ç¬¦åˆå€¼ä¸”è¢«ç¦ç”¨çš„æŒ‰éˆ•æ¢å¾©
            for (let btn of buttons) {
                if (btn.textContent === val && btn.disabled) {
                    btn.disabled = false;
                    break;
                }
            }
        }

        function checkStep(stepIdx) {
            const stepDiv = document.getElementById(`step-${stepIdx}`);
            const slots = stepDiv.querySelectorAll('.slot');
            let allCorrect = true;
            let allFilled = true;

            slots.forEach(slot => {
                if (!slot.classList.contains('filled')) {
                    allFilled = false;
                    return;
                }
                if (slot.dataset.value !== slot.dataset.ans) {
                    allCorrect = false;
                    slot.classList.add('error');
                    setTimeout(() => slot.classList.remove('error'), 500);
                } else {
                    slot.classList.add('correct');
                    slot.classList.remove('error');
                }
            });

            if (!allFilled) {
                alert("è«‹å¡«æ»¿æ‰€æœ‰ç©ºæ ¼å†æª¢æŸ¥ï¼");
                return;
            }

            if (allCorrect) {
                // è©²æ­¥é©Ÿå®Œæˆ
                stepDiv.classList.add('done');
                stepDiv.querySelector('.check-icon').classList.remove('opacity-0');
                
                // é€²å…¥ä¸‹ä¸€æ­¥
                if (currentStepIndex < problems[currentProblemIndex].steps.length - 1) {
                    currentStepIndex++;
                    const nextStep = document.getElementById(`step-${currentStepIndex}`);
                    nextStep.classList.add('active');
                    
                    // å¹³æ»‘æ²å‹•
                    setTimeout(() => {
                        nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                } else {
                    // å…¨éƒ¨å®Œæˆ
                    setTimeout(() => {
                        document.getElementById('completion-modal').classList.remove('hidden');
                    }, 500);
                }
            } else {
                // æœ‰éŒ¯ï¼Œåƒ…æ¢å¾©éŒ¯èª¤çš„ slot ç‹€æ…‹è®“å­¸ç”Ÿé‡å¡« (ä¸æ¸…é™¤å…§å®¹ï¼Œé€™ç¬¦åˆ"å†æƒ³æƒ³çœ‹"é‚è¼¯ï¼Œä½†ç‚ºäº†è®“å­¸ç”ŸçŸ¥é“éŒ¯å“ªï¼Œæˆ‘é€™è£¡è¨­è¨ˆæ˜¯æ¨™ç´…æ¡†)
                // è‹¥è¦åš´æ ¼ä¸æ¸…é™¤ï¼Œåªéœ€æ¨™ç´…æ¡†å³å¯ã€‚è‹¥è¦è®“å­¸ç”Ÿé‡é¸ï¼Œå‰‡éœ€æ¸…é™¤éŒ¯èª¤çš„ slotã€‚
                // æ ¹æ“šæŒ‡ç¤ºï¼šâœ– éŒ¯èª¤ â†’ é¡¯ç¤ºã€Œå†æƒ³æƒ³çœ‹ã€ï¼Œä½† ä¸å¾—æ¸…é™¤å­¸ç”Ÿå·²å¡«å¯«å…§å®¹
                // å·²é€é CSS animation: shake å’Œ border-red é”æˆè¦–è¦ºåé¥‹ã€‚
                
                // ç‚ºäº†æ–¹ä¾¿ä¿®æ”¹ï¼Œé€™è£¡å°‡éŒ¯èª¤çš„ slot æ¢å¾©å¯é»æ“Šç‹€æ…‹ï¼Œä½†ä¸è‡ªå‹•æ¸…ç©ºæ–‡å­—ï¼Œéœ€å­¸ç”Ÿæ‰‹å‹•é»æˆ–æˆ‘å€‘ç§»é™¤ correct class
                slots.forEach(slot => {
                    if (slot.dataset.value !== slot.dataset.ans) {
                         slot.classList.remove('correct'); // ç¢ºä¿æ²’ç¶ æ¡†
                         // é€™è£¡ä¸è‡ªå‹•æ¸…ç©ºï¼Œè®“å­¸ç”Ÿçœ‹è‘—éŒ¯èª¤æ€è€ƒ
                    }
                });
            }
        }

        function resetCurrentProblem() {
            loadProblem(currentProblemIndex);
        }

        function closeModal() {
            document.getElementById('completion-modal').classList.add('hidden');
        }

    </script>
</body>
</html>