<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WMNZ6FESH7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WMNZ6FESH7');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三角形相似判別</title>
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        :root {
            /* 預設主題顏色 */
            --theme-bg: #f5f3ff;
            --tab-border: #a78bfa;
            --tab-color: #6d28d9;
            --tab-active-bg: #6d28d9;
            --instr-bg: #eef2ff;
            --instr-strong: #4f46e5;
            --selected-border: #4f46e5;
            --selected-bg: #e0e7ff;
            --hover-bg: #e0e7ff;
            --angle-color: #4338ca;
        }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--theme-bg);
            transition: background-color 0.3s ease;
        }

        /* --- 主題變數 --- */
        .theme-aa { --theme-bg: #f5f3ff; --tab-border: #a78bfa; --tab-color: #6d28d9; --tab-active-bg: #6d28d9; --instr-bg: #eef2ff; --instr-strong: #4f46e5; --selected-border: #4f46e5; --selected-bg: #e0e7ff; --hover-bg: #e0e7ff; --angle-color: #4338ca;}
        .theme-sas { --theme-bg: #fdf2f8; --tab-border: #f9a8d4; --tab-color: #be185d; --tab-active-bg: #be185d; --instr-bg: #fce7f3; --instr-strong: #db2777; --selected-border: #db2777; --selected-bg: #fce7f3; --hover-bg: #fce7f3; --angle-color: #be123c;}
        .theme-sss { --theme-bg: #f0fdf4; --tab-border: #6ee7b7; --tab-color: #047857; --tab-active-bg: #047857; --instr-bg: #d1fae5; --instr-strong: #059669; --selected-border: #059669; --selected-bg: #d1fae5; --hover-bg: #d1fae5; --angle-color: transparent;}
        
        /* --- 通用樣式 --- */
        .triangle-container { position: relative; width: 100%; max-width: 200px; margin: 0 auto; cursor: pointer; transition: all 0.2s ease-in-out; border: 3px solid transparent; border-radius: 12px; padding: 5px; }
        .triangle-container:not(.completed):hover { transform: scale(1.05); background-color: var(--hover-bg); }
        .triangle-container.completed { opacity: 0.4; cursor: default; background-color: #f1f5f9; }
        .triangle-container.selected { border-color: var(--selected-border); background-color: var(--selected-bg); }
        .vertex-label, .side-label, .angle-label { position: absolute; font-weight: bold; }
        .vertex-label { font-size: 0.9rem; color: #1e293b; }
        .side-label { font-size: 0.9rem; color: #1d4ed8; }
        .angle-label { font-size: 0.8rem; color: var(--angle-color); }
        .feedback-icon { font-size: 2rem; font-weight: bold; transition: transform 0.3s; }
        .tab-button { padding: 0.5rem 1.5rem; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border: 2px solid var(--tab-border); color: var(--tab-color); }
        .tab-button.active { background-color: var(--tab-active-bg); color: white; }
        #quiz-instructions { background-color: var(--instr-bg); }
        #instruction-strong { color: var(--instr-strong); }
        .ratio-tooltip { position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); background-color: #334155; color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; white-space: nowrap; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; pointer-events: none; z-index: 10; }
        .triangle-container:hover .ratio-tooltip { opacity: 1; visibility: visible; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div id="main-container" class="w-full max-w-5xl bg-white rounded-2xl shadow-lg p-6 md:p-8 space-y-6">
        


        <div class="text-center">
            <h2 id="quiz-title" class="text-2xl sm:text-3xl md:text-4xl font-bold text-slate-800"></h2>
        </div>
        <div class="flex flex-wrap justify-center gap-4 border-b pb-4">
            <button id="tab-aa" class="tab-button">AA 相似</button>
            <button id="tab-sas" class="tab-button">SAS 相似</button>
            <button id="tab-sss" class="tab-button">SSS 相似</button>
        </div>

        <div id="quiz-instructions" class="p-4 rounded-lg text-center transition-colors duration-300">
            <p id="instruction-text" class="text-slate-700 text-base sm:text-lg leading-relaxed"></p>
        </div>



        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
            
            <div id="questions-column" class="space-y-6">
                </div>
            
            <div id="options-column" class="flex flex-col items-center space-y-6 bg-slate-50 p-4 rounded-lg">
                </div>
        </div>

        <div id="completion-message" class="text-center font-bold text-2xl text-green-600 pt-4" style="display: none;">
            恭喜你，全部配對成功！
        </div>
    </div>

    <footer class="mt-6 sm:mt-8 flex items-center justify-center gap-3 text-slate-500 text-sm">
        <span>@spedmix2025</span>
        <a href="https://www.instagram.com/spedmix2025/" target="_blank" rel="noopener noreferrer" class="hover:text-slate-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
        </a>
    </footer>

    <script>
        const quizData = {
            aa: {
                title: '五、AA 相似判別',
                instruction: '<strong id="instruction-strong">任務：</strong>請點擊左方的任一三角形，再從右方選出與它相似的三角形進行配對。',
                triangles: [
                    { id: 'aa-q1', type: 'question', angles: [30, 50, 100], svg: { path: "M 0,100 L 180,100 L 30,0 Z" }, labels: { A: {lx:25, ly:-5, ax:35, ay:15}, B: {lx:185, ly:105, ax:145, ay:80}, C: {lx:-5, ly:105, ax:15, ay:80} }, angleLabels: { A:'30°', C:'50°', B:'100°' } },
                    { id: 'aa-q2', type: 'question', angles: [30, 60, 90], svg: { path: "M 0,100 L 150,100 L 0,0 Z" }, labels: { F: {lx:-15, ly:-5, ax:5, ay:10}, E: {lx:-15, ly:105, ax:5, ay:80}, D: {lx:155, ly:105, ax:125, ay:80} }, angleLabels: { F:'60°', D:'30°' } },
                    { id: 'aa-q3', type: 'question', angles: [30, 45, 105], svg: { path: "M 0,100 L 200,100 L 50,0 Z" }, labels: { I: {lx:45, ly:-5, ax:55, ay:15}, G: {lx:-15, ly:105, ax:10, ay:80}, H: {lx:205, ly:105, ax:165, ay:80} }, angleLabels: { I:'105°', H:'30°', G:'45°'} },
                    { id: 'aa-q4', type: 'question', angles: [40, 40, 100], svg: { path: "M 0,70 L 140,70 L 70,0 Z" }, labels: { L: {lx:65, ly:-5, ax:70, ay:15}, J: {lx:-15, ly:75, ax:10, ay:55}, K: {lx:145, ly:75, ax:105, ay:55} }, angleLabels: { L:'100°', J:'40°', K:'40°'} },
                    { id: 'aa-o1', type: 'option', angles: [30, 50, 100], svg: { path: "M 0,100 L 180,100 L 30,0 Z" }, labels: { R: {lx:25, ly:-5, ax:35, ay:15}, Q: {lx:185, ly:105, ax:145, ay:80}, P: {lx:-5, ly:105, ax:15, ay:80} }, angleLabels: { R:'100°', P:'30°', Q:'50°' }},
                    { id: 'aa-o2', type: 'option', angles: [30, 60, 90], svg: { path: "M 0,100 L 150,100 L 150,0 Z" }, labels: { N: {lx:155, ly:-5, ax:125, ay:10}, M: {lx:155, ly:105, ax:125, ay:80}, O: {lx:-15, ly:105, ax:10, ay:80} }, angleLabels: { N:'60°', O:'30°' } },
                    { id: 'aa-o3', type: 'option', angles: [30, 45, 105], svg: { path: "M 0,100 L 200,100 L 150,0 Z" }, labels: { T: {lx:145, ly:-5, ax:130, ay:15}, S: {lx:-15, ly:105, ax:10, ay:80}, U: {lx:205, ly:105, ax:165, ay:80} }, angleLabels: { T:'105°', S:'30°', U:'45°' } },
                    { id: 'aa-o4', type: 'option', angles: [40, 40, 100], svg: { path: "M 0,70 L 140,70 L 70,0 Z" }, labels: { L: {lx:65, ly:-5, ax:70, ay:15}, J: {lx:-15, ly:75, ax:10, ay:55}, K: {lx:145, ly:75, ax:105, ay:55} }, angleLabels: { L:'100°', J:'40°', K:'40°'} },
                ]
            },
            sas: {
                title: '六、SAS 相似判別',
                instruction: '<strong id="instruction-strong">任務：</strong>觀察三角形的「兩邊」與「夾角」，點擊左方任一三角形，再從右方選出與它相似的三角形。',
                triangles: [
                    { id: 'sas-q1', type: 'question', sides: [1, 2], angle: 110, svg: { path: "M 10,100 L 160,100 L 25,0 Z" }, labels: { C: {x:5, y:105}, A: {x:20, y:-5}, B: {x:165, y:105} }, angleLabel: { at: 'C', text: '110°', pos: {x: 25, y: 75} }, sideLabels: [{ text:'1', pos: {x: 5, y: 40} }, { text:'2', pos: {x: 90, y: 95} }] },
                    { id: 'sas-q2', type: 'question', sides: [4, 5], angle: 90, svg: { path: "M 0,100 L 125,100 L 125,0 Z" }, labels: { D:{x:130, y:105}, E:{x:-5, y:105}, F:{x:130, y:-5} }, angleLabel: { at: 'D', text: '90°', pos: {x: 100, y: 80} }, sideLabels: [{ text:'4', pos: {x: 130, y: 50} }, { text:'5', pos: {x: 50, y: 105} }] },
                    { id: 'sas-q3', type: 'question', sides: [3, 6], angle: 45, svg: { path: "M 0,100 L 180,100 L 130,0 Z" }, labels: { G:{x:-5, y:105}, H:{x:185, y:105}, I:{x:125, y:-5} }, angleLabel: { at: 'G', text: '45°', pos: {x: 20, y: 75} }, sideLabels: [{ text:'3', pos: {x: 55, y: 40} }, { text:'6', pos: {x: 80, y: 105} }] },
                    { id: 'sas-q4', type: 'question', sides: [8, 8], angle: 130, svg: { path: "M 10,50 L 190,50 L 100,0 Z" }, labels: { J:{x:95, y:-5}, K:{x:195, y:55}, L:{x:0, y:55} }, angleLabel: { at: 'J', text: '130°', pos: {x: 85, y: 20} }, sideLabels: [{ text:'8', pos: {x: 145, y: 15} }, { text:'8', pos: {x: 45, y: 15} }] },
                    { id: 'sas-o1', type: 'option', sides: [2, 4], angle: 110, svg: { path: "M 10,100 L 160,100 L 25,0 Z" }, labels: { Q:{x:5, y:105}, R:{x:20, y:-5}, P:{x:165, y:105} }, angleLabel: { at: 'R', text: '110°', pos: {x: 40, y: 20} }, sideLabels: [{ text:'2', pos: {x: 5, y: 45} }, { text:'4', pos: {x: 90, y: 40} }] },
                    { id: 'sas-o2', type: 'option', sides: [6, 7.5], angle: 90, svg: { path: "M 0,100 L 125,100 L 125,0 Z" }, labels: { O:{x:-5, y:105}, M:{x:130, y:105}, N:{x:130, y:-5} }, angleLabel: { at: 'M', text: '90°', pos: {x: 100, y: 80} }, sideLabels: [{ text:'7.5', pos: {x: 50, y: 105} }, { text:'6', pos: {x: 130, y: 50} }] },
                    { id: 'sas-o3', type: 'option', sides: [4.5, 9], angle: 45, svg: { path: "M 0,100 L 180,100 L 130,0 Z" }, labels: { Y:{x:-5, y:105}, X:{x:185, y:105}, Z:{x:125, y:-5} }, angleLabel: { at: 'Y', text: '45°', pos: {x: 20, y: 75} }, sideLabels: [{ text:'9', pos: {x: 80, y: 105} }, { text:'4.5', pos: {x: 55, y: 40} }] },
                    { id: 'sas-o4', type: 'option', sides: [5, 5], angle: 130, svg: { path: "M 10,50 L 190,50 L 100,0 Z" }, labels: { T:{x:0, y:55}, S:{x:95, y:-5}, U:{x:195, y:55} }, angleLabel: { at: 'S', text: '130°', pos: {x: 85, y: 20} }, sideLabels: [{ text:'5', pos: {x: 45, y: 15} }, { text:'5', pos: {x: 145, y: 15} }] },
                ]
            },
            sss: {
                title: '七、SSS 相似判別',
                instruction: '<strong id="instruction-strong">任務：</strong>觀察三角形的「三個邊長」，找出對應邊成比例的三角形，將它們配對起來。',
                triangles: [
                    { id: 'sss-q1', type: 'question', sides: [2, 2, 4], svg: { path: "M 0,5 L 200,5 L 100,0 Z" }, labels: { A:{x:95, y:-5}, B:{x:-5, y:10}, C:{x:205, y:10} }, sideLabels: [{ text:'4', pos: {x: 95, y: 10} }, { text:'2', pos: {x: 40, y: -5} }, { text:'2', pos: {x: 150, y: -5} }] },
                    { id: 'sss-q2', type: 'question', sides: [3, 3, 3], svg: { path: "M 100,0 L 0,86.6 L 200,86.6 Z" }, labels: { D:{x:95, y:-5}, E:{x:-5, y:90}, F:{x:205, y:90} }, sideLabels: [{ text:'3', pos: {x: 95, y: 90} }, { text:'3', pos: {x: 35, y: 35} }, { text:'3', pos: {x: 155, y: 35} }] },
                    { id: 'sss-q3', type: 'question', sides: [3, 6, 7.2], svg: { path: "M 5,90 L 195,90 L 30,0 Z" }, labels: { I:{x:25, y:-5}, H:{x:-10, y:95}, G:{x:200, y:95} }, sideLabels: [{ text:'7.2', pos: {x: 90, y: 95} }, { text:'3', pos: {x: 5, y: 40} }, { text:'6', pos: {x: 110, y: 35} }] },
                    { id: 'sss-q4', type: 'question', sides: [2, 3, 4], svg: { path: "M 30,90 L 170,90 L 0,0 Z" }, labels: { K:{x:-5, y:-5}, L:{x:25, y:95}, J:{x:175, y:95} }, sideLabels: [{ text:'4', pos: {x: 90, y: 95} }, { text:'2', pos: {x: 5, y: 40} }, { text:'3', pos: {x: 90, y: 35} }] },
                    { id: 'sss-o1', type: 'option', sides: [1, 1, 2], svg: { path: "M 0,5 L 200,5 L 100,0 Z" }, labels: { S:{x:95, y:-5}, T:{x:205, y:10}, U:{x:-5, y:10} }, sideLabels: [{ text:'2', pos: {x: 95, y: 10} }, { text:'1', pos: {x: 40, y: -5} }, { text:'1', pos: {x: 150, y: -5} }] },
                    { id: 'sss-o2', type: 'option', sides: [5, 5, 5], svg: { path: "M 100,0 L 0,86.6 L 200,86.6 Z" }, labels: { Q:{x:95, y:-5}, P:{x:-5, y:90}, R:{x:205, y:90} }, sideLabels: [{ text:'5', pos: {x: 95, y: 90} }, { text:'5', pos: {x: 35, y: 35} }, { text:'5', pos: {x: 155, y: 35} }] },
                    { id: 'sss-o3', type: 'option', sides: [1.5, 3, 3.6], svg: { path: "M 5,90 L 195,90 L 30,0 Z" }, labels: { O:{x:25, y:-5}, M:{x:-10, y:95}, N:{x:200, y:95} }, sideLabels: [{ text:'3.6', pos: {x: 90, y: 95} }, { text:'1.5', pos: {x: 5, y: 40} }, { text:'3', pos: {x: 110, y: 35} }] },
                    { id: 'sss-o4', type: 'option', sides: [3, 4.5, 6], svg: { path: "M 30,90 L 170,90 L 0,0 Z" }, labels: { Y:{x:-5, y:-5}, Z:{x:25, y:95}, X:{x:175, y:95} }, sideLabels: [{ text:'6', pos: {x: 90, y: 95} }, { text:'3', pos: {x: 5, y: 40} }, { text:'4.5', pos: {x: 90, y: 35} }] },
                ]
            }
        };

        let currentQuizType = null;
        let selectedQuestionId = null;

        // --- 相似判斷函式 ---
        function areAnglesSimilar_AA(angles1, angles2) {
            return [...angles1].sort((a,b)=>a-b).join(',') === [...angles2].sort((a,b)=>a-b).join(',');
        }
        function areTrianglesSimilar_SAS(qData, oData) {
            if (qData.angle !== oData.angle) return false;
            const qSides = [...qData.sides].sort((a, b) => a - b);
            const oSides = [...oData.sides].sort((a, b) => a - b);
            return Math.abs((qSides[0] / oSides[0]) - (qSides[1] / oSides[1])) < 0.001;
        }
        function areTrianglesSimilar_SSS(qData, oData) {
            const qSides = [...qData.sides].sort((a, b) => a - b);
            const oSides = [...oData.sides].sort((a, b) => a - b);
            const ratio = qSides[0] / oSides[0];
            return qSides.every((side, i) => Math.abs(side / oSides[i] - ratio) < 0.001);
        }

        // --- SSS 邊長比計算函式 ---
        const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
        function findSideRatio(sides) {
            let multiplier = 1;
            sides.forEach(side => {
                const s = side.toString();
                if (s.includes('.')) { multiplier = Math.max(multiplier, Math.pow(10, s.split('.')[1].length)); }
            });
            const intSides = sides.map(s => Math.round(s * multiplier));
            const commonDivisor = intSides.reduce(gcd);
            return intSides.map(s => s / commonDivisor).join(' : ');
        }
        // 為 SSS 數據預先計算邊長比
        quizData.sss.triangles.forEach(data => { data.ratio = findSideRatio(data.sides); });
        
        // --- HTML 產生函式 ---
        function createTriangleHTML_AA(data) {
            let labelsHTML = '';
            for(const key in data.labels) {
                const v = data.labels[key];
                labelsHTML += `<div class="vertex-label" style="left:${v.lx}px; top:${v.ly}px;">${key}</div>`;
                if(data.angleLabels[key]) {
                    labelsHTML += `<div class="angle-label" style="left:${v.ax}px; top:${v.ay}px;">${data.angleLabels[key]}</div>`;
                }
            }
            return `<div class="triangle-container" id="${data.id}" data-id="${data.id}"><svg viewBox="-20 -10 240 120"><path d="${data.svg.path}" stroke="#374151" stroke-width="2" fill="#f3f4f6"></path></svg>${labelsHTML}</div>`;
        }
        function createTriangleHTML_SAS(data) {
            let labelsHTML = '';
            for (const key in data.labels) { labelsHTML += `<div class="vertex-label" style="left:${data.labels[key].x}px; top:${data.labels[key].y}px;">${key}</div>`; }
            data.sideLabels.forEach(label => { labelsHTML += `<div class="side-label" style="left:${label.pos.x}px; top:${label.pos.y}px;">${label.text}</div>`; });
            if (data.angleLabel) { labelsHTML += `<div class="angle-label" style="left:${data.angleLabel.pos.x}px; top:${data.angleLabel.pos.y}px;">${data.angleLabel.text}</div>`; }
            return `<div class="triangle-container" id="${data.id}" data-id="${data.id}"><svg viewBox="-20 -10 240 120"><path d="${data.svg.path}" stroke="#374151" stroke-width="2" fill="#f3f4f6"></path></svg>${labelsHTML}</div>`;
        }
        function createTriangleHTML_SSS(data) {
            let labelsHTML = '';
            for (const key in data.labels) { labelsHTML += `<div class="vertex-label" style="left:${data.labels[key].x}px; top:${data.labels[key].y}px;">${key}</div>`; }
            data.sideLabels.forEach(label => { labelsHTML += `<div class="side-label" style="left:${label.pos.x}px; top:${label.pos.y}px;">${label.text}</div>`; });
            const tooltipHTML = `<div class="ratio-tooltip">最簡邊長比: ${data.ratio}</div>`;
            return `<div class="triangle-container" id="${data.id}" data-id="${data.id}"><svg viewBox="-20 -10 240 120"><path d="${data.svg.path}" stroke="#374151" stroke-width="2" fill="#f3f4f6"></path></svg>${labelsHTML}${tooltipHTML}</div>`;
        }
        
        function renderQuiz(quizType) {
            const data = quizData[quizType];
            const questionsColumn = document.getElementById('questions-column');
            const optionsColumn = document.getElementById('options-column');
            questionsColumn.innerHTML = '';
            optionsColumn.innerHTML = '';
            
            let createTriangleHTML;
            switch(quizType) {
                case 'aa': createTriangleHTML = createTriangleHTML_AA; break;
                case 'sas': createTriangleHTML = createTriangleHTML_SAS; break;
                case 'sss': createTriangleHTML = createTriangleHTML_SSS; break;
            }
            
            const questions = data.triangles.filter(t => t.type === 'question');
            const options = data.triangles.filter(t => t.type === 'option');
            const shuffledOptions = [...options].sort(() => Math.random() - 0.5);

            questions.forEach(q => {
                questionsColumn.innerHTML += `<div class="flex items-center gap-4"><div class="w-2/3">${createTriangleHTML(q)}</div><div class="w-1/3 text-center"><span class="feedback-icon" id="feedback-${q.id}"></span></div></div>`;
            });

            shuffledOptions.forEach(o => { optionsColumn.innerHTML += createTriangleHTML(o); });
            addEventListeners();
        }

        function addEventListeners() {
            document.querySelectorAll('.triangle-container').forEach(el => el.addEventListener('click', handleTriangleClick));
        }
        
        function handleTriangleClick(event) {
            const clickedEl = event.currentTarget;
            if (clickedEl.classList.contains('completed')) return;

            const clickedId = clickedEl.dataset.id;
            const clickedData = quizData[currentQuizType].triangles.find(t => t.id === clickedId);

            if (clickedData.type === 'question') {
                document.querySelectorAll('#questions-column .triangle-container').forEach(el => el.classList.remove('selected'));
                clickedEl.classList.add('selected');
                selectedQuestionId = clickedId;
            } else if (clickedData.type === 'option' && selectedQuestionId) {
                const questionData = quizData[currentQuizType].triangles.find(t => t.id === selectedQuestionId);
                let isCorrect = false;

                switch(currentQuizType) {
                    case 'aa': isCorrect = areAnglesSimilar_AA(questionData.angles, clickedData.angles); break;
                    case 'sas': isCorrect = areTrianglesSimilar_SAS(questionData, clickedData); break;
                    case 'sss': isCorrect = areTrianglesSimilar_SSS(questionData, clickedData); break;
                }
                
                const feedbackEl = document.getElementById(`feedback-${selectedQuestionId}`);
                if (isCorrect) {
                    feedbackEl.textContent = '✔';
                    feedbackEl.style.color = '#16a34a';
                    document.getElementById(selectedQuestionId).classList.add('completed', 'correct');
                    document.getElementById(selectedQuestionId).classList.remove('selected');
                    clickedEl.classList.add('completed');
                    selectedQuestionId = null;
                } else {
                    feedbackEl.textContent = '✖';
                    feedbackEl.style.color = '#dc2626';
                    setTimeout(() => { feedbackEl.textContent = ''; }, 1000);
                }
                checkCompletion();
            }
        }

        function checkCompletion() {
            const allQuestions = quizData[currentQuizType].triangles.filter(t => t.type === 'question');
            const allCompleted = allQuestions.every(q => document.getElementById(q.id).classList.contains('completed'));
            if (allCompleted) {
                document.getElementById('completion-message').style.display = 'block';
            }
        }

        function loadQuiz(quizType) {
            if (currentQuizType === quizType) return;
            currentQuizType = quizType;
            selectedQuestionId = null;
            
            document.documentElement.className = `theme-${quizType}`;
            
            const data = quizData[quizType];
            document.getElementById('quiz-title').textContent = data.title;
            document.getElementById('instruction-text').innerHTML = data.instruction;
            document.getElementById('completion-message').style.display = 'none';
            
            document.getElementById('tab-aa').classList.toggle('active', quizType === 'aa');
            document.getElementById('tab-sas').classList.toggle('active', quizType === 'sas');
            document.getElementById('tab-sss').classList.toggle('active', quizType === 'sss');

            renderQuiz(quizType);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('tab-aa').addEventListener('click', () => loadQuiz('aa'));
            document.getElementById('tab-sas').addEventListener('click', () => loadQuiz('sas'));
            document.getElementById('tab-sss').addEventListener('click', () => loadQuiz('sss'));
            
            loadQuiz('aa');
        });
    </script>
</body>
</html>