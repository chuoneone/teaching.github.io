<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¾ä½•å¤§å¸«ï¼šå…¨æ–¹ä½è¤‡ç¿’å¹³å°</title>
    
    <!-- 1. å¤–éƒ¨å‡½å¼åº«è¼‰å…¥ -->
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js (ç”¨æ–¼é›·é”åœ–) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- KaTeX (ç”¨æ–¼æ•¸å­¸å…¬å¼æ¸²æŸ“) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&family=LXGW+WenKai+TC&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- å…¨åŸŸé‡ç½®èˆ‡é€šç”¨æ¨£å¼ --- */
        body { margin: 0; overflow-x: hidden; transition: background 0.5s; font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif; }
        .hidden-section { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ================= éŠæˆ²ä¸€ (ç‰›ä»”) æ¨£å¼ ================= */
        .game1-theme {
            --wood-dark: #5d4037;
            --wood-light: #8d6e63;
            --paper-bg: #fdf5e6;
            --accent-red: #b71c1c;
            --accent-gold: #ffb300;
            --text-color: #3e2723;
            font-family: 'Chiron GoRound TC', 'LXGW WenKai TC', serif;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            position: relative;
        }
        .game1-theme .cactus { position: absolute; bottom: 10%; left: 5%; width: 40px; height: 100px; background: #2e7d32; border-radius: 20px 20px 0 0; z-index: 0; }
        .game1-theme .cactus::before { content: ''; position: absolute; top: 30px; left: -20px; width: 30px; height: 10px; background: #2e7d32; border-radius: 10px 0 0 10px; }
        .game1-theme .cactus::after { content: ''; position: absolute; top: 20px; left: -20px; width: 10px; height: 20px; background: #2e7d32; border-radius: 10px 10px 0 0; }
        .game1-theme .cactus.small { left: auto; right: 10%; bottom: 20%; transform: scale(0.6); }
        .game1-theme #game-container {
            width: 90%; max-width: 1000px; height: 85vh;
            background: repeating-linear-gradient(90deg, var(--wood-dark), var(--wood-dark) 10px, var(--wood-light) 10px, var(--wood-light) 20px);
            border: 8px solid #3e2723; border-radius: 15px;
            box-shadow: 10px 10px 30px rgba(0,0,0,0.6);
            display: flex; position: relative; z-index: 10; overflow: hidden;
        }
        .game1-theme .side-panel {
            flex: 1; background: rgba(62, 39, 35, 0.9); color: #fff;
            padding: 20px; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            border-right: 4px solid #281815; text-align: center;
        }
        .game1-theme .main-panel { flex: 2; padding: 30px; display: flex; justify-content: center; align-items: center; position: relative; }
        .game1-theme .paper-card {
            background: var(--paper-bg);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            width: 100%; height: 100%; border-radius: 5px; padding: 20px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
            position: relative; display: flex; flex-direction: column; overflow-y: auto;
        }
        .game1-theme .btn {
            background: var(--wood-light); color: #fff; border: 2px solid #3e2723;
            padding: 12px 24px; font-size: 1.1rem; cursor: pointer; margin: 10px 0;
            border-radius: 8px; box-shadow: 0 4px 0 #3e2723; width: 100%; max-width: 300px;
        }
        .game1-theme .btn:hover { background: #a1887f; }
        .game1-theme .option-btn {
            background: white; color: var(--text-color); border: 2px solid var(--wood-dark);
            padding: 20px; cursor: pointer; font-size: 1.2rem; border-radius: 5px;
            transition: transform 0.1s; text-align: center; font-weight: bold; width: 100%;
        }
        .game1-theme .option-btn.correct { background: #c8e6c9 !important; border-color: #2e7d32; }
        .game1-theme .option-btn.wrong { background: #ffcdd2 !important; border-color: #c62828; }
        .game1-theme .options-grid { display: grid; gap: 15px; grid-template-columns: 1fr 1fr; width: 100%; }

        /* Game 1 RWD Fixes */
        @media (max-width: 768px) {
            .game1-theme #game-container { flex-direction: column; height: auto; min-height: 90vh; }
            .game1-theme .side-panel { flex: none; width: 100%; border-right: none; border-bottom: 4px solid #281815; padding: 15px; flex-direction: row; justify-content: space-around; }
            .game1-theme .main-panel { padding: 15px; min-height: 50vh; }
            .game1-theme .options-grid { grid-template-columns: 1fr; }
        }
        
        /* ================= éŠæˆ²äºŒ (æ•™ç§‘æ›¸) æ¨£å¼ ================= */
        .math-container {
            font-family: 'Times New Roman', serif; font-size: 1.5rem; font-weight: 500;
            color: #1e293b; display: inline-flex; align-items: center; flex-wrap: wrap; gap: 0.3rem;
        }
        .sqrt-wrapper { display: inline-flex; align-items: stretch; margin: 0 4px; }
        .sqrt-symbol { font-family: 'Times New Roman', serif; font-size: 1.8rem; line-height: 1; transform: scaleY(1.2); display: flex; align-items: flex-end; padding-bottom: 4px; }
        .sqrt-content { border-top: 2px solid #0f172a; padding-top: 4px; padding-left: 2px; padding-right: 2px; display: inline-flex; align-items: center; gap: 4px; margin-top: 0.6rem; }
        .g2-slot {
            display: inline-flex; justify-content: center; align-items: center; min-width: 50px; height: 40px;
            border: 2px dashed #94a3b8; border-radius: 6px; background-color: #ffffff;
            font-size: 1.4rem; font-family: 'Times New Roman', serif; font-weight: bold; color: #334155;
            cursor: pointer; padding: 0 6px; margin: 0 2px;
        }
        .g2-slot.filled { border-style: solid; border-color: #2563eb; color: #1d4ed8; }
        .g2-slot.correct { border-color: #16a34a; background-color: #dcfce7; color: #15803d; }
        .step-block { opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; display: none; }
        .step-block.visible { opacity: 1; transform: translateY(0); display: block; }
        
        /* ================= éŠæˆ²ä¸‰ (å¤–å¿ƒèˆ‡è§’åº¦) æ¨£å¼ ================= */
        .math-text { font-size: 1.5rem; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; vertical-align: middle; color: #1e293b; font-family: 'å¾®è»Ÿæ­£é»‘é«”', system-ui; }
        .g3-slot { 
            display: inline-flex; align-items: center; justify-content: center; min-width: 60px; height: 50px; 
            border: 3px solid #cbd5e1; border-radius: 12px; background-color: #ffffff; color: #334155;
            font-size: 1.5rem; font-weight: bold; cursor: pointer; margin: 0 4px; padding: 0 10px; transition: all 0.2s;
            font-family: system-ui, sans-serif;
        }
        .g3-slot.active { border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2); }
        .g3-slot.filled { border-color: #3b82f6; background-color: #eff6ff; color: #1d4ed8; }
        .g3-slot.correct { border-color: #22c55e; background-color: #f0fdf4; color: #15803d; pointer-events: none; }
        .g3-slot.error { animation: shake 0.4s ease-in-out; border-color: #ef4444; }
        .g3-option-btn {
            background-color: #ffffff; border: 2px solid #e2e8f0; border-bottom-width: 4px;
            color: #1e293b; font-size: 1.25rem; font-weight: bold; padding: 10px 20px; border-radius: 16px; cursor: pointer;
            transition: transform 0.1s, border-color 0.2s; user-select: none; min-width: 70px; text-align: center;
        }
        .g3-option-btn:active:not(:disabled) { transform: translateY(2px); border-bottom-width: 2px; }
        .g3-option-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; border-bottom-width: 2px; background-color: #f1f5f9; }
        .g3-step-container { opacity: 0.5; pointer-events: none; filter: grayscale(1); transition: all 0.4s ease; margin-bottom: 2rem; }
        .g3-step-container.active { opacity: 1; pointer-events: auto; filter: grayscale(0); }
        .g3-step-container.done .options-area { display: none; }

        /* ================= éŠæˆ²å›› (å…§å¿ƒæ€§è³ª) æ¨£å¼ ================= */
        .g4-math { font-family: 'Times New Roman', serif; font-style: italic; font-size: 1.25em; font-weight: 600; display: inline-flex; align-items: center; gap: 2px; color: #1f2937; }
        .g4-angle::before { content: "âˆ "; font-style: normal; margin-right: 2px; }
        .g4-degree::after { content: "Â°"; font-style: normal; }
        .g4-fraction { display: inline-flex; flex-direction: column; align-items: center; line-height: 1; vertical-align: middle; margin: 0 4px; }
        .g4-fraction span:first-child { border-bottom: 2px solid #000; padding: 0 4px; width: 100%; text-align: center; }
        .g4-fraction span:last-child { padding-top: 2px; width: 100%; text-align: center; }
        .g4-slot {
            display: inline-flex; justify-content: center; align-items: center; min-width: 70px; height: 48px;
            border-bottom: 3px solid #9ca3af; background-color: #ffffff; color: #374151; font-size: 1.25em; font-weight: bold;
            margin: 0 6px; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); padding: 0 10px; vertical-align: middle;
            border-radius: 4px 4px 0 0; box-shadow: inset 0 -1px 2px rgba(0,0,0,0.05);
        }
        .g4-slot:hover { background-color: #f3f4f6; border-color: #6b7280; }
        .g4-slot.filled { border-bottom-color: #3b82f6; color: #2563eb; background-color: #eff6ff; }
        .g4-slot.correct { border-bottom-color: #10b981; color: #059669; background-color: #ecfdf5; pointer-events: none; border-bottom-width: 4px; }
        .g4-option-btn {
            background-color: #ffffff; border: 2px solid #e5e7eb; color: #111827; padding: 10px 24px; font-size: 1.25em;
            font-weight: 600; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 0 #e5e7eb; transition: all 0.1s active;
            user-select: none; min-width: 60px; text-align: center;
        }
        .g4-option-btn:active { transform: translateY(4px); box-shadow: none; }
        .g4-option-btn:disabled { opacity: 0.3; cursor: not-allowed; transform: translateY(4px); box-shadow: none; background-color: #f3f4f6; border-color: #e5e7eb; }
        .g4-option-btn:hover:not(:disabled) { border-color: #3b82f6; color: #2563eb; background-color: #eff6ff; box-shadow: 0 4px 0 #bfdbfe; }
        .g4-step-container {
            background: white; border-radius: 20px; padding: 24px; margin-bottom: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            opacity: 0.4; pointer-events: none; transform: scale(0.98); transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); border: 2px solid transparent;
        }
        .g4-step-container.active { opacity: 1; pointer-events: auto; transform: scale(1); border-color: #3b82f6; box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1); }
        .g4-step-container.done { opacity: 1; pointer-events: auto; border-color: #10b981; background-color: #f0fdf4; }

        /* ================= éŠæˆ²äº” (å…§å¿ƒèˆ‡é¢ç©) æ¨£å¼ ================= */
        .g5-math { font-family: 'Times New Roman', serif; font-style: italic; font-weight: 600; padding: 0 2px; }
        .g5-segment { text-decoration: overline; }
        .g5-slot {
            display: inline-flex; justify-content: center; align-items: center; min-width: 60px; height: 48px; padding: 0 10px;
            border: 2px dashed #94a3b8; border-radius: 8px; background-color: white; color: #334155; font-weight: bold; font-size: 1.25rem;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); margin: 0 4px; vertical-align: middle; user-select: none;
        }
        .g5-slot.filled { border-style: solid; border-color: #3b82f6; background-color: #eff6ff; color: #1d4ed8; transform: scale(1.05); }
        .g5-slot.correct { border-color: #22c55e; background-color: #f0fdf4; color: #15803d; border-style: solid; }
        .g5-slot.error { border-color: #ef4444; animation: shake 0.5s; }
        .g5-option-btn {
            background-color: white; border: 2px solid #cbd5e1; border-bottom-width: 4px; padding: 10px 20px; border-radius: 12px;
            font-size: 1.25rem; font-weight: bold; color: #475569; cursor: pointer; transition: all 0.1s; position: relative; top: 0;
        }
        .g5-option-btn:active { border-bottom-width: 2px; top: 2px; background-color: #f1f5f9; }
        .g5-option-btn:disabled { background-color: #e2e8f0; color: #cbd5e1; border-color: #e2e8f0; border-bottom-width: 2px; top: 2px; cursor: not-allowed; pointer-events: none; }
        .g5-step-container {
            background: white; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;
            overflow: hidden; transition: all 0.5s; opacity: 0.5; filter: blur(1px); pointer-events: none; transform: translateY(10px);
        }
        .g5-step-container.active { opacity: 1; filter: blur(0); pointer-events: auto; transform: translateY(0); }

        /* ================= éŠæˆ²å…­ (ç›´è§’ä¸‰è§’å½¢å…§åˆ‡åœ“) æ¨£å¼ ================= */
        .g6-math-text { font-size: 1.35rem; font-weight: 700; color: #1e3a8a; display: inline-flex; align-items: center; flex-wrap: wrap; gap: 0.5rem; line-height: 2.5rem; }
        .g6-slot {
            width: 3.5rem; height: 3.5rem; border: 3px dashed #94a3b8; background-color: #ffffff; border-radius: 0.75rem;
            display: inline-flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; color: #334155;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); user-select: none; margin: 0 2px; box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
        }
        .g6-slot:hover { border-color: #60a5fa; background-color: #f8fafc; }
        .g6-slot.filled { border-style: solid; border-color: #3b82f6; background-color: #eff6ff; color: #1d4ed8; transform: scale(1.05); box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2); }
        .g6-slot.correct { border-color: #22c55e; background-color: #dcfce7; color: #15803d; border-style: solid; }
        .g6-option-btn {
            background-color: #ffffff; border: 2px solid #3b82f6; color: #1d4ed8; font-size: 1.5rem; font-weight: bold;
            padding: 0.75rem 1.5rem; border-radius: 9999px; cursor: pointer; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.1s active; user-select: none; min-width: 4rem; text-align: center; touch-action: manipulation;
        }
        .g6-option-btn:active { transform: scale(0.95); background-color: #eff6ff; }
        .g6-option-btn:disabled { background-color: #f1f5f9; border-color: #cbd5e1; color: #94a3b8; cursor: default; transform: none; box-shadow: none; opacity: 0.6; }
        .g6-step-card {
            background: white; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            border-left: 6px solid #cbd5e1; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0.4; filter: grayscale(0.8);
            pointer-events: none; transform: translateY(20px);
        }
        .g6-step-card.active { border-left-color: #3b82f6; opacity: 1; filter: grayscale(0); pointer-events: auto; transform: translateY(0); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .g6-step-card.completed { border-left-color: #22c55e; opacity: 0.9; background-color: #f0fdf4; transform: translateY(0); }
        .g6-svg-text { font-family: 'Noto Sans TC', sans-serif; font-weight: 700; paint-order: stroke; stroke: white; stroke-width: 3px; }

        /* ================= éŠæˆ²ä¸ƒ (ä¸‰è§’å½¢çš„é‡å¿ƒ) æ¨£å¼ ================= */
        .g7-segment { border-top: 2px solid #000; padding-top: 2px; display: inline-block; line-height: 1.2; }
        .g7-slot {
            display: inline-flex; justify-content: center; align-items: center; min-width: 50px; padding: 0 8px; height: 45px;
            border: 2px dashed #9ca3af; border-radius: 8px; background-color: #fff; margin: 0 4px; font-size: 1.25rem;
            font-weight: bold; color: #2563eb; cursor: pointer; transition: all 0.2s; vertical-align: middle;
        }
        .g7-slot.filled { border: 2px solid #2563eb; background-color: #eff6ff; }
        .g7-slot.correct { border: 2px solid #10b981; background-color: #d1fae5; color: #047857; pointer-events: none; }
        .g7-slot.incorrect { border: 2px solid #ef4444; background-color: #fee2e2; animation: shake 0.5s; }
        .g7-option-btn {
            background-color: #fff; border: 2px solid #3b82f6; color: #3b82f6; padding: 8px 16px; border-radius: 999px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            user-select: none; margin-bottom: 8px;
        }
        .g7-option-btn:hover:not(:disabled) { background-color: #3b82f6; color: #fff; transform: translateY(-2px); }
        .g7-option-btn:active:not(:disabled) { transform: translateY(0); }
        .g7-option-btn:disabled { background-color: #e5e7eb; border-color: #d1d5db; color: #9ca3af; cursor: not-allowed; transform: none; box-shadow: none; }
        .g7-step-container {
            border-left: 4px solid #e5e7eb; padding-left: 20px; margin-bottom: 30px; position: relative; opacity: 0.5; pointer-events: none;
        }
        .g7-step-container.active { opacity: 1; pointer-events: auto; border-left-color: #3b82f6; }
        .g7-step-container.completed { opacity: 1; pointer-events: auto; border-left-color: #10b981; }

        /* ================= éŠæˆ²å…« (é‡å¿ƒèˆ‡é¢ç©) æ¨£å¼ ================= */
        .g8-math-text { font-family: 'Times New Roman', serif; font-style: italic; font-weight: bold; }
        .g8-highlight-area { fill: rgba(59, 130, 246, 0.3); stroke: #2563eb; stroke-width: 2; }
        .g8-slot {
            display: inline-flex; align-items: center; justify-content: center; min-width: 60px; height: 45px;
            border-bottom: 3px solid #94a3b8; background-color: #ffffff; color: #334155; font-size: 1.5rem;
            font-weight: bold; margin: 0 5px; cursor: pointer; transition: all 0.2s; border-radius: 4px 4px 0 0; padding: 0 10px;
        }
        .g8-slot.filled { border-color: #3b82f6; background-color: #eff6ff; color: #1d4ed8; }
        .g8-slot.correct { border-color: #22c55e; background-color: #dcfce7; color: #15803d; }
        .g8-slot.error { border-color: #ef4444; background-color: #fee2e2; animation: shake 0.5s; }
        .g8-option-btn {
            background-color: #fff; border: 2px solid #3b82f6; color: #3b82f6; padding: 8px 16px;
            font-size: 1.25rem; font-weight: bold; border-radius: 12px; cursor: pointer; transition: all 0.1s;
            box-shadow: 0 4px 0 #2563eb; user-select: none;
        }
        .g8-option-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #2563eb; }
        .g8-option-btn:disabled { background-color: #e2e8f0; border-color: #cbd5e1; color: #94a3b8; box-shadow: none; cursor: not-allowed; transform: translateY(4px); }
        .g8-step-container { opacity: 0.5; pointer-events: none; filter: grayscale(1); transition: all 0.4s ease; margin-bottom: 2rem; }
        .g8-step-container.active { opacity: 1; pointer-events: auto; filter: grayscale(0); }
        .g8-step-container.done .options-area { display: none; }
        
        /* --- å‹•ç•« --- */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes tada { 0% { transform: scale(1); } 10%, 20% { transform: scale(0.9) rotate(-3deg); } 30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); } 40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); } 100% { transform: scale(1) rotate(0); } }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-tada { animation: tada 0.8s; }
        .pop-in { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-pop { animation: pop 0.3s ease-out; }

        /* --- å„€è¡¨æ¿æ¨£å¼ --- */
        #dashboard-container { background-color: #f3f4f6; min-height: 100vh; }
        .nav-btn { padding: 8px 16px; border-radius: 999px; font-weight: 700; transition: all 0.3s; }
        .nav-btn.active { background-color: #2563eb; color: white; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3); }
        .nav-btn:not(.active) { background-color: #e5e7eb; color: #6b7280; }
        .nav-btn:not(.active):hover { background-color: #d1d5db; }
        mark.highlight { background-color: #fef08a; padding: 2px 6px; border-radius: 4px; box-decoration-break: clone; font-weight: bold; color: #854d0e; }
    </style>
</head>
<body id="main-body" class="bg-gray-100">

    <!-- ================= 1. é¦–é å„€è¡¨æ¿ ================= -->
    <div id="dashboard-container" class="flex flex-col items-center p-6">
        <header class="w-full max-w-7xl flex justify-between items-center mb-8 bg-white p-4 rounded-xl shadow-md">
            <h1 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
                ğŸ“ å¹¾ä½•è¤‡ç¿’ä¸­å¿ƒ <span class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">å­¸ç”Ÿç‰ˆ</span>
            </h1>
            <button onclick="clearAllProgress()" class="text-xs text-red-400 hover:text-red-600 underline">é‡ç½®é€²åº¦</button>
        </header>

        <div class="w-full max-w-7xl grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- é›·é”åœ–å€å¡Š -->
            <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col items-center justify-center">
                <h2 class="text-xl font-bold text-slate-600 mb-4">å­¸ç¿’ç‹€æ…‹å„€è¡¨æ¿</h2>
                <div class="relative w-full h-[320px]">
                    <canvas id="skillsRadar"></canvas>
                </div>
                <div class="mt-4 grid grid-cols-5 gap-2 text-center w-full text-sm">
                    <div class="bg-orange-50 p-1 rounded-lg"><div class="text-xs text-orange-600 font-bold">è§€å¿µ</div><div id="stat-concept-acc" class="font-bold text-orange-800">0%</div></div>
                    <div class="bg-blue-50 p-1 rounded-lg"><div class="text-xs text-blue-600 font-bold">é•·åº¦</div><div id="stat-calc-g2" class="font-bold text-blue-800">0/4</div></div>
                    <div class="bg-indigo-50 p-1 rounded-lg"><div class="text-xs text-indigo-600 font-bold">å¤–å¿ƒè§’</div><div id="stat-calc-g3" class="font-bold text-indigo-800">0/4</div></div>
                    <div class="bg-emerald-50 p-1 rounded-lg"><div class="text-xs text-emerald-600 font-bold">å…§å¿ƒæ€§</div><div id="stat-calc-g4" class="font-bold text-emerald-800">0/3</div></div>
                    <div class="bg-purple-50 p-1 rounded-lg"><div class="text-xs text-purple-600 font-bold">å…§å¿ƒç©</div><div id="stat-calc-g5" class="font-bold text-purple-800">0/4</div></div>
                    <div class="bg-cyan-50 p-1 rounded-lg"><div class="text-xs text-cyan-600 font-bold">å…§åˆ‡åœ“</div><div id="stat-calc-g6" class="font-bold text-cyan-800">0/3</div></div>
                    <div class="bg-sky-50 p-1 rounded-lg"><div class="text-xs text-sky-600 font-bold">é‡å¿ƒ</div><div id="stat-calc-g7" class="font-bold text-sky-800">0/4</div></div>
                    <div class="bg-yellow-50 p-1 rounded-lg"><div class="text-xs text-yellow-600 font-bold">é‡é¢ç©</div><div id="stat-calc-g8" class="font-bold text-yellow-800">0/3</div></div>
                </div>
            </div>

            <!-- å…¥å£æŒ‰éˆ•å€å¡Š (2æ¬„x4åˆ—) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[500px] overflow-y-auto p-4 no-scrollbar content-start">
                <div class="bg-gradient-to-r from-amber-700 to-orange-600 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame1()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">ğŸ¤ </div>
                    <h3 class="text-xl font-bold mb-1">è’é‡å¤§é¢å®¢ï¼šå¤–å¿ƒä½ç½®</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">åˆ¤æ–·ç›´è§’ã€éŠ³è§’ã€éˆè§’çš„å¤–å¿ƒä½ç½®ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-orange-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é€²å…¥æŒ‘æˆ° â”</span></div>
                </div>
                <div class="bg-gradient-to-r from-blue-600 to-cyan-500 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame2()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">ğŸ“</div>
                    <h3 class="text-xl font-bold mb-1">ç›´è§’ä¸‰è§’å½¢å¤–æ¥åœ“</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">æ­¥é©Ÿæ•™å­¸ï¼šè¨ˆç®—æ–œé‚Šèˆ‡åŠå¾‘ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-blue-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é–‹å§‹ç·´ç¿’ â”</span></div>
                </div>
                <div class="bg-gradient-to-r from-indigo-600 to-purple-500 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame3()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">âœï¸</div>
                    <h3 class="text-xl font-bold mb-1">å¤–å¿ƒèˆ‡è§’åº¦æ€§è³ª</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">äº’å‹•è§£é¡Œï¼šå¤–å¿ƒè§’åº¦é—œä¿‚èˆ‡è¨ˆç®—ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-indigo-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é–‹å§‹ç·´ç¿’ â”</span></div>
                </div>
                <div class="bg-gradient-to-r from-emerald-600 to-teal-500 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame4()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">ğŸ¯</div>
                    <h3 class="text-xl font-bold mb-1">ä¸‰è§’å½¢çš„å…§å¿ƒ</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">äº’å‹•è§£é¡Œï¼šå…§åˆ‡åœ“ã€è·é›¢èˆ‡è§’åº¦ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-emerald-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é–‹å§‹ç·´ç¿’ â”</span></div>
                </div>
                <div class="bg-gradient-to-r from-purple-600 to-pink-500 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame5()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">ğŸ”¢</div>
                    <h3 class="text-xl font-bold mb-1">å…§å¿ƒèˆ‡é¢ç©</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">äº’å‹•è§£é¡Œï¼šé¢ç©æ¯”ä¾‹èˆ‡è¨ˆç®—ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-purple-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é–‹å§‹ç·´ç¿’ â”</span></div>
                </div>
                <div class="bg-gradient-to-r from-cyan-600 to-blue-500 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame6()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">âšª</div>
                    <h3 class="text-xl font-bold mb-1">ç›´è§’ä¸‰è§’å½¢å…§åˆ‡åœ“</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">äº’å‹•è§£é¡Œï¼šè¨ˆç®—å…§åˆ‡åœ“åŠå¾‘ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-cyan-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é–‹å§‹ç·´ç¿’ â”</span></div>
                </div>
                <div class="bg-gradient-to-r from-sky-600 to-indigo-500 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame7()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">âš–ï¸</div>
                    <h3 class="text-xl font-bold mb-1">ä¸‰è§’å½¢çš„é‡å¿ƒ</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">äº’å‹•è§£é¡Œï¼šé‡å¿ƒä½ç½®èˆ‡é•·åº¦æ¯”ä¾‹ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-sky-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é–‹å§‹ç·´ç¿’ â”</span></div>
                </div>
                <div class="bg-gradient-to-r from-slate-700 to-slate-500 rounded-2xl p-6 shadow-lg text-white relative overflow-hidden group cursor-pointer hover:scale-[1.02] transition-transform flex flex-col h-full" onclick="launchGame8()">
                    <div class="absolute right-[-10px] bottom-[-10px] text-8xl opacity-20">â›°ï¸</div>
                    <h3 class="text-xl font-bold mb-1">é‡å¿ƒèˆ‡é¢ç©</h3>
                    <p class="text-sm opacity-90 mb-3 flex-grow">äº’å‹•è§£é¡Œï¼šè¨ˆç®—åˆ†å‰²å€åŸŸé¢ç©ã€‚</p>
                    <div class="mt-auto pt-2"><span class="inline-block bg-white text-slate-800 px-3 py-1 rounded-full text-sm font-bold shadow-md">é–‹å§‹ç·´ç¿’ â”</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= 2-8. éŠæˆ²å®¹å™¨ ================= -->
    <!-- Game 1: Cowboy -->
    <div id="game1-wrapper" class="hidden-section game1-theme">
        <div style="position: absolute; top: 10px; left: 10px; z-index: 100;"><button onclick="backToDashboard()" style="background: white; border: 2px solid #5d4037; padding: 5px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;">ğŸ  è¿”å›é¦–é </button></div>
        <div class="cactus"></div><div class="cactus small"></div>
        <div id="game-container"><div class="side-panel"><div style="width: 80px; height: 80px; background: #ffb300; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); margin-bottom: 20px; display: flex; justify-content: center; align-items: center; font-weight: bold; color: #5d4037; font-size: 12px;">MATH</div><h2 id="g1-level-display">æ‡¸è³å¹¾ä½•</h2><p>ç›®å‰è³é‡‘</p><h1 style="color: gold; font-size: 3rem; margin: 0;" id="g1-score-display">0</h1><p id="g1-progress-display">æº–å‚™ä¸­...</p></div><div class="main-panel"><div id="g1-start-screen" class="paper-card" style="justify-content: center; align-items: center; text-align: center;"><h1 style="font-size: 2.2rem; margin-bottom: 5px; color:#3e2723">ğŸ¤  è’é‡å¹¾ä½•å°æ±º</h1><button class="btn" onclick="startCowboyGame()">æ‹”æ§é–‹å§‹</button><div style="margin-top:20px; font-size:0.9rem; color:#8d6e63;">* éŠç©ç´€éŒ„å°‡è‡ªå‹•åŒæ­¥è‡³å„€è¡¨æ¿</div></div><div id="g1-quiz-screen" class="paper-card hidden-section"><div id="g1-question-container" style="font-size: 1.8rem; margin-bottom: 20px; text-align: center; border-bottom: 2px dashed #5d4037; padding-bottom: 15px; font-weight: bold; color:#3e2723"></div><div id="g1-options-container" class="options-grid"></div><div id="g1-feedback-area" style="margin-top: 10px; min-height: 30px; font-weight: bold; text-align: center;"></div><div style="display:flex; justify-content:space-between; margin-top:15px; width:100%"><button id="g1-next-btn" class="btn" onclick="g1NextQuestion()" style="width:100%">ä¸‹ä¸€é¡Œ â¯</button></div></div><div id="g1-result-screen" class="paper-card hidden-section" style="text-align:center;"><h2 style="color:#3e2723">å†’éšªçµæŸ</h2><div id="g1-final-score" style="font-size: 1.8rem; color: #b71c1c; margin: 20px 0;"></div><button class="btn" onclick="restartCowboyGame()">å†æ¬¡æŒ‘æˆ°</button><button class="btn" style="background:#6d4c41" onclick="backToDashboard()">è¿”å›å„€è¡¨æ¿</button></div></div></div>
    </div>

    <!-- Game 2-7 containers (collapsed for brevity) -->
    <div id="game2-wrapper" class="hidden-section flex flex-col h-screen bg-slate-50 font-[Noto Sans TC]"><header class="bg-slate-800 text-white shadow-lg shrink-0 z-50 flex items-center justify-between px-4 py-3"><h1 class="text-xl font-bold text-yellow-400">ğŸ“ ç›´è§’ä¸‰è§’å½¢å¤–æ¥åœ“</h1><button onclick="backToDashboard()" class="bg-slate-600 hover:bg-slate-500 px-3 py-1 rounded text-sm">ğŸ  è¿”å›</button></header><main class="flex-1 flex flex-col md:flex-row overflow-hidden relative"><section class="md:w-1/3 bg-white border-r border-slate-200 p-6 overflow-y-auto z-10 shadow-md"><div class="flex gap-2 overflow-x-auto pb-4 mb-4" id="g2-nav-buttons"></div><div class="bg-blue-50 border-l-8 border-blue-500 p-4 mb-6 rounded-r-lg"><h2 class="text-xl font-bold text-slate-800 mb-2" id="g2-problem-title">é¡Œç›®</h2><div class="text-base text-slate-600 leading-relaxed mt-2" id="g2-problem-desc"></div></div><div class="flex justify-center items-center bg-slate-50 rounded-xl p-4 border border-slate-100 min-h-[200px]"><div id="g2-svg-container" class="w-full max-w-[250px]"></div></div><div class="mt-4 p-4 bg-yellow-50 rounded-lg text-yellow-800 text-sm"><p class="font-bold">ğŸ’¡ æç¤ºï¼š</p><div id="g2-hint-container" class="ml-2 mt-1"></div></div></section><section class="md:w-2/3 bg-slate-100 p-4 md:p-8 overflow-y-auto scroll-smooth" id="g2-steps-container"><div class="max-w-3xl mx-auto pb-24"></div></section></main><div id="g2-completion-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] hidden backdrop-blur-sm"><div class="bg-white rounded-3xl p-8 max-w-md w-[90%] text-center shadow-2xl"><div class="text-6xl mb-4">ğŸ‰</div><h2 class="text-2xl font-bold text-slate-800 mb-2">å¤ªæ£’äº†ï¼</h2><button onclick="closeG2Modal()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-xl mt-4">ç¹¼çºŒä¸‹ä¸€é¡Œ / è¤‡ç¿’</button></div></div></div>
    <div id="game3-wrapper" class="hidden-section flex flex-col h-screen bg-slate-50 font-[Noto Sans TC]"><header class="bg-indigo-600 text-white p-3 shadow-md z-20 shrink-0 flex justify-between items-center"><div class="max-w-7xl flex items-center gap-4 overflow-x-auto no-scrollbar pb-1"><h1 class="text-xl font-bold shrink-0 mr-2 flex items-center gap-2"><span class="text-2xl">âœï¸</span> å¤–å¿ƒèˆ‡è§’åº¦</h1><div id="g3-nav-buttons" class="flex gap-2"></div></div><button onclick="backToDashboard()" class="bg-indigo-800 hover:bg-indigo-700 px-4 py-2 rounded-lg text-sm font-bold shadow-sm ml-2 whitespace-nowrap">ğŸ  è¿”å›</button></header><main class="flex-1 flex flex-col md:flex-row overflow-hidden relative"><section class="md:w-5/12 bg-slate-50 border-r border-slate-200 flex flex-col shrink-0 md:h-full h-auto max-h-[40vh] md:max-h-full overflow-y-auto z-10 shadow-sm"><div class="p-6 sticky top-0"><div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100"><span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-bold mb-3"><span id="g3-q-type">å¹¾ä½•</span></span><h2 id="g3-q-text" class="text-xl md:text-2xl font-bold text-slate-800 leading-relaxed mb-4"></h2><div id="g3-q-svg" class="w-full flex justify-center py-2"></div></div></div></section><section class="flex-1 bg-white relative overflow-hidden flex flex-col"><div id="g3-steps-area" class="flex-1 overflow-y-auto p-6 scroll-smooth pb-32"></div><div id="g3-completion-modal" class="absolute inset-0 bg-white/90 backdrop-blur-sm z-50 flex items-center justify-center hidden"><div class="bg-white p-8 rounded-3xl shadow-2xl border-4 border-green-100 text-center max-w-sm mx-4 transform transition-all scale-100"><div class="text-6xl mb-4 animate-tada">ğŸ‰</div><h3 class="text-3xl font-black text-slate-800 mb-2">å¤ªæ£’äº†ï¼</h3><div class="flex flex-col gap-3"><button onclick="closeG3Modal()" class="w-full py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-indigo-200 transition-all">ç¹¼çºŒç·´ç¿’ / è¿”å›</button></div></div></div></section></main></div>
    <div id="game4-wrapper" class="hidden-section flex flex-col h-screen bg-gray-50 text-gray-800"><header class="bg-white border-b shadow-sm z-50 flex-none sticky top-0"><div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4 overflow-x-auto hide-scrollbar justify-between"><div class="flex items-center gap-4"><div class="font-black text-xl text-emerald-600 flex-shrink-0 mr-2 flex items-center gap-2"><span>ğŸ¯</span> å…§å¿ƒæ€§è³ª</div><div class="h-8 w-px bg-gray-300 mx-2"></div><div id="g4-nav-container" class="flex gap-3"></div></div><button onclick="backToDashboard()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm ml-2 whitespace-nowrap">ğŸ  è¿”å›</button></div></header><main class="flex-1 flex flex-col md:flex-row overflow-hidden relative"><section class="w-full md:w-5/12 lg:w-1/3 bg-blue-50 p-6 flex-none overflow-y-auto border-b-4 md:border-b-0 md:border-r-4 border-blue-100 flex flex-col items-center shadow-inner"><div id="g4-problem-display" class="w-full max-w-lg sticky top-0 pop-in"></div></section><section class="w-full md:w-7/12 lg:w-2/3 bg-gray-50 p-4 md:p-8 overflow-y-auto scroll-smooth relative" id="g4-steps-area"><div id="g4-steps-container" class="max-w-3xl mx-auto pb-24"></div></section></main><div id="g4-completion-modal" class="fixed inset-0 hidden flex items-center justify-center z-[100] backdrop-blur-sm bg-black/40 transition-opacity opacity-0"><div class="bg-white rounded-3xl p-8 max-w-sm w-full mx-4 shadow-2xl text-center transform scale-95 transition-all duration-300" id="g4-modal-content"><div class="text-7xl mb-4 animate-bounce">ğŸ‰</div><h2 class="text-3xl font-black text-gray-800 mb-2 tracking-tight">æ­å–œå®Œæˆï¼</h2><div class="flex flex-col gap-3 mt-8"><button onclick="closeG4Modal()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 px-6 rounded-xl transition shadow-lg text-lg">ç¹¼çºŒ / è¿”å›</button></div></div></div><div id="g4-toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-full shadow-lg font-bold transition-all duration-300 translate-y-20 opacity-0 z-50 flex items-center gap-2"><span>ğŸ¤”</span> <span id="g4-toast-msg">å†æƒ³æƒ³çœ‹å–”</span></div></div>
    <div id="game5-wrapper" class="hidden-section flex flex-col h-screen bg-slate-50 text-slate-800 font-[Noto Sans TC]"><nav class="flex-none bg-purple-600 text-white shadow-lg z-20"><div class="max-w-7xl mx-auto px-2"><div class="flex items-center h-14 gap-4 overflow-x-auto no-scrollbar justify-between"><div class="flex items-center gap-4"><div class="flex-none font-bold text-lg px-2 flex items-center gap-2"><span>ğŸ“</span> <span class="hidden sm:inline">å…§å¿ƒèˆ‡é¢ç©</span></div><div id="g5-nav-buttons" class="flex gap-2 p-1"></div></div><button onclick="backToDashboard()" class="bg-purple-700 hover:bg-purple-800 px-4 py-2 rounded-lg text-sm font-bold shadow-sm ml-2 whitespace-nowrap">ğŸ  è¿”å›</button></div></div></nav><main class="flex-1 flex flex-col md:flex-row overflow-hidden relative"><section class="w-full md:w-5/12 bg-white border-b md:border-b-0 md:border-r border-slate-200 z-10 flex flex-col h-[40vh] md:h-full shadow-sm"><div class="p-5 overflow-y-auto flex-1"><div class="mb-3"><span id="g5-problem-tag" class="inline-block bg-purple-100 text-purple-700 text-xs font-bold px-2 py-1 rounded-full uppercase tracking-wide">å¹¾ä½•æ¦‚å¿µ</span></div><div id="g5-problem-desc" class="text-lg leading-relaxed space-y-4 mb-6"></div><div class="flex justify-center items-center bg-slate-50 rounded-xl border border-slate-100 p-4 min-h-[200px]"><svg id="g5-problem-svg" width="100%" height="100%" viewBox="0 0 320 220" preserveAspectRatio="xMidYMid meet"></svg></div></div></section><section class="w-full md:w-7/12 bg-slate-50 relative h-[60vh] md:h-full overflow-y-auto scroll-smooth" id="g5-steps-scroll-area"><div class="max-w-3xl mx-auto p-4 md:p-8 space-y-6 pb-32" id="g5-steps-container"></div></section></main><div id="g5-completion-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 opacity-0 transition-opacity duration-300"><div class="bg-white rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-sm text-center transform scale-90 transition-transform duration-300" id="g5-modal-box"><div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-5"><svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><h2 class="text-2xl font-bold text-slate-800 mb-2">å¤ªæ£’äº†ï¼</h2><div class="space-y-3 mt-6"><button onclick="closeG5Modal()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl transition shadow-md active:scale-95">ç¹¼çºŒ / è¿”å›</button></div></div></div></div>
    <div id="game6-wrapper" class="hidden-section flex flex-col h-screen bg-f0f9ff text-slate-800 overflow-hidden font-[Noto Sans TC]"><nav class="bg-white shadow-sm z-30 flex-none relative"><div class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between"><div class="flex items-center gap-4"><div class="flex-shrink-0 mr-2 flex items-center gap-2"><span class="bg-cyan-600 text-white p-1.5 rounded-lg"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg></span><span class="font-bold text-lg text-slate-700 hidden sm:block">ç›´è§’ä¸‰è§’å½¢å…§åˆ‡åœ“</span></div><div class="flex-1 overflow-x-auto no-scrollbar"><div id="g6-nav-buttons" class="flex gap-2 py-2"></div></div></div><button onclick="backToDashboard()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm whitespace-nowrap">ğŸ  è¿”å›</button></div></nav><main class="flex-1 overflow-hidden relative w-full max-w-7xl mx-auto flex flex-col md:flex-row"><section class="flex-none z-20 bg-slate-50 border-b md:border-b-0 md:border-r border-slate-200 shadow-sm h-auto max-h-[45vh] md:h-full md:max-h-none md:w-5/12 lg:w-4/12 flex flex-col"><div class="flex-1 overflow-y-auto custom-scrollbar p-5"><div class="mb-4"><h2 class="text-xl font-bold text-slate-800 flex items-center mb-2"><span class="w-2 h-8 bg-cyan-500 rounded-full mr-3"></span><span id="g6-problem-title"></span></h2><p id="g6-problem-desc" class="text-lg text-slate-600 leading-relaxed font-medium pl-5"></p></div><div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4 mb-4 flex justify-center items-center relative overflow-hidden group"><svg width="260" height="220" viewBox="0 0 260 220" class="relative z-10 transition-transform duration-500 group-hover:scale-105"><path d="M50,190 L210,190 L50,30 Z" fill="#f1f5f9" stroke="#334155" stroke-width="4" stroke-linejoin="round" class="drop-shadow-md"/><path d="M50,170 L70,170 L70,190" fill="none" stroke="#64748b" stroke-width="2"/><text id="g6-label-h" x="35" y="110" text-anchor="end" class="g6-svg-text" font-size="22" fill="#e11d48">AB</text><text id="g6-label-w" x="130" y="215" text-anchor="middle" class="g6-svg-text" font-size="22" fill="#e11d48">BC</text><text id="g6-label-hyp" x="140" y="100" text-anchor="start" class="g6-svg-text" font-size="22" fill="#059669">AC</text></svg></div><div class="bg-amber-50 border border-amber-200 rounded-xl p-4 text-center"><div class="inline-block bg-white px-4 py-2 rounded-lg border border-amber-100 shadow-sm"><span class="font-bold text-slate-700 text-lg">(<span class="text-blue-600">è‚¡</span>ï¼‹<span class="text-blue-600">è‚¡</span>ï¼<span class="text-green-600">æ–œé‚Š</span>) Ã· 2 ï¼ <span class="text-red-600">åŠå¾‘</span></span></div></div></div></section><section class="flex-1 bg-white relative h-full overflow-hidden flex flex-col"><div id="g6-steps-container" class="flex-1 overflow-y-auto scroll-smooth custom-scrollbar p-4 md:p-8 pb-32"><div id="g6-steps-wrapper" class="max-w-2xl mx-auto space-y-6"></div><div class="h-24"></div></div></section></main><div id="g6-completion-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden"><div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm opacity-0 transition-opacity" id="g6-modal-backdrop"></div><div class="bg-white rounded-3xl p-8 max-w-sm w-full mx-4 shadow-2xl transform scale-90 opacity-0 transition-all duration-300 relative z-10 flex flex-col items-center text-center" id="g6-modal-content"><div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 shadow-inner animate-tada"><svg class="w-14 h-14 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><h3 class="text-3xl font-bold text-slate-800 mb-3">å¤ªæ£’äº†ï¼ğŸ‰</h3><div class="flex flex-col gap-3 w-full"><button onclick="closeG6Modal()" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3.5 px-6 rounded-2xl transition-all shadow-lg active:scale-95">ç¹¼çºŒ / è¿”å›</button></div></div></div></div>
    <div id="game7-wrapper" class="hidden-section flex flex-col h-screen bg-f3f4f6 text-slate-800 overflow-hidden font-[Noto Sans TC]"><nav class="bg-white shadow-md z-50 flex-none"><div class="max-w-7xl mx-auto px-4"><div class="flex items-center h-16 justify-between"><div class="flex items-center space-x-4 overflow-x-auto no-scrollbar"><div class="flex-shrink-0 font-bold text-gray-700 mr-2 flex items-center gap-2"><span>âš–ï¸</span> ä¸‰è§’å½¢çš„é‡å¿ƒ</div><div id="g7-nav-buttons" class="flex gap-2"></div></div><button onclick="backToDashboard()" class="bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm whitespace-nowrap ml-2">ğŸ  è¿”å›</button></div></div></nav><main class="flex-1 flex flex-col md:flex-row overflow-hidden relative"><section class="w-full md:w-1/3 bg-white border-r border-gray-200 overflow-y-auto p-6 md:h-full relative shadow-sm z-10"><div class="mb-4"><h2 class="text-xl font-bold mb-4 text-gray-800" id="g7-problem-title"></h2><p class="mb-4 text-gray-600 leading-relaxed" id="g7-problem-desc"></p><div class="bg-blue-50 p-4 rounded-xl flex justify-center items-center mb-4 border border-blue-100" id="g7-svg-container"></div></div></section><section class="w-full md:w-2/3 bg-gray-50 overflow-y-auto p-6 relative"><div id="g7-steps-container" class="max-w-2xl mx-auto pb-24"></div></section></main><div id="g7-completion-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden"><div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm opacity-0 transition-opacity" id="g7-modal-backdrop"></div><div class="bg-white rounded-3xl p-8 max-w-sm w-full mx-4 shadow-2xl transform scale-90 opacity-0 transition-all duration-300 relative z-10 flex flex-col items-center text-center" id="g7-modal-content"><div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 shadow-inner animate-tada"><svg class="w-14 h-14 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><h3 class="text-3xl font-bold text-slate-800 mb-3">å¤ªæ£’äº†ï¼ğŸ‰</h3><div class="flex flex-col gap-3 w-full"><button onclick="closeG7Modal()" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3.5 px-6 rounded-2xl transition-all shadow-lg active:scale-95">ç¹¼çºŒ / è¿”å›</button></div></div></div></div>

    <!-- ================= 8. éŠæˆ²å…«ï¼šé‡å¿ƒèˆ‡é¢ç© (æ–°) ================= -->
    <div id="game8-wrapper" class="hidden-section flex flex-col h-screen bg-slate-50 text-slate-800 font-[Noto Sans TC]">
        <nav class="bg-slate-800 text-white shadow-md z-20 flex-none">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex items-center h-16 justify-between">
                    <div class="flex items-center space-x-4 overflow-x-auto no-scrollbar">
                        <div class="flex-shrink-0 font-bold text-lg text-yellow-400 mr-2 flex items-center gap-2"><span>â›°ï¸</span> é‡å¿ƒèˆ‡é¢ç©</div>
                        <div id="g8-nav-buttons" class="flex gap-2 p-1"></div>
                    </div>
                    <button onclick="backToDashboard()" class="bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg text-sm font-bold shadow-sm whitespace-nowrap ml-2">ğŸ  è¿”å›</button>
                </div>
            </div>
        </nav>
        <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
            <section class="w-full md:w-1/3 bg-white border-r border-gray-200 overflow-y-auto p-6 md:h-full relative shadow-sm z-10">
                <div class="mb-4">
                    <h2 class="text-xl font-bold mb-4 text-blue-800" id="g8-problem-title"></h2>
                    <p class="mb-4 text-lg text-gray-700 leading-relaxed" id="g8-problem-desc"></p>
                    <div class="bg-blue-50 p-4 rounded-xl flex justify-center items-center mb-4 border border-blue-100" id="g8-svg-container"></div>
                </div>
            </section>
            <section class="w-full md:w-2/3 bg-gray-50 overflow-y-auto p-6 relative">
                <div id="g8-steps-container" class="max-w-2xl mx-auto pb-24 space-y-6"></div>
            </section>
        </main>
        <div id="g8-completion-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden"><div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm opacity-0 transition-opacity" id="g8-modal-backdrop"></div><div class="bg-white rounded-3xl p-8 max-w-sm w-full mx-4 shadow-2xl transform scale-90 opacity-0 transition-all duration-300 relative z-10 flex flex-col items-center text-center" id="g8-modal-content"><div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 shadow-inner animate-tada"><svg class="w-14 h-14 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><h3 class="text-3xl font-bold text-slate-800 mb-3">å¤ªæ£’äº†ï¼ğŸ‰</h3><div class="flex flex-col gap-3 w-full"><button onclick="closeG8Modal()" class="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3.5 px-6 rounded-2xl transition-all shadow-lg active:scale-95">ç¹¼çºŒ / è¿”å›</button></div></div></div>
    </div>

    <!-- ================= JAVASCRIPT é‚è¼¯ ================= -->
    <script>
        // --- å…¨åŸŸè³‡æ–™ç®¡ç† ---
        const DB_KEY = 'geometry_master_all_in_one_v6';
        
        function getStats() {
            const defaultStats = {
                game1: { correct: 0, total: 0, completedRounds: 0, maxScore: 0 },
                game2: { completedProblems: [] }, game3: { completedProblems: [] },
                game4: { completedProblems: [] }, game5: { completedProblems: [] },
                game6: { completedProblems: [] }, game7: { completedProblems: [] },
                game8: { completedProblems: [] } // æ–°å¢ G8
            };
            try {
                const data = JSON.parse(localStorage.getItem(DB_KEY));
                return { ...defaultStats, ...data, game8: { ...defaultStats.game8, ...(data?.game8 || {}) } };
            } catch(e) { return defaultStats; }
        }

        function saveStats(stats) { localStorage.setItem(DB_KEY, JSON.stringify(stats)); updateRadarChart(); }
        function clearAllProgress() { if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å­¸ç¿’ç´€éŒ„å—ï¼Ÿ")) { localStorage.removeItem(DB_KEY); location.reload(); } }

        // --- å„€è¡¨æ¿ ---
        let radarChartInstance = null;
        function initDashboard() { updateRadarChart(); }

        function updateRadarChart() {
            const stats = getStats();
            const ctx = document.getElementById('skillsRadar').getContext('2d');
            
            const g1Accuracy = stats.game1.total > 0 ? Math.round((stats.game1.correct / stats.game1.total) * 100) : 0;
            const g1Mastery = stats.game1.completedRounds > 0 ? Math.min(100, (stats.game1.maxScore / 60) * 100) : 0;
            const g2Percent = Math.round((stats.game2.completedProblems.length / 4) * 100);
            const g3Percent = Math.round((stats.game3.completedProblems.length / 4) * 100);
            const g4Percent = Math.round((stats.game4.completedProblems.length / 3) * 100);
            const g5Percent = Math.round((stats.game5.completedProblems.length / 4) * 100);
            const g6Percent = Math.round((stats.game6.completedProblems.length / 3) * 100);
            const g7Percent = Math.round((stats.game7.completedProblems.length / 4) * 100);
            const g8Percent = Math.round((stats.game8.completedProblems.length / 3) * 100);
            const totalPercent = Math.round((g2Percent + g3Percent + g1Accuracy + g4Percent + g5Percent + g6Percent + g7Percent + g8Percent)/8);

            document.getElementById('stat-concept-acc').innerText = `${g1Accuracy}%`;
            document.getElementById('stat-calc-g2').innerText = `${stats.game2.completedProblems.length}/4`;
            document.getElementById('stat-calc-g3').innerText = `${stats.game3.completedProblems.length}/4`;
            document.getElementById('stat-calc-g4').innerText = `${stats.game4.completedProblems.length}/3`;
            document.getElementById('stat-calc-g5').innerText = `${stats.game5.completedProblems.length}/4`;
            document.getElementById('stat-calc-g6').innerText = `${stats.game6.completedProblems.length}/3`;
            document.getElementById('stat-calc-g7').innerText = `${stats.game7.completedProblems.length}/4`;
            document.getElementById('stat-calc-g8').innerText = `${stats.game8.completedProblems.length}/3`;

            const data = {
                labels: ['è§€å¿µæº–ç¢º', 'è§€å¿µç†Ÿç·´', 'é•·åº¦é‹ç®—', 'å¤–å¿ƒè§’åº¦', 'å…§å¿ƒæ€§è³ª', 'å…§å¿ƒé¢ç©', 'å…§åˆ‡åœ“åŠå¾‘', 'é‡å¿ƒæ€§è³ª', 'é‡å¿ƒé¢ç©', 'ç¸½é«”é€²åº¦'],
                datasets: [{
                    label: 'èƒ½åŠ›åˆ†æ',
                    data: [g1Accuracy, g1Mastery, g2Percent, g3Percent, g4Percent, g5Percent, g6Percent, g7Percent, g8Percent, totalPercent],
                    fill: true,
                    backgroundColor: 'rgba(234, 179, 8, 0.2)', // Yellow tint
                    borderColor: 'rgb(234, 179, 8)',
                    pointBackgroundColor: 'rgb(234, 179, 8)',
                    pointBorderColor: '#fff'
                }]
            };

            if (radarChartInstance) { radarChartInstance.data = data; radarChartInstance.update(); } 
            else { radarChartInstance = new Chart(ctx, { type: 'radar', data: data, options: { elements: { line: { borderWidth: 3 } }, scales: { r: { min: 0, max: 100, ticks: { stepSize: 20 } } }, plugins: { legend: { display: false } } } }); }
        }

        function switchScreen(screenId, bgColor) {
            document.querySelectorAll('.hidden-section, #dashboard-container, #game1-wrapper, #game2-wrapper, #game3-wrapper, #game4-wrapper, #game5-wrapper, #game6-wrapper, #game7-wrapper, #game8-wrapper').forEach(el => { if(el.id !== screenId) el.classList.add('hidden-section'); });
            document.getElementById(screenId).classList.remove('hidden-section');
            document.body.style.background = bgColor;
        }

        function launchGame1() { switchScreen('game1-wrapper', "linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 50%, #DEB887 50%, #D2691E 100%)"); showG1Screen('g1-start-screen'); }
        function launchGame2() { switchScreen('game2-wrapper', "#f8fafc"); initGame2(); }
        function launchGame3() { switchScreen('game3-wrapper', "#f8fafc"); initGame3(); }
        function launchGame4() { switchScreen('game4-wrapper', "#f0f9ff"); initGame4(); }
        function launchGame5() { switchScreen('game5-wrapper', "#f8fafc"); initGame5(); }
        function launchGame6() { switchScreen('game6-wrapper', "#f0f9ff"); initGame6(); }
        function launchGame7() { switchScreen('game7-wrapper', "#f3f4f6"); initGame7(); }
        function launchGame8() { switchScreen('game8-wrapper', "#f3f4f6"); initGame8(); }
        function backToDashboard() { switchScreen('dashboard-container', "#f3f4f6"); updateRadarChart(); }

        // [Game 1-7 Logic reused from previous versions, collapsed for brevity]
        const g1Questions = [{ q: "â–³ABCç‚º<u>ç›´è§’ä¸‰è§’å½¢</u>ï¼ŒOé»<u>åˆ°Aã€Bã€Cä¸‰é»ç­‰è·é›¢</u>ï¼Œå‰‡Oé»æœƒè½åœ¨â–³ABCçš„å“ªä¸€å€‹ä½ç½®ï¼Ÿ", a: "æ–œé‚Šä¸Š", options: ["å¤–éƒ¨", "å…§éƒ¨", "æ–œé‚Šä¸Š"] }, { q: "â–³ABCç‚º<u>éŠ³è§’ä¸‰è§’å½¢</u>ï¼ŒOé»<u>åˆ°Aã€Bã€Cä¸‰é»ç­‰è·é›¢</u>ï¼Œå‰‡Oé»æœƒè½åœ¨â–³ABCçš„å“ªä¸€å€‹ä½ç½®ï¼Ÿ", a: "å…§éƒ¨", options: ["å¤–éƒ¨", "å…§éƒ¨", "æ–œé‚Šä¸Š"] }, { q: "â–³ABCç‚º<u>éˆè§’ä¸‰è§’å½¢</u>ï¼ŒOé»<u>åˆ°Aã€Bã€Cä¸‰é»ç­‰è·é›¢</u>ï¼Œå‰‡Oé»æœƒè½åœ¨â–³ABCçš„å“ªä¸€å€‹ä½ç½®ï¼Ÿ", a: "å¤–éƒ¨", options: ["å¤–éƒ¨", "å…§éƒ¨", "æ–œé‚Šä¸Š"] }, { q: "â–³ABCä¸­ï¼Œ<u>âˆ A=90Â°</u>ï¼Œè‹¥Oé»<u>åˆ°Aã€Bã€Cä¸‰é»ç­‰è·é›¢</u>ï¼Œå‰‡Oé»æœƒè½åœ¨â–³ABCçš„å“ªä¸€å€‹ä½ç½®ï¼Ÿ", a: "æ–œé‚Šä¸Š", options: ["å¤–éƒ¨", "å…§éƒ¨", "æ–œé‚Šä¸Š"] }, { q: "â–³ABCä¸­ï¼Œ<u>âˆ A=100Â°</u>ï¼Œè‹¥Oé»<u>åˆ°Aã€Bã€Cä¸‰é»ç­‰è·é›¢</u>ï¼Œå‰‡Oé»æœƒè½åœ¨â–³ABCçš„å“ªä¸€å€‹ä½ç½®ï¼Ÿ", a: "å¤–éƒ¨", options: ["å¤–éƒ¨", "å…§éƒ¨", "æ–œé‚Šä¸Š"] }, { q: "â–³ABCç‚º<u>æ­£ä¸‰è§’å½¢</u>ï¼Œè‹¥Oé»<u>åˆ°Aã€Bã€Cä¸‰é»ç­‰è·é›¢</u>ï¼Œå‰‡Oé»æœƒè½åœ¨â–³ABCçš„å“ªä¸€å€‹ä½ç½®ï¼Ÿ", a: "å…§éƒ¨", options: ["å¤–éƒ¨", "å…§éƒ¨", "æ–œé‚Šä¸Š"] }];
        let g1CurrentIndex = 0; let g1Score = 0;
        function showG1Screen(id) { document.querySelectorAll('.game1-theme .paper-card').forEach(el => el.classList.add('hidden-section')); document.getElementById(id).classList.remove('hidden-section'); }
        function startCowboyGame() { g1Score = 0; g1CurrentIndex = 0; document.getElementById('g1-score-display').innerText = "0"; showG1Screen('g1-quiz-screen'); loadG1Question(); }
        function loadG1Question() { const qData = g1Questions[g1CurrentIndex]; document.getElementById('g1-progress-display').innerText = `é—œå¡ï¼š${g1CurrentIndex + 1} / ${g1Questions.length}`; document.getElementById('g1-question-container').innerHTML = qData.q; const optsDiv = document.getElementById('g1-options-container'); optsDiv.innerHTML = ''; document.getElementById('g1-feedback-area').innerHTML = ''; document.getElementById('g1-next-btn').disabled = true; document.getElementById('g1-next-btn').style.opacity = "0.5"; let shuffledOpts = [...qData.options].sort(() => Math.random() - 0.5); shuffledOpts.forEach(opt => { const btn = document.createElement('button'); btn.className = 'option-btn'; btn.innerText = opt; btn.onclick = () => checkG1Answer(opt, qData.a, btn); optsDiv.appendChild(btn); }); }
        function checkG1Answer(selected, correct, btn) { if (btn.parentElement.querySelector('.disabled')) return; const isCorrect = selected === correct; const stats = getStats(); stats.game1.total++; if (isCorrect) { g1Score += 10; stats.game1.correct++; document.getElementById('g1-score-display').innerText = g1Score; btn.classList.add('correct'); document.getElementById('g1-feedback-area').innerHTML = `<span style="color: green;">âœ” ç­”å°äº†ï¼</span>`; } else { btn.classList.add('wrong'); Array.from(document.querySelectorAll('#g1-options-container .option-btn')).forEach(b => { if (b.innerText === correct) b.classList.add('correct'); }); document.getElementById('g1-feedback-area').innerHTML = `<span style="color: #b71c1c;">âœ˜ æ­£è§£æ˜¯: ${correct}</span>`; } Array.from(document.querySelectorAll('#g1-options-container .option-btn')).forEach(b => { b.classList.add('disabled'); b.style.pointerEvents = 'none'; }); document.getElementById('g1-next-btn').disabled = false; document.getElementById('g1-next-btn').style.opacity = "1"; saveStats(stats); }
        function g1NextQuestion() { if (g1CurrentIndex < g1Questions.length - 1) { g1CurrentIndex++; loadG1Question(); } else { showG1Screen('g1-result-screen'); document.getElementById('g1-final-score').innerText = `æœ¬å±€è³é‡‘ï¼š$${g1Score}`; const stats = getStats(); stats.game1.completedRounds++; if (g1Score > stats.game1.maxScore) stats.game1.maxScore = g1Score; saveStats(stats); } }
        function restartCowboyGame() { startCowboyGame(); }
        // Game 2
        const g2Problems = [{ id: 1, title: "é¡Œç›® 1", desc: `å¦‚åœ–ï¼Œ\\(\\triangle ABC\\) ä¸­ï¼Œ\\(\\angle B = 90^\\circ\\)ï¼Œ<br> \\(AB = 10\\)ï¼Œ\\(BC = 24\\)ï¼Œ<br> æ±‚ \\(\\triangle ABC\\) çš„å¤–æ¥åœ“åŠå¾‘ã€‚`, hint: `ç›´è§’ä¸‰è§’å½¢å¤–æ¥åœ“åŠå¾‘ = æ–œé‚Šçš„ä¸€åŠ`, svg: `<svg viewBox="-5 -5 40 25" class="w-full h-full"><path d="M0,10 L0,0 L24,0 Z" fill="#e0f2fe" stroke="#334155" stroke-width="0.8"/><text x="-2" y="5" font-size="2" fill="blue">10</text><text x="12" y="3" font-size="2" fill="blue">24</text></svg>`, steps: [ { instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºæ–œé‚Šé•·åº¦", template: `<div class="math-container">\\(c = \\sqrt{10^2 + 24^2} = \\sqrt{676} = \\)<span class="g2-slot" data-ans="26"></span></div>`, options: ["26", "24", "10"], hint: "676 é–‹æ ¹è™Ÿ" }, { instruction: "æ­¥é©Ÿ 2ï¼šç®—å‡ºå¤–æ¥åœ“åŠå¾‘", template: `<div class="math-container"><span class="g2-slot" data-ans="26"></span> Ã· 2 = <span class="g2-slot" data-ans="13"></span></div>`, options: ["26", "13", "12"], hint: "æ–œé‚Šä¸€åŠ" } ] }, { id: 2, title: "é¡Œç›® 2", desc: `å¦‚åœ–ï¼Œ\\(\\triangle ABC\\) ä¸­ï¼Œ\\(\\angle C = 90^\\circ\\)ï¼Œ\\(AC = 6\\)ï¼Œ\\(BC = 8\\)ï¼Œæ±‚å¤–æ¥åœ“åŠå¾‘ã€‚`, hint: `ç›´è§’ä¸‰è§’å½¢å¤–æ¥åœ“åŠå¾‘ = æ–œé‚Šçš„ä¸€åŠ`, svg: `<svg viewBox="-2 -2 15 12" class="w-full h-full"><path d="M0,6 L0,0 L8,0 Z" fill="#fff7ed" stroke="#334155" stroke-width="0.5"/><text x="-1.5" y="3" font-size="1" fill="blue">6</text><text x="4" y="1.5" font-size="1" fill="blue">8</text></svg>`, steps: [ { instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºæ–œé‚Šé•·åº¦", template: `<div class="math-container">\\(c = \\sqrt{6^2 + 8^2} = \\sqrt{100} = \\)<span class="g2-slot" data-ans="10"></span></div>`, options: ["6", "8", "10"], hint: "100 é–‹æ ¹è™Ÿ" }, { instruction: "æ­¥é©Ÿ 2ï¼šç®—å‡ºå¤–æ¥åœ“åŠå¾‘", template: `<div class="math-container"><span class="g2-slot" data-ans="10"></span> Ã· 2 = <span class="g2-slot" data-ans="5"></span></div>`, options: ["10", "5", "4"], hint: "æ–œé‚Šä¸€åŠ" } ] }, { id: 3, title: "é¡Œç›® 3", desc: `å¦‚åœ–ï¼Œ\\(\\triangle ABC\\) ä¸­ï¼Œ\\(\\angle B = 90^\\circ\\)ï¼Œ\\(AB = 4\\)ï¼Œ\\(BC = 3\\)ï¼Œæ±‚å¤–æ¥åœ“é¢ç©ã€‚`, hint: `é¢ç© = \\(\\pi R^2\\)`, svg: `<svg viewBox="-2 -2 6 6" class="w-full h-full"><path d="M0,4 L0,0 L3,0 Z" fill="#e0f2fe" stroke="#334155" stroke-width="0.2"/><text x="-0.8" y="2" font-size="0.6" fill="blue">4</text><text x="1.5" y="-0.3" font-size="0.6" fill="blue">3</text></svg>`, steps: [ { instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºæ–œé‚Š", template: `<div class="math-container">\\(c = \\sqrt{3^2 + 4^2} = \\)<span class="g2-slot" data-ans="5"></span></div>`, options: ["5", "7", "12"], hint: "å•†é«˜æ•¸ 3-4-5" }, { instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾åŠå¾‘", template: `<div class="math-container"><span class="g2-slot" data-ans="5"></span> Ã· 2 = <span class="g2-slot" data-ans="2.5"></span></div>`, options: ["5", "2.5"], hint: "ä¸€åŠ" }, { instruction: "æ­¥é©Ÿ 3ï¼šæ±‚é¢ç©", template: `<div class="math-container">\\(\\pi \\times 2.5^2 = \\)<span class="g2-slot" data-ans="6.25"></span>\\(\\pi\\)</div>`, options: ["6.25", "5"], hint: "2.5*2.5" } ] }, { id: 4, title: "é¡Œç›® 4", desc: `å¦‚åœ–ï¼Œ\\(\\triangle ABC\\) ä¸­ï¼Œ\\(\\angle C = 90^\\circ\\)ï¼Œ\\(AC = 6\\)ï¼Œ\\(BC = 8\\)ï¼Œæ±‚å¤–æ¥åœ“é¢ç©ã€‚`, hint: `å…ˆç®—åŠå¾‘ï¼Œå†ç®—é¢ç©`, svg: `<svg viewBox="-2 -2 12 10" class="w-full h-full"><path d="M0,6 L0,0 L8,0 Z" fill="#e0f2fe" stroke="#334155" stroke-width="0.2"/><text x="-1.5" y="3" font-size="1" fill="blue">6</text><text x="4" y="-0.5" font-size="1" fill="blue">8</text></svg>`, steps: [ { instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾æ–œé‚Š", template: `<div class="math-container">\\(c = \\sqrt{6^2 + 8^2} = \\)<span class="g2-slot" data-ans="10"></span></div>`, options: ["10", "14"], hint: "6-8-10" }, { instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾åŠå¾‘", template: `<div class="math-container"><span class="g2-slot" data-ans="10"></span> Ã· 2 = <span class="g2-slot" data-ans="5"></span></div>`, options: ["5", "10"], hint: "ä¸€åŠ" }, { instruction: "æ­¥é©Ÿ 3ï¼šæ±‚é¢ç©", template: `<div class="math-container">\\(\\pi \\times 5^2 = \\)<span class="g2-slot" data-ans="25"></span>\\(\\pi\\)</div>`, options: ["25", "10"], hint: "5*5" } ] }];
        let g2CurrentProblemIndex = 0; function initGame2() { renderG2Nav(); loadG2Problem(0); } function renderG2Nav() { const nav = document.getElementById('g2-nav-buttons'); nav.innerHTML = ''; g2Problems.forEach((prob, index) => { const btn = document.createElement('button'); const stats = getStats(); const isDone = stats.game2.completedProblems.includes(prob.id); btn.className = `whitespace-nowrap px-4 py-2 rounded-full font-bold transition-all ${index === g2CurrentProblemIndex ? 'bg-blue-600 text-white shadow-md' : isDone ? 'bg-green-100 text-green-700 border border-green-300' : 'bg-slate-200 text-slate-500 hover:bg-slate-300'}`; btn.textContent = prob.title + (isDone ? ' âœ”' : ''); btn.onclick = () => loadG2Problem(index); nav.appendChild(btn); }); } function loadG2Problem(index) { g2CurrentProblemIndex = index; renderG2Nav(); const p = g2Problems[index]; document.getElementById('g2-problem-title').textContent = p.title; document.getElementById('g2-problem-desc').innerHTML = p.desc; renderMathInElement(document.getElementById('g2-problem-desc'), { delimiters: [{left: '\\(', right: '\\)', display: false}] }); document.getElementById('g2-svg-container').innerHTML = p.svg; document.getElementById('g2-hint-container').innerHTML = p.hint; document.querySelector('#g2-steps-container > div').innerHTML = ''; renderG2Step(0); } function renderG2Step(stepIdx) { const problem = g2Problems[g2CurrentProblemIndex]; if (stepIdx >= problem.steps.length) { const stats = getStats(); if (!stats.game2.completedProblems.includes(problem.id)) { stats.game2.completedProblems.push(problem.id); saveStats(stats); renderG2Nav(); } document.getElementById('g2-completion-modal').classList.remove('hidden'); return; } const stepData = problem.steps[stepIdx]; const container = document.querySelector('#g2-steps-container > div'); const stepDiv = document.createElement('div'); stepDiv.className = `step-block bg-white rounded-2xl p-6 shadow-sm mb-6 border-l-8 border-slate-300`; stepDiv.innerHTML = `<div class="flex items-center justify-between mb-4"><h3 class="text-lg font-bold text-slate-700">${stepData.instruction}</h3><span class="status-icon hidden text-green-500 font-bold text-xl">âœ”</span></div><div class="flex flex-col items-center gap-4"><div class="math-template w-full flex justify-center flex-wrap">${stepData.template}</div><div class="options-area flex flex-wrap justify-center gap-2 w-full mt-2"></div></div>`; container.appendChild(stepDiv); renderMathInElement(stepDiv, { delimiters: [{left: '\\(', right: '\\)', display: false}] }); const slots = stepDiv.querySelectorAll('.g2-slot'); const optionsArea = stepDiv.querySelector('.options-area'); stepData.options.forEach(optVal => { const btn = document.createElement('button'); btn.className = 'bg-white border-2 border-slate-300 border-b-4 px-4 py-2 rounded-lg font-bold text-slate-600 hover:bg-slate-50 active:border-b-2 active:translate-y-[2px]'; btn.textContent = optVal; btn.onclick = () => { let filled = false; slots.forEach(s => { if (!s.textContent && !filled) { s.textContent = optVal; s.classList.add('filled'); filled = true; } }); if (Array.from(slots).every(s => s.textContent)) { let allCorrect = true; slots.forEach(s => { if (s.textContent !== s.dataset.ans) allCorrect = false; }); if (allCorrect) { slots.forEach(s => s.classList.add('correct')); stepDiv.classList.add('border-green-400'); stepDiv.classList.remove('border-slate-300'); stepDiv.querySelector('.status-icon').classList.remove('hidden'); optionsArea.style.display = 'none'; renderG2Step(stepIdx + 1); } else { slots.forEach(s => { s.classList.add('bg-red-100'); setTimeout(() => { s.textContent = ''; s.classList.remove('filled', 'bg-red-100'); }, 500); }); } } }; optionsArea.appendChild(btn); }); setTimeout(() => stepDiv.classList.add('visible'), 50); document.getElementById('g2-steps-container').scrollTo(0, document.getElementById('g2-steps-container').scrollHeight); } function closeG2Modal() { document.getElementById('g2-completion-modal').classList.add('hidden'); }
        // Game 3
        const g3Problems = [{ id: 1, title: "é¡Œç›® 1", type: "å¹¾ä½•ï¼šå¤–å¿ƒæ€§è³ª", text: "å¦‚åœ–ï¼Œ<span class='math-text'>â–³ABC</span> ä¸­ï¼Œ<span class='math-text'>âˆ A = 75Â°</span>ï¼Œ<span class='math-text'>O</span> é»ç‚º <span class='math-text'>â–³ABC</span> çš„å¤–å¿ƒï¼Œæ±‚ <span class='math-text'>âˆ BOC</span>ã€‚", svg: `<svg width="200" height="150" viewBox="0 0 240 200"><polygon points="60,30 20,150 220,150" fill="#fde2e9" stroke="#333" stroke-width="2"/><circle cx="120" cy="110" r="3" fill="#333"/><text x="120" y="130" text-anchor="middle" font-size="16">O</text><text x="55" y="25" font-size="16">A</text><text x="10" y="160" font-size="16">B</text><text x="225" y="160" font-size="16">C</text><line x1="20" y1="150" x2="120" y2="110" stroke="#333" stroke-width="1.5"/><line x1="220" y1="150" x2="120" y2="110" stroke="#333" stroke-width="1.5"/></svg>`, steps: [ { instruction: "é¡Œç›®å·²çŸ¥ âˆ A æ˜¯å¹¾åº¦ï¼Ÿ", template: "<span class='math-text'>âˆ A = <div class='g3-slot' data-ans='75'></div>Â°</span>", options: ["60", "75", "90"] }, { instruction: "æ ¹æ“šå¤–å¿ƒæ€§è³ªï¼Œâˆ BOC æ˜¯ âˆ A çš„å¹¾å€ï¼Ÿ", template: "<span class='math-text'>âˆ BOC = <div class='g3-slot' data-ans='2'></div> Ã— âˆ A</span>", options: ["2", "3", "0.5"] }, { instruction: "è¨ˆç®— âˆ BOC çš„è§’åº¦ï¼š", template: "<span class='math-text'>= <div class='g3-slot' data-ans='2'></div> Ã— <div class='g3-slot' data-ans='75'></div>Â°</span>", options: ["2", "75", "60"] }, { instruction: "æœ€å¾Œç®—å‡ºç­”æ¡ˆï¼š", template: "<span class='math-text'>= <div class='g3-slot' data-ans='150'></div>Â°</span>", options: ["140", "150", "120"] } ] }, { id: 2, title: "é¡Œç›® 2", type: "å¹¾ä½•ï¼šå¤–å¿ƒæ€§è³ª", text: "å¦‚åœ–ï¼Œ<span class='math-text'>â–³ABC</span> ä¸­ï¼Œ<span class='math-text'>âˆ B = 60Â°</span>ï¼Œ<span class='math-text'>O</span> é»ç‚º <span class='math-text'>â–³ABC</span> çš„å¤–å¿ƒï¼Œæ±‚ <span class='math-text'>âˆ AOC</span>ã€‚", svg: `<svg width="200" height="150" viewBox="0 0 240 180"><polygon points="60,40 40,140 200,140" fill="none" stroke="#333" stroke-width="2"/><circle cx="100" cy="110" r="3" fill="#333"/><text x="100" y="100" text-anchor="middle" font-size="16">O</text><text x="60" y="30" font-size="16">B</text><text x="30" y="155" font-size="16">A</text><text x="210" y="155" font-size="16">C</text><line x1="40" y1="140" x2="100" y2="110" stroke="#333" stroke-width="1.5"/><line x1="200" y1="140" x2="100" y2="110" stroke="#333" stroke-width="1.5"/></svg>`, steps: [ { instruction: "é¡Œç›®å·²çŸ¥ âˆ B æ˜¯å¹¾åº¦ï¼Ÿ", template: "<span class='math-text'>âˆ B = <div class='g3-slot' data-ans='60'></div>Â°</span>", options: ["60", "30", "120"] }, { instruction: "æ ¹æ“šå¤–å¿ƒæ€§è³ªï¼Œâˆ AOC æ˜¯ âˆ B çš„å¹¾å€ï¼Ÿ", template: "<span class='math-text'>âˆ AOC = <div class='g3-slot' data-ans='2'></div> Ã— âˆ B</span>", options: ["2", "60", "3"] }, { instruction: "ç®—å‡º âˆ AOC çš„è§’åº¦ï¼š", template: "<span class='math-text'>= <div class='g3-slot' data-ans='2'></div> Ã— <div class='g3-slot' data-ans='60'></div>Â° = <div class='g3-slot' data-ans='120'></div>Â°</span>", options: ["2", "60", "120", "180"] } ] }, { id: 3, title: "é¡Œç›® 3", type: "å¹¾ä½•ï¼šè§’åº¦è¨ˆç®—", text: "å¦‚åœ–ï¼Œ<span class='math-text'>O</span> ç‚ºéŠ³è§’ <span class='math-text'>â–³ABC</span> å¤–å¿ƒï¼Œ<span class='math-text'>âˆ BAC=40Â°</span>ï¼Œ<span class='math-text'>âˆ ABC=82Â°</span>ï¼Œæ±‚ <span class='math-text'>âˆ AOB</span>ã€‚", svg: `<svg width="200" height="150" viewBox="0 0 240 200"><polygon points="100,20 40,160 200,160" fill="#dbeafe" stroke="#333" stroke-width="2"/><circle cx="120" cy="110" r="3" fill="#333"/><text x="120" y="135" text-anchor="middle" font-size="16">O</text><text x="100" y="15" font-size="16">A</text><text x="25" y="170" font-size="16">B</text><text x="210" y="170" font-size="16">C</text><line x1="100" y1="20" x2="120" y2="110" stroke="#555" stroke-dasharray="4"/><line x1="40" y1="160" x2="120" y2="110" stroke="#555" stroke-dasharray="4"/><line x1="200" y1="160" x2="120" y2="110" stroke="#555" stroke-dasharray="4"/></svg>`, steps: [ { instruction: "å…ˆç®—å‡º âˆ ACB (ä¸‰è§’å½¢å…§è§’å’Œ 180Â°)ï¼š", template: "<span class='math-text'>âˆ ACB = 180Â° - <div class='g3-slot' data-ans='40'></div>Â° - <div class='g3-slot' data-ans='82'></div>Â°</span>", options: ["40", "82", "180"] }, { instruction: "ç®—å‡º âˆ ACB çš„çµæœï¼š", template: "<span class='math-text'>= <div class='g3-slot' data-ans='58'></div>Â°</span>", options: ["58", "48", "60"] }, { instruction: "å› ç‚º âˆ AOB å°æ‡‰å¼§ ABï¼Œè§’åº¦æ˜¯ âˆ ACB çš„å…©å€ï¼š", template: "<span class='math-text'>âˆ AOB = <div class='g3-slot' data-ans='2'></div> Ã— âˆ ACB</span>", options: ["2", "3", "58"] }, { instruction: "å¸¶å…¥æ•¸å€¼è¨ˆç®—ï¼š", template: "<span class='math-text'>= <div class='g3-slot' data-ans='2'></div> Ã— <div class='g3-slot' data-ans='58'></div>Â°</span>", options: ["2", "58", "116"] }, { instruction: "æœ€å¾Œç­”æ¡ˆï¼š", template: "<span class='math-text'>= <div class='g3-slot' data-ans='116'></div>Â°</span>", options: ["116", "106", "126"] } ] }, { id: 4, title: "é¡Œç›® 4", type: "å¹¾ä½•ï¼šç­‰è…°èˆ‡å¤–å¿ƒ", text: "å¦‚åœ–ï¼Œ<span class='math-text'>O</span> é»ç‚ºéŠ³è§’ <span class='math-text'>â–³ABC</span> å¤–å¿ƒï¼Œ<span class='math-text'>âˆ BAO=40Â°</span>ï¼Œ<span class='math-text'>âˆ OAC=26Â°</span>ï¼Œæ±‚ <span class='math-text'>âˆ OBC</span>ã€‚", svg: `<svg width="200" height="180" viewBox="0 0 200 220"><polygon points="100,20 40,180 160,180" fill="none" stroke="#333" stroke-width="2"/><circle cx="100" cy="130" r="3" fill="#333"/><text x="100" y="155" text-anchor="middle" font-size="16">O</text><text x="100" y="15" font-size="16">A</text><text x="30" y="190" font-size="16">B</text><text x="170" y="190" font-size="16">C</text><line x1="100" y1="20" x2="100" y2="130" stroke="#555" stroke-dasharray="4"/><line x1="40" y1="180" x2="100" y2="130" stroke="#555" stroke-dasharray="4"/><line x1="160" y1="180" x2="100" y2="130" stroke="#555" stroke-dasharray="4"/></svg>`, steps: [ { instruction: "ç®—å‡º âˆ BAC (å°‡å…©å€‹è§’åº¦ç›¸åŠ )ï¼š", template: "<span class='math-text'>âˆ BAC = <div class='g3-slot' data-ans='40'></div> + <div class='g3-slot' data-ans='26'></div> = <div class='g3-slot' data-ans='66'></div>Â°</span>", options: ["40", "26", "66"] }, { instruction: "ç®—å‡ºä¸­å¿ƒè§’ âˆ BOC (å¤–å¿ƒæ€§è³ªæ˜¯ 2 å€)ï¼š", template: "<span class='math-text'>âˆ BOC = 2 Ã— <div class='g3-slot' data-ans='66'></div> = <div class='g3-slot' data-ans='132'></div>Â°</span>", options: ["66", "132", "2"] }, { instruction: "â–³OBC æ˜¯ç­‰è…°ä¸‰è§’å½¢ï¼Œç®—å‡ºå…©å€‹åº•è§’çš„ç¸½å’Œï¼š", template: "<span class='math-text'>180 - <div class='g3-slot' data-ans='132'></div> = <div class='g3-slot' data-ans='48'></div>Â°</span>", options: ["132", "180", "48"] }, { instruction: "æœ€å¾Œç®—å‡ºä¸€å€‹åº•è§’ âˆ OBCï¼š", template: "<span class='math-text'>âˆ OBC = <div class='g3-slot' data-ans='48'></div> Ã· 2 = <div class='g3-slot' data-ans='24'></div>Â°</span>", options: ["48", "24", "2"] } ] }];
        let g3CurrentProblemIndex = 0; function initGame3() { renderG3Nav(); loadG3Problem(0); } function renderG3Nav() { const container = document.getElementById('g3-nav-buttons'); container.innerHTML = g3Problems.map((p, idx) => { const stats = getStats(); const isDone = stats.game3.completedProblems.includes(p.id); return `<button onclick="loadG3Problem(${idx})" class="nav-btn px-4 py-2 rounded-full font-bold transition-all whitespace-nowrap ${idx === g3CurrentProblemIndex ? 'bg-indigo-700 text-white shadow-md opacity-100' : isDone ? 'bg-green-300 text-green-900' : 'bg-indigo-400 text-indigo-100 hover:bg-indigo-500'}">${p.title} ${isDone?'âœ”':''}</button>`; }).join(''); } function loadG3Problem(index) { g3CurrentProblemIndex = index; renderG3Nav(); document.getElementById('g3-completion-modal').classList.add('hidden'); const p = g3Problems[index]; document.getElementById('g3-q-type').textContent = p.type; document.getElementById('g3-q-text').innerHTML = p.text; document.getElementById('g3-q-svg').innerHTML = p.svg; const stepsArea = document.getElementById('g3-steps-area'); stepsArea.innerHTML = ''; p.steps.forEach((step, sIdx) => { const stepDiv = document.createElement('div'); stepDiv.id = `g3-step-${sIdx}`; stepDiv.className = `g3-step-container p-4 bg-white rounded-2xl border-2 border-slate-100 shadow-sm ${sIdx === 0 ? 'active' : ''}`; stepDiv.innerHTML = `<div class="flex items-center justify-between mb-3"><span class="text-slate-500 font-bold text-sm tracking-wider uppercase">Step ${sIdx + 1}</span><span class="check-icon text-green-500 font-bold opacity-0 transition-opacity">âœ” å®Œæˆ</span></div><p class="text-lg text-slate-700 font-medium mb-3">${step.instruction}</p><div class="mb-4 text-xl flex flex-wrap items-center gap-2">${step.template}</div><div class="options-area flex flex-wrap gap-3 mt-2">${step.options.map(opt => `<button class="g3-option-btn" onclick="handleG3OptionClick(this, '${opt}', ${sIdx})">${opt}</button>`).join('')}<button class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold ml-auto hover:bg-indigo-700 shadow-lg shadow-indigo-200" onclick="checkG3Step(${sIdx})">æª¢æŸ¥</button></div>`; stepsArea.appendChild(stepDiv); stepDiv.querySelectorAll('.g3-slot').forEach(slot => { slot.addEventListener('click', () => { if (!slot.classList.contains('correct')) { const val = slot.textContent; slot.textContent = ''; slot.classList.remove('filled', 'error'); const btns = stepDiv.querySelectorAll('.g3-option-btn'); for (let btn of btns) { if (btn.textContent === val) btn.disabled = false; } } }); }); }); } function handleG3OptionClick(btn, value, stepIdx) { const stepDiv = document.getElementById(`g3-step-${stepIdx}`); const emptySlots = Array.from(stepDiv.querySelectorAll('.g3-slot')).filter(s => !s.classList.contains('filled')); if (emptySlots.length > 0) { const slot = emptySlots[0]; slot.textContent = value; slot.dataset.value = value; slot.classList.add('filled'); btn.disabled = true; } } function checkG3Step(stepIdx) { const stepDiv = document.getElementById(`g3-step-${stepIdx}`); const slots = stepDiv.querySelectorAll('.g3-slot'); let allCorrect = true; let allFilled = true; slots.forEach(slot => { if (!slot.classList.contains('filled')) { allFilled = false; return; } if (slot.dataset.value !== slot.dataset.ans) { allCorrect = false; slot.classList.add('error'); setTimeout(() => slot.classList.remove('error'), 500); } else { slot.classList.add('correct'); } }); if (!allFilled) { alert("è«‹å¡«æ»¿ç©ºæ ¼"); return; } if (allCorrect) { stepDiv.classList.add('done'); stepDiv.querySelector('.check-icon').classList.remove('opacity-0'); if (stepIdx < g3Problems[g3CurrentProblemIndex].steps.length - 1) { const nextStep = document.getElementById(`g3-step-${stepIdx + 1}`); nextStep.classList.add('active'); setTimeout(() => nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' }), 300); } else { const stats = getStats(); const pid = g3Problems[g3CurrentProblemIndex].id; if (!stats.game3.completedProblems.includes(pid)) { stats.game3.completedProblems.push(pid); saveStats(stats); renderG3Nav(); } setTimeout(() => document.getElementById('g3-completion-modal').classList.remove('hidden'), 500); } } else { slots.forEach(slot => { if(slot.dataset.value !== slot.dataset.ans) slot.classList.remove('correct'); }); } } function closeG3Modal() { document.getElementById('g3-completion-modal').classList.add('hidden'); }
        // Game 4
        const g4Problems = [{ id: 1, title: "é¡Œç›® 1ï¼šæœ€å¤§åœ“å½¢æ¦‚å¿µ", type: "æ¦‚å¿µåˆ¤æ–·", desc: `<div class="space-y-4"><p class="text-lg">åœ¨ä¸€å¡Šä¸‰è§’å½¢çš„æœ¨æ¿ä¸Šï¼Œè¦åˆ‡å‡ºä¸€å€‹<mark class="highlight">é¢ç©æœ€å¤§</mark>çš„åœ“å½¢ã€‚</p><p class="text-lg font-bold text-blue-700">è«‹å•ï¼šæ­¤åœ“çš„åœ“å¿ƒç‚ºæ­¤æœ¨æ¿ä¸Šçš„å“ªå€‹å¿ƒï¼Ÿ</p></div>`, svg: `<svg viewBox="0 0 300 200" class="w-full h-auto drop-shadow-lg rounded-lg bg-white"><polygon points="150,20 50,180 250,180" fill="#f3f4f6" stroke="#374151" stroke-width="2"/><circle cx="150" cy="125" r="55" fill="#dbeafe" stroke="#2563eb" stroke-width="2" stroke-dasharray="5,3"/><circle cx="150" cy="125" r="4" fill="#2563eb"/><text x="145" y="115" font-size="24" fill="#1e40af" font-weight="bold">?</text></svg>`, steps: [ { title: "æ­¥é©Ÿ 1ï¼šåˆ¤æ–·åœ“å¿ƒæ€§è³ª", instruction: "ä¸‰è§’å½¢å…§éƒ¨ã€Œæœ€å¤§ã€çš„åœ“å½¢ï¼Œå°±æ˜¯èˆ‡ä¸‰é‚Šéƒ½ç›¸åˆ‡çš„åœ“ã€‚", template: `<div class="flex flex-col items-center gap-4"><div class="text-xl">é€™å€‹åœ“ç¨±ç‚ºä¸‰è§’å½¢çš„ <span class="g4-slot" data-ans="å…§åˆ‡åœ“" style="width: 120px"></span></div><div class="text-xl">åœ“å¿ƒç¨±ç‚º <span class="g4-slot" data-ans="å…§å¿ƒ" style="width: 100px"></span></div></div>`, options: ["å¤–æ¥åœ“", "å…§åˆ‡åœ“", "å¤–å¿ƒ", "å…§å¿ƒ", "é‡å¿ƒ"] } ] }, { id: 2, title: "é¡Œç›® 2ï¼šå…§å¿ƒè·é›¢æ€§è³ª", type: "æ€§è³ªæ‡‰ç”¨", desc: `<div class="space-y-4"><p class="text-lg"><span class="g4-math">â–³ABC</span> ä¸­ï¼Œ<span class="g4-math">I</span> é»ç‚ºå…§å¿ƒã€‚</p><ul class="list-disc list-inside bg-white p-3 rounded-lg text-gray-700"><li>è‹¥ <span class="g4-math">I</span> é»åˆ° <span class="g4-math" style="text-decoration:overline">AB</span> çš„è·é›¢ç‚º <span class="g4-math text-red-600">3</span>ã€‚</li></ul><p class="font-bold text-xl text-blue-700">æ±‚ <span class="g4-math">I</span> é»åˆ° <span class="g4-math" style="text-decoration:overline">BC</span> çš„è·é›¢ = ?</p></div>`, svg: `<svg viewBox="0 0 300 200" class="w-full h-auto drop-shadow-lg rounded-lg bg-white"><polygon points="150,20 40,180 260,180" fill="#fff" stroke="#374151" stroke-width="2"/><circle cx="150" cy="120" r="4" fill="#ef4444"/><text x="150" y="110" font-size="20" fill="#ef4444" font-weight="bold">I</text><line x1="150" y1="120" x2="88" y2="100" stroke="#ef4444" stroke-width="2"/><text x="105" y="100" font-size="18" fill="#ef4444" font-weight="bold">3</text><line x1="150" y1="120" x2="150" y2="180" stroke="#2563eb" stroke-width="2" stroke-dasharray="5"/><text x="158" y="160" font-size="24" fill="#2563eb" font-weight="bold">?</text><text x="145" y="15" font-size="20" fill="#374151">A</text><text x="20" y="190" font-size="20" fill="#374151">B</text><text x="270" y="190" font-size="20" fill="#374151">C</text></svg>`, steps: [ { title: "æ­¥é©Ÿ 1ï¼šå›æƒ³å…§å¿ƒæ€§è³ª", instruction: "å…§å¿ƒæ˜¯ç”±è§’å¹³åˆ†ç·šäº¤é»å½¢æˆï¼Œå®ƒåˆ°ä¸‰è§’å½¢ä¸‰é‚Šçš„è·é›¢æœ‰ä»€éº¼é—œä¿‚ï¼Ÿ", template: `<div class="text-xl bg-white p-4 rounded-lg border text-center">å…§å¿ƒåˆ°ä¸‰é‚Šçš„è·é›¢çš† <span class="g4-slot" data-ans="ç›¸ç­‰" style="width: 100px;"></span></div>`, options: ["ç›¸ç­‰", "ä¸ç›¸ç­‰", "å¹³åˆ†"] }, { title: "æ­¥é©Ÿ 2ï¼šå¡«å…¥ç­”æ¡ˆ", instruction: "å› ç‚ºè·é›¢ç›¸ç­‰ï¼Œåƒè€ƒé¡Œç›®çµ¦çš„æ•¸å­—ã€‚", template: `<div class="g4-math bg-white p-4 rounded-lg border text-center" style="font-size:1.5em">è·é›¢ = <span class="g4-slot" data-ans="3"></span></div>`, options: ["3", "1.5", "6"] } ] }, { id: 3, title: "é¡Œç›® 3ï¼šè§’åº¦è¨ˆç®—", type: "å¹¾ä½•è¨ˆç®—", desc: `<div class="space-y-4"><p class="text-lg">å¦‚åœ–ï¼Œ<span class="g4-math">I</span> é»ç‚º <span class="g4-math">â–³ABC</span> çš„<mark class="highlight">å…§å¿ƒ</mark>ã€‚</p><ul class="list-disc list-inside bg-white p-3 rounded-lg text-gray-700 space-y-1"><li>è‹¥ <span class="g4-math g4-angle">BAC</span><span class="g4-math">= 60<span class="g4-degree"></span></span></li><li><span class="g4-math g4-angle">ABC</span><span class="g4-math">= 40<span class="g4-degree"></span></span></li></ul><p class="font-bold text-xl text-blue-700">æ±‚ <span class="g4-math g4-angle">AIB</span> = ?</p></div>`, svg: `<svg viewBox="0 0 300 220" class="w-full h-auto drop-shadow-lg rounded-lg bg-white"><defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#666" /></marker></defs><polygon points="150,20 40,200 260,200" fill="#fff" stroke="#374151" stroke-width="2.5"/><line x1="150" y1="20" x2="150" y2="140" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6,4"/><line x1="40" y1="200" x2="150" y2="140" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6,4"/><line x1="260" y1="200" x2="150" y2="140" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6,4"/><circle cx="150" cy="140" r="5" fill="#ef4444"/><text x="145" y="15" font-size="20" fill="#374151">A</text><text x="20" y="210" font-size="20" fill="#374151">B</text><text x="270" y="210" font-size="20" fill="#374151">C</text><text x="160" y="140" font-size="22" font-weight="bold" fill="#ef4444">I</text><text x="130" y="55" font-size="16" fill="#2563eb" font-weight="bold">60Â°</text><text x="50" y="190" font-size="16" fill="#059669" font-weight="bold">40Â°</text></svg>`, steps: [ { title: "æ­¥é©Ÿ 1ï¼šè¨ˆç®— âˆ BAI", instruction: "å…§å¿ƒæ˜¯è§’å¹³åˆ†ç·šçš„äº¤é»ï¼Œæœƒå°‡é ‚è§’å¹³åˆ†ã€‚", template: `<div class="flex flex-col items-center gap-3"><div class="text-gray-600 text-sm">è«‹æ‰¾å‡º âˆ A çš„ä¸€åŠ</div><div class="g4-math bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm" style="font-size:1.5em"><span class="g4-angle">BAI</span> = <div class="g4-fraction"><span class="g4-slot" data-ans="60"></span><span>2</span></div> = <span class="g4-slot" data-ans="30"></span><span class="g4-degree"></span></div></div>`, options: ["60", "40", "30", "20"] }, { title: "æ­¥é©Ÿ 2ï¼šè¨ˆç®— âˆ ABI", instruction: "åŒæ¨£çš„ï¼Œå…§å¿ƒä¹Ÿæœƒå¹³åˆ† âˆ Bã€‚", template: `<div class="flex flex-col items-center gap-3"><div class="text-gray-600 text-sm">è«‹æ‰¾å‡º âˆ B çš„ä¸€åŠ</div><div class="g4-math bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm" style="font-size:1.5em"><span class="g4-angle">ABI</span> = <div class="g4-fraction"><span class="g4-slot" data-ans="40"></span><span>2</span></div> = <span class="g4-slot" data-ans="20"></span><span class="g4-degree"></span></div></div>`, options: ["40", "20", "80", "10"] }, { title: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— âˆ AIB", instruction: "åœ¨ â–³ABI ä¸­ï¼Œåˆ©ç”¨å…§è§’å’Œ 180Â° ä¾†è¨ˆç®—ã€‚", template: `<div class="flex flex-col items-center gap-3"><div class="text-gray-600 text-sm">180Â° æ¸›å»å¦å¤–å…©å€‹è§’</div><div class="g4-math bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm" style="font-size:1.5em"><span class="g4-angle">AIB</span> = 180 - <span class="g4-slot" data-ans="30"></span> - <span class="g4-slot" data-ans="20"></span></div><div class="g4-math bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm" style="font-size:1.5em">= <span class="g4-slot" data-ans="130"></span><span class="g4-degree"></span></div></div>`, options: ["30", "20", "130", "180"] } ] }];
        let g4CurrentProblemIdx = 0; let g4ToastTimeout;
        function initGame4() { renderG4Nav(); loadG4Problem(0); }
        function renderG4Nav() { const container = document.getElementById('g4-nav-container'); container.innerHTML = g4Problems.map((p, idx) => { const stats = getStats(); const isDone = stats.game4.completedProblems.includes(p.id); return `<button onclick="switchG4Problem(${idx})" class="nav-btn ${idx === g4CurrentProblemIdx ? 'active' : ''}">${p.title.split('ï¼š')[0]} ${isDone?'âœ”':''}</button>`; }).join(''); }
        function switchG4Problem(idx) { g4CurrentProblemIdx = idx; renderG4Nav(); document.getElementById('g4-completion-modal').classList.add('hidden'); loadG4Problem(idx); }
        function loadG4Problem(idx) { const problem = g4Problems[idx]; document.getElementById('g4-problem-display').innerHTML = `<div class="flex items-center gap-2 mb-2"><span class="bg-blue-100 text-blue-800 text-sm font-bold px-2 py-1 rounded border border-blue-200">${problem.type}</span></div><h1 class="text-2xl font-bold mb-4 text-gray-800">${problem.title.split('ï¼š')[1]}</h1><div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-4">${problem.desc}</div><div class="rounded-xl overflow-hidden bg-white border border-gray-200 shadow-sm transition-transform hover:scale-[1.02] duration-300">${problem.svg}</div>`; const stepsArea = document.getElementById('g4-steps-container'); stepsArea.innerHTML = ''; problem.steps.forEach((step, stepIndex) => { const stepEl = document.createElement('div'); stepEl.className = `g4-step-container ${stepIndex === 0 ? 'active' : ''}`; stepEl.id = `g4-step-${stepIndex}`; const optionsHtml = step.options.map((opt, i) => `<button class="g4-option-btn" onclick="handleG4OptionClick(${stepIndex}, '${opt}', this)">${opt}</button>`).join(''); stepEl.innerHTML = `<div class="flex items-center justify-between mb-3 border-b border-gray-100 pb-2"><div class="flex items-center gap-2"><span class="bg-blue-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold shadow-md ring-2 ring-blue-100">${stepIndex + 1}</span><h3 class="font-bold text-lg text-gray-700">${step.title}</h3></div><span class="status-icon text-green-500 font-bold hidden flex items-center gap-1 bg-green-50 px-2 py-1 rounded-lg"><span>âœ”</span> å®Œæˆ</span></div><p class="text-gray-500 mb-4 text-base bg-blue-50/50 p-3 rounded-lg border border-blue-100/50">ğŸ’¡ ${step.instruction}</p><div class="py-2 mb-6 text-center select-none">${step.template}</div><div class="options-wrapper transition-all duration-300 overflow-hidden"><div class="flex flex-wrap gap-3 justify-center" id="g4-options-${stepIndex}">${optionsHtml}</div></div><div class="mt-6 flex justify-center h-12"><button class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-8 rounded-full shadow-lg shadow-green-500/30 transition transform active:scale-95 hidden flex items-center gap-2 text-lg" id="g4-check-btn-${stepIndex}" onclick="checkG4Step(${stepIndex})"><span>âœ¨</span> æª¢æŸ¥ç­”æ¡ˆ</button></div>`; stepsArea.appendChild(stepEl); }); stepsArea.querySelectorAll('.g4-slot').forEach(slot => { slot.addEventListener('click', function() { if (this.classList.contains('correct')) return; const val = this.innerText; if (val) { this.innerText = ''; this.classList.remove('filled'); const stepIdx = this.closest('.g4-step-container').id.split('-')[2]; const btn = Array.from(document.querySelectorAll(`#g4-options-${stepIdx} .g4-option-btn`)).find(b => b.innerText === val && b.disabled); if (btn) btn.disabled = false; document.getElementById(`g4-check-btn-${stepIdx}`).classList.add('hidden'); } }); }); }
        function handleG4OptionClick(stepIndex, value, btnElement) { const stepEl = document.getElementById(`g4-step-${stepIndex}`); const slots = Array.from(stepEl.querySelectorAll('.g4-slot')); const emptySlot = slots.find(s => s.innerText === ''); if (emptySlot) { emptySlot.innerText = value; emptySlot.classList.add('filled'); emptySlot.animate([{ transform: 'scale(1.2)' }, { transform: 'scale(1)' }], { duration: 200 }); btnElement.disabled = true; if (slots.every(s => s.innerText !== '')) { const checkBtn = document.getElementById(`g4-check-btn-${stepIndex}`); checkBtn.classList.remove('hidden'); checkBtn.classList.add('pop-in'); checkBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); } } else { showG4Toast("ç©ºæ ¼éƒ½å¡«æ»¿å›‰ï¼"); } }
        function checkG4Step(stepIndex) { const stepEl = document.getElementById(`g4-step-${stepIndex}`); const slots = stepEl.querySelectorAll('.g4-slot'); let isAllCorrect = true; slots.forEach(slot => { if (slot.innerText.trim() === slot.dataset.ans) { slot.classList.add('correct'); slot.classList.remove('filled'); } else { isAllCorrect = false; slot.classList.add('animate-tada'); slot.style.borderColor = '#ef4444'; slot.style.color = '#ef4444'; setTimeout(() => { slot.classList.remove('animate-tada'); slot.style.borderColor = ''; slot.style.color = ''; }, 1000); } }); if (isAllCorrect) { const checkBtn = document.getElementById(`g4-check-btn-${stepIndex}`); checkBtn.innerHTML = "<span>ğŸ‰</span> æ­£ç¢ºï¼"; checkBtn.classList.replace('bg-green-500', 'bg-gray-300'); checkBtn.disabled = true; setTimeout(() => checkBtn.classList.add('hidden'), 1000); const optionsDiv = document.getElementById(`g4-options-${stepIndex}`); optionsDiv.style.opacity = '0'; optionsDiv.style.height = '0'; stepEl.querySelector('.status-icon').classList.remove('hidden'); stepEl.classList.add('done'); const nextStep = document.getElementById(`g4-step-${stepIndex + 1}`); if (nextStep) { setTimeout(() => { nextStep.classList.add('active'); nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 600); } else { const stats = getStats(); const pid = g4Problems[g4CurrentProblemIdx].id; if (!stats.game4.completedProblems.includes(pid)) { stats.game4.completedProblems.push(pid); saveStats(stats); renderG4Nav(); } setTimeout(() => showG4CompletionModal(), 800); } } else { showG4Toast("æœ‰åœ°æ–¹æ€ªæ€ªçš„ï¼Œå†æª¢æŸ¥ä¸€ä¸‹ï¼"); } }
        function showG4Toast(msg) { const toast = document.getElementById('g4-toast'); document.getElementById('g4-toast-msg').innerText = msg; toast.classList.remove('translate-y-20', 'opacity-0'); clearTimeout(g4ToastTimeout); g4ToastTimeout = setTimeout(() => { toast.classList.add('translate-y-20', 'opacity-0'); }, 3000); }
        function showG4CompletionModal() { const modal = document.getElementById('g4-completion-modal'); const content = document.getElementById('g4-modal-content'); modal.classList.remove('hidden'); setTimeout(() => { modal.classList.remove('opacity-0'); content.classList.replace('scale-95', 'scale-100'); }, 10); }
        function closeG4Modal() { const modal = document.getElementById('g4-completion-modal'); const content = document.getElementById('g4-modal-content'); modal.classList.add('opacity-0'); content.classList.replace('scale-100', 'scale-95'); setTimeout(() => { modal.classList.add('hidden'); }, 300); }
        // Game 5
        const g5Problems = [{ id: 1, type: "å¹¾ä½•ï¼šå…§å¿ƒèˆ‡é¢ç©", title: "é¡Œç›® 1", desc: `è‹¥ <span class="g5-math">I</span> é»ç‚º <span class="g5-math">â–³ABC</span> çš„å…§å¿ƒï¼Œ<br> <span class="g5-math">â–³AIB</span> çš„é¢ç©ç‚º <mark class="bg-yellow-200 px-1 rounded">12</mark>ï¼Œ<br> <span class="g5-math">â–³BIC</span> çš„é¢ç©ç‚º <mark class="bg-yellow-200 px-1 rounded">14</mark>ï¼Œ<br> <span class="g5-math">â–³CIA</span> çš„é¢ç©ç‚º <mark class="bg-yellow-200 px-1 rounded">16</mark>ã€‚<br> å‰‡ <span class="g5-math"><span class="g5-segment">AB</span> : <span class="g5-segment">BC</span> : <span class="g5-segment">CA</span> = ?</span>`, svgData: { type: 'ratio', labels: ['12', '14', '16'] }, steps: [ { title: "è§€å¿µç¢ºèª", instruction: "å…§å¿ƒåˆ°ä¸‰é‚Šè·é›¢ç›¸ç­‰ï¼ˆçš†ç‚ºåŠå¾‘ rï¼‰ã€‚ç•¶é«˜ç›¸ç­‰æ™‚ï¼Œé¢ç©æ¯”ç­‰æ–¼ä»€éº¼æ¯”ï¼Ÿ", slots: 1, options: ["åº•é‚Šé•·çš„æ¯”", "é«˜çš„æ¯”", "è§’åº¦çš„æ¯”"], answer: ["åº•é‚Šé•·çš„æ¯”"] }, { title: "å¡«å…¥é¢ç©æ•¸å€¼", instruction: "é¢ç©æ¯” = é‚Šé•·æ¯”ã€‚è«‹å…ˆä¾åºå¡«å…¥é¡Œç›®çµ¦çš„é¢ç©ã€‚", template: `<div class="flex items-center flex-wrap gap-2 text-lg"><span class="g5-math"><span class="g5-segment">AB</span> : <span class="g5-segment">BC</span> : <span class="g5-segment">CA</span></span> = <span class="g5-slot" data-idx="0"></span> : <span class="g5-slot" data-idx="1"></span> : <span class="g5-slot" data-idx="2"></span></div>`, slots: 3, options: ["12", "14", "16"], answer: ["12", "14", "16"] }, { title: "åŒ–ç°¡æ¯”", instruction: "å°‡ 12 : 14 : 16 åŒé™¤ä»¥ 2ï¼Œå¾—åˆ°æœ€ç°¡æ•´æ•¸æ¯”ã€‚", template: `<div class="flex items-center flex-wrap gap-2 text-lg"><span class="g5-math"><span class="g5-segment">AB</span> : <span class="g5-segment">BC</span> : <span class="g5-segment">CA</span></span> = <span class="g5-slot" data-idx="0"></span> : <span class="g5-slot" data-idx="1"></span> : <span class="g5-slot" data-idx="2"></span></div>`, slots: 3, options: ["6", "7", "8"], answer: ["6", "7", "8"] } ] }, { id: 2, type: "å¹¾ä½•ï¼šå…§å¿ƒèˆ‡é¢ç© (é€²éš)", title: "é¡Œç›® 2", desc: `è‹¥ <span class="g5-math">I</span> é»ç‚º <span class="g5-math">â–³ABC</span> çš„å…§å¿ƒï¼Œ<br> <span class="g5-math">â–³AIB</span> çš„é¢ç©ç‚º <mark class="bg-yellow-200 px-1 rounded">39</mark>ï¼Œ<br> <span class="g5-math">â–³BIC</span> çš„é¢ç©ç‚º <mark class="bg-yellow-200 px-1 rounded">24</mark>ï¼Œ<br> <span class="g5-math">â–³CIA</span> çš„é¢ç©ç‚º <mark class="bg-yellow-200 px-1 rounded">30</mark>ã€‚<br> å‰‡ <span class="g5-math"><span class="g5-segment">AB</span> : <span class="g5-segment">BC</span> : <span class="g5-segment">CA</span> = ?</span>`, svgData: { type: 'ratio', labels: ['39', '24', '30'] }, steps: [ { title: "åˆ—å‡ºæ¯”ä¾‹å¼", instruction: "å› ç‚ºå…§å¿ƒåˆ°ä¸‰é‚Šç­‰è·ï¼Œæ‰€ä»¥é‚Šé•·æ¯” = é¢ç©æ¯”ã€‚", template: `<div class="flex items-center flex-wrap gap-2 text-lg"><span class="g5-math"><span class="g5-segment">AB</span> : <span class="g5-segment">BC</span> : <span class="g5-segment">CA</span></span> = <span class="g5-slot" data-idx="0"></span> : <span class="g5-slot" data-idx="1"></span> : <span class="g5-slot" data-idx="2"></span></div>`, slots: 3, options: ["39", "24", "30"], answer: ["39", "24", "30"] }, { title: "åŒ–ç°¡æ¯”", instruction: "å°‡ 39 : 24 : 30 åŒé™¤ä»¥ 3ï¼Œå¾—åˆ°æœ€ç°¡æ•´æ•¸æ¯”ã€‚", template: `<div class="flex items-center flex-wrap gap-2 text-lg"><span class="g5-math"><span class="g5-segment">AB</span> : <span class="g5-segment">BC</span> : <span class="g5-segment">CA</span></span> = <span class="g5-slot" data-idx="0"></span> : <span class="g5-slot" data-idx="1"></span> : <span class="g5-slot" data-idx="2"></span></div>`, slots: 3, options: ["13", "8", "10"], answer: ["13", "8", "10"] } ] }, { id: 3, type: "å¹¾ä½•ï¼šå…§åˆ‡åœ“åŠå¾‘æ±‚é¢ç©", title: "é¡Œç›® 3", desc: `è‹¥ <span class="g5-math">â–³ABC</span> çš„<mark class="bg-yellow-200 px-1 rounded">å‘¨é•·ç‚º 56</mark>ï¼Œ<br> å…§åˆ‡åœ“çš„<mark class="bg-yellow-200 px-1 rounded">åŠå¾‘ r ç‚º 3</mark>ï¼Œ<br> å‰‡ <span class="g5-math">â–³ABC</span> çš„é¢ç©ç‚ºä½•ï¼Ÿ`, svgData: { type: 'formula', r: '3' }, steps: [ { title: "å¡«å…¥å…¬å¼", instruction: "ä¸‰è§’å½¢é¢ç© = å…§åˆ‡åœ“åŠå¾‘ Ã— å‘¨é•· Ã· 2", template: `<div class="flex items-center flex-wrap gap-2 text-xl font-bold">é¢ç© = <span class="g5-slot" data-idx="0"></span> Ã— <span class="g5-slot" data-idx="1"></span> Ã· 2</div>`, slots: 2, options: ["3", "56"], answer: ["3", "56"] }, { title: "è¨ˆç®—çµæœ", instruction: "3 Ã— 56 = 168ï¼Œå†é™¤ä»¥ 2ã€‚", template: `<div class="flex items-center flex-wrap gap-2 text-xl font-bold">é¢ç© = <span class="g5-slot" data-idx="0"></span></div>`, slots: 1, options: ["84", "168", "28"], answer: ["84"] } ] }, { id: 4, type: "å¹¾ä½•ï¼šå…§åˆ‡åœ“åŠå¾‘æ±‚é¢ç© (ç·´ç¿’)", title: "é¡Œç›® 4", desc: `è‹¥ <span class="g5-math">â–³ABC</span> çš„<mark class="bg-yellow-200 px-1 rounded">å‘¨é•·ç‚º 24</mark>ï¼Œ<br> å…§åˆ‡åœ“çš„<mark class="bg-yellow-200 px-1 rounded">åŠå¾‘ r ç‚º 16</mark>ï¼Œ<br> å‰‡ <span class="g5-math">â–³ABC</span> çš„é¢ç©ç‚ºä½•ï¼Ÿ`, svgData: { type: 'formula', r: '16' }, steps: [ { title: "é¸æ“‡ç®—å¼", instruction: "è«‹é¸æ“‡æ­£ç¢ºçš„è¨ˆç®—å¼ã€‚", slots: 1, options: ["16Ã—24Ã·2", "16Ã—24", "24Ã·16"], answer: ["16Ã—24Ã·2"] }, { title: "è¨ˆç®—çµæœ", instruction: "16 Ã— 24 = 384ï¼Œå†é™¤ä»¥ 2ã€‚", template: `<div class="flex items-center flex-wrap gap-2 text-xl font-bold">é¢ç© = <span class="g5-slot" data-idx="0"></span></div>`, slots: 1, options: ["192", "384", "48"], answer: ["192"] } ] }];
        let g5CurrentIdx = 0; let g5StepStatus = [];
        function initGame5() { renderG5Nav(); loadG5Problem(0); }
        function renderG5Nav() { const container = document.getElementById('g5-nav-buttons'); container.innerHTML = g5Problems.map((p, idx) => { const stats = getStats(); const isDone = stats.game5.completedProblems.includes(p.id); return `<button onclick="appSwitchG5Problem(${idx})" class="nav-btn whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-bold transition-all border-2 border-transparent ${idx === 0 ? 'bg-purple-800 border-purple-400' : 'bg-purple-500 hover:bg-purple-400'}">${p.title} ${isDone ? 'âœ”' : ''}</button>`; }).join(''); }
        function appSwitchG5Problem(idx) { g5CurrentIdx = idx; document.querySelectorAll('#g5-nav-buttons .nav-btn').forEach((btn, i) => { if (i === idx) { btn.classList.add('bg-purple-800', 'border-purple-400'); btn.classList.remove('bg-purple-500', 'hover:bg-purple-400'); } else { btn.classList.remove('bg-purple-800', 'border-purple-400'); btn.classList.add('bg-purple-500', 'hover:bg-purple-400'); } }); document.getElementById('g5-completion-modal').classList.add('hidden'); loadG5Problem(idx); }
        function loadG5Problem(idx) { g5CurrentIdx = idx; const problem = g5Problems[idx]; g5StepStatus = new Array(problem.steps.length).fill(false); document.getElementById('g5-problem-tag').textContent = problem.type; document.getElementById('g5-problem-desc').innerHTML = problem.desc; renderG5SVG(problem.svgData); const container = document.getElementById('g5-steps-container'); container.innerHTML = ''; problem.steps.forEach((step, stepIdx) => { const stepEl = document.createElement('div'); stepEl.id = `g5-step-${stepIdx}`; stepEl.className = `g5-step-container bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden transition-all duration-500 ${stepIdx === 0 ? 'active' : ''}`; let html = `<div class="bg-slate-50 border-b border-slate-100 px-6 py-4 flex justify-between items-center"><h3 class="font-bold text-slate-700 text-lg flex items-center gap-2"><span class="bg-purple-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs">${stepIdx + 1}</span>${step.title}</h3><span id="g5-status-icon-${stepIdx}" class="hidden text-green-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></span></div><div class="p-6"><p class="text-slate-600 mb-4 text-lg font-medium">${step.instruction}</p>`; html += `<div class="bg-purple-50/50 rounded-xl p-4 mb-6 border border-purple-100/50 flex justify-center min-h-[80px] items-center" id="g5-slot-area-${stepIdx}">`; if (step.template) { html += step.template; } else { html += `<div class="flex flex-wrap gap-2 justify-center">`; for(let i=0; i<step.slots; i++) { html += `<span class="g5-slot" data-idx="${i}"></span>`; } html += `</div>`; } html += `</div>`; html += `<div class="flex flex-wrap gap-3 justify-center mb-4" id="g5-options-area-${stepIdx}">`; step.options.forEach(opt => { html += `<button class="g5-option-btn" onclick="handleG5OptionClick(${stepIdx}, '${opt}', this)">${opt}</button>`; }); html += `</div><div class="flex flex-col items-center gap-2"><div id="g5-msg-${stepIdx}" class="h-6 text-sm font-bold transition-all opacity-0 text-red-500">æç¤ºå€</div><button id="g5-check-btn-${stepIdx}" onclick="checkG5Answer(${stepIdx})" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl shadow-md transition transform active:scale-[0.98] flex items-center justify-center gap-2 hidden pop-in"><span>æª¢æŸ¥ç­”æ¡ˆ</span></button></div></div>`; stepEl.innerHTML = html; container.appendChild(stepEl); stepEl.querySelectorAll('.g5-slot').forEach(slot => { slot.addEventListener('click', () => clearG5Slot(stepIdx, slot)); }); }); document.getElementById('g5-steps-scroll-area').scrollTop = 0; }
        function renderG5SVG(data) { const svg = document.getElementById('g5-problem-svg'); const A = {x: 160, y: 30}, B = {x: 40, y: 190}, C = {x: 280, y: 190}, I = {x: 160, y: 130}; let content = `<polygon points="${A.x},${A.y} ${B.x},${B.y} ${C.x},${C.y}" fill="none" stroke="#1e293b" stroke-width="2.5" stroke-linejoin="round"/>`; content += `<text x="${A.x}" y="${A.y-10}" text-anchor="middle" font-weight="bold" fill="#1e293b">A</text><text x="${B.x-10}" y="${B.y}" text-anchor="middle" font-weight="bold" fill="#1e293b">B</text><text x="${C.x+10}" y="${C.y}" text-anchor="middle" font-weight="bold" fill="#1e293b">C</text>`; if (data.type === 'ratio') { content += `<line x1="${A.x}" y1="${A.y}" x2="${I.x}" y2="${I.y}" stroke="#94a3b8" stroke-dasharray="5,3" stroke-width="2"/><line x1="${B.x}" y1="${B.y}" x2="${I.x}" y2="${I.y}" stroke="#94a3b8" stroke-dasharray="5,3" stroke-width="2"/><line x1="${C.x}" y1="${C.y}" x2="${I.x}" y2="${I.y}" stroke="#94a3b8" stroke-dasharray="5,3" stroke-width="2"/><circle cx="${I.x}" cy="${I.y}" r="4" fill="#ef4444"/><text x="${I.x}" y="${I.y+20}" text-anchor="middle" font-weight="bold" fill="#ef4444">I</text>`; if (data.labels) { content += `<text x="100" y="120" fill="#64748b" font-size="14">${data.labels[0]}</text><text x="160" y="170" fill="#64748b" font-size="14" text-anchor="middle">${data.labels[1]}</text><text x="220" y="120" fill="#64748b" font-size="14">${data.labels[2]}</text>`; } } else if (data.type === 'formula') { const r = 60; content += `<circle cx="${I.x}" cy="${I.y}" r="${r}" fill="#fecaca" fill-opacity="0.3" stroke="#ef4444" stroke-width="2"/><line x1="${I.x}" y1="${I.y}" x2="${I.x}" y2="${I.y+r}" stroke="#ef4444" stroke-width="2"/><polyline points="${I.x-5},${I.y+r} ${I.x-5},${I.y+r-5} ${I.x},${I.y+r-5}" fill="none" stroke="#ef4444" stroke-width="1.5"/><text x="${I.x+5}" y="${I.y+r/2}" fill="#ef4444" font-weight="bold" font-size="14">r=${data.r}</text><circle cx="${I.x}" cy="${I.y}" r="3" fill="#ef4444"/>`; } svg.innerHTML = content; }
        function handleG5OptionClick(stepIdx, value, btn) { const slotArea = document.getElementById(`g5-slot-area-${stepIdx}`); const emptySlot = Array.from(slotArea.querySelectorAll('.g5-slot')).find(s => !s.classList.contains('filled')); if (emptySlot) { emptySlot.textContent = value; emptySlot.dataset.value = value; emptySlot.classList.add('filled', 'animate-pop'); setTimeout(() => emptySlot.classList.remove('animate-pop'), 300); btn.disabled = true; document.getElementById(`g5-msg-${stepIdx}`).style.opacity = '0'; if (!Array.from(slotArea.querySelectorAll('.g5-slot')).some(s => !s.classList.contains('filled'))) { document.getElementById(`g5-check-btn-${stepIdx}`).classList.remove('hidden'); } } }
        function clearG5Slot(stepIdx, slot) { if (!slot.classList.contains('filled') || g5StepStatus[stepIdx]) return; const value = slot.textContent; const btn = Array.from(document.getElementById(`g5-options-area-${stepIdx}`).querySelectorAll('button')).find(b => b.textContent === value && b.disabled); if (btn) btn.disabled = false; slot.textContent = ''; slot.classList.remove('filled', 'error'); delete slot.dataset.value; document.getElementById(`g5-check-btn-${stepIdx}`).classList.add('hidden'); }
        function checkG5Answer(stepIdx) { const problem = g5Problems[g5CurrentIdx]; const step = problem.steps[stepIdx]; const slotArea = document.getElementById(`g5-slot-area-${stepIdx}`); const slots = Array.from(slotArea.querySelectorAll('.g5-slot')); const userVals = slots.map(s => s.dataset.value); let isCorrect = false; if (problem.id === 3 && stepIdx === 0) { isCorrect = JSON.stringify([...userVals].sort()) === JSON.stringify([...step.answer].sort()); } else { isCorrect = JSON.stringify(userVals) === JSON.stringify(step.answer); } if (isCorrect) { g5StepStatus[stepIdx] = true; slots.forEach(s => s.classList.add('correct')); document.getElementById(`g5-status-icon-${stepIdx}`).classList.remove('hidden'); document.getElementById(`g5-check-btn-${stepIdx}`).classList.add('hidden'); document.getElementById(`g5-options-area-${stepIdx}`).style.display = 'none'; if (stepIdx < problem.steps.length - 1) { const nextStep = document.getElementById(`g5-step-${stepIdx + 1}`); nextStep.classList.remove('opacity-50', 'blur-[2px]', 'pointer-events-none', 'translate-y-4'); nextStep.classList.add('opacity-100', 'translate-y-0'); setTimeout(() => nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' }), 500); } else { const stats = getStats(); if (!stats.game5.completedProblems.includes(problem.id)) { stats.game5.completedProblems.push(problem.id); saveStats(stats); renderG5Nav(); } setTimeout(showG5Completion, 800); } } else { slots.forEach(s => { s.classList.add('error'); setTimeout(() => s.classList.remove('error'), 500); }); const msg = document.getElementById(`g5-msg-${stepIdx}`); msg.textContent = "é †åºæˆ–æ•¸å€¼ä¸å°å–”ï¼"; msg.style.opacity = '1'; } }
        function showG5Completion() { const modal = document.getElementById('g5-completion-modal'); const box = document.getElementById('g5-modal-box'); modal.classList.remove('hidden'); requestAnimationFrame(() => { modal.classList.remove('opacity-0'); box.classList.remove('scale-90'); box.classList.add('scale-100'); }); }
        function closeG5Modal() { const modal = document.getElementById('g5-completion-modal'); const box = document.getElementById('g5-modal-box'); modal.classList.add('opacity-0'); box.classList.add('scale-90'); setTimeout(() => { modal.classList.add('hidden'); }, 300); }
        // Game 6
        const g6Problems = [{ id: 1, title: "é¡Œç›®ä¸€", desc: "ç›´è§’ä¸‰è§’å½¢ ABC ä¸­ï¼ŒAB=6ï¼ŒBC=8ï¼ŒAC=10ï¼Œæ±‚å…§åˆ‡åœ“åŠå¾‘ï¼Ÿ", labels: { h: 6, w: 8, hyp: 10 }, steps: [ { instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºå…©è‚¡ï¼ˆç›´è§’é‚Šï¼‰çš„é•·åº¦", template: `<div class="g6-math-text">å…©è‚¡æ˜¯ <div class="g6-slot" data-idx="0"></div> å’Œ <div class="g6-slot" data-idx="1"></div></div>`, options: [6, 8, 10], correctSet: [6, 8], slots: 2 }, { instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾å‡ºæ–œé‚Šï¼ˆæœ€é•·é‚Šï¼‰çš„é•·åº¦", template: `<div class="g6-math-text">æ–œé‚Šæ˜¯ <div class="g6-slot" data-idx="0"></div></div>`, options: [6, 8, 10], correct: [10], slots: 1 }, { instruction: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— ( å…©è‚¡å’Œ - æ–œé‚Š )", template: `<div class="g6-math-text">( <div class="g6-slot" data-idx="0"></div> + <div class="g6-slot" data-idx="1"></div> ) - <div class="g6-slot" data-idx="2"></div> = <div class="g6-slot" data-idx="3"></div></div>`, options: [6, 8, 10, 4, 14], logicCheck: (inputs) => { const legs = [inputs[0], inputs[1]].sort((a,b)=>a-b); return (legs[0] == 6 && legs[1] == 8 && inputs[2] == 10 && inputs[3] == 4); }, slots: 4 }, { instruction: "æ­¥é©Ÿ 4ï¼šç®—å‡ºåŠå¾‘ ( ä¸Šä¸€æ­¥çµæœ Ã· 2 )", template: `<div class="g6-math-text"><div class="g6-slot" data-idx="0"></div> Ã· 2 = <div class="g6-slot" data-idx="1"></div></div>`, options: [4, 2, 8], correct: [4, 2], slots: 2 } ] }, { id: 2, title: "é¡Œç›®äºŒ", desc: "ç›´è§’ä¸‰è§’å½¢ ABC ä¸­ï¼ŒAB=8ï¼ŒBC=15ï¼ŒAC=17ï¼Œæ±‚å…§åˆ‡åœ“åŠå¾‘ï¼Ÿ", labels: { h: 8, w: 15, hyp: 17 }, steps: [ { instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºå…©è‚¡ï¼ˆç›´è§’é‚Šï¼‰", template: `<div class="g6-math-text">å…©è‚¡ï¼š <div class="g6-slot" data-idx="0"></div> , <div class="g6-slot" data-idx="1"></div></div>`, options: [8, 15, 17], correctSet: [8, 15], slots: 2 }, { instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾å‡ºæ–œé‚Š", template: `<div class="g6-math-text">æ–œé‚Šï¼š <div class="g6-slot" data-idx="0"></div></div>`, options: [8, 15, 17], correct: [17], slots: 1 }, { instruction: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— ( å…©è‚¡å’Œ - æ–œé‚Š )", template: `<div class="g6-math-text">( <div class="g6-slot" data-idx="0"></div> + <div class="g6-slot" data-idx="1"></div> ) - <div class="g6-slot" data-idx="2"></div> = <div class="g6-slot" data-idx="3"></div></div>`, options: [8, 15, 17, 6, 23], logicCheck: (inputs) => { const legs = [inputs[0], inputs[1]].sort((a,b)=>a-b); return (legs[0] == 8 && legs[1] == 15 && inputs[2] == 17 && inputs[3] == 6); }, slots: 4 }, { instruction: "æ­¥é©Ÿ 4ï¼šç®—å‡ºåŠå¾‘", template: `<div class="g6-math-text"><div class="g6-slot" data-idx="0"></div> Ã· 2 = <div class="g6-slot" data-idx="1"></div></div>`, options: [6, 3, 12], correct: [6, 3], slots: 2 } ] }, { id: 3, title: "é¡Œç›®ä¸‰", desc: "ç›´è§’ä¸‰è§’å½¢ PQR ä¸­ï¼ŒPQ=7ï¼ŒQR=24ï¼ŒPR=25ï¼Œæ±‚å…§åˆ‡åœ“åŠå¾‘ï¼Ÿ", labels: { h: 7, w: 24, hyp: 25 }, steps: [ { instruction: "æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºå…©è‚¡", template: `<div class="g6-math-text">å…©è‚¡ï¼š <div class="g6-slot" data-idx="0"></div> , <div class="g6-slot" data-idx="1"></div></div>`, options: [7, 24, 25], correctSet: [7, 24], slots: 2 }, { instruction: "æ­¥é©Ÿ 2ï¼šæ‰¾å‡ºæ–œé‚Š", template: `<div class="g6-math-text">æ–œé‚Šï¼š <div class="g6-slot" data-idx="0"></div></div>`, options: [7, 24, 25], correct: [25], slots: 1 }, { instruction: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— ( å…©è‚¡å’Œ - æ–œé‚Š )", template: `<div class="g6-math-text">( <div class="g6-slot" data-idx="0"></div> + <div class="g6-slot" data-idx="1"></div> ) - <div class="g6-slot" data-idx="2"></div> = <div class="g6-slot" data-idx="3"></div></div>`, options: [7, 24, 25, 6, 31], logicCheck: (inputs) => { const legs = [inputs[0], inputs[1]].sort((a,b)=>a-b); return (legs[0] == 7 && legs[1] == 24 && inputs[2] == 25 && inputs[3] == 6); }, slots: 4 }, { instruction: "æ­¥é©Ÿ 4ï¼šç®—å‡ºåŠå¾‘", template: `<div class="g6-math-text"><div class="g6-slot" data-idx="0"></div> Ã· 2 = <div class="g6-slot" data-idx="1"></div></div>`, options: [6, 3, 12], correct: [6, 3], slots: 2 } ] }];
        let g6CurrentProblemIdx = 0, g6CurrentStepIdx = 0, g6UserInputs = {};
        function initGame6() { renderG6Nav(); loadG6Problem(0); }
        function renderG6Nav() { const container = document.getElementById('g6-nav-buttons'); container.innerHTML = g6Problems.map((p, idx) => { const stats = getStats(); const isDone = stats.game6.completedProblems.includes(p.id); return `<button onclick="switchG6Problem(${idx})" class="px-5 py-2 rounded-xl font-bold transition-all whitespace-nowrap border-2 ${idx === g6CurrentProblemIdx ? 'bg-cyan-600 border-cyan-600 text-white shadow-md' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'}">${p.title} ${isDone?'âœ”':''}</button>`; }).join(''); }
        function switchG6Problem(idx) { if (idx === g6CurrentProblemIdx) return; g6CurrentProblemIdx = idx; g6CurrentStepIdx = 0; g6UserInputs = {}; renderG6Nav(); const content = document.querySelector('#game6-wrapper main'); content.style.opacity = '0.5'; setTimeout(() => { loadG6Problem(idx); content.style.opacity = '1'; }, 200); }
        function loadG6Problem(idx) { const p = g6Problems[idx]; document.getElementById('g6-problem-title').textContent = p.title; document.getElementById('g6-problem-desc').textContent = p.desc; document.getElementById('g6-label-h').textContent = p.labels.h; document.getElementById('g6-label-w').textContent = p.labels.w; document.getElementById('g6-label-hyp').textContent = p.labels.hyp; const container = document.getElementById('g6-steps-wrapper'); container.innerHTML = ''; p.steps.forEach((step, sIdx) => { const stepEl = document.createElement('div'); stepEl.className = `g6-step-card ${sIdx === 0 ? 'active' : ''}`; stepEl.id = `g6-step-${sIdx}`; stepEl.innerHTML = `<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-xl text-slate-800 flex items-center gap-2"><span class="bg-slate-200 text-slate-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">${sIdx + 1}</span>${step.instruction.split('ï¼š')[1] || step.instruction}</h3><span class="status-icon hidden flex items-center gap-1 text-green-600 font-bold bg-green-100 px-3 py-1 rounded-full text-sm"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>å®Œæˆ</span></div><div class="mb-6 bg-slate-50 p-6 rounded-2xl border border-slate-200 flex justify-center items-center min-h-[5rem] shadow-inner">${step.template}</div><div class="options-wrapper transition-all duration-300"><div class="border-t border-slate-100 pt-4 mb-2"><p class="text-sm text-slate-500 mb-3 font-bold flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg>é»æ“Šä¸‹æ–¹é¸é …å¡«å…¥ï¼š</p><div class="flex flex-wrap gap-3 justify-center" id="g6-options-${sIdx}">${step.options.map(opt => `<button class="g6-option-btn" onclick="handleG6OptionClick(${sIdx}, ${opt}, this)">${opt}</button>`).join('')}</div></div><div class="mt-6 flex flex-col md:flex-row justify-between items-center gap-4"><div id="g6-msg-${sIdx}" class="text-center md:text-left font-bold min-h-[1.5rem] flex-1"></div><button onclick="checkG6Answer(${sIdx})" class="w-full md:w-auto bg-cyan-600 hover:bg-cyan-700 active:bg-cyan-800 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-cyan-200 transition-all flex items-center justify-center gap-2">æª¢æŸ¥ç­”æ¡ˆ</button></div></div>`; container.appendChild(stepEl); }); document.querySelectorAll('.g6-slot').forEach(slot => { slot.addEventListener('click', function() { const stepDiv = this.closest('.g6-step-card'); if (!stepDiv.classList.contains('active') || stepDiv.classList.contains('completed')) return; if (this.classList.contains('filled')) { const val = parseInt(this.textContent); const btns = stepDiv.querySelectorAll('.g6-option-btn'); for(let btn of btns) { if (parseInt(btn.textContent) === val && btn.disabled) { btn.disabled = false; break; } } this.textContent = ''; this.classList.remove('filled', 'correct', 'animate-pop'); delete g6UserInputs[`${parseInt(stepDiv.id.split('-')[1])}-${this.dataset.idx}`]; document.getElementById(`g6-msg-${parseInt(stepDiv.id.split('-')[1])}`).textContent = ''; } }); }); }
        function handleG6OptionClick(stepIdx, value, btn) { if (stepIdx !== g6CurrentStepIdx) return; const stepDiv = document.getElementById(`g6-step-${stepIdx}`); const slots = stepDiv.querySelectorAll('.g6-slot'); let targetSlot = null; for (let slot of slots) { if (!slot.classList.contains('filled')) { targetSlot = slot; break; } } if (targetSlot) { targetSlot.textContent = value; targetSlot.classList.add('filled', 'animate-pop'); btn.disabled = true; g6UserInputs[`${stepIdx}-${targetSlot.dataset.idx}`] = value; document.getElementById(`g6-msg-${stepIdx}`).textContent = ''; } else { document.getElementById(`g6-msg-${stepIdx}`).innerHTML = `<span class="text-orange-500">æ ¼å­æ»¿å›‰ï¼è«‹å…ˆé»æ“Šæ ¼å­æ¸…é™¤ã€‚</span>`; } }
        function checkG6Answer(stepIdx) { const stepData = g6Problems[g6CurrentProblemIdx].steps[stepIdx]; const stepDiv = document.getElementById(`g6-step-${stepIdx}`); const slots = stepDiv.querySelectorAll('.g6-slot'); const msgEl = document.getElementById(`g6-msg-${stepIdx}`); let currentValues = []; let isFull = true; slots.forEach(s => { if (!s.classList.contains('filled')) isFull = false; currentValues.push(parseInt(s.textContent)); }); if (!isFull) { msgEl.innerHTML = `<span class="text-orange-500">é‚„æœ‰æ ¼å­æ²’å¡«å–”ï¼</span>`; return; } let isCorrect = false; if (stepData.logicCheck) isCorrect = stepData.logicCheck(currentValues); else if (stepData.correctSet) isCorrect = JSON.stringify([...currentValues].sort()) === JSON.stringify([...stepData.correctSet].sort()); else isCorrect = JSON.stringify(currentValues) === JSON.stringify(stepData.correct); if (isCorrect) { msgEl.innerHTML = `<span class="text-green-600">ç­”å°äº†ï¼å¤ªæ£’äº†ï¼</span>`; stepDiv.classList.add('completed'); stepDiv.querySelector('.status-icon').classList.remove('hidden'); stepDiv.querySelector('.status-icon').classList.add('flex'); slots.forEach(s => s.classList.add('correct')); if (stepIdx < g6Problems[g6CurrentProblemIdx].steps.length - 1) { g6CurrentStepIdx++; const nextStep = document.getElementById(`g6-step-${g6CurrentStepIdx}`); nextStep.classList.add('active'); setTimeout(() => { const container = document.getElementById('g6-steps-container'); container.scrollTo({ top: nextStep.offsetTop - container.offsetTop - 20, behavior: 'smooth' }); }, 400); } else { const stats = getStats(); if (!stats.game6.completedProblems.includes(g6Problems[g6CurrentProblemIdx].id)) { stats.game6.completedProblems.push(g6Problems[g6CurrentProblemIdx].id); saveStats(stats); renderG6Nav(); } setTimeout(showG6CompletionModal, 600); } } else { msgEl.innerHTML = `<span class="text-red-500">ç­”æ¡ˆä¸å¤ªå°ï¼Œå†æª¢æŸ¥ä¸€ä¸‹ï¼Ÿ</span>`; stepDiv.classList.add('animate-[pulse_0.2s_ease-in-out_2]'); setTimeout(() => stepDiv.classList.remove('animate-[pulse_0.2s_ease-in-out_2]'), 500); } }
        function showG6CompletionModal() { const modal = document.getElementById('g6-completion-modal'); const backdrop = document.getElementById('g6-modal-backdrop'); const content = document.getElementById('g6-modal-content'); modal.classList.remove('hidden'); void modal.offsetWidth; backdrop.classList.remove('opacity-0'); content.classList.remove('scale-90', 'opacity-0'); content.classList.add('scale-100', 'opacity-100'); }
        function closeG6Modal() { const modal = document.getElementById('g6-completion-modal'); const backdrop = document.getElementById('g6-modal-backdrop'); const content = document.getElementById('g6-modal-content'); backdrop.classList.add('opacity-0'); content.classList.remove('scale-100', 'opacity-100'); content.classList.add('scale-90', 'opacity-0'); setTimeout(() => { modal.classList.add('hidden'); }, 300); }

        // ================= GAME 7: ä¸‰è§’å½¢çš„é‡å¿ƒ =================
        const g7Problems = [
            { id: 1, title: "1. é‡å¿ƒä½ç½®", desc: "å¦‚åœ–ï¼Œå¦‚æœç”¨æ‰‹æŒ‡æ’èµ·ä¸‰è§’å½¢æ¿çš„é‡å¿ƒï¼Œå¯ç™¼ç¾ä¸‰è§’å½¢æ¿å‘ˆç¾å¹³è¡¡çš„ç‹€æ…‹ï¼Œä¸æœƒæ‰ä¸‹ä¾†ã€‚", svgType: "centroid", steps: [ { instr: "ç›´è§’ä¸‰è§’å½¢çš„é‡å¿ƒåœ¨å“ªè£¡ï¼Ÿ", ans: "å…§éƒ¨", opts: ["å¤–éƒ¨", "å…§éƒ¨", "ä»»ä¸€é‚Šä¸Š"] }, { instr: "éˆè§’ä¸‰è§’å½¢çš„é‡å¿ƒåœ¨å“ªè£¡ï¼Ÿ", ans: "å…§éƒ¨", opts: ["å¤–éƒ¨", "å…§éƒ¨", "ä»»ä¸€é‚Šä¸Š"] }, { instr: "éŠ³è§’ä¸‰è§’å½¢çš„é‡å¿ƒåœ¨å“ªè£¡ï¼Ÿ", ans: "å…§éƒ¨", opts: ["å¤–éƒ¨", "å…§éƒ¨", "ä»»ä¸€é‚Šä¸Š"] } ] },
            { id: 2, title: "2. é•·åº¦è¨ˆç®— (å…¥é–€)", desc: "å·²çŸ¥ä¸­ç·šé•·åº¦ï¼š<br>1. <span class='g7-segment'>AD</span> = <mark class='bg-yellow-200 px-1 rounded'>6</mark><br>2. <span class='g7-segment'>BE</span> = <mark class='bg-blue-200 px-1 rounded'>12</mark><br>3. <span class='g7-segment'>CF</span> = <mark class='bg-green-200 px-1 rounded'>9</mark>", svgType: "medians", steps: [ { instr: "æ±‚ AG çš„é•·åº¦ï¼š(6 Ã· 3 Ã— 2)", template: `<div class="text-xl">(<div class="g7-slot" data-ans="6"></div>) Ã· 3 Ã— 2 = (<div class="g7-slot" data-ans="4"></div>)</div>`, opts: ["6", "4", "3", "12"] }, { instr: "æ±‚ BG çš„é•·åº¦ï¼š(12 Ã· 3 Ã— 2)", template: `<div class="text-xl">(<div class="g7-slot" data-ans="12"></div>) Ã· 3 Ã— 2 = (<div class="g7-slot" data-ans="8"></div>)</div>`, opts: ["12", "8", "4", "24"] }, { instr: "æ±‚ CG çš„é•·åº¦ï¼š(9 Ã· 3 Ã— 2)", template: `<div class="text-xl">(<div class="g7-slot" data-ans="9"></div>) Ã· 3 Ã— 2 = (<div class="g7-slot" data-ans="6"></div>)</div>`, opts: ["9", "6", "3", "18"] } ] },
            { id: 3, title: "3. æ¯”ä¾‹æ€§è³ª", desc: "å¦‚åœ–ï¼ŒADã€BEã€CF ç‚ºä¸­ç·šï¼Œäº¤æ–¼ G é»ï¼ˆé‡å¿ƒï¼‰ã€‚", svgType: "medians", steps: [ { instr: "æ±‚ <span class='g7-segment'>AG</span> : <span class='g7-segment'>GD</span> (é‡å¿ƒåˆ°é ‚é» : é‡å¿ƒåˆ°å°é‚Šä¸­é»)", template: `<div class="text-xl"><div class="g7-slot" data-ans="2"></div> : <div class="g7-slot" data-ans="1"></div></div>`, opts: ["1", "2", "3"] }, { instr: "æ±‚ <span class='g7-segment'>BG</span> : <span class='g7-segment'>GE</span>", template: `<div class="text-xl"><div class="g7-slot" data-ans="2"></div> : <div class="g7-slot" data-ans="1"></div></div>`, opts: ["1", "2", "3"] }, { instr: "æ±‚ <span class='g7-segment'>CG</span> : <span class='g7-segment'>CF</span> (é‡å¿ƒæ®µ : æ•´æ¢ä¸­ç·š)", template: `<div class="text-xl"><div class="g7-slot" data-ans="2"></div> : <div class="g7-slot" data-ans="3"></div></div>`, opts: ["1", "2", "3"] } ] },
            { id: 4, title: "4. é€²éšè¨ˆç®—", desc: "å·²çŸ¥ï¼š<br>1. ä¸­ç·š <span class='g7-segment'>AD</span> = 9<br>2. ä¸­ç·š <span class='g7-segment'>BE</span> = 12<br>3. ä¸­ç·š <span class='g7-segment'>CF</span> = 15", svgType: "medians", steps: [ { instr: "æ±‚ <span class='g7-segment'>AG</span> (å·²çŸ¥ AD=9)", template: `<div class="text-xl"><div class="g7-slot" data-ans="9"></div> Ã· <div class="g7-slot" data-ans="3"></div> Ã— <div class="g7-slot" data-ans="2"></div> = <div class="g7-slot" data-ans="6"></div></div>`, opts: ["9", "3", "2", "6"] }, { instr: "æ±‚ <span class='g7-segment'>BG</span> (å·²çŸ¥ BE=12)", template: `<div class="text-xl"><div class="g7-slot" data-ans="12"></div> Ã· <div class="g7-slot" data-ans="3"></div> Ã— <div class="g7-slot" data-ans="2"></div> = <div class="g7-slot" data-ans="8"></div></div>`, opts: ["12", "3", "2", "8"] }, { instr: "æ±‚ <span class='g7-segment'>CG</span> (å·²çŸ¥ CF=15)", template: `<div class="text-xl"><div class="g7-slot" data-ans="15"></div> Ã· <div class="g7-slot" data-ans="3"></div> Ã— <div class="g7-slot" data-ans="2"></div> = <div class="g7-slot" data-ans="10"></div></div>`, opts: ["15", "3", "2", "10"] } ] }
        ];
        let g7CurrentProblemIdx = 0, g7CurrentStepIdx = 0;
        function initGame7() { renderG7Nav(); loadG7Problem(0); }
        function renderG7Nav() {
            const container = document.getElementById('g7-nav-buttons');
            container.innerHTML = g7Problems.map((p, idx) => {
                const stats = getStats();
                const isDone = stats.game7.completedProblems.includes(p.id);
                return `<button onclick="switchG7Problem(${idx})" class="px-3 py-1.5 rounded-lg text-sm font-bold transition whitespace-nowrap border ${idx === g7CurrentProblemIdx ? 'bg-sky-100 text-sky-700 border-sky-300' : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'}">${p.title.split(' ')[1]} ${isDone?'âœ”':''}</button>`;
            }).join('');
        }
        function switchG7Problem(idx) {
            g7CurrentProblemIdx = idx; g7CurrentStepIdx = 0; renderG7Nav();
            const content = document.querySelector('#game7-wrapper main'); content.style.opacity = '0.5';
            setTimeout(() => { loadG7Problem(idx); content.style.opacity = '1'; }, 200);
        }
        function loadG7Problem(idx) {
            const p = g7Problems[idx];
            document.getElementById('g7-problem-title').innerText = p.title;
            document.getElementById('g7-problem-desc').innerHTML = p.desc;
            const svgContainer = document.getElementById('g7-svg-container');
            if (p.svgType === 'centroid') {
                svgContainer.innerHTML = `<svg width="200" height="150" viewBox="0 0 200 150"><path d="M40,100 L160,100 L100,40 Z" fill="#ddd" stroke="#666" stroke-width="2"/><circle cx="100" cy="80" r="3" fill="#e63946"/><text x="105" y="80" font-size="12" fill="#e63946">é‡å¿ƒ</text><path d="M95,150 L95,100 L105,100 L105,150 Z" fill="#fca5a5"/></svg>`;
            } else {
                svgContainer.innerHTML = `<svg width="220" height="180" viewBox="0 0 220 180"><polygon points="110,20 20,150 200,150" fill="none" stroke="#333" stroke-width="2"/><text x="105" y="15" font-size="16" font-weight="bold">A</text><text x="5" y="160" font-size="16" font-weight="bold">B</text><text x="205" y="160" font-size="16" font-weight="bold">C</text><line x1="110" y1="20" x2="110" y2="150" stroke="#f59e0b" stroke-width="2" /><text x="105" y="170" font-size="14">D</text><line x1="20" y1="150" x2="155" y2="85" stroke="#3b82f6" stroke-width="2" /><text x="160" y="85" font-size="14">E</text><line x1="200" y1="150" x2="65" y2="85" stroke="#10b981" stroke-width="2" /><text x="50" y="85" font-size="14">F</text><circle cx="110" cy="106.6" r="4" fill="#000"/><text x="115" y="115" font-size="16" font-weight="bold">G</text></svg>`;
            }
            const container = document.getElementById('g7-steps-container'); container.innerHTML = '';
            p.steps.forEach((step, sIdx) => {
                const stepEl = document.createElement('div');
                stepEl.className = `g7-step-container bg-white p-5 rounded-xl shadow-sm border border-slate-200 mb-4 ${sIdx === 0 ? 'active' : ''}`;
                stepEl.id = `g7-step-${sIdx}`;
                let content = `<h3 class="font-bold text-gray-800 mb-3">${sIdx+1}. ${step.instr}</h3>`;
                if (step.template) {
                    content += `<div class="mb-4 bg-slate-50 p-3 rounded-lg flex justify-center items-center slot-area">${step.template}</div>`;
                } else {
                    content += `<div class="mb-4 bg-slate-50 p-3 rounded-lg flex justify-center items-center slot-area"><div class="g7-slot" data-ans="${step.ans}"></div><span class="ml-2">ã€‚</span></div>`;
                }
                content += `<div class="flex flex-wrap gap-2 options-area">${step.opts.map(o => `<button class="g7-option-btn" onclick="handleG7Option('${o}', this, ${sIdx})">${o}</button>`).join('')}</div>`;
                content += `<button class="w-full mt-3 bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 rounded-lg check-btn hidden" onclick="checkG7Step(${sIdx})">æª¢æŸ¥ç­”æ¡ˆ</button>`;
                stepEl.innerHTML = content;
                container.appendChild(stepEl);
                // Bind slot clear
                stepEl.querySelectorAll('.g7-slot').forEach(slot => {
                    slot.addEventListener('click', () => {
                        if (stepEl.classList.contains('completed')) return;
                        const val = slot.textContent;
                        slot.textContent = ''; slot.classList.remove('filled', 'incorrect');
                        Array.from(stepEl.querySelectorAll('.g7-option-btn')).forEach(btn => { if (btn.textContent === val) btn.disabled = false; });
                        stepEl.querySelector('.check-btn').classList.add('hidden');
                    });
                });
            });
        }
        function handleG7Option(val, btn, stepIdx) {
            const stepEl = document.getElementById(`g7-step-${stepIdx}`);
            const emptySlot = Array.from(stepEl.querySelectorAll('.g7-slot')).find(s => !s.classList.contains('filled'));
            if (emptySlot) {
                emptySlot.textContent = val; emptySlot.classList.add('filled'); btn.disabled = true;
                if (!Array.from(stepEl.querySelectorAll('.g7-slot')).some(s => !s.classList.contains('filled'))) {
                    stepEl.querySelector('.check-btn').classList.remove('hidden');
                }
            }
        }
        function checkG7Step(stepIdx) {
            const stepEl = document.getElementById(`g7-step-${stepIdx}`);
            const slots = stepEl.querySelectorAll('.g7-slot');
            let allCorrect = true;
            slots.forEach(slot => {
                if (slot.textContent !== slot.dataset.ans) {
                    allCorrect = false; slot.classList.add('incorrect'); setTimeout(() => slot.classList.remove('incorrect'), 500);
                } else {
                    slot.classList.add('correct');
                }
            });
            if (allCorrect) {
                stepEl.classList.add('completed');
                stepEl.querySelector('.check-btn').classList.add('hidden');
                stepEl.querySelector('.options-area').style.display = 'none';
                if (stepIdx < g7Problems[g7CurrentProblemIdx].steps.length - 1) {
                    const nextStep = document.getElementById(`g7-step-${stepIdx+1}`);
                    nextStep.classList.add('active');
                    nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    const stats = getStats();
                    if (!stats.game7.completedProblems.includes(g7Problems[g7CurrentProblemIdx].id)) {
                        stats.game7.completedProblems.push(g7Problems[g7CurrentProblemIdx].id);
                        saveStats(stats); renderG7Nav();
                    }
                    setTimeout(() => { document.getElementById('g7-completion-modal').classList.remove('hidden'); }, 500);
                }
            }
        }
        function closeG7Modal() { document.getElementById('g7-completion-modal').classList.add('hidden'); }

        // ================= GAME 8: é‡å¿ƒèˆ‡é¢ç© (æ–°) =================
        const g8Problems = [
            { id: 1, title: "é¡Œç›® 1", text: "å¦‚åœ–ï¼Œâ–³ABC çš„ä¸‰æ¢ä¸­ç·šäº¤æ–¼ G é»ï¼Œè‹¥ â–³ABC çš„é¢ç©ç‚º <mark class='bg-yellow-200 px-1 rounded'>48</mark>ï¼Œæ±‚ â–³BFG çš„é¢ç©ã€‚", highlight: "BFG", steps: [ { instruction: "é¡Œç›®çµ¦çš„ç¸½é¢ç©æ˜¯å¤šå°‘ï¼Ÿ", slots: [{ans:"48"}], opts: ["6", "24", "48"] }, { instruction: "è¨ˆç®— â–³BFG çš„é¢ç©ï¼š(ç¸½é¢ç© Ã· 6)", template: "{0} Ã· {1} = {2}", slots: [{ans:"48"}, {ans:"6"}, {ans:"8"}], opts: ["6", "8", "48"] } ] },
            { id: 2, title: "é¡Œç›® 2", text: "å¦‚åœ–ï¼Œâ–³ABC çš„ä¸‰æ¢ä¸­ç·šäº¤æ–¼ G é»ï¼Œè‹¥ â–³ABC çš„é¢ç©ç‚º <mark class='bg-yellow-200 px-1 rounded'>24</mark>ï¼Œæ±‚ â–³AGE çš„é¢ç©ã€‚", highlight: "AGE", steps: [ { instruction: "é‡å¿ƒ G å°‡å¤§ä¸‰è§’å½¢åˆ‡åˆ†æˆå¹¾å€‹é¢ç©ç›¸ç­‰çš„å°ä¸‰è§’å½¢ï¼Ÿ", slots: [{ans:"6"}], opts: ["3", "6", "9"], suffix: "å€‹" }, { instruction: "è¨ˆç®— â–³AGE çš„é¢ç©ï¼š(ç¸½é¢ç© Ã· 6)", template: "{0} Ã· {1} = {2}", slots: [{ans:"24"}, {ans:"6"}, {ans:"4"}], opts: ["4", "6", "24"] } ] },
            { id: 3, title: "é¡Œç›® 3", text: "å¦‚åœ–ï¼Œâ–³ABC çš„ä¸‰æ¢ä¸­ç·šäº¤æ–¼ G é»ï¼Œè‹¥ â–³AFG çš„é¢ç©ç‚º <mark class='bg-yellow-200 px-1 rounded'>12</mark>ï¼Œæ±‚ï¼š<br>(1) å››é‚Šå½¢ BFGD çš„é¢ç©ã€‚<br>(2) â–³ABC çš„é¢ç©ã€‚", highlight: "AFG", steps: [ { instruction: "å·²çŸ¥ â–³AFG é¢ç©æ˜¯ 12ã€‚å››é‚Šå½¢ BFGD åŒ…å«å¹¾å€‹é€™æ¨£çš„å°ä¸‰è§’å½¢ï¼Ÿ", slots: [{ans:"2"}], opts: ["1", "2", "3"], suffix: "å€‹" }, { instruction: "è¨ˆç®— (1) å››é‚Šå½¢ BFGD çš„é¢ç©ï¼š", template: "{0} Ã— {1} = {2}", slots: [{ans:"12"}, {ans:"2"}, {ans:"24"}], opts: ["2", "12", "24"] }, { instruction: "é‡å¿ƒå°‡ â–³ABC åˆ†æˆ 6 ç­‰ä»½ï¼Œè¨ˆç®— (2) â–³ABC ç¸½é¢ç©ï¼š", template: "{0} Ã— {1} = {2}", slots: [{ans:"12"}, {ans:"6"}, {ans:"72"}], opts: ["6", "12", "72"] } ] }
        ];
        let g8CurrentProblemIdx = 0, g8CurrentStepIdx = 0, g8StepState = [];
        function initGame8() { renderG8Nav(); loadG8Problem(0); }
        function renderG8Nav() {
            const container = document.getElementById('g8-nav-buttons');
            container.innerHTML = g8Problems.map((p, idx) => {
                const stats = getStats();
                const isDone = stats.game8.completedProblems.includes(p.id);
                return `<button onclick="switchG8Problem(${idx})" class="px-3 py-1.5 rounded-lg text-sm font-bold transition whitespace-nowrap border ${idx === g8CurrentProblemIdx ? 'bg-slate-700 text-white border-slate-600' : 'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}">${p.title} ${isDone?'âœ”':''}</button>`;
            }).join('');
        }
        function switchG8Problem(idx) {
            g8CurrentProblemIdx = idx; g8CurrentStepIdx = 0; g8StepState = []; renderG8Nav();
            const content = document.querySelector('#game8-wrapper main'); content.style.opacity = '0.5';
            setTimeout(() => { loadG8Problem(idx); content.style.opacity = '1'; }, 200);
        }
        function loadG8Problem(idx) {
            const p = g8Problems[idx];
            document.getElementById('g8-problem-title').innerText = p.title;
            document.getElementById('g8-problem-desc').innerHTML = p.text;
            document.getElementById('g8-svg-container').innerHTML = generateG8SVG(p.highlight);
            const container = document.getElementById('g8-steps-container'); container.innerHTML = '';
            
            p.steps.forEach((step, sIdx) => {
                g8StepState.push({ slotsFilled: new Array(step.slots.length).fill(null), isCompleted: false });
                const stepEl = document.createElement('div');
                stepEl.className = `g8-step-container bg-white p-5 rounded-xl shadow-sm border border-slate-200 mb-4 ${sIdx === 0 ? 'active' : ''}`;
                stepEl.id = `g8-step-${sIdx}`;
                
                let content = `<div class="flex justify-between mb-3"><h3 class="font-bold text-gray-800 text-lg flex items-center gap-2"><span class="bg-slate-200 text-slate-600 w-6 h-6 rounded-full flex items-center justify-center text-xs">${sIdx+1}</span>æ­¥é©Ÿ ${sIdx+1}</h3><span class="status-icon hidden text-green-500 font-bold text-sm">âœ” å®Œæˆ</span></div>`;
                content += `<p class="text-gray-700 mb-4 font-medium">${step.instruction}</p>`;
                
                let slotsHtml = '';
                if (step.template) {
                    let temp = step.template;
                    step.slots.forEach((_, slotIdx) => { temp = temp.replace(`{${slotIdx}}`, `<div class="g8-slot" data-idx="${slotIdx}"></div>`); });
                    slotsHtml = `<div class="flex flex-wrap items-center gap-2 mb-4 g8-math-text justify-center bg-slate-50 p-3 rounded-lg">${temp}</div>`;
                } else {
                    slotsHtml = `<div class="flex items-center gap-3 mb-4 justify-center bg-slate-50 p-3 rounded-lg"><div class="g8-slot" data-idx="0"></div>${step.suffix ? `<span class="text-lg font-bold">${step.suffix}</span>` : ''}</div>`;
                }
                content += slotsHtml;
                content += `<div class="flex flex-wrap gap-2 justify-center mb-3 options-area">${step.opts.map(o => `<button class="g8-option-btn" onclick="handleG8Option('${o}', this, ${sIdx})">${o}</button>`).join('')}</div>`;
                content += `<button class="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 rounded-lg check-btn hidden" onclick="checkG8Step(${sIdx})">æª¢æŸ¥ç­”æ¡ˆ</button>`;
                
                stepEl.innerHTML = content;
                container.appendChild(stepEl);
                
                stepEl.querySelectorAll('.g8-slot').forEach(slot => {
                    slot.addEventListener('click', () => {
                        if (g8StepState[sIdx].isCompleted) return;
                        const val = slot.textContent;
                        slot.textContent = ''; slot.classList.remove('filled', 'error');
                        g8StepState[sIdx].slotsFilled[slot.dataset.idx] = null;
                        Array.from(stepEl.querySelectorAll('.g8-option-btn')).forEach(btn => { if (btn.textContent === val) btn.disabled = false; });
                        stepEl.querySelector('.check-btn').classList.add('hidden');
                    });
                });
            });
        }
        function generateG8SVG(highlight) {
            const A={x:150,y:20}, B={x:50,y:180}, C={x:250,y:180}, D={x:150,y:180}, E={x:200,y:100}, F={x:100,y:100}, G={x:150,y:126.6};
            const paths = {
                'AGE': `M${A.x},${A.y} L${G.x},${G.y} L${E.x},${E.y} Z`,
                'AFG': `M${A.x},${A.y} L${F.x},${F.y} L${G.x},${G.y} Z`,
                'BFG': `M${B.x},${B.y} L${F.x},${F.y} L${G.x},${G.y} Z`,
                'BDG': `M${B.x},${B.y} L${D.x},${D.y} L${G.x},${G.y} Z`,
                'CDG': `M${C.x},${C.y} L${D.x},${D.y} L${G.x},${G.y} Z`,
                'CEG': `M${C.x},${C.y} L${E.x},${E.y} L${G.x},${G.y} Z`
            };
            let hPath = '';
            if (highlight === 'BFG') hPath = `<path d="${paths.BFG}" class="g8-highlight-area" />`;
            if (highlight === 'AGE') hPath = `<path d="${paths.AGE}" class="g8-highlight-area" />`;
            if (highlight === 'AFG') hPath = `<path d="${paths.AFG}" class="g8-highlight-area" />`;
            
            return `<svg width="260" height="200" viewBox="0 0 300 200"><path d="M150,20 L50,180 L250,180 Z" fill="none" stroke="#334155" stroke-width="2"/>${hPath}<line x1="150" y1="20" x2="150" y2="180" stroke="#94a3b8"/><line x1="50" y1="180" x2="200" y2="100" stroke="#94a3b8"/><line x1="250" y1="180" x2="100" y2="100" stroke="#94a3b8"/><text x="145" y="15" font-weight="bold">A</text><text x="35" y="190" font-weight="bold">B</text><text x="255" y="190" font-weight="bold">C</text><text x="160" y="130" font-weight="bold">G</text><text x="80" y="100">F</text><text x="210" y="100">E</text><text x="145" y="195">D</text></svg>`;
        }
        function handleG8Option(val, btn, sIdx) {
            const state = g8StepState[sIdx];
            const emptyIdx = state.slotsFilled.findIndex(x => x === null);
            if (emptyIdx !== -1) {
                state.slotsFilled[emptyIdx] = val;
                const slot = document.getElementById(`g8-step-${sIdx}`).querySelector(`.g8-slot[data-idx="${emptyIdx}"]`);
                slot.textContent = val; slot.classList.add('filled');
                btn.disabled = true;
                if (!state.slotsFilled.includes(null)) document.getElementById(`g8-step-${sIdx}`).querySelector('.check-btn').classList.remove('hidden');
            }
        }
        function checkG8Step(sIdx) {
            const step = g8Problems[g8CurrentProblemIdx].steps[sIdx];
            const state = g8StepState[sIdx];
            let correct = true;
            state.slotsFilled.forEach((val, i) => { if (val !== step.slots[i].ans) correct = false; });
            const stepEl = document.getElementById(`g8-step-${sIdx}`);
            if (correct) {
                state.isCompleted = true;
                stepEl.classList.add('done');
                stepEl.querySelector('.status-icon').classList.remove('hidden');
                stepEl.querySelector('.check-btn').classList.add('hidden');
                stepEl.querySelectorAll('.g8-slot').forEach(s => s.classList.add('correct'));
                
                if (sIdx < g8Problems[g8CurrentProblemIdx].steps.length - 1) {
                    const next = document.getElementById(`g8-step-${sIdx+1}`);
                    next.classList.add('active');
                    next.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    const stats = getStats();
                    if (!stats.game8.completedProblems.includes(g8Problems[g8CurrentProblemIdx].id)) {
                        stats.game8.completedProblems.push(g8Problems[g8CurrentProblemIdx].id);
                        saveStats(stats); renderG8Nav();
                    }
                    setTimeout(() => document.getElementById('g8-completion-modal').classList.remove('hidden'), 500);
                }
            } else {
                stepEl.querySelectorAll('.g8-slot').forEach(s => { s.classList.add('error'); setTimeout(()=>s.classList.remove('error'), 500); });
            }
        }
        function closeG8Modal() { document.getElementById('g8-completion-modal').classList.add('hidden'); }

        // å•Ÿå‹•
        window.onload = initDashboard;
    </script>
</body>
</html>