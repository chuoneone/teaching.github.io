<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動幾何學習：平行線截比例線段</title>    
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .step-container {
            transition: all 0.5s ease-in-out;
        }
        .step-locked {
            opacity: 0.4;
            pointer-events: none;
        }
        .feedback-message {
            transition: opacity 0.3s;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 500;
        }
        .feedback-correct {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .feedback-incorrect {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .diagram-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin: 1rem auto;
            aspect-ratio: 4 / 3;
        }
        .diagram-label {
            position: absolute;
            font-weight: bold;
            color: #1f2937;
        }
        .diagram-input {
            position: absolute;
            width: 60px;
            padding: 4px;
            border-radius: 4px;
            border: 1px solid #9ca3af;
            text-align: center;
            font-size: 1rem;
            transition: all 0.3s ease-in-out;
        }
        #label-A { top: -5%; left: 48%; }
        #label-B { top: 90%; left: -5%; }
        #label-C { top: 90%; left: 98%; }
        #label-P { top: 32%; left: 18%; }
        #label-Q { top: 32%; left: 75%; }

        #input-ap { top: 12%; left: 28%; transform: rotate(-35deg); }
        #input-pb { top: 58%; left: 10%; transform: rotate(-35deg); }
        #input-aq { top: 12%; left: 60%; transform: rotate(30deg); }
        #input-qc { top: 58%; left: 80%; transform: rotate(30deg); }
        #input-pq { top: 40%; left: 45%; }
        #input-bc { top: 95%; left: 45%; }
        
        .highlight {
            background: linear-gradient(to top, #fef08a 60%, transparent 60%);
            padding: 0 0.2rem;
        }
        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .nav-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .nav-btn:not(.active) {
            background-color: #e5e7eb;
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        <!-- 題庫導覽 -->
        <div id="question-nav" class="flex justify-center items-center flex-wrap gap-2 mb-6 border-b pb-4">
            <!-- Nav buttons will be inserted by JS -->
        </div>

        <!-- 標題部分 -->
        <div class="text-center mb-8">
            <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-slate-800">平行線截比例線段性質</h1>
            <p class="text-slate-500 mt-2 text-lg">互動式練習</p>
        </div>

        <div class="flex flex-col md:flex-row md:space-x-8">
            <!-- 左半部: 題目與圖形 -->
            <div class="md:w-1/2">
                <div id="prompt-container" class="bg-slate-100 p-5 rounded-lg mb-6">
                    <p id="prompt-text" class="text-slate-700 leading-relaxed text-lg">
                        <!-- Prompt will be inserted by JS -->
                    </p>
                </div>

                <div id="diagram-step" class="step-container">
                    <h3 class="font-bold text-center text-xl text-slate-700 mb-2">請先在圖形中填入已知線段長度</h3>
                    <div class="diagram-container">
                        <svg viewBox="0 0 100 75" class="w-full h-full">
                            <polygon points="50,5 0,70 100,70" style="fill:none;stroke:#6b7280;stroke-width:0.5"/>
                            <line x1="25" y1="37.5" x2="75" y2="37.5" style="stroke:#6b7280;stroke-width:0.5" />
                            <g id="custom-arcs">
                                <!-- Part-Part Arcs -->
                                <path id="arc-ap" d="M 50 5 A 45 45 0 0 0 25 37.5" stroke="#ef4444" stroke-width="0.8" fill="none" />
                                <path id="arc-pb" d="M 25 37.5 A 45 45 0 0 0 0 70" stroke="#22c55e" stroke-width="0.8" fill="none" />
                                <path id="arc-aq" d="M 50 5 A 45 45 0 0 1 75 37.5" stroke="#ef4444" stroke-width="0.8" fill="none" />
                                <path id="arc-qc" d="M 75 37.5 A 45 45 0 0 1 100 70" stroke="#22c55e" stroke-width="0.8" fill="none" />
                                <!-- Part-Whole Arcs -->
                                <path id="arc-ab" d="M 50 5 A 85 85 0 0 0 0 70" stroke="#22c55e" stroke-width="0.8" fill="none" />
                                <path id="arc-ac" d="M 50 5 A 85 85 0 0 1 100 70" stroke="#22c55e" stroke-width="0.8" fill="none" />
                                <!-- Middle-Base Arcs -->
                                <path id="arc-pq" d="M 25 37.5 A 26 10 0 0 0 75 37.5" stroke="#ef4444" stroke-width="0.8" fill="none" />
                                <path id="arc-bc" d="M 0 70 A 60 40 0 0 0 100 70" stroke="#22c55e" stroke-width="0.8" fill="none" />
                            </g>
                        </svg>
                        <div id="label-A" class="diagram-label">A</div><div id="label-B" class="diagram-label">B</div><div id="label-C" class="diagram-label">C</div><div id="label-P" class="diagram-label">P</div><div id="label-Q" class="diagram-label">Q</div>
                        <input id="input-ap" type="number" class="diagram-input" placeholder="AP">
                        <input id="input-pb" type="number" class="diagram-input" placeholder="PB">
                        <input id="input-aq" type="number" class="diagram-input" placeholder="AQ">
                        <input id="input-qc" type="text" class="diagram-input font-bold text-blue-600">
                        <input id="input-pq" type="number" class="diagram-input" placeholder="PQ">
                        <input id="input-bc" type="text" class="diagram-input font-bold text-blue-600">
                    </div>
                    <div class="text-center">
                         <button id="check-diagram-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">確認圖形</button>
                    </div>
                </div>
            </div>

            <!-- 右半部: 解題步驟 -->
            <div class="md:w-1/2 mt-8 md:mt-0 space-y-4">
                <div id="global-feedback" class="text-center h-12"></div>
                <div id="step1" class="step-container p-5 border rounded-lg">
                    <h3 id="s1-title" class="font-bold text-xl text-slate-700 mb-2"></h3>
                    <p id="s1-hint" class="text-base text-slate-500 mb-4"></p>
                    <div class="flex items-center justify-center space-x-2">
                        <input id="s1_1" type="number" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">:</span><input id="s1_2" type="number" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">=</span><input id="s1_3" type="number" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">:</span><input id="s1_4" type="text" class="w-20 p-2 border rounded text-center text-lg">
                    </div>
                     <div class="text-center mt-4"><button id="check-s1-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">檢查答案</button></div>
                </div>

                <div id="step2" class="step-container p-5 border rounded-lg">
                    <h3 id="s2-title" class="font-bold text-xl text-slate-700 mb-2"></h3>
                    <p id="s2-hint" class="text-base text-slate-500 mb-4"></p>
                    <div class="flex items-center justify-center space-x-2">
                        <input id="s2_1" type="number" class="w-20 p-2 border rounded text-center text-lg"><span class="font-bold text-lg">x</span><span class="font-bold text-lg">=</span><input id="s2_2" type="number" class="w-24 p-2 border rounded text-center text-lg">
                    </div>
                     <div class="text-center mt-4"><button id="check-s2-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">檢查答案</button></div>
                </div>
                
                <div id="step3" class="step-container p-5 border rounded-lg">
                    <h3 id="s3-title" class="font-bold text-xl text-slate-700 mb-2"></h3>
                    <p id="s3-hint" class="text-base text-slate-500 mb-4"></p>
                    <div class="flex flex-col items-center justify-center space-y-2 bg-slate-100 p-3 rounded">
                        <span id="s3-equation" class="font-mono text-xl"></span>
                        <div class="flex items-center space-x-2">
                            <span class="font-mono text-xl">x =</span>
                            <input id="s3_1" type="number" class="w-28 p-2 border rounded text-center font-bold text-lg" placeholder="最終答案">
                        </div>
                    </div>
                     <div class="text-center mt-4"><button id="check-s3-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">提交最終答案</button></div>
                </div>
            </div>
        </div>

        <div id="completion-message" class="text-center mt-8 p-6 bg-green-100 border-2 border-green-400 rounded-lg" style="display: none;">
            <h2 class="text-3xl font-bold text-green-700">恭喜你，完成練習！</h2>
            <p class="mt-2 text-green-600 text-lg">你已經掌握了這個概念！</p>
            <button id="reset-btn" class="mt-4 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">再做一次</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const questions = [
          { // Q1
            description: "AP = 8，PB = 12，AQ = 10", findText: "求 QC。", formulaType: 'part-part',
            diagram: { ap: 8, pb: 12, aq: 10, qc: 'x' },
            steps: [
              { title: "步驟一：列出比例式", hint: "口訣：<span class='font-bold text-red-500'>上 : 下 = 上 : 下</span>。", correct: ["8", "12", "10", "x"] },
              { title: "步驟二：列出方程式", hint: "根據 <span class='font-mono'>8 : 12 = 10 : x</span>，利用「內項積 = 外項積」。", correct: ["8", "120"] },
              { title: "步驟三：解出 x", hint: "化簡算式 <span class='font-mono'>8x = 120</span>。", correct: ["15"] }
            ]
          },
          { // Q2
            description: "AP = 12，PB = 9，AQ = 8", findText: "求 QC。", formulaType: 'part-part',
            diagram: { ap: 12, pb: 9, aq: 8, qc: 'x' },
            steps: [
              { title: "步驟一：列出比例式", hint: "口訣：<span class='font-bold text-red-500'>上 : 下 = 上 : 下</span>。", correct: ["12", "9", "8", "x"] },
              { title: "步驟二：列出方程式", hint: "根據 <span class='font-mono'>12 : 9 = 8 : x</span>，利用「內項積 = 外項積」。", correct: ["12", "72"] },
              { title: "步驟三：解出 x", hint: "化簡算式 <span class='font-mono'>12x = 72</span>。", correct: ["6"] }
            ]
          },
          { // Q3
            description: "AP = 14，AB = 42，AQ = 12", findText: "求 AC。", formulaType: 'part-whole',
            diagram: { ap: 14, ab: 42, aq: 12, ac: 'x' },
            steps: [
              { title: "步驟一：列出比例式", hint: "提示：<span class='font-bold text-red-500'>上 : 全 = 上 : 全</span>。", correct: ["14", "42", "12", "x"] },
              { title: "步驟二：列出方程式", hint: "根據 <span class='font-mono'>14 : 42 = 12 : x</span>，利用「內項積 = 外項積」。", correct: ["14", "504"] },
              { title: "步驟三：解出 x", hint: "化簡算式 <span class='font-mono'>14x = 504</span>。", correct: ["36"] }
            ]
          },
           { // Q4
            description: "AP = 6，AB = 27，AQ = 4", findText: "求 AC。", formulaType: 'part-whole',
            diagram: { ap: 6, ab: 27, aq: 4, ac: 'x' },
            steps: [
              { title: "步驟一：列出比例式", hint: "提示：<span class='font-bold text-red-500'>上 : 全 = 上 : 全</span>。", correct: ["6", "27", "4", "x"] },
              { title: "步驟二：列出方程式", hint: "根據 <span class='font-mono'>6 : 27 = 4 : x</span>，利用「內項積 = 外項積」。", correct: ["6", "108"] },
              { title: "步驟三：解出 x", hint: "化簡算式 <span class='font-mono'>6x = 108</span>。", correct: ["18"] }
            ]
          },
          { // Q5
            description: "AP = 8，AB = 20，PQ = 14", findText: "求 BC。", formulaType: 'middle-base',
            diagram: { ap: 8, ab: 20, pq: 14, bc: 'x' },
            steps: [
              { title: "步驟一：列出比例式", hint: "提示：<span class='font-bold text-red-500'>上 : 全 = 中 : 底</span>。 ", correct: ["8", "20", "14", "x"] },
              { title: "步驟二：列出方程式", hint: "根據 <span class='font-mono'>8 : 20 = 14 : x</span>，利用「內項積 = 外項積」。", correct: ["8", "280"] },
              { title: "步驟三：解出 x", hint: "化簡算式 <span class='font-mono'>8x = 280</span>。", correct: ["35"] }
            ]
          },
          { // Q6
            description: "AP = 15，AB = 24，PQ = 10", findText: "求 BC。", formulaType: 'middle-base',
            diagram: { ap: 15, ab: 24, pq: 10, bc: 'x' },
            steps: [
              { title: "步驟一：列出比例式", hint: "提示：<span class='font-bold text-red-500'>上 : 全 = 中 : 底</span>。", correct: ["15", "24", "10", "x"] },
              { title: "步驟二：列出方程式", hint: "根據 <span class='font-mono'>15 : 24 = 10 : x</span>，利用「內項積 = 外項積」。", correct: ["15", "240"] },
              { title: "步驟三：解出 x", hint: "化簡算式 <span class='font-mono'>15x = 240</span>。", correct: ["16"] }
            ]
          }
        ];
        let currentQuestionIndex = 0;

        // --- DOM Elements ---
        const feedbackEl = document.getElementById('global-feedback');
        const diagramLabels = { Q: document.getElementById('label-Q'), C: document.getElementById('label-C') };
        const diagramInputs = { ap: document.getElementById('input-ap'), pb: document.getElementById('input-pb'), aq: document.getElementById('input-aq'), qc: document.getElementById('input-qc'), pq: document.getElementById('input-pq'), bc: document.getElementById('input-bc') };
        const customArcs = {
            ap: document.getElementById('arc-ap'), pb: document.getElementById('arc-pb'), aq: document.getElementById('arc-aq'),
            qc: document.getElementById('arc-qc'), ab: document.getElementById('arc-ab'), ac: document.getElementById('arc-ac'),
            pq: document.getElementById('arc-pq'), bc: document.getElementById('arc-bc'),
        };
        
        // --- Helper Function ---
        function getDiagramInputEl(key) {
            if (key === 'ab') return diagramInputs.pb;
            if (key === 'ac') return diagramInputs.qc;
            return diagramInputs[key];
        }

        function disableStepControls(stepId) {
            const step = document.getElementById(stepId);
            step.querySelectorAll('input').forEach(input => input.disabled = true);
            step.querySelectorAll('button').forEach(button => button.disabled = true);
        }

        // --- Functions ---
        function showFeedback(message, isCorrect) {
            feedbackEl.innerHTML = `<div class="feedback-message ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}">${message}</div>`;
            setTimeout(() => { feedbackEl.innerHTML = ''; }, 2500);
        }

        function setStepLock(stepId, locked) {
            const step = document.getElementById(stepId);
            const inputs = step.querySelectorAll('input');
            const buttons = step.querySelectorAll('button');
            if (locked) {
                step.classList.add('step-locked');
                inputs.forEach(input => input.disabled = true);
                buttons.forEach(button => button.disabled = true);
            } else {
                step.classList.remove('step-locked');
                inputs.forEach(input => input.disabled = false);
                buttons.forEach(button => button.disabled = false);
                if(inputs.length > 0 && !inputs[0].readOnly) {
                   inputs[0].focus();
                }
            }
        }

        function loadQuestion(index) {
            currentQuestionIndex = index;
            const data = questions[index];
            
            document.querySelectorAll('#question-nav .nav-btn').forEach((btn, i) => btn.classList.toggle('active', i === index));

            let promptHTML = `<strong>題目：</strong>如下圖，在△ABC中，P、Q兩點分別在 <span class="font-mono">AB</span>、<span class="font-mono">AC</span> 上，若 <span class="font-mono">PQ // BC</span>，`;
            const clues = data.description.split('，').map(c => `<span class="highlight font-mono">${c.trim()}</span>`).join('，');
            promptHTML += `${clues}，${data.findText}(令未知數為 x)`;
            document.getElementById('prompt-text').innerHTML = promptHTML;
            
            const type = data.formulaType;
            diagramInputs.pb.style.top = (type === 'part-whole') ? '45%' : '58%';
            diagramInputs.pb.style.left = (type === 'part-whole') ? '0%' : '10%';
            diagramInputs.qc.style.top = (type === 'part-whole') ? '45%' : '58%';
            diagramInputs.qc.style.left = (type === 'part-whole') ? '90%' : '80%';
            
            // Toggle visibility based on type
            const showRightSide = type === 'part-part' || type === 'part-whole';
            const showMiddleBase = type === 'middle-base';
            
            diagramInputs.aq.style.display = showRightSide ? 'block' : 'none';
            diagramInputs.qc.style.display = showRightSide ? 'block' : 'none';
            diagramLabels.Q.style.display = showRightSide ? 'block' : 'none';
            
            diagramInputs.pq.style.display = showMiddleBase ? 'block' : 'none';
            diagramInputs.bc.style.display = showMiddleBase ? 'block' : 'none';

            customArcs.ap.style.display = 'block';
            customArcs.aq.style.display = showRightSide ? 'block' : 'none';
            customArcs.pb.style.display = (type === 'part-part') ? 'block' : 'none';
            customArcs.qc.style.display = (type === 'part-part') ? 'block' : 'none';
            customArcs.ab.style.display = (type === 'part-whole' || type === 'middle-base') ? 'block' : 'none';
            customArcs.ac.style.display = (type === 'part-whole') ? 'block' : 'none';
            customArcs.pq.style.display = showMiddleBase ? 'block' : 'none';
            customArcs.bc.style.display = showMiddleBase ? 'block' : 'none';

            diagramInputs.pb.placeholder = (type === 'part-whole') ? 'AB' : 'AB';
            diagramInputs.qc.placeholder = (type === 'part-whole') ? 'AC' : 'QC';

            document.getElementById('s1-title').innerText = data.steps[0].title;
            document.getElementById('s1-hint').innerHTML = data.steps[0].hint;
            document.getElementById('s2-title').innerText = data.steps[1].title;
            document.getElementById('s2-hint').innerHTML = data.steps[1].hint;
            document.getElementById('s3-title').innerText = data.steps[2].title;
            document.getElementById('s3-hint').innerHTML = data.steps[2].hint;
            document.getElementById('s3-equation').innerText = data.steps[2].hint.match(/<span class='font-mono'>(.*?)<\/span>/)[1] + " →";

            resetCurrentQuestion();
        }
        
        function resetCurrentQuestion() {
            document.querySelectorAll('.step-container').forEach((step, i) => {
                 setStepLock(step.id, i !== 0);
                 step.querySelectorAll('input').forEach(input => input.value = '');
            });
            document.getElementById('completion-message').style.display = 'none';

            Object.values(diagramInputs).forEach(input => {
                input.value = '';
                input.classList.remove('border-2', 'border-green-500', 'bg-green-100');
                input.readOnly = false;
            });
            
            const data = questions[currentQuestionIndex];
            const unknownKey = Object.keys(data.diagram).find(key => data.diagram[key] === 'x');
            const unknownInputEl = getDiagramInputEl(unknownKey);
            if (unknownInputEl) {
                unknownInputEl.value = 'x';
                unknownInputEl.readOnly = true;
            }

            showFeedback(`第 ${currentQuestionIndex + 1} 題載入完成`, true);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function checkDiagram() {
            const data = questions[currentQuestionIndex];
            const correct = data.diagram;
            
            let isCorrect = true;
            // Check all keys present in diagram data against the input fields
            for (const key in correct) {
                if (key !== 'x' && correct[key] !== 'x') {
                    const inputEl = getDiagramInputEl(key);
                    if (inputEl && inputEl.value.trim() != correct[key]) {
                        isCorrect = false;
                        break;
                    }
                }
            }
            
            if (isCorrect) {
                showFeedback('圖形數字正確！請開始計算。', true);
                document.getElementById('diagram-step').classList.remove('step-locked');
                disableStepControls('diagram-step');
                setStepLock('step1', false);
            } else {
                showFeedback('圖形中的數字不對喔，請再對照一次題目。', false);
            }
        }
        
        function checkStep(stepIndex) {
            const stepId = `step${stepIndex + 1}`;
            const nextStepId = `step${stepIndex + 2}`;
            const data = questions[currentQuestionIndex];
            const correctValues = data.steps[stepIndex].correct;
            const inputElements = document.querySelectorAll(`#${stepId} input`);
            
            const userValues = Array.from(inputElements).map(el => el.value.trim().toLowerCase());
            const isCorrect = JSON.stringify(userValues) === JSON.stringify(correctValues);

            if (isCorrect) {
                showFeedback(`步驟 ${stepIndex + 1} 正確！`, true);
                document.getElementById(stepId).classList.remove('step-locked');
                disableStepControls(stepId);

                if (stepIndex < 2) {
                   setStepLock(nextStepId, false);
                } else { 
                   document.getElementById('completion-message').style.display = 'block';
                   const unknownKey = Object.keys(data.diagram).find(key => data.diagram[key] === 'x');
                   const unknownInputEl = getDiagramInputEl(unknownKey);
                   if(unknownInputEl) {
                       unknownInputEl.value = correctValues[0];
                       unknownInputEl.classList.add('border-2', 'border-green-500', 'bg-green-100');
                   }
                   document.getElementById('completion-message').scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            } else {
                showFeedback('答案有誤，請再檢查一次。', false);
            }
        }
        
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const navContainer = document.getElementById('question-nav');
            questions.forEach((q, i) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.innerText = `第 ${i + 1} 題`;
                btn.onclick = () => loadQuestion(i);
                navContainer.appendChild(btn);
            });

            document.getElementById('check-diagram-btn').onclick = checkDiagram;
            document.getElementById('check-s1-btn').onclick = () => checkStep(0);
            document.getElementById('check-s2-btn').onclick = () => checkStep(1);
            document.getElementById('check-s3-btn').onclick = () => checkStep(2);
            document.getElementById('reset-btn').onclick = resetCurrentQuestion;
            
            document.querySelectorAll('input').forEach(input => {
                input.onkeydown = (event) => {
                    if (event.key === 'Enter') {
                        const parentStep = input.closest('.step-container, #diagram-step');
                        if (parentStep && !parentStep.querySelector('button').disabled) {
                            parentStep.querySelector('button').click();
                        }
                    }
                };
            });

            loadQuestion(0);
        });

    </script>
</body>
</html>


