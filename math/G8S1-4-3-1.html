<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼ï¼šKaTeX äº’å‹•æ•™å­¸ç‰ˆ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&family=LXGW+WenKai+TC&display=swap" rel="stylesheet">
    
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <!-- KaTeX JS -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <!-- KaTeX Auto-render Extension -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --font-ui: "Chiron GoRound TC", sans-serif;
            --font-text: "LXGW WenKai TC", serif;
        }
        
        body {
            font-family: var(--font-ui);
            background-color: #f5f5f4;
            -webkit-tap-highlight-color: transparent;
        }

        .math-text {
            font-family: var(--font-text);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .option-chip {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }
        
        .option-chip:active { transform: scale(0.95); }

        .solution-step {
            border-left: 4px solid #ea580c;
            padding-left: 1rem;
            margin-bottom: 1.5rem;
            animation: slide-in 0.5s ease-out forwards;
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* ä¿®æ­£ KaTeX åœ¨é¸é …ä¸­çš„é‚Šè· */
        .katex-display { margin: 0.5em 0; }
        .option-chip .katex { font-size: 1.1em; }
    </style>
    <!-- Chosen Palette: Warm Neutrals (Stone & Orange) -->
    <!-- Application Structure Plan: 
         1. **KaTeX Integration**: All mathematical notation is wrapped in delimiters ($ or $$) and rendered via the KaTeX auto-render extension.
         2. **Typography**: UI uses Chiron GoRound TC, and problem text/solutions use LXGW WenKai TC for an organic, friendly feel.
         3. **Seamless Transition**: After Phase 1 (Interactive Formulation), Phase 2 (Direct Teaching) is revealed in the same container.
         4. **Responsive Math**: KaTeX expressions are placed in flexible containers to prevent horizontal overflow on smaller devices.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="text-stone-800 min-h-screen flex flex-col">

    <!-- Header & Progress -->
    <header class="bg-white shadow-sm flex-none sticky top-0 z-20">
        <div class="max-w-4xl mx-auto px-4 py-3 sm:py-4 flex flex-col sm:flex-row justify-between items-center gap-3">
            <div class="flex items-center gap-3 w-full sm:w-auto">
                <div class="bg-orange-500 p-1.5 sm:p-2 rounded-lg text-white font-bold text-lg sm:text-xl">
                    Math<span class="opacity-80">Flow</span>
                </div>
                <h1 class="text-base sm:text-lg font-semibold text-stone-700 truncate">æ–¹ç¨‹å¼ï¼šåˆ—å¼èˆ‡è§£é¡Œ</h1>
            </div>
            <div class="flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-end">
                <div class="text-xs sm:text-sm font-medium text-stone-500 whitespace-nowrap">é€²åº¦: <span id="progress-text">1/6</span></div>
                <div class="w-full sm:w-32 h-2 bg-stone-200 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-orange-500 w-1/6 transition-all duration-500"></div>
                </div>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="bg-stone-50 border-t border-stone-200 overflow-x-auto no-scrollbar">
            <div class="max-w-4xl mx-auto flex px-2" id="nav-tabs"></div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-3 sm:p-6 lg:p-8">
        <div class="max-w-3xl mx-auto">
            
            <!-- Main Content Card -->
            <div id="problem-card" class="bg-white rounded-xl sm:rounded-2xl shadow-lg border border-stone-200 overflow-hidden mb-6">
                
                <!-- Problem Narrative -->
                <div class="p-5 sm:p-8 border-b border-stone-100 bg-stone-50/50">
                    <div class="flex items-center gap-2 mb-3">
                        <span id="problem-category" class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-orange-100 text-orange-700">åˆ†é¡æ¨™ç±¤</span>
                        <span id="phase-tag" class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-stone-200 text-stone-600">ç¬¬ä¸€éšæ®µï¼šå¼•å°åˆ—å¼</span>
                    </div>
                    <p id="problem-text" class="math-text text-xl sm:text-2xl text-stone-800 leading-relaxed font-medium">
                        <!-- JS content -->
                    </p>
                </div>

                <!-- Interaction/Solution Area -->
                <div class="p-5 sm:p-8">
                    <!-- Phase 1 Container -->
                    <div id="phase1-container" class="space-y-8">
                        <!-- Dynamic Steps -->
                    </div>

                    <!-- Transition: Final Equation -->
                    <div id="equation-display-box" class="mt-8 p-6 sm:p-8 bg-stone-900 rounded-xl hidden opacity-0 transition-all duration-500">
                        <p class="text-stone-500 text-[10px] uppercase tracking-widest text-center mb-3">å»ºç«‹çš„æ–¹ç¨‹å¼</p>
                        <div id="equation-formula" class="text-2xl sm:text-4xl text-white flex flex-wrap justify-center items-center gap-1 sm:gap-2"></div>
                        <div class="mt-6 flex justify-center">
                            <button id="start-solve-btn" onclick="app.showSolutionGuide()" class="px-8 py-3 bg-orange-500 text-white rounded-full font-bold shadow-lg hover:bg-orange-600 active:scale-95 transition-all">
                                è§€çœ‹è§£é¡Œæ­¥é©Ÿæ•™å­¸
                            </button>
                        </div>
                    </div>

                    <!-- Phase 2: Solution Guide (Teaching Mode) -->
                    <div id="phase2-container" class="mt-10 space-y-8 hidden">
                        <div class="flex items-center gap-2 mb-6 border-b border-stone-100 pb-2">
                            <span class="text-orange-600">ğŸ“–</span>
                            <h3 class="text-lg font-bold text-stone-800">è§£é¡Œæ­¥é©Ÿæ•™å­¸</h3>
                        </div>
                        <div id="solution-steps" class="math-text space-y-2">
                            <!-- JS injected static content -->
                        </div>
                        <div class="pt-6 border-t border-stone-100 flex justify-center">
                            <button onclick="app.nextProblem()" class="w-full sm:w-auto px-10 py-4 bg-stone-900 text-white rounded-full font-bold hover:bg-stone-800 transition-all">
                                æˆ‘å­¸æœƒäº†ï¼Œä¸‹ä¸€é¡Œ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const problems = [
            {
                id: 1,
                category: "åŸå­ç­†è²·è³£",
                text: "å°é½Šè²·åŸå­ç­†ï¼Œæ•¸é‡æ¯”å–®åƒ¹å°‘ 6ï¼Œä»˜äº† 140 å…ƒæ‰¾å› 5 å…ƒï¼Œå–®åƒ¹æ˜¯å¤šå°‘å…ƒï¼Ÿ",
                phase1: [
                    { label: "è¨­å–®åƒ¹ç‚º", options: ["$x$"], correct: "$x$" },
                    { label: "æ•¸é‡å‰‡æ˜¯", options: ["$x + 6$", "$x - 6$"], correct: "$x - 6$" },
                    { label: "å¯¦éš›èŠ±äº†", options: ["$135$", "$145$"], correct: "$135$" }
                ],
                formula: ["$x(x - 6) = 135$"],
                solution: [
                    { title: "æ­¥é©Ÿ 1ï¼šå±•é–‹ä¸¦ç§»é …æ•´ç†", content: "å°‡ç®—å¼å±•é–‹å¾—åˆ° $x^2 - 6x = 135$ï¼Œç§»é …æ•´ç†æˆæ¨™æº–å¼ï¼š<br><span class='text-orange-600 font-bold'>$x^2 - 6x - 135 = 0$</span>" },
                    { title: "æ­¥é©Ÿ 2ï¼šé€²è¡Œå› å¼åˆ†è§£", content: "åˆ©ç”¨åå­—äº¤ä¹˜æ³•ï¼Œæ‰¾å‡ºçµ„åˆç‚º $-15$ èˆ‡ $+9$ï¼š<br><span class='text-stone-700 font-bold'>$(x - 15)(x + 9) = 0$</span>" },
                    { title: "æ­¥é©Ÿ 3ï¼šæ±‚å‡ºæœªçŸ¥æ•¸ $x$", content: "å¯å¾—ï¼š<span class='text-stone-700 font-bold'>$x = 15$</span> æˆ– <span class='text-stone-700 font-bold'>$x = -9$</span>" },
                    { title: "æ­¥é©Ÿ 4ï¼šåˆ¤æ–·ç­”æ¡ˆåˆç†æ€§", content: "åƒ¹éŒ¢ä¸å¯èƒ½æ˜¯è² æ•¸ï¼Œæ•… <span class='text-red-500'>$x = -9$ (ä¸åˆ)</span>ã€‚<br>æœ€çµ‚ç­”æ¡ˆï¼š<span class='text-green-600 font-bold'>å–®åƒ¹ç‚º 15 å…ƒ</span>ã€‚" }
                ]
            },
            {
                id: 2,
                category: "ç­†è¨˜æœ¬è²·è³£",
                text: "é˜¿å¼·è²·ç­†è¨˜æœ¬ï¼Œæ•¸é‡æ¯”å–®åƒ¹å°‘ 13ï¼Œä»˜ 150 å…ƒæ‰¾å› 10 å…ƒï¼Œå–®åƒ¹å¤šå°‘å…ƒï¼Ÿ",
                phase1: [
                    { label: "è¨­å–®åƒ¹ç‚º", options: ["$x$"], correct: "$x$" },
                    { label: "æ•¸é‡å‰‡æ˜¯", options: ["$x - 13$", "$x + 13$"], correct: "$x - 13$" },
                    { label: "å¯¦éš›èŠ±äº†", options: ["$140$", "$160$"], correct: "$140$" }
                ],
                formula: ["$x(x - 13) = 140$"],
                solution: [
                    { title: "æ­¥é©Ÿ 1ï¼šå±•é–‹ä¸¦ç§»é …æ•´ç†", content: "æ•´ç†å¾—åˆ°ï¼š<span class='text-orange-600 font-bold'>$x^2 - 13x - 140 = 0$</span>" },
                    { title: "æ­¥é©Ÿ 2ï¼šå› å¼åˆ†è§£", content: "æ‰¾å‡ºçµ„åˆç‚º $-20$ èˆ‡ $+7$ï¼š<br><span class='text-stone-700 font-bold'>$(x - 20)(x + 7) = 0$</span>" },
                    { title: "æ­¥é©Ÿ 3ï¼šæ±‚å‡º $x$", content: "è§£å¾—ï¼š<span class='text-stone-700 font-bold'>$x = 20$</span> æˆ– <span class='text-stone-700 font-bold'>$x = -7$</span>" },
                    { title: "æ­¥é©Ÿ 4ï¼šåˆç†åˆ¤æ–·", content: "å–®åƒ¹éœ€ç‚ºæ­£æ•¸ï¼Œæ•… <span class='text-red-500'>$x = -7$ (ä¸åˆ)</span>ã€‚<br>æœ€çµ‚ç­”æ¡ˆï¼š<span class='text-green-600 font-bold'>å–®åƒ¹ç‚º 20 å…ƒ</span>ã€‚" }
                ]
            },
            {
                id: 3,
                category: "éŒ¢æ•¸é—œä¿‚",
                text: "å°è±çš„éŒ¢æ˜¯å°å„€çš„ 2 å€å°‘ 19ï¼Œå…©äººéŒ¢æ•¸ç›¸ä¹˜å¾— 91ï¼Œå‰‡å°å„€æœ‰å¤šå°‘å…ƒï¼Ÿ",
                phase1: [
                    { label: "è¨­å°å„€ç‚º", options: ["$x$"], correct: "$x$" },
                    { label: "å°è±å‰‡æ˜¯", options: ["$2x - 19$", "$2x + 19$"], correct: "$2x - 19$" }
                ],
                formula: ["$x(2x - 19) = 91$"],
                solution: [
                    { title: "æ­¥é©Ÿ 1ï¼šå±•é–‹èˆ‡æ•´ç†", content: "æ•´ç†å¾Œå¾—åˆ°æ¨™æº–å¼ï¼š<br><span class='text-orange-600 font-bold'>$2x^2 - 19x - 91 = 0$</span>" },
                    { title: "æ­¥é©Ÿ 2ï¼šå› å¼åˆ†è§£", content: "ä½¿ç”¨åå­—äº¤ä¹˜æ³•åˆ†è§£ï¼š<br><span class='text-stone-700 font-bold'>$(2x + 7)(x - 13) = 0$</span>" },
                    { title: "æ­¥é©Ÿ 3ï¼šæ±‚å‡º $x$", content: "è§£å¾—ï¼š<span class='text-stone-700 font-bold'>$x = 13$</span> æˆ– <span class='text-stone-700 font-bold'>$x = -3.5$</span>" },
                    { title: "æ­¥é©Ÿ 4ï¼šåˆç†åˆ¤æ–·", content: "éŒ¢æ•¸æ‡‰ç‚ºæ­£æ•¸ï¼Œæ•… <span class='text-red-500'>$x = -3.5$ (ä¸åˆ)</span>ã€‚<br>æœ€çµ‚ç­”æ¡ˆï¼š<span class='text-green-600 font-bold'>å°å„€æœ‰ 13 å…ƒ</span>ã€‚" }
                ]
            },
            {
                id: 4,
                category: "é€£çºŒå¥‡æ•¸",
                text: "ä¸‰å€‹é€£çºŒæ­£å¥‡æ•¸ï¼Œå…¶å¹³æ–¹å’Œç‚º 371ï¼Œé€™ä¸‰å€‹æ•¸ç‚ºä½•ï¼Ÿ",
                phase1: [
                    { label: "è¨­ä¸‰æ•¸ç‚º", options: ["$x, x+2, x+4$", "$x, x+1, x+2$"], correct: "$x, x+2, x+4$" }
                ],
                formula: ["$x^2 + (x+2)^2 + (x+4)^2 = 371$"],
                solution: [
                    { title: "æ­¥é©Ÿ 1ï¼šå±•é–‹æ‹¬è™Ÿ", content: "å±•é–‹å¾Œï¼š$x^2 + (x^2 + 4x + 4) + (x^2 + 8x + 16) = 371$" },
                    { title: "æ­¥é©Ÿ 2ï¼šåˆä½µä¸¦åŒ–ç°¡", content: "åˆä½µå¾ŒåŒé™¤ä»¥ 3ï¼š<br><span class='text-orange-600 font-bold'>$x^2 + 4x - 117 = 0$</span>" },
                    { title: "æ­¥é©Ÿ 3ï¼šå› å¼åˆ†è§£èˆ‡æ±‚æ ¹", content: "åˆ†è§£ç‚º $(x+13)(x-9)=0$ï¼Œè§£å¾— <span class='text-stone-700 font-bold'>$x = 9$</span> æˆ– <span class='text-stone-700 font-bold'>$-13$</span>" },
                    { title: "æ­¥é©Ÿ 4ï¼šæœ€çµ‚ç­”æ¡ˆ", content: "é¡Œç›®è¦æ±‚ã€Œæ­£ã€å¥‡æ•¸ï¼Œæ•…å– <span class='text-green-600 font-bold'>$x = 9$</span>ã€‚ä¸‰æ•¸ç‚º 9ã€11ã€13ã€‚" }
                ]
            },
            {
                id: 5,
                category: "é€£çºŒå¥‡æ•¸",
                text: "ä¸‰å€‹é€£çºŒæ­£å¥‡æ•¸ï¼Œå…¶å¹³æ–¹å’Œç‚º 875ï¼Œé€™ä¸‰å€‹æ•¸ç‚ºä½•ï¼Ÿ",
                phase1: [
                    { label: "è¨­ä¸‰æ•¸ç‚º", options: ["$x, x+2, x+4$"], correct: "$x, x+2, x+4$" }
                ],
                formula: ["$x^2 + (x+2)^2 + (x+4)^2 = 875$"],
                solution: [
                    { title: "æ­¥é©Ÿ 1ï¼šå±•é–‹èˆ‡ç°¡åŒ–", content: "åŒç†ç°¡åŒ–å¾Œå¾—åˆ°ï¼š<br><span class='text-orange-600 font-bold'>$x^2 + 4x - 285 = 0$</span>" },
                    { title: "æ­¥é©Ÿ 2ï¼šå› å¼åˆ†è§£", content: "åˆ†è§£ç‚º $(x + 19)(x - 15) = 0$" },
                    { title: "æ­¥é©Ÿ 3ï¼šæ±‚æ ¹èˆ‡åˆ¤æ–·", content: "è§£å¾— $x=15$ æˆ– $-19$ï¼Œå› è¦æ±‚ã€Œæ­£ã€å¥‡æ•¸ï¼Œå– <span class='text-green-600 font-bold'>$x = 15$</span>ã€‚" },
                    { title: "æ­¥é©Ÿ 4ï¼šæœ€çµ‚ç­”æ¡ˆ", content: "ä¸‰æ•¸åˆ†åˆ¥ç‚º 15ã€17ã€19ã€‚" }
                ]
            },
            {
                id: 6,
                category: "è² æ•´æ•¸å·®ç©",
                text: "å…©å€‹è² æ•´æ•¸ç›¸å·® 4ï¼Œå…¶ä¹˜ç©ç‚º 165ï¼Œé€™å…©å€‹æ•¸ç‚ºä½•ï¼Ÿ",
                phase1: [
                    { label: "è¨­å…©æ•¸ç‚º", options: ["$x, x+4$", "$x, 4x$"], correct: "$x, x+4$" }
                ],
                formula: ["$x(x + 4) = 165$"],
                solution: [
                    { title: "æ­¥é©Ÿ 1ï¼šå±•é–‹æ•´ç†", content: "å¾—åˆ°æ¨™æº–å¼ï¼š<br><span class='text-orange-600 font-bold'>$x^2 + 4x - 165 = 0$</span>" },
                    { title: "æ­¥é©Ÿ 2ï¼šå› å¼åˆ†è§£", content: "åˆ©ç”¨åå­—äº¤ä¹˜ï¼š<span class='text-stone-700 font-bold'>$(x + 15)(x - 11) = 0$</span>" },
                    { title: "æ­¥é©Ÿ 3ï¼šæ±‚å‡º $x$", content: "è§£å¾—ï¼š<span class='text-stone-700 font-bold'>$x = -15$</span> æˆ– <span class='text-stone-700 font-bold'>$x = 11$</span>" },
                    { title: "æ­¥é©Ÿ 4ï¼šåˆ¤æ–·ç­”æ¡ˆ", content: "é¡Œç›®æŒ‡å®šã€Œè² æ•´æ•¸ã€ï¼Œæ•…å– <span class='text-green-600 font-bold'>$x = -15$</span>ã€‚<br>äºŒæ•¸ç‚º $-15$ èˆ‡ $-11$ã€‚" }
                ]
            }
        ];

        let currentIdx = 0;

        const app = {
            init: () => {
                app.renderTabs();
                app.loadProblem(0);
            },

            // è§¸ç™¼ KaTeX æ¸²æŸ“
            renderMath: (element) => {
                if (window.renderMathInElement) {
                    renderMathInElement(element || document.body, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false}
                        ],
                        throwOnError: false
                    });
                }
            },

            renderTabs: () => {
                const nav = document.getElementById('nav-tabs');
                nav.innerHTML = '';
                problems.forEach((p, i) => {
                    const btn = document.createElement('button');
                    btn.className = `nav-tab px-6 py-3 text-xs font-bold whitespace-nowrap border-b-2 flex-none transition-all ${i === 0 ? 'border-orange-500 text-orange-600 bg-white' : 'border-transparent text-stone-400'}`;
                    btn.textContent = `ç¬¬ ${i + 1} é¡Œ`;
                    btn.onclick = () => app.loadProblem(i);
                    nav.appendChild(btn);
                });
            },

            loadProblem: (idx) => {
                currentIdx = idx;
                const p = problems[idx];

                document.getElementById('progress-text').textContent = `${idx + 1}/6`;
                document.getElementById('progress-bar').style.width = `${((idx + 1) / 6) * 100}%`;
                document.getElementById('problem-category').textContent = p.category;
                document.getElementById('problem-text').innerHTML = p.text;
                
                document.querySelectorAll('.nav-tab').forEach((t, i) => {
                    t.className = `nav-tab px-6 py-3 text-xs font-bold whitespace-nowrap border-b-2 flex-none transition-all ${i === idx ? 'border-orange-500 text-orange-600 bg-white' : 'border-transparent text-stone-400'}`;
                    if(i === idx) t.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                });

                document.getElementById('phase-tag').textContent = "ç¬¬ä¸€éšæ®µï¼šå¼•å°åˆ—å¼";
                document.getElementById('phase-tag').className = "px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-stone-200 text-stone-600";
                document.getElementById('equation-display-box').classList.add('hidden');
                document.getElementById('phase1-container').classList.remove('hidden');
                document.getElementById('phase2-container').classList.add('hidden');
                
                app.renderPhase1Steps(0);
                app.renderMath(); // æ¸²æŸ“é¡Œç›®ä¸­çš„æ•¸å­¸å¼
            },

            renderPhase1Steps: (stepIdx) => {
                const container = document.getElementById('phase1-container');
                const p = problems[currentIdx];
                if (stepIdx === 0) container.innerHTML = '';

                const step = p.phase1[stepIdx];
                const div = document.createElement('div');
                div.className = "animate-in fade-in slide-in-from-bottom-2 duration-500";
                div.innerHTML = `
                    <div class="flex items-center gap-3 mb-3">
                        <span class="w-6 h-6 rounded-full bg-stone-800 text-white text-xs flex items-center justify-center font-bold">${stepIdx + 1}</span>
                        <span class="font-bold text-stone-700 text-sm sm:text-base">${step.label}</span>
                    </div>
                    <div class="flex flex-wrap gap-2 ml-9" id="opt-wrap-${stepIdx}"></div>
                `;
                container.appendChild(div);

                const wrap = document.getElementById(`opt-wrap-${stepIdx}`);
                step.options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "option-chip px-5 py-2 bg-white border-2 border-stone-200 rounded-xl text-lg shadow-sm hover:border-orange-300";
                    btn.innerHTML = opt; // ä½¿ç”¨ innerHTML ä»¥åˆ© KaTeX
                    btn.onclick = () => app.handleChoice(stepIdx, opt, btn);
                    wrap.appendChild(btn);
                });
                
                app.renderMath(div); // æ¸²æŸ“æ–°ç”¢ç”Ÿçš„é¸é …
                if(stepIdx > 0) div.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            },

            handleChoice: (idx, choice, el) => {
                const p = problems[currentIdx];
                if (choice === p.phase1[idx].correct) {
                    el.className = "option-chip px-5 py-2 bg-green-500 border-2 border-green-600 rounded-xl text-lg text-white pointer-events-none shadow-md";
                    Array.from(el.parentElement.children).forEach(c => {
                        if (c !== el) { c.style.opacity = "0.2"; c.style.pointerEvents = "none"; }
                    });

                    if (idx < p.phase1.length - 1) {
                        setTimeout(() => app.renderPhase1Steps(idx + 1), 300);
                    } else {
                        app.showEquationSummary();
                    }
                } else {
                    el.classList.add('border-red-500', 'bg-red-50', 'text-red-600');
                    setTimeout(() => el.classList.remove('border-red-500', 'bg-red-50', 'text-red-600'), 800);
                }
            },

            showEquationSummary: () => {
                const box = document.getElementById('equation-display-box');
                const formulaArea = document.getElementById('equation-formula');
                const p = problems[currentIdx];

                formulaArea.innerHTML = '';
                p.formula.forEach((f, i) => {
                    const span = document.createElement('span');
                    span.className = "char-enter text-orange-400 font-bold";
                    span.style.animationDelay = `${i * 0.05}s`;
                    span.innerHTML = f;
                    formulaArea.appendChild(span);
                });

                box.classList.remove('hidden');
                setTimeout(() => {
                    box.classList.replace('opacity-0', 'opacity-100');
                    app.renderMath(formulaArea);
                }, 100);
                box.scrollIntoView({ behavior: 'smooth' });
            },

            showSolutionGuide: () => {
                const p = problems[currentIdx];
                const container = document.getElementById('phase2-container');
                const stepsArea = document.getElementById('solution-steps');
                
                document.getElementById('phase-tag').textContent = "ç¬¬äºŒéšæ®µï¼šè§£é¡Œæ­¥é©Ÿæ•™å­¸";
                document.getElementById('phase-tag').className = "px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-orange-500 text-white";
                
                document.getElementById('phase1-container').classList.add('hidden');
                document.getElementById('equation-display-box').classList.add('hidden');

                stepsArea.innerHTML = '';
                p.solution.forEach((step, i) => {
                    const div = document.createElement('div');
                    div.className = "solution-step";
                    div.style.animationDelay = `${i * 0.2}s`;
                    div.innerHTML = `
                        <h4 class="font-bold text-stone-800 text-lg mb-1">${step.title}</h4>
                        <div class="text-stone-600 leading-relaxed math-content">${step.content}</div>
                    `;
                    stepsArea.appendChild(div);
                });

                container.classList.remove('hidden');
                app.renderMath(stepsArea);
                container.scrollIntoView({ behavior: 'smooth' });
            },

            nextProblem: () => {
                if (currentIdx < problems.length - 1) {
                    app.loadProblem(currentIdx + 1);
                } else {
                    const card = document.getElementById('problem-card');
                    card.innerHTML = `
                        <div class="p-12 text-center animate-in zoom-in duration-700">
                            <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl">âœ“</div>
                            <h2 class="text-3xl font-bold text-stone-800 mb-4">å…¨éƒ¨ç·´ç¿’å®Œæˆï¼</h2>
                            <p class="text-stone-500 text-lg mb-8 max-w-sm mx-auto">ä½ å·²ç¶“å­¸æœƒäº†æ•¸å­¸åˆ—å¼èˆ‡è§£é¡Œé‚è¼¯ï¼Œå¤ªæ£’äº†ï¼</p>
                            <button onclick="location.reload()" class="px-10 py-3 bg-stone-900 text-white rounded-full font-bold shadow-xl">é‡æ–°ç·´ç¿’</button>
                        </div>
                    `;
                }
            }
        };

        window.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>