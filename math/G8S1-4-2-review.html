<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數學小家教 - 互動式學習</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 KaTeX CSS (數學公式樣式) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel (用來編譯瀏覽器中的 React 程式碼) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 KaTeX JS (數學公式運算核心) -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <style>
        /* 隱藏捲軸但保留功能 */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* 簡單的淡入動畫 */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }

        /* 字體設定 */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 圖示組件 (Inline SVGs) ---
        const ArrowRight = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        );
        const ArrowLeft = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        );
        const RefreshCw = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const CheckCircle = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m22 4-12 12-4-4"/></svg>
        );
        const ChevronRight = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 18 6-6-6-6"/></svg>
        );
        const Calculator = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
        );
        const BookOpen = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );
        const Brain = ({size=24, className=""}) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
        );

        // --- 主應用程式 ---
        const MathLearningApp = () => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [stepIndex, setStepIndex] = useState(0);
            const [isKatexLoaded, setIsKatexLoaded] = useState(false);

            // 檢查 KaTeX 是否載入完成
            useEffect(() => {
                // 簡單輪詢檢查 window.katex 是否存在
                const checkKatex = setInterval(() => {
                    if (window.katex) {
                        setIsKatexLoaded(true);
                        clearInterval(checkKatex);
                    }
                }, 100);
                
                // 3秒後若還沒載入，假設已載入（避免一直卡在 Loading）
                const timeout = setTimeout(() => {
                    setIsKatexLoaded(true);
                    clearInterval(checkKatex);
                }, 3000);

                return () => {
                    clearInterval(checkKatex);
                    clearTimeout(timeout);
                };
            }, []);

            const questions = [
                {
                    id: 1,
                    title: "題目 1：平方根求解",
                    problem: "9x^2 = 7",
                    intro: "這題我們要像剝洋蔥一樣，把 x 旁邊的數字慢慢拿走。",
                    steps: [
                        { text: "第一步：孤立 x 平方", detail: "x 的旁邊乘以 9，我們要把 9 移到對面，變成除法。", math: "x^2 = \\frac{7}{9}" },
                        { text: "第二步：幫它戴上帽子（開根號）", detail: "要把平方拿掉，就要開根號。記得！答案會有正負兩個喔。", math: "x = \\pm\\sqrt{\\frac{7}{9}}" },
                        { text: "第三步：整理數字", detail: "下面根號 9 剛好是 3。上面根號 7 算不出來，就留著。", math: "x = \\pm\\frac{\\sqrt{7}}{3}" }
                    ]
                },
                {
                    id: 2,
                    title: "題目 2：配成完全平方",
                    problem: "x^2 - 18x + \\Box = (x - \\Box)^2",
                    intro: "這是在玩填空遊戲。口訣是：「中間數字，切一半，再平方」。",
                    steps: [
                        { text: "第一步：看中間的數字", detail: "中間的數字是 -18。", math: "-18" },
                        { text: "第二步：切一半 (找右邊格子)", detail: "-18 除以 2 等於 -9。這就是右邊括號要填的。", math: "\\text{右邊填: } 9" },
                        { text: "第三步：再平方 (找左邊格子)", detail: "把剛剛的 -9 自己乘自己。負負得正，9x9=81。", math: "\\text{左邊填: } 81" }
                    ]
                },
                {
                    id: 3,
                    title: "題目 3：配方法解題",
                    problem: "x^2 - 4x = -1",
                    intro: "利用剛剛學的「切一半再平方」技巧來解這題。",
                    steps: [
                        { text: "第一步：找配方數字", detail: "中間是 -4，切一半是 -2，平方是 4。所以兩邊都要加 4。", math: "x^2 - 4x + \\mathbf{4} = -1 + \\mathbf{4}" },
                        { text: "第二步：變身成括號", detail: "左邊變成了平方公式，右邊算出來是 3。", math: "(x - 2)^2 = 3" },
                        { text: "第三步：脫掉平方", detail: "兩邊開根號，右邊記得加正負。", math: "x - 2 = \\pm\\sqrt{3}" },
                        { text: "第四步：把 -2 搬家", detail: "把 -2 搬到右邊變成 +2。", math: "x = 2 \\pm\\sqrt{3}" }
                    ]
                },
                {
                    id: 4,
                    title: "題目 4：判別式",
                    problem: "x^2 - x + 4 = 0",
                    intro: "這題不用算出 x，只要當偵探檢查有沒有解。\n公式代號 D = b^2 - 4ac",
                    steps: [
                        { text: "第一步：找出代號數字", detail: "a是頭，b是身體，c是尾巴。", math: "a=1, \\quad b=-1, \\quad c=4" },
                        { text: "第二步：套入公式檢查", detail: "把數字放進 D = b^2 - 4ac 裡面算算看。", math: "D = (-1)^2 - 4(1)(4)" },
                        { text: "第三步：計算結果", detail: "1 減掉 16，結果是負數。", math: "1 - 16 = -15" },
                        { text: "第四步：判斷", detail: "因為算出來是負的 (<0)，代表無解。", math: "\\text{答案：無解}" }
                    ]
                },
                {
                    id: 5,
                    title: "題目 5：公式解",
                    problem: "3x^2 + 5x + 1 = 0",
                    intro: "這是萬能公式，只要把數字填進去就有答案！",
                    steps: [
                        { text: "第一步：找出三兄弟 a, b, c", detail: "把題目對應的數字找出來。", math: "a=3, \\quad b=5, \\quad c=1" },
                        { text: "第二步：準備公式", detail: "分母是 2a，分子是 -b 加減根號...", math: "x = \\frac{-5 \\pm \\sqrt{5^2 - 4(3)(1)}}{2(3)}" },
                        { text: "第三步：計算根號裡面", detail: "25 減掉 12 等於 13。", math: "25 - 12 = 13" },
                        { text: "第四步：組合答案", detail: "把算好的數字放好，就是答案了。", math: "x = \\frac{-5 \\pm \\sqrt{13}}{6}" }
                    ]
                },
                {
                    id: 6,
                    title: "題目 6：進階公式解",
                    problem: "-x^2 - 9x + 4 = 0",
                    intro: "開頭有個負號很討厭，我們先把它變不見。",
                    steps: [
                        { text: "第一步：變號魔法", detail: "全部乘以 -1，大家的符號都反過來，這樣比較好算。", math: "x^2 + 9x - 4 = 0" },
                        { text: "第二步：找出 a, b, c", detail: "小心 c 是負的喔！", math: "a=1, \\quad b=9, \\quad c=-4" },
                        { text: "第三步：套公式", detail: "小心負負得正！根號裡面是 81 減掉 (4乘1乘-4)。", math: "\\sqrt{81 - (-16)} = \\sqrt{97}" },
                        { text: "第四步：寫出答案", detail: "分母是 2，分子前面是 -9。", math: "x = \\frac{-9 \\pm \\sqrt{97}}{2}" }
                    ]
                }
            ];

            const currentQuestion = questions[currentQuestionIndex];

            useEffect(() => {
                setStepIndex(0);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, [currentQuestionIndex]);

            const handleNextStep = () => {
                if (stepIndex < currentQuestion.steps.length) {
                    setStepIndex(prev => prev + 1);
                }
            };

            const handleNextQuestion = () => {
                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                }
            };

            const handlePrevQuestion = () => {
                if (currentQuestionIndex > 0) {
                    setCurrentQuestionIndex(prev => prev - 1);
                }
            };

            const jumpToQuestion = (index) => {
                setCurrentQuestionIndex(index);
            };

            // KaTeX Display Component
            const MathDisplay = ({ latex, display = true }) => {
                const containerRef = useRef(null);

                useEffect(() => {
                    if (isKatexLoaded && window.katex && containerRef.current) {
                        try {
                            window.katex.render(latex, containerRef.current, {
                                throwOnError: false,
                                displayMode: display,
                                strict: false
                            });
                        } catch (error) {
                            console.error("KaTeX error:", error);
                            containerRef.current.textContent = latex;
                        }
                    }
                }, [latex, isKatexLoaded, display]);

                if (!isKatexLoaded) {
                    return <span className="text-slate-400 animate-pulse text-sm">...</span>;
                }

                return <div ref={containerRef} className={`${display ? 'my-2' : 'inline'}`} />;
            };

            return (
                <div className="min-h-screen p-4 sm:p-6 flex flex-col items-center max-w-4xl mx-auto">
                    
                    {/* 導覽列 */}
                    <header className="w-full mb-6 bg-white p-4 rounded-2xl shadow-sm border-2 border-slate-100 flex flex-col gap-4">
                        <div className="flex items-center justify-between border-b border-slate-100 pb-3">
                            <div className="flex items-center gap-2">
                                <div className="bg-blue-100 p-1.5 rounded-lg text-blue-600">
                                    <Calculator size={20} />
                                </div>
                                <h1 className="font-bold text-slate-700 text-lg">數學小家教</h1>
                            </div>
                            <span className="text-sm text-slate-500 font-medium bg-slate-50 px-3 py-1 rounded-full">
                                第 {currentQuestionIndex + 1} 題 / 共 {questions.length} 題
                            </span>
                        </div>

                        <div className="flex items-center gap-3 overflow-x-auto pb-1 px-1 scrollbar-hide">
                            <span className="text-xs font-bold text-slate-400 shrink-0 uppercase tracking-wider mr-1">跳至:</span>
                            {questions.map((q, index) => (
                                <button
                                    key={q.id}
                                    onClick={() => jumpToQuestion(index)}
                                    className={`
                                        flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm transition-all duration-200 border-2
                                        ${currentQuestionIndex === index 
                                            ? 'bg-blue-600 text-white border-blue-600 shadow-md scale-110' 
                                            : 'bg-white text-slate-500 border-slate-200 hover:border-blue-300 hover:bg-blue-50'}
                                    `}
                                    title={q.title}
                                >
                                    {index + 1}
                                </button>
                            ))}
                        </div>
                    </header>

                    {/* 主要內容區 */}
                    <main className="w-full flex-1 flex flex-col gap-6">
                        <div className="bg-white rounded-3xl shadow-lg border-2 border-blue-100 overflow-hidden">
                            <div className="bg-blue-50 p-6 border-b border-blue-100">
                                <h2 className="text-blue-800 font-bold text-lg mb-2 flex items-center gap-2">
                                    <BookOpen size={20}/>
                                    {currentQuestion.title}
                                </h2>
                                <div className="text-xl sm:text-2xl text-center py-4 text-slate-800 tracking-wider flex justify-center items-center min-h-[80px]">
                                    <MathDisplay latex={currentQuestion.problem} display={true} />
                                </div>
                                <div className="bg-white/80 p-4 rounded-xl text-slate-600 border border-blue-100 flex gap-3 items-start">
                                    <Brain className="shrink-0 text-blue-400 mt-1" size={20} />
                                    <p className="text-lg leading-relaxed whitespace-pre-line">{currentQuestion.intro}</p>
                                </div>
                            </div>

                            <div className="p-6 space-y-6 bg-white min-h-[300px]">
                                {currentQuestion.steps.map((step, index) => (
                                    <div 
                                        key={index}
                                        className={`transition-all duration-500 ease-out transform ${
                                            index <= stepIndex 
                                                ? "opacity-100 translate-y-0" 
                                                : "opacity-0 translate-y-4 hidden"
                                        }`}
                                    >
                                        <div className="flex gap-4">
                                            <div className="flex flex-col items-center">
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold shrink-0 ${
                                                    index === stepIndex ? "bg-blue-500 scale-110 shadow-lg ring-4 ring-blue-100" : "bg-slate-300"
                                                }`}>
                                                    {index + 1}
                                                </div>
                                                {index < currentQuestion.steps.length - 1 && (
                                                    <div className={`w-1 flex-1 my-1 rounded-full ${index < stepIndex ? "bg-slate-200" : "bg-transparent"}`}></div>
                                                )}
                                            </div>
                                            
                                            <div className="flex-1 pb-4">
                                                <h3 className="text-lg font-bold text-slate-700 mb-1">{step.text}</h3>
                                                <p className="text-slate-600 text-lg mb-3 leading-relaxed">{step.detail}</p>
                                                <div className="bg-slate-50 p-4 rounded-xl border-l-4 border-blue-400 inline-block pr-8 shadow-sm text-xl">
                                                    <MathDisplay latex={step.math} display={true} />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}

                                {stepIndex === currentQuestion.steps.length && (
                                    <div className="flex flex-col items-center justify-center p-6 bg-green-50 rounded-2xl border-2 border-green-100 animate-fade-in-up">
                                        <CheckCircle className="text-green-500 mb-2 w-12 h-12" />
                                        <h3 className="text-xl font-bold text-green-700">太棒了！你完成了這題</h3>
                                        <p className="text-green-600">休息一下，準備好了就按下一題</p>
                                    </div>
                                )}
                            </div>

                            <div className="bg-slate-50 p-4 border-t border-slate-100 flex justify-between items-center sticky bottom-0">
                                <button 
                                    onClick={handlePrevQuestion}
                                    disabled={currentQuestionIndex === 0}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-xl font-bold transition-all ${
                                        currentQuestionIndex === 0 
                                            ? "text-slate-300 cursor-not-allowed" 
                                            : "text-slate-600 hover:bg-white hover:shadow-md"
                                    }`}
                                >
                                    <ArrowLeft size={20} />
                                    上一題
                                </button>

                                {stepIndex < currentQuestion.steps.length ? (
                                    <button 
                                        onClick={handleNextStep}
                                        className="flex-1 mx-4 bg-blue-600 hover:bg-blue-700 text-white text-lg px-6 py-4 rounded-2xl font-bold shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all flex items-center justify-center gap-2 active:scale-95"
                                    >
                                        下一步
                                        <ChevronRight size={24} />
                                    </button>
                                ) : (
                                    <button 
                                        onClick={() => setStepIndex(0)}
                                        className="flex-1 mx-4 bg-white text-slate-600 border-2 border-slate-200 text-lg px-6 py-4 rounded-2xl font-bold hover:bg-slate-50 transition-all flex items-center justify-center gap-2"
                                    >
                                        <RefreshCw size={20} />
                                        重看一次
                                    </button>
                                )}

                                <button 
                                    onClick={handleNextQuestion}
                                    disabled={currentQuestionIndex === questions.length - 1}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-xl font-bold transition-all ${
                                        currentQuestionIndex === questions.length - 1 
                                            ? "text-slate-300 cursor-not-allowed" 
                                            : "text-blue-600 hover:bg-blue-50 hover:shadow-md"
                                    }`}
                                >
                                    下一題
                                    <ArrowRight size={20} />
                                </button>
                            </div>
                        </div>
                    </main>

                    <div className="mt-8 text-slate-400 text-sm font-medium">
                        專為學習設計 · 慢慢來，比較快
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MathLearningApp />);
    </script>
</body>
</html>