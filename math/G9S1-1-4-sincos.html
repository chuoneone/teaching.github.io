<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼ä¸‰è§’å‡½æ•¸å­¸ç¿’</title>
<script src="https://cdn.tailwindcss.com"></script>

<!-- KaTeX for math rendering -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMeaMurDcGPPc5LB7GX8idWEAyptpevM/jsV1bk44bCDWpiWm" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>

<!-- Custom Font: Chiron GoRound TC -->
<link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: "Chiron GoRound TC", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        .highlight {
            background: linear-gradient(to top, #ffea00 50%, transparent 50%);
            padding: 0 4px;
            font-weight: 700;
        }
        .step-container {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .step-container.hidden {
            opacity: 0;
            transform: translateY(20px);
            position: absolute;
            pointer-events: none;
        }
        .step-container.active {
            opacity: 1;
            transform: translateY(0);
        }
        .katex-display > .katex {
            text-align: left !important;
        }
        /* Hide main content initially */
        #main-content {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Start Screen -->
    <div id="start-screen" class="w-full max-w-xl mx-auto p-6 text-center" style="padding-top: 20vh;">
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-4">ä¸‰è§’å‡½æ•¸é€æ­¥å­¸</h1>
        <p class="text-lg text-gray-500 mb-10">è«‹é¸æ“‡ä¸€å€‹æ¨¡å¼é–‹å§‹ä½ çš„ç·´ç¿’ï¼</p>
        <div class="flex flex-col gap-5">
            <button id="start-learn-btn" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-4 px-8 text-xl rounded-lg transition-colors duration-300">
                ğŸš€ å­¸ç¿’ç‰ˆ (æœ‰æç¤º)
            </button>
            <button id="start-challenge-btn" class="w-full bg-rose-500 hover:bg-rose-600 text-white font-bold py-4 px-8 text-xl rounded-lg transition-colors duration-300">
                ğŸ† æŒ‘æˆ°ç‰ˆ (ç„¡æç¤º)
            </button>
        </div>
    </div>

    <!-- Main Content (Hidden by default) -->
    <main id="main-content" class="w-full max-w-4xl mx-auto p-4 sm:p-6 pb-24">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-2">ä¸‰è§’å‡½æ•¸é€æ­¥å­¸</h1>
        
        <!-- Progress Indicator -->
        <div id="progress-indicator" class="text-center text-lg font-bold text-sky-600 mb-4"></div>

        <div class="md:flex md:flex-row md:items-start md:gap-6">
            <!-- Canvas for drawing the triangle -->
            <div class="md:w-5/12 flex justify-center mb-6 md:mb-0 bg-white p-4 rounded-xl border sticky top-6">
                <canvas id="triangle-canvas" width="300" height="300"></canvas>
            </div>
            
            <!-- Step Container -->
            <div id="steps-wrapper" class="md:w-7/12 relative bg-white p-6 rounded-xl border min-h-[310px]">
                <!-- Steps will be dynamically inserted here -->
            </div>
        </div>
    </main>
    
    <footer class="fixed bottom-0 left-0 w-full text-center text-gray-400 text-sm bg-white bg-opacity-80 py-2 border-t border-gray-200 backdrop-blur-sm">
      Â© 2025 ç‰¹æ•™ç±³å…‹å¸«ï½œæ¡ç”¨ 
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="text-sky-600 hover:underline">
        CC BY-NC-SA 4.0 å‰µç”¨CCæˆæ¬Š
      </a>ï½œéå•†æ¥­ç”¨é€”æ­¡è¿è½‰è¼‰æˆ–æ”¹ç·¨ï¼Œè«‹ä¿ç•™ç½²åä¸¦é™„ä¸ŠåŸå§‹é€£çµã€‚
    </footer>

    <script>
        const fullLearningData = [
            // Set 1: 3-4-5 Triangle
            { title: "ç¬¬ä¸€é¡Œï¼šsin A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, highlightSides: ['opposite', 'hypotenuse'], options: ["3/5", "4/5", "3/4", "4/3"], answer: "3/5", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬ä¸€é¡Œï¼šsin A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, highlightSides: [], options: ["3/5", "4/5", "3/4", "4/3"], answer: "3/5", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬äºŒé¡Œï¼šcos A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, highlightSides: ['adjacent', 'hypotenuse'], options: ["4/5", "3/5", "4/3", "3/4"], answer: "4/5", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬äºŒé¡Œï¼šcos A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, highlightSides: [], options: ["4/5", "3/5", "4/3", "3/4"], answer: "4/5", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬ä¸‰é¡Œï¼štan A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, highlightSides: ['opposite', 'adjacent'], options: ["3/4", "4/3", "3/5", "4/5"], answer: "3/4", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬ä¸‰é¡Œï¼štan A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, highlightSides: [], options: ["3/4", "4/3", "3/5", "4/5"], answer: "3/4", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">tan A</span> çš„å€¼ã€‚` },

            // Set 2: 5-12-13 Triangle
            { title: "ç¬¬å››é¡Œï¼šsin A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, highlightSides: ['opposite', 'hypotenuse'], options: ["5/13", "12/13", "5/12", "12/5"], answer: "5/13", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬å››é¡Œï¼šsin A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, highlightSides: [], options: ["5/13", "12/13", "5/12", "12/5"], answer: "5/13", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬äº”é¡Œï¼šcos A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, highlightSides: ['adjacent', 'hypotenuse'], options: ["12/13", "5/13", "12/5", "5/12"], answer: "12/13", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬äº”é¡Œï¼šcos A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, highlightSides: [], options: ["12/13", "5/13", "12/5", "5/12"], answer: "12/13", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬å…­é¡Œï¼štan A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, highlightSides: ['opposite', 'adjacent'], options: ["5/12", "12/5", "5/13", "12/13"], answer: "5/12", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬å…­é¡Œï¼štan A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, highlightSides: [], options: ["5/12", "12/5", "5/13", "12/13"], answer: "5/12", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">tan A</span> çš„å€¼ã€‚` },

            // Set 3: 8-15-17 Triangle
            { title: "ç¬¬ä¸ƒé¡Œï¼šsin A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 15, o: 8, h: 17 }, highlightSides: ['opposite', 'hypotenuse'], options: ["8/17", "15/17", "8/15", "15/8"], answer: "8/17", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬ä¸ƒé¡Œï¼šsin A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 15, o: 8, h: 17 }, highlightSides: [], options: ["8/17", "15/17", "8/15", "15/8"], answer: "8/17", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬å…«é¡Œï¼šcos A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 15, o: 8, h: 17 }, highlightSides: ['adjacent', 'hypotenuse'], options: ["15/17", "8/17", "15/8", "8/15"], answer: "15/17", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬å…«é¡Œï¼šcos A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 15, o: 8, h: 17 }, highlightSides: [], options: ["15/17", "8/17", "15/8", "8/15"], answer: "15/17", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬ä¹é¡Œï¼štan A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 15, o: 8, h: 17 }, highlightSides: ['opposite', 'adjacent'], options: ["8/15", "15/8", "8/17", "15/17"], answer: "8/15", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬ä¹é¡Œï¼štan A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 15, o: 8, h: 17 }, highlightSides: [], options: ["8/15", "15/8", "8/17", "15/17"], answer: "8/15", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            
            // Set 4: 7-24-25 Triangle
            { title: "ç¬¬åé¡Œï¼šsin A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, highlightSides: ['opposite', 'hypotenuse'], options: ["7/25", "24/25", "7/24", "24/7"], answer: "7/25", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åé¡Œï¼šsin A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, highlightSides: [], options: ["7/25", "24/25", "7/24", "24/7"], answer: "7/25", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åä¸€é¡Œï¼šcos A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, highlightSides: ['adjacent', 'hypotenuse'], options: ["24/25", "7/25", "24/7", "7/24"], answer: "24/25", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åä¸€é¡Œï¼šcos A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, highlightSides: [], options: ["24/25", "7/25", "24/7", "7/24"], answer: "24/25", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åäºŒé¡Œï¼štan A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, highlightSides: ['opposite', 'adjacent'], options: ["7/24", "24/7", "7/25", "24/25"], answer: "7/24", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åäºŒé¡Œï¼štan A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, highlightSides: [], options: ["7/24", "24/7", "7/25", "24/25"], answer: "7/24", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">tan A</span> çš„å€¼ã€‚` },

            // Set 5: 9-12-15 Triangle
            { title: "ç¬¬åä¸‰é¡Œï¼šsin A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, highlightSides: ['opposite', 'hypotenuse'], options: ["9/15", "12/15", "9/12", "12/9"], answer: "9/15", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åä¸‰é¡Œï¼šsin A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, highlightSides: [], options: ["9/15", "12/15", "9/12", "12/9"], answer: "9/15", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åå››é¡Œï¼šcos A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, highlightSides: ['adjacent', 'hypotenuse'], options: ["12/15", "9/15", "12/9", "9/12"], answer: "12/15", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åå››é¡Œï¼šcos A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, highlightSides: [], options: ["12/15", "9/15", "12/9", "9/12"], answer: "12/15", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åäº”é¡Œï¼štan A (è¦–è¦ºæç¤º)", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, highlightSides: ['opposite', 'adjacent'], options: ["9/12", "12/9", "9/15", "12/15"], answer: "9/12", question: `è«‹æ ¹æ“šåœ–ä¸Šè¢å…‰ç­†æ¨™ç¤ºï¼Œé¸å‡º <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "ç¬¬åäº”é¡Œï¼štan A (å†æ¬¡æŒ‘æˆ°)", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, highlightSides: [], options: ["9/12", "12/9", "9/15", "12/15"], answer: "9/12", question: `åšå¾—å¥½ï¼ç¾åœ¨è«‹ç¨ç«‹åˆ¤æ–· <span class="highlight">tan A</span> çš„å€¼ã€‚` },
        ];

        const challengeData = [
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, rotation: 0, options: ["3/5", "4/5", "3/4", "4/3"], answer: "3/5", question: `è«‹è¨ˆç®— <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 4, o: 3, h: 5 }, rotation: 0, options: ["4/5", "3/5", "4/3", "3/4"], answer: "4/5", question: `è«‹è¨ˆç®— <span class="highlight">sin B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 4, o: 3, h: 5 }, rotation: 0, options: ["4/5", "3/5", "4/3", "3/4"], answer: "4/5", question: `è«‹è¨ˆç®— <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 4, o: 3, h: 5 }, rotation: 0, options: ["4/3", "3/4", "4/5", "3/5"], answer: "4/3", question: `è«‹è¨ˆç®— <span class="highlight">tan B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, rotation: 0, options: ["12/13", "5/13", "12/5", "5/12"], answer: "12/13", question: `è«‹è¨ˆç®— <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 12, o: 5, h: 13 }, rotation: 0, options: ["5/13", "12/13", "5/12", "12/5"], answer: "5/13", question: `è«‹è¨ˆç®— <span class="highlight">cos B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, rotation: 0, options: ["5/13", "12/13", "5/12", "12/5"], answer: "5/13", question: `è«‹è¨ˆç®— <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 12, o: 5, h: 13 }, rotation: 0, options: ["5/12", "12/5", "5/13", "12/13"], answer: "5/12", question: `è«‹è¨ˆç®— <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 15, o: 8, h: 17 }, rotation: 0, options: ["8/15", "15/8", "8/17", "15/17"], answer: "8/15", question: `è«‹è¨ˆç®— <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 15, o: 8, h: 17 }, rotation: 0, options: ["15/8", "8/15", "15/17", "8/17"], answer: "15/8", question: `è«‹è¨ˆç®— <span class="highlight">tan B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 15, o: 8, h: 17 }, rotation: 0, options: ["15/17", "8/17", "15/8", "8/15"], answer: "15/17", question: `è«‹è¨ˆç®— <span class="highlight">sin B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 15, o: 8, h: 17 }, rotation: 0, options: ["8/17", "15/17", "8/15", "15/8"], answer: "8/17", question: `è«‹è¨ˆç®— <span class="highlight">cos B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, rotation: 0, options: ["7/25", "24/25", "7/24", "24/7"], answer: "7/25", question: `è«‹è¨ˆç®— <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 24, o: 7, h: 25 }, rotation: 0, options: ["24/25", "7/25", "24/7", "7/24"], answer: "24/25", question: `è«‹è¨ˆç®— <span class="highlight">cos A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 24, o: 7, h: 25 }, rotation: 0, options: ["24/7", "7/24", "24/25", "7/25"], answer: "24/7", question: `è«‹è¨ˆç®— <span class="highlight">tan B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 12, o: 9, h: 15 }, rotation: 0, options: ["9/15", "12/15", "9/12", "12/9"], answer: "9/15", question: `è«‹è¨ˆç®— <span class="highlight">cos B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, rotation: 0, options: ["9/15", "12/15", "9/12", "12/9"], answer: "9/15", question: `è«‹è¨ˆç®— <span class="highlight">sin A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, rotation: 0, options: ["9/12", "12/9", "9/15", "12/15"], answer: "9/12", question: `è«‹è¨ˆç®— <span class="highlight">tan A</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'B', sides: { a: 12, o: 9, h: 15 }, rotation: 0, options: ["12/15", "9/15", "12/9", "9/12"], answer: "12/15", question: `è«‹è¨ˆç®— <span class="highlight">sin B</span> çš„å€¼ã€‚` },
            { title: "æŒ‘æˆ°é¡Œ", testAngle: 'A', sides: { a: 12, o: 9, h: 15 }, rotation: 0, options: ["12/15", "9/15", "12/9", "9/12"], answer: "12/15", question: `è«‹è¨ˆç®— <span class="highlight">cos A</span> çš„å€¼ã€‚` },
        ];

        let currentProblemIndex = 0;
        let currentDataset = fullLearningData;
        let score = 0;
        let totalQuestions = 10;

let canvas, ctx, stepsWrapper, progressIndicator, startScreen, mainContent;

// Utility function to shuffle an array
function shuffleArray(array) {
    let currentIndex = array.length, randomIndex;
    // While there remain elements to shuffle.
    while (currentIndex != 0) {
        // Pick a remaining element.
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        // And swap it with the current element.
        [array[currentIndex], array[randomIndex]] = [
        array[randomIndex], array[currentIndex]];
    }
    return array;
}

function getSideNames(angle) {
    if (angle === 'A') return { o: 'o', a: 'a' }; // For angle A, opposite is 'o', adjacent is 'a'
    if (angle === 'B') return { o: 'a', a: 'o' }; // For angle B, opposite is 'a', adjacent is 'o'
    return {};
}

function drawTriangle(sides, highlightSides = [], angleToCircle = null, rotation = 0) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    
    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.rotate(rotation * Math.PI / 180);

    const w = 200;
    const h = 120;
    const coords = { a: { x: -w/2, y: h/2 }, c: { x: w/2, y: h/2 }, b: { x: w/2, y: -h/2 } };

    // Highlight sides based on the current angle
    ctx.lineCap = 'round';
    if (highlightSides.length > 0) {
        const sideMap = getSideNames(angleToCircle);
        ctx.beginPath();
        ctx.strokeStyle = '#fde047';
        ctx.lineWidth = 12;
        highlightSides.forEach(side => {
            if (side === 'opposite') {
                if(sideMap.o === 'o') { ctx.moveTo(coords.b.x, coords.b.y); ctx.lineTo(coords.c.x, coords.c.y); }
                if(sideMap.o === 'a') { ctx.moveTo(coords.a.x, coords.a.y); ctx.lineTo(coords.c.x, coords.c.y); }
            }
            if (side === 'adjacent') {
                if(sideMap.a === 'a') { ctx.moveTo(coords.a.x, coords.a.y); ctx.lineTo(coords.c.x, coords.c.y); }
                if(sideMap.a === 'o') { ctx.moveTo(coords.b.x, coords.b.y); ctx.lineTo(coords.c.x, coords.c.y); }
            }
            if (side === 'hypotenuse') { ctx.moveTo(coords.a.x, coords.a.y); ctx.lineTo(coords.b.x, coords.b.y); }
        });
        ctx.stroke();
    }

    // Draw triangle
    ctx.beginPath();
    ctx.moveTo(coords.a.x, coords.a.y); ctx.lineTo(coords.b.x, coords.b.y); ctx.lineTo(coords.c.x, coords.c.y); ctx.closePath();
    ctx.strokeStyle = '#333'; ctx.lineWidth = 2; ctx.stroke();
    
    // Draw right angle symbol
    ctx.beginPath();
    ctx.moveTo(coords.c.x - 20, coords.c.y); ctx.lineTo(coords.c.x - 20, coords.c.y - 20); ctx.lineTo(coords.c.x, coords.c.y - 20);
    ctx.strokeStyle = '#333'; ctx.lineWidth = 1.5; ctx.stroke();

    // Circle the angle
    if (angleToCircle) {
        ctx.beginPath();
        ctx.strokeStyle = '#ef4444'; // red-500
        ctx.lineWidth = 2.5;
        const targetCoord = coords[angleToCircle.toLowerCase()];
        ctx.arc(targetCoord.x, targetCoord.y, 25, 0, 2 * Math.PI);
        ctx.stroke();
    }

    // Labels and Side lengths
    ctx.fillStyle = '#333'; ctx.font = 'bold 18px "Chiron GoRound TC"';
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    
    ctx.save();
    ctx.rotate(-rotation * Math.PI / 180); // Counter-rotate text
    ctx.fillText('A', coords.a.x - 20, coords.a.y);
    ctx.fillText('B', coords.b.x + 20, coords.b.y);
    ctx.fillText('C', coords.c.x, coords.c.y + 20);
    
    ctx.fillStyle = '#1d4ed8'; ctx.font = '700 18px "Chiron GoRound TC"';
    ctx.fillText(sides.a, (coords.a.x + coords.c.x) / 2, coords.c.y + 20);
    
    ctx.save();
    ctx.translate(coords.b.x + 25, (coords.b.y + coords.c.y) / 2);
    ctx.rotate(Math.PI / 2);
    ctx.fillText(sides.o, 0, 0);
    ctx.restore();

    ctx.save();
    ctx.translate((coords.a.x + coords.b.x) / 2, (coords.a.y + coords.b.y) / 2);
    ctx.rotate(Math.atan2(coords.b.y - coords.a.y, coords.b.x - coords.a.x));
    ctx.fillText(sides.h, 0, -15);
    ctx.restore();
    ctx.restore();

    ctx.restore();
}

function renderProblem() {
    if (currentProblemIndex >= currentDataset.length) {
                renderCompletion();
                return;
            }
            
            const problem = currentDataset[currentProblemIndex];
            progressIndicator.textContent = `ç¬¬ ${currentProblemIndex + 1} é¡Œ / å…± ${totalQuestions} é¡Œ`;
            
            const stepContainer = document.createElement('div');
            stepContainer.className = 'step-container absolute top-0 left-0 w-full p-6';
            
            let content = `<h2 class="text-xl mb-4">${problem.question}</h2>`;
            
            // Shuffle options
            const shuffledOptions = shuffleArray([...problem.options]);

            content += `<div class="grid grid-cols-2 gap-3">`;
            shuffledOptions.forEach(opt => {
                const katexString = `\\frac{${opt.split('/')[0]}}{${opt.split('/')[1]}}`;
                content += `<button class="option-btn w-full p-3 text-lg bg-gray-100 rounded-lg text-gray-700 font-semibold hover:bg-sky-200 transition-colors duration-200" data-value="${opt}">${katexString}</button>`;
            });
            content += `</div><div class="feedback mt-4 text-center text-lg font-bold min-h-[60px]"></div>`;
            stepContainer.innerHTML = content;
            
            const oldStep = stepsWrapper.querySelector('.step-container');
            if (oldStep) {
                oldStep.classList.remove('active');
                oldStep.classList.add('hidden');
                setTimeout(() => oldStep.remove(), 500);
            }
            
            stepsWrapper.appendChild(stepContainer);
            setTimeout(() => stepContainer.classList.add('active'), 10);
            
            stepContainer.querySelectorAll('.option-btn').forEach(btn => {
                katex.render(btn.innerHTML, btn, { throwOnError: false });
                btn.addEventListener('click', () => checkAnswer(btn, problem, stepContainer));
            });
            
            drawTriangle(problem.sides, problem.highlightSides, problem.testAngle, problem.rotation || 0);
        }
        
        function checkAnswer(button, problem, container) {
            const selected = button.dataset.value;
            const correct = problem.answer;
            const feedbackEl = container.querySelector('.feedback');

            container.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            
            if(selected === correct) {
                score++; // ç­”å°æ™‚åŠ åˆ†
                button.classList.remove('bg-gray-100', 'hover:bg-sky-200');
                button.classList.add('bg-green-500', 'text-white');
                
                const nextBtn = document.createElement('button');
                nextBtn.className = 'mt-4 bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform scale-0';
                nextBtn.textContent = currentProblemIndex < currentDataset.length - 1 ? 'å¤ªæ£’äº†ï¼Œä¸‹ä¸€é¡Œï¼' : 'æ­å–œï¼Œå®Œæˆï¼';
                nextBtn.onclick = () => {
                    currentProblemIndex++;
                    renderProblem();
                };
                feedbackEl.innerHTML = '<span class="text-green-600">ç­”å°äº†ï¼</span>';
                feedbackEl.appendChild(nextBtn);
                setTimeout(()=> nextBtn.classList.add('scale-100'), 100);

            } else {
                feedbackEl.innerHTML = '<span class="text-red-600">ä¸å°å–”ï¼Œå†è©¦ä¸€æ¬¡ï¼</span>';
                button.classList.remove('bg-gray-100');
                button.classList.add('bg-red-500', 'text-white');
                setTimeout(() => {
                   container.querySelectorAll('.option-btn').forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('bg-red-500', 'text-white');
                        btn.classList.add('bg-gray-100', 'hover:bg-sky-200');
                   });
                   feedbackEl.innerHTML = '';
                }, 2000);
            }
        }

        function startGame(mode) {
            score = 0; // é‡ç½®åˆ†æ•¸
            totalQuestions = 10; // è¨­å®šç¸½é¡Œæ•¸

            if (mode === 'learn') {
                // éš¨æ©Ÿé¸ 5 çµ„ (10 é¡Œ)
                const pairIndices = [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28];
                const shuffledPairIndices = shuffleArray(pairIndices);
                currentDataset = [];
                for (let i = 0; i < 5; i++) {
                    const pairIndex = shuffledPairIndices[i];
                    currentDataset.push(fullLearningData[pairIndex]);
                    currentDataset.push(fullLearningData[pairIndex + 1]);
                }
            } else {
                // éš¨æ©Ÿé¸ 10 é¡ŒæŒ‘æˆ°é¡Œ
                const shuffledChallenges = shuffleArray([...challengeData]);
                currentDataset = shuffledChallenges.slice(0, 10);
            }
            currentProblemIndex = 0;
            startScreen.style.display = 'none';
            mainContent.style.display = 'block';
            renderProblem();
        }
        
        function renderCompletion() {
            progressIndicator.textContent = 'æ¸¬é©—å®Œæˆï¼';
            stepsWrapper.innerHTML = `
                <div class="text-center p-6 flex flex-col items-center justify-center h-full min-h-[310px]">
                    <h2 class="text-3xl font-bold text-green-600 mb-4">æœ€çµ‚æˆç¸¾</h2>
                    <p class="text-6xl font-bold text-gray-800 mb-10">${score} / ${totalQuestions}</p>
                    <button id="home-btn" class="w-full sm:w-auto bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 text-lg rounded-lg transition-colors duration-300">
                        è¿”å›é¦–é 
                    </button>
                </div>
            `;
            document.getElementById('home-btn').addEventListener('click', () => {
                mainContent.style.display = 'none';
                startScreen.style.display = 'block';
                progressIndicator.textContent = '';
                stepsWrapper.innerHTML = ''; // <-- æ–°å¢é€™ä¸€è¡Œä¾†æ¸…ç©ºå…§å®¹
            });
        }
        
        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            // Get elements
            canvas = document.getElementById('triangle-canvas');
            ctx = canvas.getContext('2d');
            stepsWrapper = document.getElementById('steps-wrapper');
            progressIndicator = document.getElementById('progress-indicator');
            startScreen = document.getElementById('start-screen');
            mainContent = document.getElementById('main-content');
            
            // Add event listeners for start buttons
            document.getElementById('start-learn-btn').addEventListener('click', () => {
                startGame('learn');
            });
            document.getElementById('start-challenge-btn').addEventListener('click', () => {
                startGame('challenge');
            });
        });
    </script>
</body>
</html>




