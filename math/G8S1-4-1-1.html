<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPEDMIX - åˆ¤åˆ¥ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff; /* æ·ºè—è‰²èƒŒæ™¯ï¼Œè­·çœ¼ä¸”æ”¾é¬† */
        }

        /* æ•¸å­¸å¼å°ˆç”¨ CSS (ç¬¦åˆæ•™ç§‘æ›¸æ’ç‰ˆ) */
        .math {
            font-family: 'Times New Roman', serif; /* æ•¸å­¸ç¬¦è™Ÿå¸¸ç”¨å­—é«” */
            font-size: 32px; /* ç‰¹æ•™éœ€æ±‚ï¼šå­—é«”åŠ å¤§ */
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #1e3a8a; /* æ·±è—è‰²ï¼Œå°æ¯”æ¸…æ™° */
        }

        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.1;
            margin: 0 4px;
        }

        .fraction span:first-child {
            border-bottom: 2px solid #000;
            padding: 0 4px;
            width: 100%;
            text-align: center;
        }

        .power {
            font-size: 20px;
            vertical-align: super;
            margin-left: 1px;
            margin-bottom: 12px; /* ä¿®æ­£å°é½Š */
            color: #e63946; /* æ¬¡æ–¹ç”¨ç´…è‰²æ¨™ç¤ºï¼Œæç¤ºé‡é» */
        }

        .sqrt::before {
            content: "âˆš";
            font-size: 32px;
            margin-right: 2px;
        }

        .abs::before { content: "|"; margin-right: 2px;}
        .abs::after { content: "|"; margin-left: 2px;}

        /* äº’å‹•å…ƒä»¶æ¨£å¼ */
        .slot {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 80px;
            height: 50px;
            border-bottom: 3px solid #cbd5e1;
            background-color: #ffffff;
            margin: 0 8px;
            font-size: 24px;
            color: #334155;
            cursor: pointer;
            transition: all 0.2s ease;
            vertical-align: middle;
            border-radius: 8px 8px 0 0;
        }

        .slot:hover {
            background-color: #e2e8f0;
        }

        .slot.filled {
            border-bottom-color: #3b82f6; /* å¡«å…¥å¾Œè®Šè— */
            background-color: #eff6ff;
            font-weight: bold;
        }

        .slot.correct {
            border-bottom-color: #22c55e; /* ç­”å°è®Šç¶  */
            background-color: #dcfce7;
            color: #15803d;
        }

        /* ä¿®æ”¹å¾Œçš„æŒ‰éˆ•æ¨£å¼ */
        .option-btn {
            background-color: #ffffff;
            border: 2px solid #94a3b8;
            color: #475569;
            padding: 12px 32px;
            font-size: 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 #64748b;
            transition: all 0.1s;
            min-width: 120px; /* åŠ å¯¬ */
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        
        /* æ˜¯æŒ‰éˆ• */
        .option-btn.btn-yes {
            border-color: #3b82f6;
            color: #2563eb;
            box-shadow: 0 4px 0 #1d4ed8;
        }
        .option-btn.btn-yes:hover { background-color: #eff6ff; }

        /* å¦æŒ‰éˆ• */
        .option-btn.btn-no {
            border-color: #ef4444;
            color: #dc2626;
            box-shadow: 0 4px 0 #b91c1c;
        }
        .option-btn.btn-no:hover { background-color: #fef2f2; }


        .option-btn:disabled {
            background-color: #e2e8f0;
            border-color: #cbd5e1;
            color: #94a3b8;
            box-shadow: none;
            cursor: not-allowed;
            transform: translateY(4px);
        }

        /* é‡é»æ¨™ç¤º */
        mark {
            background-color: #fef08a; /* æŸ”å’Œé»ƒ */
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #854d0e;
        }

        /* å‹•ç•« */
        @keyframes tada {
            0% { transform: scale(1); }
            10%, 20% { transform: scale(0.9) rotate(-3deg); }
            30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
            40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
            100% { transform: scale(1) rotate(0); }
        }

        .animate-tada {
            animation: tada 1s ease-in-out;
        }

        .step-container {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.8);
            transition: all 0.5s ease;
        }

        .step-container.active {
            opacity: 1;
            pointer-events: auto;
            filter: grayscale(0);
            transform: scale(1);
        }

        .step-container.completed {
            opacity: 1;
            filter: grayscale(0);
            border-color: #22c55e;
            background-color: #f0fdf4;
        }

        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="p-4 md:p-8 max-w-4xl mx-auto pb-40">

    <!-- Header -->
    <header class="text-center mb-10">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2">ä¸€ã€åˆ¤åˆ¥ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼</h1>
        <p class="text-slate-600 text-lg">è«‹ä¾ç…§æ­¥é©Ÿï¼Œæª¢æŸ¥æ¯ä¸€å€‹æ•¸å­¸å¼æ˜¯å¦ç¬¦åˆæ¢ä»¶ã€‚</p>
    </header>

    <!-- Progress Bar -->
    <div class="fixed top-0 left-0 w-full h-2 bg-gray-200 z-50">
        <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div>
    </div>

    <!-- Main Content Area -->
    <div id="quiz-container" class="space-y-12">
        <!-- Steps will be injected here by JS -->
    </div>

    <!-- Feedback & Controls (Fixed Bottom) -->
    <div class="fixed bottom-0 left-0 w-full bg-white shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] p-4 border-t border-gray-100 z-40">
        <div class="max-w-4xl mx-auto flex flex-col items-center">
            
            <!-- Message Area -->
            <div id="feedback-message" class="text-xl font-bold mb-4 h-8 text-center transition-all duration-300 text-slate-600">
                è«‹é»æ“ŠæŒ‰éˆ•å¡«å…¥ç©ºæ ¼
            </div>

            <!-- Options Area -->
            <div id="options-container" class="flex flex-wrap justify-center gap-8 w-full">
                <!-- Buttons injected by JS -->
            </div>

            <!-- Action Buttons -->
            <div class="mt-4 flex gap-4 w-full justify-center">
                <button id="check-btn" onclick="checkAnswer()" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-xl shadow-[0_4px_0_#15803d] active:translate-y-1 active:shadow-none transition-all text-xl w-full md:w-auto min-w-[200px]">
                    æª¢æŸ¥ç­”æ¡ˆ
                </button>
                <button id="next-btn" onclick="nextStep()" class="hidden bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-[0_4px_0_#1d4ed8] active:translate-y-1 active:shadow-none transition-all text-xl w-full md:w-auto min-w-[200px]">
                    ä¸‹ä¸€é¡Œ â”
                </button>
            </div>
        </div>
    </div>

    <!-- Sounds (Optional) -->
    <audio id="sound-correct" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="></audio>
    <audio id="sound-wrong" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="></audio>

<script>
    // --- é¡Œç›®è³‡æ–™ ---
    // è¦å‰‡ï¼šmathHtml (æ•¸å­¸å¼ HTML), answers (æ­£ç¢ºç­”æ¡ˆé™£åˆ—), hints (æ•™å­¸æç¤º)
    // Options æ¬„ä½å·²ç§»é™¤ï¼Œæ”¹ç‚ºå›ºå®šçš„ Yes/No æŒ‰éˆ•
    const quizData = [
        {
            id: 1,
            title: "ç¬¬ 1 é¡Œ",
            mathHtml: `<div class="math">3x + 5 = 0</div>`,
            conditions: [
                { label: "åªæœ‰ä¸€å€‹æœªçŸ¥æ•¸å—ï¼Ÿ(ä¸€å…ƒ)", answer: "æ˜¯" },
                { label: "æœ€é«˜æ¬¡æ–¹æ˜¯ 2 å—ï¼Ÿ(äºŒæ¬¡)", answer: "å¦" },
                { label: "æœ‰ç­‰è™Ÿå—ï¼Ÿ(æ–¹ç¨‹å¼)", answer: "æ˜¯" },
                { label: "çµè«–ï¼šé€™æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼å—ï¼Ÿ", answer: "å¦" }
            ],
            hint: "è§€å¯Ÿ x çš„ä¸Šæ–¹ï¼Œå¦‚æœæ²’æœ‰æ•¸å­—ï¼Œä»£è¡¨æ˜¯ 1 æ¬¡æ–¹å–”ï¼"
        },
        {
            id: 2,
            title: "ç¬¬ 2 é¡Œ",
            mathHtml: `<div class="math">2x<span class="power">2</span> + x = 7</div>`,
            conditions: [
                { label: "åªæœ‰ä¸€å€‹æœªçŸ¥æ•¸å—ï¼Ÿ(ä¸€å…ƒ)", answer: "æ˜¯" },
                { label: "æœ€é«˜æ¬¡æ–¹æ˜¯ 2 å—ï¼Ÿ(äºŒæ¬¡)", answer: "æ˜¯" },
                { label: "æœ‰ç­‰è™Ÿå—ï¼Ÿ(æ–¹ç¨‹å¼)", answer: "æ˜¯" },
                { label: "çµè«–ï¼šé€™æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼å—ï¼Ÿ", answer: "æ˜¯" }
            ],
            hint: "åªè¦æ•´ç†å¾Œæœ€é«˜æ¬¡æ–¹æ˜¯ 2ï¼Œä¸”åªæœ‰ä¸€ç¨®æœªçŸ¥æ•¸ï¼Œå°±æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼ã€‚"
        },
        {
            id: 3,
            title: "ç¬¬ 3 é¡Œ",
            mathHtml: `<div class="math">x<span class="power">2</span> - 1 = 0</div>`,
            conditions: [
                { label: "åªæœ‰ä¸€å€‹æœªçŸ¥æ•¸å—ï¼Ÿ(ä¸€å…ƒ)", answer: "æ˜¯" },
                { label: "æœ€é«˜æ¬¡æ–¹æ˜¯ 2 å—ï¼Ÿ(äºŒæ¬¡)", answer: "æ˜¯" },
                { label: "æœ‰ç­‰è™Ÿå—ï¼Ÿ(æ–¹ç¨‹å¼)", answer: "æ˜¯" },
                { label: "çµè«–ï¼šé€™æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼å—ï¼Ÿ", answer: "æ˜¯" }
            ],
            hint: "å³ä½¿ç¼ºäº† x é …ï¼Œåªè¦æœ€é«˜æ¬¡æ–¹æ˜¯ 2 å°±å¯ä»¥äº†ã€‚"
        },
        {
            id: 4,
            title: "ç¬¬ 4 é¡Œ",
            mathHtml: `<div class="math">5x<span class="power">2</span> - 4x - 3 = 0</div>`,
            conditions: [
                { label: "åªæœ‰ä¸€å€‹æœªçŸ¥æ•¸å—ï¼Ÿ(ä¸€å…ƒ)", answer: "æ˜¯" },
                { label: "æœ€é«˜æ¬¡æ–¹æ˜¯ 2 å—ï¼Ÿ(äºŒæ¬¡)", answer: "æ˜¯" },
                { label: "æœ‰ç­‰è™Ÿå—ï¼Ÿ(æ–¹ç¨‹å¼)", answer: "æ˜¯" },
                { label: "çµè«–ï¼šé€™æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼å—ï¼Ÿ", answer: "æ˜¯" }
            ],
            hint: "é€™æ˜¯ä¸€å€‹å¾ˆæ¨™æº–çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼å½¢å¼ã€‚"
        },
        {
            id: 5,
            title: "ç¬¬ 5 é¡Œ (é™·é˜±é¡Œ)",
            mathHtml: `<div class="math">3x<span class="power">2</span> - 4x + 5</div>`,
            conditions: [
                { label: "åªæœ‰ä¸€å€‹æœªçŸ¥æ•¸å—ï¼Ÿ(ä¸€å…ƒ)", answer: "æ˜¯" },
                { label: "æœ€é«˜æ¬¡æ–¹æ˜¯ 2 å—ï¼Ÿ(äºŒæ¬¡)", answer: "æ˜¯" },
                { label: "æœ‰ç­‰è™Ÿå—ï¼Ÿ(æ–¹ç¨‹å¼)", answer: "å¦" },
                { label: "çµè«–ï¼šé€™æ˜¯ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼å—ï¼Ÿ", answer: "å¦" }
            ],
            hint: "æ³¨æ„çœ‹ï¼Œé€™å€‹å¼å­æœ‰ç­‰è™Ÿã€Œ=ã€å—ï¼Ÿæ²’æœ‰ç­‰è™Ÿå°±ä¸æ˜¯æ–¹ç¨‹å¼å–”ï¼"
        }
    ];

    // --- ç‹€æ…‹è®Šæ•¸ ---
    let currentStep = 0;
    let userAnswers = {}; // å„²å­˜ä½¿ç”¨è€…æ¯ä¸€æ­¥çš„ç­”æ¡ˆ { stepIndex: [ans1, ans2...] }

    // --- åˆå§‹åŒ– ---
    document.addEventListener("DOMContentLoaded", () => {
        renderAllSteps();
        activateStep(0);
    });

    // --- æ¸²æŸ“ç•«é¢ ---
    function renderAllSteps() {
        const container = document.getElementById('quiz-container');
        container.innerHTML = quizData.map((data, index) => {
            // å»ºç«‹æ¢ä»¶åˆ—è¡¨çš„ HTML
            const conditionsHtml = data.conditions.map((cond, i) => `
                <div class="flex items-center justify-between bg-white p-3 rounded-lg border border-slate-200 shadow-sm mb-3">
                    <span class="text-lg md:text-xl text-slate-700 font-medium flex-1">
                        ${highlightKeywords(cond.label)}
                    </span>
                    <div class="slot empty" 
                         data-step="${index}" 
                         data-slot-index="${i}" 
                         onclick="clearSlot(${index}, ${i})">
                    </div>
                </div>
            `).join('');

            return `
                <div id="step-${index}" class="step-container bg-white rounded-2xl shadow-lg border-2 border-slate-100 overflow-hidden mb-8 transform transition-all">
                    <!-- æ¨™é¡Œå€ -->
                    <div class="bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold">${index + 1}</span>
                            <h2 class="text-xl font-bold text-slate-700">${data.title}</h2>
                        </div>
                        <div class="status-icon opacity-0 text-green-500 font-bold text-xl">
                            âœ”ï¸ å®Œæˆ
                        </div>
                    </div>

                    <div class="p-6">
                        <!-- é¡Œç›®é¡¯ç¤ºå€ -->
                        <div class="flex justify-center mb-8 p-6 bg-blue-50 rounded-xl border-dashed border-2 border-blue-200">
                            ${data.mathHtml}
                        </div>

                        <!-- å¡«ç­”å€ -->
                        <div class="space-y-2">
                            ${conditionsHtml}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // é—œéµå­—é«˜äº®
    function highlightKeywords(text) {
        return text
            .replace(/ä¸€å…ƒ/g, "<mark>ä¸€å…ƒ</mark>")
            .replace(/äºŒæ¬¡/g, "<mark>äºŒæ¬¡</mark>")
            .replace(/æ–¹ç¨‹å¼/g, "<mark>æ–¹ç¨‹å¼</mark>")
            .replace(/ç­‰è™Ÿ/g, "<mark>ç­‰è™Ÿ</mark>");
    }

    // --- é‚è¼¯æ§åˆ¶ ---

    function activateStep(index) {
        // æ›´æ–°é€²åº¦æ¢
        const progress = ((index) / quizData.length) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;

        // è¦–è¦ºåˆ‡æ›
        document.querySelectorAll('.step-container').forEach((el, i) => {
            if (i === index) {
                el.classList.add('active');
                // æ»¾å‹•åˆ°è©²å…ƒç´ 
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else if (i < index) {
                el.classList.add('completed');
                el.classList.remove('active');
            } else {
                el.classList.remove('active', 'completed');
            }
        });

        // æº–å‚™é¸é …æŒ‰éˆ• (æ”¹ç‚ºå›ºå®šå…©å€‹)
        renderFixedOptions(index);
        
        // éš±è—/é¡¯ç¤ºæ§åˆ¶æŒ‰éˆ•
        document.getElementById('check-btn').classList.remove('hidden');
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('feedback-message').textContent = "è«‹é»æ“Šã€Œæ˜¯ã€æˆ–ã€Œå¦ã€å¡«å…¥ç©ºæ ¼";
        document.getElementById('feedback-message').className = "text-xl font-bold mb-4 h-8 text-center text-slate-600";
        
        // åˆå§‹åŒ–è©²æ­¥é©Ÿçš„ç­”æ¡ˆé™£åˆ—
        if (!userAnswers[index]) {
            userAnswers[index] = new Array(quizData[index].conditions.length).fill(null);
        }
    }

    function renderFixedOptions(stepIndex) {
        const container = document.getElementById('options-container');
        // ä¸å†å¾ quizData è®€å– optionsï¼Œç›´æ¥ç”Ÿæˆå›ºå®šçš„ æ˜¯/å¦ æŒ‰éˆ•
        container.innerHTML = `
            <button class="option-btn btn-yes" 
                    onclick="handleOptionClick(this, 'æ˜¯', ${stepIndex})">
                â­• æ˜¯
            </button>
            <button class="option-btn btn-no" 
                    onclick="handleOptionClick(this, 'å¦', ${stepIndex})">
                âŒ å¦
            </button>
        `;
    }

    function handleOptionClick(btn, value, stepIndex) {
        // 1. æ‰¾åˆ°è©²æ­¥é©Ÿç¬¬ä¸€å€‹ç©ºçš„ slot
        const emptySlotIndex = userAnswers[stepIndex].findIndex(val => val === null);

        if (emptySlotIndex === -1) {
            showMessage("ç©ºæ ¼å·²ç¶“æ»¿å›‰ï¼è«‹å…ˆæª¢æŸ¥ç­”æ¡ˆã€‚", "orange");
            return;
        }

        // 2. å¡«å…¥è³‡æ–™ (ä¸å†éœ€è¦ç´€éŒ„ btnId å› ç‚ºæŒ‰éˆ•ä¸ç¦ç”¨)
        userAnswers[stepIndex][emptySlotIndex] = { value: value };
        
        // 3. æ›´æ–° UI (Slot)
        const slot = document.querySelector(`.slot[data-step="${stepIndex}"][data-slot-index="${emptySlotIndex}"]`);
        slot.textContent = value;
        slot.classList.remove('empty');
        slot.classList.add('filled');
        
        // å¦‚æœå¡«å…¥çš„æ˜¯ "å¦"ï¼Œå¯ä»¥è€ƒæ…®çµ¦å®ƒç´…è‰²æ–‡å­—ï¼Œ"æ˜¯" çµ¦è—è‰²æ–‡å­— (é¸æ“‡æ€§)
        if (value === "å¦") {
            slot.style.color = "#dc2626";
        } else {
            slot.style.color = "#2563eb";
        }

        // 4. ä¸ç¦ç”¨æŒ‰éˆ• (Binary Choice æ¨¡å¼ä¸‹å…è¨±é‡è¤‡ä½¿ç”¨)

        // 5. æç¤º
        showMessage("å·²å¡«å…¥", "gray");
    }

    function clearSlot(stepIndex, slotIndex) {
        // åªæœ‰ç•¶å‰æ­¥é©Ÿä¸”æœªå®Œæˆæ™‚å¯ä»¥æ¸…é™¤
        if (stepIndex !== currentStep) return;
        const currentData = userAnswers[stepIndex][slotIndex];
        
        if (!currentData) return; // å·²ç¶“æ˜¯ç©ºçš„

        // 1. (ç§»é™¤) ä¸éœ€æ¢å¾©æŒ‰éˆ•ï¼Œå› ç‚ºæŒ‰éˆ•æœ¬ä¾†å°±æ²’è¢«ç¦ç”¨

        // 2. æ¸…é™¤è³‡æ–™
        userAnswers[stepIndex][slotIndex] = null;

        // 3. æ›´æ–° UI
        const slot = document.querySelector(`.slot[data-step="${stepIndex}"][data-slot-index="${slotIndex}"]`);
        slot.textContent = "";
        slot.style.color = ""; // é‡ç½®é¡è‰²
        slot.classList.remove('filled', 'correct', 'error');
        slot.classList.add('empty');
    }

    function checkAnswer() {
        const currentData = quizData[currentStep];
        const currentAnswers = userAnswers[currentStep];

        // 1. æª¢æŸ¥æ˜¯å¦å¡«æ»¿
        if (currentAnswers.includes(null)) {
            showMessage("é‚„æœ‰ç©ºæ ¼æ²’å¡«å®Œå–”ï¼", "red");
            shakeElement(document.getElementById(`step-${currentStep}`));
            return;
        }

        // 2. æ¯”å°ç­”æ¡ˆ
        let isAllCorrect = true;
        currentData.conditions.forEach((cond, i) => {
            const userVal = currentAnswers[i].value;
            const slot = document.querySelector(`.slot[data-step="${currentStep}"][data-slot-index="${i}"]`);
            
            if (userVal === cond.answer) {
                slot.classList.add('correct');
            } else {
                slot.classList.add('error'); 
                isAllCorrect = false;
            }
        });

        if (isAllCorrect) {
            handleCorrect();
        } else {
            handleWrong();
        }
    }

    function handleCorrect() {
        showMessage("å¤ªæ£’äº†ï¼å®Œå…¨æ­£ç¢ºï¼ğŸ‰", "green");
        playSound('correct');

        // è©²æ­¥é©ŸåŠ ä¸Šå®Œæˆæ¨™è¨˜
        const stepEl = document.getElementById(`step-${currentStep}`);
        stepEl.querySelector('.status-icon').style.opacity = '1';
        stepEl.classList.add('border-green-400');

        // æŒ‰éˆ•åˆ‡æ›
        document.getElementById('check-btn').classList.add('hidden');
        document.getElementById('options-container').innerHTML = ''; // éš±è—æŒ‰éˆ•

        if (currentStep < quizData.length - 1) {
            document.getElementById('next-btn').classList.remove('hidden');
            // è‡ªå‹•è§¸ç™¼ Tada å‹•ç•«
            document.querySelector(`.status-icon`).classList.add('animate-tada');
        } else {
            // å…¨éƒ¨å®Œæˆ
            finishQuiz();
        }
    }

    function handleWrong() {
        showMessage(`å†æƒ³ä¸€ä¸‹å–”ï¼æç¤ºï¼š${quizData[currentStep].hint}`, "red");
        playSound('wrong');
        
        userAnswers[currentStep].forEach((ans, i) => {
             const slot = document.querySelector(`.slot[data-step="${currentStep}"][data-slot-index="${i}"]`);
             if (ans.value !== quizData[currentStep].conditions[i].answer) {
                 shakeElement(slot);
                 slot.style.borderColor = '#ef4444'; // ç´…è‰²é‚Šæ¡†æç¤º
                 setTimeout(() => slot.style.borderColor = '', 1000); // 1ç§’å¾Œæ¢å¾©
             }
        });
    }

    function nextStep() {
        currentStep++;
        activateStep(currentStep);
    }

    function finishQuiz() {
        document.getElementById('progress-bar').style.width = '100%';
        showMessage("æ­å–œï¼ä½ å®Œæˆäº†æ‰€æœ‰ç·´ç¿’ï¼ğŸ†", "green");
        
        const container = document.getElementById('quiz-container');
        container.innerHTML += `
            <div class="text-center py-10 animate-tada">
                <h2 class="text-4xl font-bold text-blue-600 mb-4">å…¨éƒ¨é€šé—œï¼</h2>
                <p class="text-xl text-slate-600">ä½ å·²ç¶“å­¸æœƒåˆ¤æ–·ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼å›‰ï¼</p>
                <button onclick="location.reload()" class="mt-8 bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-3 px-8 rounded-xl shadow-lg transition-transform hover:scale-105">
                    å†ç©ä¸€æ¬¡ â†»
                </button>
            </div>
        `;
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // --- è¼”åŠ©å‡½å¼ ---

    function showMessage(text, type) {
        const el = document.getElementById('feedback-message');
        el.textContent = text;
        
        el.classList.remove('text-slate-600', 'text-green-600', 'text-red-500', 'text-orange-500');
        
        if (type === 'green') el.classList.add('text-green-600');
        else if (type === 'red') el.classList.add('text-red-500');
        else if (type === 'orange') el.classList.add('text-orange-500');
        else el.classList.add('text-slate-600');
    }

    function shakeElement(el) {
        el.style.animation = 'shake 0.5s';
        setTimeout(() => el.style.animation = '', 500);
    }
    
    // å®šç¾© shake keyframes (JSæ³¨å…¥)
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    `;
    document.head.appendChild(styleSheet);

    function playSound(type) {
        // é€™è£¡åƒ…ä½œç¤ºä¾‹ï¼Œå¯¦éš›ä½¿ç”¨æ™‚éœ€æ”¾å…¥çœŸå¯¦éŸ³æ•ˆ Base64 æˆ–è·¯å¾‘
        // console.log("Play sound:", type);
    }

</script>
</body>
</html>