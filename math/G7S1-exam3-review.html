<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒå¹´ç´šæ•¸å­¸ç§‘ - äº’å‹•è¤‡ç¿’å· (å‹•æ…‹ç¸®æ”¾ & æœ¬åœ°å„²å­˜ç‰ˆ)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Modern Educational -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'warm-bg': '#F8FAFC',
                        'warm-surface': '#F1F5F9',
                        'calm-text': '#1E293B',
                        'soft-blue': '#3B82F6',
                        'soft-amber': '#F59E0B',
                        'correct-green': '#10B981',
                        'wrong-red': '#EF4444'
                    },
                    fontFamily: {
                        'sans': ['"Noto Sans TC"', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --app-font-size: 1rem;
        }

        body {
            background-color: #F8FAFC;
            color: #1E293B;
            font-size: var(--app-font-size);
            transition: font-size 0.15s ease-out;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 250px;
            max-height: 300px;
        }

        /* Scalable UI Elements using rem/em */
        .question-text { font-size: 1.25em; line-height: 1.6; }
        .option-text { font-size: 1.1em; }
        .katex { font-size: 1.15em; }
        
        /* Layout Transitions */
        .view-transition {
            transition: opacity 0.3s ease;
        }
        
        .question-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }

        /* Control Button Styling */
        .zoom-btn {
            @apply p-2 rounded-lg hover:bg-blue-50 text-slate-600 border border-slate-200 transition-all active:scale-90;
        }
    </style>

    <!-- Application Structure Plan: 
         1. **Information Architecture**: A dynamic assessment tool focused on visual comfort and progress tracking.
         2. **Dashboard**: Centralizes performance metrics (History Line Chart) and structural overview (Topic Doughnut).
         3. **Dynamic Font Scaling**: Implements a real-time font-size controller in the navbar. Users can increment/decrement the root font-size, which cascades to all UI components and KaTeX formulas.
         4. **Data Persistence**: Uses `localStorage` for both Score History and the preferred Font Size scale.
         5. **Visual Design**: High contrast but soft colors (Slate & Blue) to reduce eye fatigue during study sessions.
    -->

    <!-- Visualization & Content Choices:
         1. **KaTeX**: Standardized rendering for all math expressions.
         2. **Chart.js**: Line chart for history, Doughnut for topics. Both are responsive to container resizing.
         3. **Dynamic Scaling**: Uses CSS variables (--app-font-size) manipulated via JS to ensure smooth, non-glitchy resizing of the entire application.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="font-sans antialiased min-h-screen flex flex-col" id="main-body">

    <!-- Navbar with Zoom Controls -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-soft-blue rounded-lg flex items-center justify-center text-white font-bold">âˆ‘</div>
                <span class="text-xl font-bold text-slate-800">æ•¸æ„Ÿè¤‡ç¿’å¹³å°</span>
            </div>
            
            <div class="flex items-center bg-slate-50 border border-slate-200 rounded-xl p-1">
                <button onclick="adjustZoom(-0.1)" class="w-10 h-10 flex items-center justify-center hover:bg-white hover:shadow-sm rounded-lg text-xl font-bold text-slate-500 transition-all" title="ç¸®å°å­—é«”">
                    ï¼
                </button>
                <div class="px-3 min-w-[70px] text-center font-bold text-slate-700 border-x border-slate-200" id="zoom-display">
                    100%
                </div>
                <button onclick="adjustZoom(0.1)" class="w-10 h-10 flex items-center justify-center hover:bg-white hover:shadow-sm rounded-lg text-xl font-bold text-slate-500 transition-all" title="æ”¾å¤§å­—é«”">
                    ï¼‹
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-grow max-w-4xl mx-auto w-full px-4 py-8">
        
        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard" class="space-y-8">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                <h1 class="text-3xl font-extrabold text-slate-900 mb-2">æº–å‚™å¥½ç·´ç¿’äº†å—ï¼Ÿ</h1>
                <p class="text-slate-500 text-lg">é€™æ˜¯ 114 ä¸ƒå¹´ç´šç¬¬ä¸‰æ¬¡æ®µè€ƒè¤‡ç¿’å·ã€‚æˆ‘å€‘æœƒè¨˜éŒ„ä½ çš„æ¯ä¸€æ¬¡é€²æ­¥ã€‚</p>
                
                <div class="mt-8 flex flex-col sm:flex-row gap-4">
                    <button onclick="switchView('view-quiz')" class="px-8 py-4 bg-soft-blue hover:bg-blue-600 text-white font-bold rounded-2xl shadow-lg shadow-blue-200 transition-all flex-grow text-center text-xl">
                        é–‹å§‹æ–°ç·´ç¿’
                    </button>
                    <button onclick="clearHistory()" class="px-6 py-4 bg-white hover:bg-red-50 text-red-500 font-medium rounded-2xl border border-red-100 transition-all text-center">
                        æ¸…é™¤ç´€éŒ„
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-800 mb-4">å¾—åˆ†æ­·å²</h3>
                    <div class="chart-container">
                        <canvas id="historyChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-800 mb-4">é¡Œç›®é¡åˆ¥åˆ†ä½ˆ</h3>
                    <div class="chart-container">
                        <canvas id="topicChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- QUIZ VIEW -->
        <section id="view-quiz" class="hidden space-y-8">
            <div class="sticky top-20 z-40 bg-warm-bg/95 backdrop-blur-md pb-4 border-b border-slate-100">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-sm font-bold text-soft-blue" id="progress-text">ä½œç­”é€²åº¦ï¼š0 / 18</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-3">
                    <div id="progress-bar" class="bg-soft-blue h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <div id="questions-list" class="space-y-12">
                <!-- Questions injected via JS -->
            </div>

            <div class="pt-12 pb-24 flex justify-center">
                <button onclick="submitExam()" class="px-16 py-5 bg-slate-800 hover:bg-black text-white text-2xl font-black rounded-3xl shadow-2xl transform transition active:scale-95">
                    æäº¤å·å­
                </button>
            </div>
        </section>

        <!-- RESULTS VIEW -->
        <section id="view-results" class="hidden space-y-8">
            <div class="bg-white p-10 rounded-3xl shadow-xl border border-slate-200 text-center">
                <div class="text-sm text-slate-400 uppercase font-bold tracking-widest mb-2">æœ¬æ¬¡è©•åˆ†</div>
                <div class="text-8xl font-black text-soft-blue mb-8" id="res-score">0</div>
                
                <div class="grid grid-cols-2 gap-4 max-w-sm mx-auto mb-10">
                    <div class="p-4 bg-correct-green/5 rounded-2xl border border-correct-green/10">
                        <div class="text-xs text-slate-400 font-bold mb-1">ç­”å°</div>
                        <div class="text-3xl font-bold text-correct-green" id="res-correct">0</div>
                    </div>
                    <div class="p-4 bg-wrong-red/5 rounded-2xl border border-wrong-red/10">
                        <div class="text-xs text-slate-400 font-bold mb-1">ç­”éŒ¯</div>
                        <div class="text-3xl font-bold text-wrong-red" id="res-wrong">0</div>
                    </div>
                </div>

                <button onclick="switchView('view-dashboard')" class="w-full py-4 bg-slate-800 hover:bg-black text-white font-bold rounded-2xl transition">
                    å›åˆ°é¦–é 
                </button>
            </div>

            <div id="wrong-answer-review" class="hidden bg-white p-8 rounded-3xl shadow-sm border border-red-100">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <span class="mr-2">ğŸ”</span> éŒ¯é¡Œå›é¡§
                </h3>
                <div id="wrong-list" class="space-y-8">
                    <!-- Injected via JS -->
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- DATA ---
        const questions = [
            { id: 1, category: "è§£æ–¹ç¨‹å¼", q: "è«‹åˆ¤æ–·å“ªä¸€å€‹æ•¸å­—æ˜¯æ–¹ç¨‹å¼ $15 + 2x = 7$ çš„è§£ï¼Ÿ", options: ["$x = 4$", "$x = -2$", "$x = 11$", "$x = -4$"], answer: 3, label: "(D) $x = -4$" },
            { id: 2, category: "ä»£æ•¸ç°¡è¨˜", q: "å°‡ç®—å¼ $5 \\times y - 7$ ç°¡è¨˜ï¼Œçµæœæ˜¯å¤šå°‘ï¼Ÿ", options: ["$5y - 7$", "$-2y$", "$35y$", "$y - 2$"], answer: 0, label: "(A) $5y - 7$" },
            { id: 3, category: "ä»£æ•¸è§€å¿µ", q: "ä¸‹é¢å“ªä¸€å€‹æ•˜è¿°æ˜¯ã€ŒéŒ¯èª¤ã€çš„ï¼Ÿ", options: ["$5 \\times y$ ç°¡è¨˜ç‚º $5y$", "$-y$ è¡¨ç¤º $(-1) \\times y$", "è‹¥ $x = y$ï¼Œå‰‡ $x + 8 = y + 8$", "$5x - 4x$ åŒ–ç°¡å¾Œçµæœæ˜¯ $1$"], answer: 3, label: "(D) $5x - 4x = x$ï¼Œä¸¦é $1$" },
            { id: 4, category: "åŒ–ç°¡", q: "åŒ–ç°¡ç®—å¼ $-6(3y - 2)$ï¼Œçµæœæ˜¯å¤šå°‘ï¼Ÿ", options: ["$-18y - 12$", "$-18y + 12$", "$18y + 12$", "$-18y - 2$"], answer: 1, label: "(B) $-18y + 12$" },
            { id: 5, category: "æ‡‰ç”¨é¡Œ", q: "å°è¨±æœ‰ $b$ å¼µ $500$ å…ƒèˆ‡ $20$ å€‹ $100$ å…ƒï¼Œè«‹å•ç¸½å…±å­˜äº†å¤šå°‘å…ƒï¼Ÿ", options: ["$500b + 2000$", "$500b + 200$", "$100b + 500$", "$20b + 100$"], answer: 0, label: "(A) $500b + 2000$" },
            { id: 6, category: "è§£æ–¹ç¨‹å¼", q: "è‹¥ $x = 3$ æ˜¯æ–¹ç¨‹å¼ $2x - m + 5 = 4$ çš„è§£ï¼Œè«‹å• $m = $ ï¼Ÿ", options: ["$15$", "$11$", "$7$", "$3$"], answer: 2, label: "(C) $7$" },
            { id: 7, category: "ä»£æ•¸è§€å¿µ", q: "ä¸‹é¢å“ªä¸€å€‹ã€Œä¸æ˜¯ã€ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹å¼ï¼Ÿ", options: ["$x - 7 = 10$", "$\\frac{x}{2} + \\frac{x}{2} = x$", "$x + 4 = x + 5$", "$3x = 0$"], answer: 2, label: "(C) $x+4=x+5$ æ•´ç†å¾Œç„¡æœªçŸ¥æ•¸" },
            { id: 8, category: "åŒ–ç°¡", q: "åŒ–ç°¡ $-12 - 4x + 15 + 2x$ çš„çµæœï¼Ÿ", options: ["$3 - 6x$", "$-27 - 2x$", "$3 - 2x$", "$-3 + 2x$"], answer: 2, label: "(C) $3 - 2x$" },
            { id: 9, category: "ç­‰é‡å…¬ç†", q: "å‡è¨­ $a, b, c$ ä»£è¡¨ä¸‰å€‹æ•¸ï¼Œå“ªä¸€å€‹ä¸ä¸€å®šæ­£ç¢ºï¼Ÿ", options: ["è‹¥ $a+5=b+5$ å‰‡ $a=b$", "è‹¥ $a-10=b-10$ å‰‡ $a=b$", "è‹¥ $a \\times 0 = b \\times 0$ å‰‡ $a=b$", "è‹¥ $a \\div 2 = b \\div 2$ å‰‡ $a=b$"], answer: 2, label: "(C) ä¹˜ä»¥ 0 å¾Œç„¡æ³•åæ¨åŸæ•¸" },
            { id: 10, category: "æ‡‰ç”¨é¡Œ", q: "ç¹©å­åˆ† 5 æ®µï¼Œæ¯æ®µæ¯”å°æ¼¢èº«é«˜ $y$ å¤š $25$ å…¬åˆ†ï¼Œç¸½é•·ï¼Ÿ", options: ["$5y + 25$", "$5y + 125$", "$y + 125$", "$5(y - 25)$"], answer: 1, label: "(B) $5(y + 25) = 5y + 125$" },
            { id: 11, category: "ä»£æ•¸æ±‚å€¼", q: "è‹¥ $x = -2$ï¼Œå‰‡ $-4 - 3x$ è¨ˆç®—çµæœæ˜¯å¤šå°‘ï¼Ÿ", options: ["$2$", "$-10$", "$10$", "$-2$"], answer: 0, label: "(A) $2$" },
            { id: 12, category: "åŒ–ç°¡", q: "å°‡ç®—å¼ $10 + x \\div \\frac{3}{4}$ åŒ–ç°¡å¾Œçš„çµæœæ˜¯å¤šå°‘ï¼Ÿ", options: ["$\\frac{40+3x}{4}$", "$10 + \\frac{3}{4}x$", "$10 + \\frac{4}{3}x$", "$\\frac{13}{4}x$"], answer: 2, label: "(C) é™¤ä»¥åˆ†æ•¸ç­‰æ–¼ä¹˜ä»¥å€’æ•¸" },
            { id: 13, category: "æ‡‰ç”¨é¡Œ", q: "å°å…‰æˆæœ¬ $y$ å…ƒè²· $12$ ç½ï¼Œæ¯ç½è³£ $\\frac{y}{4}$ å…ƒï¼Œè³ºå¤šå°‘ï¼Ÿ", options: ["$2y$ å…ƒ", "$3y$ å…ƒ", "$4y$ å…ƒ", "$12y$ å…ƒ"], answer: 0, label: "(A) $2y$ å…ƒ" },
            { id: 14, category: "åŒ–ç°¡", q: "åŒ–ç°¡ $-4(6x - 1) + 2(5x - 8)$ï¼Ÿ", options: ["$-14x - 12$", "$-14x + 20$", "$-34x - 12$", "$-14x - 15$"], answer: 0, label: "(A) $-14x - 12$" },
            { id: 15, category: "æ‡‰ç”¨é¡Œ", q: "å’Œç‚º 20ï¼Œå°æ•¸ $x$ æ¯”å¤§æ•¸ $\\frac{1}{3}$ å€å¤š $2$ï¼Œåˆ—å¼ï¼Ÿ", options: ["$20 - x = \\frac{1}{3}x + 2$", "$x = \\frac{1}{3}(20 - x) + 2$", "$x - \\frac{1}{3}x = 2$", "$x + 2 = \\frac{1}{3}(20 - x)$"], answer: 1, label: "(B) å¤§æ•¸ç‚º $20-x$" },
            { id: 16, category: "åŒ–ç°¡", q: "åŒ–ç°¡ $\\frac{-x+5}{4} - \\frac{3x-2}{3}$ çš„çµæœï¼Ÿ", options: ["$\\frac{-15x + 23}{12}$", "$\\frac{-15x + 7}{12}$", "$\\frac{-9x + 23}{12}$", "$\\frac{-15x - 23}{12}$"], answer: 0, label: "(A) $\\frac{-15x + 23}{12}$" },
            { id: 17, category: "ä»£æ•¸è§€å¿µ", q: "åŒ–ç°¡ $\\frac{3x+1}{4} - \\frac{-2x+3}{3}$ï¼Œèª°åšæ³•æ˜¯å°çš„ï¼Ÿ", options: ["å…©äººéƒ½å°", "å…©äººéƒ½éŒ¯", "å°æ¼¢å° (ä¹˜12)", "å°å…‰å° (é€šåˆ†)"], answer: 3, label: "(D) ç®—å¼åŒ–ç°¡ä¸å¯ç›´æ¥ä¹˜åˆ†æ¯" },
            { id: 18, category: "æ‡‰ç”¨é¡Œ", q: "èª¿æ¼² 20% ä¸”æœƒå“¡æ”¹ä¹æŠ˜ã€‚åŸåƒ¹ $y$ï¼Œå‰å¾Œç›¸å·®ï¼Ÿ", options: ["$0.12y$", "$0.25y$", "$0.28y$", "$0.30y$"], answer: 2, label: "(C) $0.28y$" }
        ];

        // --- STATE ---
        let currentAnswers = new Array(questions.length).fill(null);
        let zoomLevel = parseFloat(localStorage.getItem('math_app_zoom') || '1.0');

        // --- ZOOM LOGIC ---
        function applyZoom() {
            document.documentElement.style.setProperty('--app-font-size', `${zoomLevel}rem`);
            document.getElementById('zoom-display').innerText = `${Math.round(zoomLevel * 100)}%`;
            localStorage.setItem('math_app_zoom', zoomLevel.toString());
        }

        function adjustZoom(delta) {
            zoomLevel = Math.min(Math.max(zoomLevel + delta, 0.8), 1.5);
            applyZoom();
        }

        // --- UI NAVIGATION ---
        function switchView(viewId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            if(viewId === 'view-quiz') initQuiz();
            else if(viewId === 'view-dashboard') refreshDashboard();
            window.scrollTo(0,0);
        }

        function initQuiz() {
            currentAnswers = new Array(questions.length).fill(null);
            const list = document.getElementById('questions-list');
            list.innerHTML = questions.map((q, idx) => `
                <div class="question-card bg-white p-8 rounded-3xl shadow-sm border border-slate-100 transition-all" id="qc-${idx}">
                    <div class="flex items-start mb-6">
                        <span class="bg-slate-800 text-white w-10 h-10 rounded-xl flex items-center justify-center font-bold mr-4 shrink-0">
                            ${idx + 1}
                        </span>
                        <div class="question-text text-slate-800 font-medium">
                            ${q.q}
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-3 sm:ml-14">
                        ${q.options.map((opt, oIdx) => `
                            <button onclick="selectAnswer(${idx}, ${oIdx})" id="opt-${idx}-${oIdx}"
                                    class="option-btn text-left p-4 rounded-2xl border-2 border-slate-50 hover:border-soft-blue hover:bg-blue-50 transition-all flex items-center group">
                                <span class="w-8 h-8 rounded-full border border-slate-300 flex items-center justify-center mr-4 group-hover:border-soft-blue font-bold text-sm shrink-0">
                                    ${String.fromCharCode(65 + oIdx)}
                                </span>
                                <span class="option-text">${opt}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            
            updateProgress();
            renderMathInElement(list, {
                delimiters: [{left: "$", right: "$", display: false}]
            });
        }

        function selectAnswer(qIdx, oIdx) {
            currentAnswers[qIdx] = oIdx;
            const card = document.getElementById(`qc-${qIdx}`);
            card.querySelectorAll('.option-btn').forEach(b => {
                b.classList.remove('bg-soft-blue', 'text-white', 'border-soft-blue');
                b.querySelector('span:first-child').classList.remove('bg-white', 'text-soft-blue', 'border-white');
            });
            const btn = document.getElementById(`opt-${qIdx}-${oIdx}`);
            btn.classList.add('bg-soft-blue', 'text-white', 'border-soft-blue');
            btn.querySelector('span:first-child').classList.add('bg-white', 'text-soft-blue', 'border-white');
            updateProgress();
        }

        function updateProgress() {
            const count = currentAnswers.filter(a => a !== null).length;
            const pct = (count / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;
            document.getElementById('progress-text').innerText = `ä½œç­”é€²åº¦ï¼š${count} / ${questions.length}`;
        }

        function submitExam() {
            let correct = 0;
            const wrongs = [];
            questions.forEach((q, i) => {
                if(currentAnswers[i] === q.answer) correct++;
                else wrongs.push({
                    idx: i + 1, q: q.q,
                    user: currentAnswers[i] !== null ? q.options[currentAnswers[i]] : "æœªä½œç­”",
                    correct: q.label
                });
            });

            const score = Math.round((correct / questions.length) * 100);
            const history = JSON.parse(localStorage.getItem('math_exam_history_v2') || '[]');
            history.push({ date: new Date().toLocaleString(), score, correct });
            localStorage.setItem('math_exam_history_v2', JSON.stringify(history.slice(-10)));

            document.getElementById('res-score').innerText = score;
            document.getElementById('res-correct').innerText = correct;
            document.getElementById('res-wrong').innerText = questions.length - correct;
            
            const wrongList = document.getElementById('wrong-list');
            if(wrongs.length > 0) {
                document.getElementById('wrong-answer-review').classList.remove('hidden');
                wrongList.innerHTML = wrongs.map(w => `
                    <div class="bg-slate-50 p-6 rounded-2xl border-l-4 border-wrong-red">
                        <div class="font-bold text-slate-800 mb-2">é¡Œç›® ${w.idx}ï¼š${w.q}</div>
                        <div class="flex flex-wrap gap-4 text-sm font-medium">
                            <span class="text-wrong-red bg-white px-2 py-1 rounded shadow-sm">âŒ ä½ çš„å›ç­”ï¼š${w.user}</span>
                            <span class="text-correct-green bg-white px-2 py-1 rounded shadow-sm">âœ… æ­£ç¢ºè§£ç­”ï¼š${w.correct}</span>
                        </div>
                    </div>
                `).join('');
                renderMathInElement(wrongList, { delimiters: [{left: "$", right: "$", display: false}] });
            } else {
                document.getElementById('wrong-answer-review').classList.add('hidden');
            }
            switchView('view-results');
        }

        function clearHistory() {
            if(confirm('ç¢ºå®šæ¸…é™¤æ­·å²ç´€éŒ„å—ï¼Ÿ')) {
                localStorage.removeItem('math_exam_history_v2');
                refreshDashboard();
            }
        }

        function refreshDashboard() {
            const history = JSON.parse(localStorage.getItem('math_exam_history_v2') || '[]');
            
            const ctxTopic = document.getElementById('topicChart').getContext('2d');
            const categories = {};
            questions.forEach(q => categories[q.category] = (categories[q.category] || 0) + 1);
            if(window.tChart) window.tChart.destroy();
            window.tChart = new Chart(ctxTopic, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{ data: Object.values(categories), backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#F43F5E', '#8B5CF6'], borderWidth: 0 }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }}}
            });

            const ctxHist = document.getElementById('historyChart').getContext('2d');
            if(window.hChart) window.hChart.destroy();
            window.hChart = new Chart(ctxHist, {
                type: 'line',
                data: {
                    labels: history.map((h, i) => `ç¬¬ ${i+1} æ¬¡`),
                    datasets: [{ label: 'å¾—åˆ†', data: history.map(h => h.score), borderColor: '#3B82F6', backgroundColor: '#3B82F615', fill: true, tension: 0.4, pointRadius: 5 }]
                },
                options: { maintainAspectRatio: false, scales: { y: { min: 0, max: 100 } } }
            });
        }

        window.onload = () => {
            applyZoom();
            refreshDashboard();
        };
    </script>
</body>
</html>