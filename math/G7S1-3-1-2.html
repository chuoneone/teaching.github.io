<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡å­—ç¬¦è™Ÿçš„ç°¡è¨˜ - äº’å‹•ç·´ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff; /* Light Blue bg */
        }

        /* -------------------------------------- */
        /* æ•¸å­¸å¼å°ˆç”¨ CSS (ç¬¦åˆæ•™ç§‘æ›¸æ’ç‰ˆè¦å‰‡) */
        /* -------------------------------------- */
        .math {
            font-family: 'Times New Roman', serif; /* æ•¸å­¸è®Šæ•¸å¸¸æ•¸å¸¸ç”¨è¥¯ç·šå­— */
            font-size: 28px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #1e3a8a; /* Dark Blue */
            vertical-align: middle;
        }

        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            line-height: 1;
            vertical-align: middle;
            margin: 0 4px;
            font-size: 0.9em; /* åˆ†æ•¸ç¨å¾®ç¸®å°ä¸€é»ä»¥å…éå¤§ */
        }
        
        .fraction span:first-child {
            border-bottom: 2px solid #000;
            padding: 2px 4px;
            display: block;
            width: 100%;
            text-align: center;
        }

        .fraction span:last-child {
            padding-top: 2px;
            display: block;
        }

        /* -------------------------------------- */
        /* äº’å‹•å…ƒä»¶ CSS */
        /* -------------------------------------- */
        
        /* å¡«ç­”æ§½ (Slot) */
        .slot {
            min-width: 60px;
            height: 60px;
            padding: 0 10px;
            border: 2px dashed #94a3b8;
            border-radius: 8px;
            background-color: #ffffff;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 4px;
            vertical-align: middle;
        }

        .slot.filled {
            border: 2px solid #3b82f6; /* Blue border when filled */
            background-color: #eff6ff;
            border-style: solid;
        }

        .slot.correct {
            border: 2px solid #22c55e; /* Green border */
            background-color: #dcfce7;
            color: #15803d;
        }

        /* é¸é …æŒ‰éˆ• (Option Button) */
        .option-btn {
            min-width: 60px;
            height: 60px;
            padding: 0 16px;
            margin: 6px;
            background-color: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 24px;
            font-family: 'Times New Roman', serif;
            font-weight: bold;
            color: #334155;
            box-shadow: 0 4px 0 #cbd5e1;
            transition: all 0.1s;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #cbd5e1;
        }

        .option-btn:disabled {
            background-color: #f1f5f9;
            color: #cbd5e1;
            border-color: #f1f5f9;
            box-shadow: none;
            cursor: not-allowed;
            transform: translateY(4px);
        }

        /* æ­¥é©Ÿå®¹å™¨ */
        .step-container {
            opacity: 0.5;
            pointer-events: none;
            transition: opacity 0.5s ease;
            filter: grayscale(0.8);
        }

        .step-container.active {
            opacity: 1;
            pointer-events: auto;
            filter: grayscale(0);
            background-color: white;
            border: 2px solid #3b82f6;
            transform: scale(1.01);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .step-container.completed {
            opacity: 1;
            filter: grayscale(0);
            border: 2px solid #22c55e;
            background-color: #f0fdf4;
        }

        /* é‡é»é«˜äº® */
        mark {
            background-color: #fef08a; /* Yellow-200 */
            padding: 2px 6px;
            border-radius: 4px;
            color: #854d0e;
            font-weight: bold;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col items-center">

    <!-- Header -->
    <header class="w-full max-w-3xl mb-8 text-center">
        <div class="inline-block bg-pink-600 text-white px-6 py-2 rounded-full text-lg font-bold mb-4 shadow-md">
            ğŸ§© ç†Ÿç·´ 2ï¼šæ–‡å­—ç¬¦è™Ÿçš„ç°¡è¨˜
        </div>
        <p class="text-slate-600 text-lg">
            è«‹ä¾ç…§ã€Œæ•¸å­—åœ¨æ–‡å­—å‰ã€ä¹˜è™Ÿçœç•¥ã€çš„è¦å‰‡ï¼Œç°¡è¨˜ä¸‹åˆ—å„å¼ã€‚
        </p>
    </header>

    <!-- Main Game Area -->
    <main id="game-area" class="w-full max-w-3xl space-y-6">
        <!-- Steps will be injected here by JS -->
    </main>

    <!-- Global Feedback Area -->
    <div id="feedback-modal" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-white px-6 py-4 rounded-xl shadow-2xl border-l-8 border-yellow-500 hidden z-50 flex items-center gap-4 transition-all duration-300">
        <span id="feedback-icon" class="text-3xl">ğŸ¤”</span>
        <span id="feedback-text" class="text-xl font-bold text-slate-700">æç¤ºè¨Šæ¯</span>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // é¡Œç›®è³‡æ–™çµæ§‹ (Updated based on image "ç†Ÿç·´ 2")
        const stepsData = [
            {
                id: 1,
                title: "é¡Œç›® 1ï¼šæ•¸å­—èˆ‡æ–‡å­—ç›¸ä¹˜",
                question: "ç°¡è¨˜ï¼š <span class='math'>y Ã— (-1.2)</span>",
                slots: 2, // -1.2 y
                options: ["y", "-1.2", "1.2", "Ã—", "+"],
                correctAnswer: ["-1.2", "y"],
                hint: "æ•¸å­—è¦æ”¾åœ¨æ–‡å­—å‰é¢ï¼Œä¸”è² è™Ÿè¦ä¿ç•™å–”ï¼",
            },
            {
                id: 2,
                title: "é¡Œç›® 2ï¼šåŒé¡é …é€£åŠ ",
                question: "ç°¡è¨˜ï¼š <span class='math'>a + a + a + a</span>",
                slots: 2, // 4 a
                options: ["a", "4", "3", "+", "a"],
                correctAnswer: ["4", "a"],
                hint: "æ•¸æ•¸çœ‹æœ‰å¹¾å€‹ a åŠ åœ¨ä¸€èµ·ï¼Ÿ",
            },
            {
                id: 3,
                title: "é¡Œç›® 3ï¼šä¹˜æ³•çµåˆåŠ æ³•",
                question: "ç°¡è¨˜ï¼š <span class='math'>x Ã— 44 + 7</span>",
                slots: 4, // 44 x + 7
                options: ["x", "44", "+", "7", "Ã—"],
                correctAnswer: ["44", "x", "+", "7"],
                hint: "å…ˆè™•ç†ä¹˜æ³•éƒ¨åˆ†ï¼ˆçœç•¥ä¹˜è™Ÿï¼‰ï¼Œå¾Œé¢çš„åŠ è™Ÿå’Œæ•¸å­—è¦ç…§æŠ„å–”ã€‚",
            },
            {
                id: 4,
                title: "é¡Œç›® 4ï¼šé€£ä¹˜èˆ‡é™¤æ³•é‹ç®—",
                question: "ç°¡è¨˜ï¼š <span class='math'>y Ã— (-20) Ã· 5</span>",
                slots: 2, // -4 y
                options: ["y", "-4", "4", "-20", "5"],
                correctAnswer: ["-4", "y"],
                hint: "å…ˆç®—æ•¸å­—ï¼š(-20) Ã· 5 ç­‰æ–¼å¤šå°‘å‘¢ï¼Ÿ",
            },
            {
                id: 5,
                title: "é¡Œç›® 5ï¼šæ•¸å­—ä½ç½®èˆ‡å¸¸æ•¸",
                question: "ç°¡è¨˜ï¼š <span class='math'>a Ã— 3 + 16</span>",
                slots: 4, // 3 a + 16
                options: ["a", "3", "+", "16", "Ã—"],
                correctAnswer: ["3", "a", "+", "16"],
                hint: "æ•¸å­— 3 è¦ç§»åˆ° a çš„å‰é¢ï¼Œå¾Œé¢çš„ +16 åˆ¥å¿˜äº†ã€‚",
            },
            {
                id: 6,
                title: "é¡Œç›® 6ï¼šåˆ†æ•¸é™¤æ³•é‹ç®—",
                // x Ã· (-3/5) Ã— (-3) -> x * (-5/3) * (-3) -> x * 5 -> 5x
                question: "ç°¡è¨˜ï¼š <div class='math'>x Ã· ( - <span class='fraction'><span>3</span><span>5</span></span> ) Ã— (-3)</div>",
                slots: 2, // 5 x
                options: ["x", "5", "-5", "3", "1/5"],
                correctAnswer: ["5", "x"],
                hint: "é™¤ä»¥åˆ†æ•¸ç­‰æ–¼ä¹˜ä»¥å€’æ•¸ï¼è² è² å¾—æ­£ï¼Œå…ˆç®—æ•¸å­—éƒ¨åˆ†ï¼š(-5/3) Ã— (-3) æ˜¯å¤šå°‘ï¼Ÿ",
            }
        ];

        let currentStep = 0;
        let userAnswers = {}; 
        let stepCompleted = {}; 

        const gameArea = document.getElementById('game-area');
        const feedbackModal = document.getElementById('feedback-modal');
        const feedbackText = document.getElementById('feedback-text');
        const feedbackIcon = document.getElementById('feedback-icon');

        // åˆå§‹åŒ–
        function init() {
            renderSteps();
            activateStep(0);
        }

        // æ¸²æŸ“æ‰€æœ‰æ­¥é©Ÿ
        function renderSteps() {
            gameArea.innerHTML = '';
            stepsData.forEach((step, index) => {
                // å»ºç«‹æ­¥é©Ÿå®¹å™¨
                const stepEl = document.createElement('div');
                stepEl.id = `step-${index}`;
                stepEl.className = `step-container bg-white p-6 rounded-2xl border border-slate-200 shadow-sm relative overflow-hidden`;
                
                userAnswers[index] = new Array(step.slots).fill(null);
                stepCompleted[index] = false;

                // æ§‹å»º HTML
                stepEl.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-bold text-slate-400 step-title">Topic ${index + 1}</h3>
                        <span class="status-icon hidden text-green-500 text-xl font-bold">âœ”ï¸ å®Œæˆ</span>
                    </div>
                    
                    <div class="mb-6 text-2xl text-slate-800 leading-relaxed font-medium">
                        ${step.question} <span class="mx-2 text-slate-400">=</span> ?
                    </div>

                    <div class="flex flex-col items-center gap-6">
                        <!-- ç­”é¡Œå€ (Slots) -->
                        <div class="flex items-center flex-wrap gap-2 bg-slate-50 p-4 rounded-xl w-full justify-center min-h-[100px]" id="slots-area-${index}">
                            ${generateSlotsHTML(index, step.slots)}
                        </div>

                        <!-- é¸é …å€ (Options) -->
                        <div class="flex flex-wrap justify-center gap-2" id="options-area-${index}">
                            ${generateOptionsHTML(index, step.options)}
                        </div>

                        <!-- æª¢æŸ¥æŒ‰éˆ• -->
                        <button onclick="checkStep(${index})" class="check-btn bg-indigo-600 hover:bg-indigo-700 text-white text-lg font-bold py-3 px-8 rounded-xl shadow-lg transform transition active:scale-95 w-full md:w-auto mt-2">
                            æª¢æŸ¥ç­”æ¡ˆ
                        </button>
                    </div>
                `;
                gameArea.appendChild(stepEl);
            });
        }

        function generateSlotsHTML(stepIndex, count) {
            let html = '<div class="math">'; 
            for (let i = 0; i < count; i++) {
                html += `<div class="slot" data-step="${stepIndex}" data-slot-index="${i}" onclick="handleSlotClick(${stepIndex}, ${i})"></div>`;
            }
            html += '</div>';
            return html;
        }

        function generateOptionsHTML(stepIndex, options) {
            return options.map(opt => `
                <button class="option-btn" data-step="${stepIndex}" data-val="${opt}" onclick="handleOptionClick(${stepIndex}, '${opt}', this)">
                    ${opt}
                </button>
            `).join('');
        }

        function activateStep(index) {
            currentStep = index;
            const stepEl = document.getElementById(`step-${index}`);
            if (stepEl) {
                stepEl.classList.add('active');
                setTimeout(() => {
                    stepEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        }

        window.handleOptionClick = function(stepIndex, value, btnEl) {
            if (stepCompleted[stepIndex]) return; 

            const emptySlotIndex = userAnswers[stepIndex].findIndex(val => val === null);
            
            if (emptySlotIndex !== -1) {
                userAnswers[stepIndex][emptySlotIndex] = value;
                
                const slotEl = document.querySelector(`.slot[data-step="${stepIndex}"][data-slot-index="${emptySlotIndex}"]`);
                slotEl.innerHTML = renderMathContent(value);
                slotEl.classList.add('filled');
                
                btnEl.disabled = true;
                btnEl.dataset.linkedSlot = emptySlotIndex; 
                playSound('pop');
            } else {
                showFeedback('ç©ºæ ¼å·²ç¶“æ»¿å›‰ï¼è«‹å…ˆæª¢æŸ¥æˆ–é»æ“Šç©ºæ ¼æ¸…é™¤ã€‚', 'warning');
            }
        }

        window.handleSlotClick = function(stepIndex, slotIndex) {
            if (stepCompleted[stepIndex]) return;

            const currentVal = userAnswers[stepIndex][slotIndex];
            if (currentVal) {
                userAnswers[stepIndex][slotIndex] = null;

                const slotEl = document.querySelector(`.slot[data-step="${stepIndex}"][data-slot-index="${slotIndex}"]`);
                slotEl.innerHTML = '';
                slotEl.classList.remove('filled');

                const optionBtns = document.querySelectorAll(`#options-area-${stepIndex} .option-btn`);
                for (let btn of optionBtns) {
                    if (btn.disabled && btn.dataset.val === currentVal) {
                        btn.disabled = false;
                        break; 
                    }
                }
            }
        }

        window.checkStep = function(stepIndex) {
            const currentAnswers = userAnswers[stepIndex];
            const correctData = stepsData[stepIndex].correctAnswer;
            const hint = stepsData[stepIndex].hint;

            if (currentAnswers.includes(null)) {
                showFeedback('è«‹å¡«æ»¿æ‰€æœ‰ç©ºæ ¼å†æŒ‰æª¢æŸ¥å–”ï¼', 'warning');
                return;
            }

            let isCorrect = false;
            // è™•ç†å¤šçµ„ç­”æ¡ˆ (é›–ç„¶é€™æ¬¡é¡Œç›®å¤§å¤šå›ºå®šï¼Œä½†ä¿ç•™ç›¸å®¹æ€§)
            if (Array.isArray(correctData[0])) {
                isCorrect = correctData.some(ans => JSON.stringify(ans) === JSON.stringify(currentAnswers));
            } else {
                isCorrect = JSON.stringify(currentAnswers) === JSON.stringify(correctData);
            }

            if (isCorrect) {
                handleSuccess(stepIndex);
            } else {
                handleFailure(stepIndex, hint);
            }
        }

        function handleSuccess(stepIndex) {
            stepCompleted[stepIndex] = true;
            
            const stepEl = document.getElementById(`step-${stepIndex}`);
            stepEl.classList.remove('active');
            stepEl.classList.add('completed');
            
            stepEl.querySelector('.status-icon').classList.remove('hidden');
            stepEl.querySelector('.check-btn').classList.add('hidden'); 
            
            const slots = stepEl.querySelectorAll('.slot');
            slots.forEach(s => s.classList.add('correct'));

            showFeedback('å¤ªæ£’äº†ï¼ç­”å°äº†ï¼ ğŸ‰', 'success');
            playSound('success');

            if (stepIndex < stepsData.length - 1) {
                setTimeout(() => {
                    activateStep(stepIndex + 1);
                }, 1500);
            } else {
                setTimeout(() => {
                    showFeedback('å¤ªå²å®³äº†ï¼æ‰€æœ‰æŒ‘æˆ°éƒ½å®Œæˆäº†ï¼ ğŸ†', 'success');
                    confettiEffect();
                }, 1000);
            }
        }

        function handleFailure(stepIndex, hint) {
            // é¡¯ç¤ºç‰¹å®šé¡Œç›®çš„æç¤º
            showFeedback(`å†è©¦è©¦çœ‹ï¼ğŸ’¡ ${hint}`, 'error');
            playSound('error');
            
            const slotsArea = document.getElementById(`slots-area-${stepIndex}`);
            slotsArea.classList.add('animate-pulse'); 
            setTimeout(() => slotsArea.classList.remove('animate-pulse'), 500);
        }

        function renderMathContent(val) {
            if (val === "/") return "Ã·";
            if (val === "*") return "Ã—";
            return val;
        }

        function showFeedback(msg, type) {
            feedbackText.innerText = msg;
            feedbackModal.classList.remove('hidden');
            
            feedbackModal.className = "fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-white px-8 py-4 rounded-xl shadow-2xl border-l-8 z-50 flex items-center gap-4 transition-all duration-300 min-w-[300px]";
            
            if (type === 'success') {
                feedbackModal.classList.add('border-green-500');
                feedbackIcon.innerText = "ğŸ˜„";
            } else if (type === 'error') {
                feedbackModal.classList.add('border-red-500');
                feedbackIcon.innerText = "ğŸ’ª";
            } else {
                feedbackModal.classList.add('border-yellow-500');
                feedbackIcon.innerText = "â˜ï¸";
            }

            setTimeout(() => {
                feedbackModal.classList.add('hidden');
            }, 4000);
        }

        function playSound(type) {
            console.log(`Playing sound: ${type}`);
        }
        
        function confettiEffect() {
            const colors = ['#ec4899', '#8b5cf6', '#3b82f6', '#10b981', '#f59e0b'];
            for(let i=0; i<50; i++) {
                const conf = document.createElement('div');
                conf.style.position = 'fixed';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.top = '-10px';
                conf.style.width = '10px';
                conf.style.height = '10px';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.transition = 'top 3s ease-out, transform 3s linear';
                conf.style.zIndex = '9999';
                document.body.appendChild(conf);
                
                setTimeout(() => {
                    conf.style.top = '105vh';
                    conf.style.transform = `rotate(${Math.random() * 360}deg)`;
                }, 100);
            }
        }

        init();
    </script>
</body>
</html>