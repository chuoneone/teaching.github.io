<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•æ•¸å­¸ï¼šä¸‰è§’å½¢çš„å…§å¿ƒ</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- åŸºç¤å­—å‹èˆ‡è¨­å®š --- */
        body { 
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; 
            background-color: #f0f9ff; /* æ·ºè—è‰²èƒŒæ™¯ï¼Œå°çœ¼ç›è¼ƒèˆ’é© */
            overflow-x: hidden; 
            touch-action: manipulation; /* å„ªåŒ–è§¸æ§ */
        }

        /* --- æ•¸å­¸å¼åš´æ ¼æ¨£å¼ (Strict HTML) --- */
        .math { 
            font-family: 'Times New Roman', serif; 
            font-style: italic; 
            font-size: 1.25em; 
            font-weight: 600; 
            display: inline-flex; 
            align-items: center; 
            gap: 2px; 
            color: #1f2937; 
        }
        .math-lg { font-size: 1.5em; }
        .angle::before { 
            content: "âˆ "; 
            font-style: normal; 
            margin-right: 2px; 
        }
        .degree::after { 
            content: "Â°"; 
            font-style: normal; 
        }
        /* åˆ†æ•¸æ¨£å¼ */
        .fraction { 
            display: inline-flex; 
            flex-direction: column; 
            align-items: center; 
            line-height: 1; 
            vertical-align: middle;
            margin: 0 4px;
        }
        .fraction span:first-child { 
            border-bottom: 2px solid #000; 
            padding: 0 4px; 
            width: 100%;
            text-align: center;
        }
        .fraction span:last-child {
            padding-top: 2px;
            width: 100%;
            text-align: center;
        }

        /* --- å¡«ç­”æ ¼ Slot æ¨£å¼ --- */
        .slot {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            min-width: 70px;
            height: 48px;
            border-bottom: 3px solid #9ca3af;
            background-color: #ffffff;
            color: #374151;
            font-size: 1.25em;
            font-weight: bold;
            margin: 0 6px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 10px;
            vertical-align: middle;
            border-radius: 4px 4px 0 0;
            box-shadow: inset 0 -1px 2px rgba(0,0,0,0.05);
        }
        .slot:hover { background-color: #f3f4f6; border-color: #6b7280; }
        .slot.filled { 
            border-bottom-color: #3b82f6; 
            color: #2563eb; 
            background-color: #eff6ff;
        }
        /* æ­£ç¢ºé–å®šç‹€æ…‹ */
        .slot.correct { 
            border-bottom-color: #10b981; 
            color: #059669; 
            background-color: #ecfdf5; 
            pointer-events: none; 
            border-bottom-width: 4px;
        }

        /* --- é¸é …æŒ‰éˆ•æ¨£å¼ --- */
        .option-btn {
            background-color: #ffffff;
            border: 2px solid #e5e7eb;
            color: #111827;
            padding: 10px 24px;
            font-size: 1.25em;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 0 #e5e7eb;
            transition: all 0.1s active;
            user-select: none;
            min-width: 60px;
            text-align: center;
        }
        .option-btn:active { transform: translateY(4px); box-shadow: none; }
        .option-btn:disabled { 
            opacity: 0.3; 
            cursor: not-allowed; 
            transform: translateY(4px); 
            box-shadow: none; 
            background-color: #f3f4f6; 
            border-color: #e5e7eb;
        }
        .option-btn:hover:not(:disabled) { 
            border-color: #3b82f6; 
            color: #2563eb; 
            background-color: #eff6ff;
            box-shadow: 0 4px 0 #bfdbfe;
        }

        /* --- æ­¥é©Ÿå®¹å™¨å‹•ç•« --- */
        .step-container {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            opacity: 0.4;
            pointer-events: none;
            transform: scale(0.98);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }
        .step-container.active { 
            opacity: 1; 
            pointer-events: auto; 
            transform: scale(1); 
            border-color: #3b82f6; 
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1);
        }
        .step-container.done { 
            opacity: 1; 
            pointer-events: auto; 
            border-color: #10b981; 
            background-color: #f0fdf4;
        }
        
        /* --- è¦–è¦ºå›é¥‹å‹•ç•« --- */
        @keyframes tada {
            0% { transform: scale(1); }
            10%, 20% { transform: scale(0.9) rotate(-3deg); }
            30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
            40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
            100% { transform: scale(1) rotate(0); }
        }
        .animate-tada { animation: tada 0.8s; }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* --- å°è¦½åˆ—èˆ‡æ²å‹•æ¢ --- */
        .nav-btn {
            padding: 10px 20px;
            border-radius: 9999px;
            font-weight: 700;
            white-space: nowrap;
            transition: all 0.3s;
            font-size: 1rem;
        }
        .nav-btn.active { 
            background-color: #2563eb; 
            color: white; 
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
        }
        .nav-btn:not(.active) { background-color: #e5e7eb; color: #6b7280; }
        .nav-btn:not(.active):hover { background-color: #d1d5db; }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- é‡é»æ¨™è¨˜ --- */
        mark.highlight {
            background-color: #fef08a;
            padding: 2px 6px;
            border-radius: 4px;
            box-decoration-break: clone;
            -webkit-box-decoration-break: clone;
            font-weight: bold;
            color: #854d0e;
        }

        /* SVG æ¨£å¼å„ªåŒ– */
        svg text { 
            font-family: sans-serif; 
            font-weight: bold; 
            pointer-events: none; /* é˜²æ­¢é¸å–æ–‡å­—å¹²æ“¾ */
        }
    </style>
</head>
<body class="h-screen flex flex-col text-gray-800">

    <!-- é ‚éƒ¨å°è¦½åˆ— -->
    <header class="bg-white border-b shadow-sm z-50 flex-none sticky top-0">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4 overflow-x-auto hide-scrollbar">
            <div class="font-black text-xl text-blue-600 flex-shrink-0 mr-2 flex items-center gap-2">
                <span>ğŸ“</span> å–®å…ƒï¼šä¸‰è§’å½¢çš„å…§å¿ƒ
            </div>
            <div class="h-8 w-px bg-gray-300 mx-2"></div>
            <!-- æŒ‰éˆ•å°‡ç”± JS ç”Ÿæˆ -->
            <div id="nav-container" class="flex gap-3"></div>
        </div>
    </header>

    <!-- ä¸»å…§å®¹å€ (Flex ä½ˆå±€ï¼šå·¦é¡Œå³è§£) -->
    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <!-- å·¦å´ï¼šé¡Œç›®å€ -->
        <section class="w-full md:w-5/12 lg:w-1/3 bg-blue-50 p-6 flex-none overflow-y-auto border-b-4 md:border-b-0 md:border-r-4 border-blue-100 flex flex-col items-center shadow-inner">
            <div id="problem-display" class="w-full max-w-lg sticky top-0 pop-in">
                <!-- é¡Œç›®å…§å®¹ -->
            </div>
        </section>

        <!-- å³å´ï¼šæ­¥é©Ÿå€ -->
        <section class="w-full md:w-7/12 lg:w-2/3 bg-gray-50 p-4 md:p-8 overflow-y-auto scroll-smooth relative" id="steps-area">
            <div id="steps-container" class="max-w-3xl mx-auto pb-24">
                <!-- æ­¥é©Ÿå…§å®¹ -->
            </div>
        </section>

    </main>

    <!-- å®Œæˆè¦–çª— (Modal) -->
    <div id="completion-modal" class="fixed inset-0 hidden flex items-center justify-center z-[100] backdrop-blur-sm bg-black/40 transition-opacity opacity-0">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full mx-4 shadow-2xl text-center transform scale-95 transition-all duration-300" id="modal-content">
            <div class="text-7xl mb-4 animate-bounce">ğŸ‰</div>
            <h2 class="text-3xl font-black text-gray-800 mb-2 tracking-tight">æ­å–œå®Œæˆï¼</h2>
            <p class="text-gray-500 mb-8 text-lg">ä½ å·²ç¶“æˆåŠŸè§£é–‹é€™å€‹é¡Œç›®äº†ï¼</p>
            <div class="flex flex-col gap-3">
                <button onclick="resetCurrentProblem()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 px-6 rounded-xl transition shadow-lg hover:shadow-blue-500/30 text-lg">
                    ğŸ”„ å†åšä¸€æ¬¡
                </button>
                <button onclick="closeModal()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-3.5 px-6 rounded-xl transition text-lg">
                    é—œé–‰è¦–çª—
                </button>
            </div>
        </div>
    </div>

    <!-- éŒ¯èª¤æç¤º Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-full shadow-lg font-bold transition-all duration-300 translate-y-20 opacity-0 z-50 flex items-center gap-2">
        <span>ğŸ¤”</span> <span id="toast-msg">å†æƒ³æƒ³çœ‹å–”</span>
    </div>

    <script>
        // --- è³‡æ–™è¨­å®š (å·²èª¿æ•´é †åº) ---
        const problems = [
            {
                id: 1, // åŸé¡Œç›® 2
                title: "é¡Œç›® 1ï¼šæœ€å¤§åœ“å½¢æ¦‚å¿µ",
                type: "æ¦‚å¿µåˆ¤æ–·",
                desc: `
                    <div class="space-y-4">
                        <p class="text-lg">
                            åœ¨ä¸€å¡Šä¸‰è§’å½¢çš„æœ¨æ¿ä¸Šï¼Œè¦åˆ‡å‡ºä¸€å€‹<mark class="highlight">é¢ç©æœ€å¤§</mark>çš„åœ“å½¢ã€‚
                        </p>
                        <p class="text-lg font-bold text-blue-700">
                            è«‹å•ï¼šæ­¤åœ“çš„åœ“å¿ƒç‚ºæ­¤æœ¨æ¿ä¸Šçš„å“ªå€‹å¿ƒï¼Ÿ
                        </p>
                    </div>
                `,
                svg: `
                    <svg viewBox="0 0 300 200" class="w-full h-auto drop-shadow-lg rounded-lg bg-white">
                        <polygon points="150,20 50,180 250,180" fill="#f3f4f6" stroke="#374151" stroke-width="2"/>
                        <!-- å…§åˆ‡åœ“ -->
                        <circle cx="150" cy="125" r="55" fill="#dbeafe" stroke="#2563eb" stroke-width="2" stroke-dasharray="5,3"/>
                        <circle cx="150" cy="125" r="4" fill="#2563eb"/>
                        <text x="145" y="115" font-size="24" fill="#1e40af" font-weight="bold">?</text>
                    </svg>
                `,
                steps: [
                    {
                        title: "æ­¥é©Ÿ 1ï¼šåˆ¤æ–·åœ“å¿ƒæ€§è³ª",
                        instruction: "ä¸‰è§’å½¢å…§éƒ¨ã€Œæœ€å¤§ã€çš„åœ“å½¢ï¼Œå°±æ˜¯èˆ‡ä¸‰é‚Šéƒ½ç›¸åˆ‡çš„åœ“ã€‚",
                        template: `
                            <div class="flex flex-col items-center gap-4">
                                <div class="text-xl">
                                    é€™å€‹åœ“ç¨±ç‚ºä¸‰è§’å½¢çš„ <span class="slot" data-ans="å…§åˆ‡åœ“" style="width: 120px"></span>
                                </div>
                                <div class="text-xl">
                                    åœ“å¿ƒç¨±ç‚º <span class="slot" data-ans="å…§å¿ƒ" style="width: 100px"></span>
                                </div>
                            </div>`,
                        options: ["å¤–æ¥åœ“", "å…§åˆ‡åœ“", "å¤–å¿ƒ", "å…§å¿ƒ", "é‡å¿ƒ"]
                    }
                ]
            },
            {
                id: 2, // åŸé¡Œç›® 3
                title: "é¡Œç›® 2ï¼šå…§å¿ƒè·é›¢æ€§è³ª",
                type: "æ€§è³ªæ‡‰ç”¨",
                desc: `
                    <div class="space-y-4">
                        <p class="text-lg">
                            <span class="math">â–³ABC</span> ä¸­ï¼Œ<span class="math">I</span> é»ç‚ºå…§å¿ƒã€‚
                        </p>
                        <ul class="list-disc list-inside bg-white p-3 rounded-lg text-gray-700">
                            <li>è‹¥ <span class="math">I</span> é»åˆ° <span class="math" style="text-decoration:overline">AB</span> çš„è·é›¢ç‚º <span class="math text-red-600">3</span>ã€‚</li>
                        </ul>
                        <p class="font-bold text-xl text-blue-700">
                            æ±‚ <span class="math">I</span> é»åˆ° <span class="math" style="text-decoration:overline">BC</span> çš„è·é›¢ = ?
                        </p>
                    </div>
                `,
                svg: `
                    <svg viewBox="0 0 300 200" class="w-full h-auto drop-shadow-lg rounded-lg bg-white">
                        <polygon points="150,20 40,180 260,180" fill="#fff" stroke="#374151" stroke-width="2"/>
                        <circle cx="150" cy="120" r="4" fill="#ef4444"/>
                        <text x="150" y="110" font-size="20" fill="#ef4444" font-weight="bold">I</text>
                        
                        <!-- åˆ° AB çš„è·é›¢ -->
                        <line x1="150" y1="120" x2="88" y2="100" stroke="#ef4444" stroke-width="2"/>
                        <text x="105" y="100" font-size="18" fill="#ef4444" font-weight="bold">3</text>
                        
                        <!-- åˆ° BC çš„è·é›¢ -->
                        <line x1="150" y1="120" x2="150" y2="180" stroke="#2563eb" stroke-width="2" stroke-dasharray="5"/>
                        <text x="158" y="160" font-size="24" fill="#2563eb" font-weight="bold">?</text>
                        
                        <text x="145" y="15" font-size="20" fill="#374151">A</text>
                        <text x="20" y="190" font-size="20" fill="#374151">B</text>
                        <text x="270" y="190" font-size="20" fill="#374151">C</text>
                    </svg>
                `,
                steps: [
                    {
                        title: "æ­¥é©Ÿ 1ï¼šå›æƒ³å…§å¿ƒæ€§è³ª",
                        instruction: "å…§å¿ƒæ˜¯ç”±è§’å¹³åˆ†ç·šäº¤é»å½¢æˆï¼Œå®ƒåˆ°ä¸‰è§’å½¢ä¸‰é‚Šçš„è·é›¢æœ‰ä»€éº¼é—œä¿‚ï¼Ÿ",
                        template: `
                            <div class="text-xl bg-white p-4 rounded-lg border text-center">
                                å…§å¿ƒåˆ°ä¸‰é‚Šçš„è·é›¢çš† <span class="slot" data-ans="ç›¸ç­‰" style="width: 100px;"></span>
                            </div>`,
                        options: ["ç›¸ç­‰", "ä¸ç›¸ç­‰", "å¹³åˆ†"]
                    },
                    {
                        title: "æ­¥é©Ÿ 2ï¼šå¡«å…¥ç­”æ¡ˆ",
                        instruction: "å› ç‚ºè·é›¢ç›¸ç­‰ï¼Œåƒè€ƒé¡Œç›®çµ¦çš„æ•¸å­—ã€‚",
                        template: `
                            <div class="math math-lg bg-white p-4 rounded-lg border text-center">
                                è·é›¢ = <span class="slot" data-ans="3"></span>
                            </div>`,
                        options: ["3", "1.5", "6"] 
                    }
                ]
            },
            {
                id: 3, // åŸé¡Œç›® 1
                title: "é¡Œç›® 3ï¼šè§’åº¦è¨ˆç®—",
                type: "å¹¾ä½•è¨ˆç®—",
                desc: `
                    <div class="space-y-4">
                        <p class="text-lg">
                            å¦‚åœ–ï¼Œ<span class="math">I</span> é»ç‚º <span class="math">â–³ABC</span> çš„<mark class="highlight">å…§å¿ƒ</mark>ã€‚
                        </p>
                        <ul class="list-disc list-inside bg-white p-3 rounded-lg text-gray-700 space-y-1">
                            <li>è‹¥ <span class="math angle">BAC</span><span class="math">= 60<span class="degree"></span></span></li>
                            <li><span class="math angle">ABC</span><span class="math">= 40<span class="degree"></span></span></li>
                        </ul>
                        <p class="font-bold text-xl text-blue-700">æ±‚ <span class="math angle">AIB</span> = ?</p>
                    </div>
                `,
                svg: `
                    <svg viewBox="0 0 300 220" class="w-full h-auto drop-shadow-lg rounded-lg bg-white">
                        <defs>
                            <marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#666" />
                            </marker>
                        </defs>
                        <!-- ä¸‰è§’å½¢ -->
                        <polygon points="150,20 40,200 260,200" fill="#fff" stroke="#374151" stroke-width="2.5"/>
                        <!-- è¼”åŠ©ç·š (è™›ç·š) -->
                        <line x1="150" y1="20" x2="150" y2="140" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6,4"/>
                        <line x1="40" y1="200" x2="150" y2="140" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6,4"/>
                        <line x1="260" y1="200" x2="150" y2="140" stroke="#9ca3af" stroke-width="2" stroke-dasharray="6,4"/>
                        <!-- å…§å¿ƒé» -->
                        <circle cx="150" cy="140" r="5" fill="#ef4444"/>
                        <!-- æ¨™ç±¤ -->
                        <text x="145" y="15" font-size="20" fill="#374151">A</text>
                        <text x="20" y="210" font-size="20" fill="#374151">B</text>
                        <text x="270" y="210" font-size="20" fill="#374151">C</text>
                        <text x="160" y="140" font-size="22" font-weight="bold" fill="#ef4444">I</text>
                        <text x="130" y="55" font-size="16" fill="#2563eb" font-weight="bold">60Â°</text>
                        <text x="50" y="190" font-size="16" fill="#059669" font-weight="bold">40Â°</text>
                    </svg>
                `,
                steps: [
                    {
                        title: "æ­¥é©Ÿ 1ï¼šè¨ˆç®— âˆ BAI",
                        instruction: "å…§å¿ƒæ˜¯è§’å¹³åˆ†ç·šçš„äº¤é»ï¼Œæœƒå°‡é ‚è§’å¹³åˆ†ã€‚",
                        template: `
                            <div class="flex flex-col items-center gap-3">
                                <div class="text-gray-600 text-sm">è«‹æ‰¾å‡º âˆ A çš„ä¸€åŠ</div>
                                <div class="math math-lg bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm">
                                    <span class="angle">BAI</span> = 
                                    <div class="fraction">
                                        <span class="slot" data-ans="60"></span>
                                        <span>2</span>
                                    </div>
                                    = <span class="slot" data-ans="30"></span><span class="degree"></span>
                                </div>
                            </div>`,
                        options: ["60", "40", "30", "20"]
                    },
                    {
                        title: "æ­¥é©Ÿ 2ï¼šè¨ˆç®— âˆ ABI",
                        instruction: "åŒæ¨£çš„ï¼Œå…§å¿ƒä¹Ÿæœƒå¹³åˆ† âˆ Bã€‚",
                        template: `
                            <div class="flex flex-col items-center gap-3">
                                <div class="text-gray-600 text-sm">è«‹æ‰¾å‡º âˆ B çš„ä¸€åŠ</div>
                                <div class="math math-lg bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm">
                                    <span class="angle">ABI</span> = 
                                    <div class="fraction">
                                        <span class="slot" data-ans="40"></span>
                                        <span>2</span>
                                    </div>
                                    = <span class="slot" data-ans="20"></span><span class="degree"></span>
                                </div>
                            </div>`,
                        options: ["40", "20", "80", "10"]
                    },
                    {
                        title: "æ­¥é©Ÿ 3ï¼šè¨ˆç®— âˆ AIB",
                        instruction: "åœ¨ â–³ABI ä¸­ï¼Œåˆ©ç”¨å…§è§’å’Œ 180Â° ä¾†è¨ˆç®—ã€‚",
                        template: `
                            <div class="flex flex-col items-center gap-3">
                                <div class="text-gray-600 text-sm">180Â° æ¸›å»å¦å¤–å…©å€‹è§’</div>
                                <div class="math math-lg bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm">
                                    <span class="angle">AIB</span> = 180 - <span class="slot" data-ans="30"></span> - <span class="slot" data-ans="20"></span>
                                </div>
                                <div class="math math-lg bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm">
                                    = <span class="slot" data-ans="130"></span><span class="degree"></span>
                                </div>
                            </div>`,
                        options: ["30", "20", "130", "180"]
                    }
                ]
            }
        ];

        // --- å…¨åŸŸè®Šæ•¸ ---
        let currentProblemIdx = 0;

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            renderNav();
            loadProblem(0);
        });

        // --- æ¸²æŸ“å°è¦½åˆ— ---
        function renderNav() {
            const container = document.getElementById('nav-container');
            container.innerHTML = problems.map((p, idx) => `
                <button 
                    onclick="switchProblem(${idx})" 
                    class="nav-btn ${idx === 0 ? 'active' : ''}"
                    id="nav-${idx}">
                    ${p.title.split('ï¼š')[0]}
                </button>
            `).join('');
        }

        // --- åˆ‡æ›é¡Œç›® ---
        function switchProblem(idx) {
            currentProblemIdx = idx;
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.nav-btn').forEach((btn, i) => {
                if(i === idx) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            
            // é‡ç½®å®Œæˆè¦–çª—
            document.getElementById('completion-modal').classList.add('hidden');
            
            loadProblem(idx);
        }

        // --- è¼‰å…¥é¡Œç›®å…§å®¹ ---
        function loadProblem(idx) {
            const problem = problems[idx];
            const displayArea = document.getElementById('problem-display');
            const stepsArea = document.getElementById('steps-container');

            // 1. æ¸²æŸ“å·¦å´é¡Œç›®å€
            displayArea.innerHTML = `
                <div class="flex items-center gap-2 mb-2">
                    <span class="bg-blue-100 text-blue-800 text-sm font-bold px-2 py-1 rounded border border-blue-200">${problem.type}</span>
                </div>
                <h1 class="text-2xl font-bold mb-4 text-gray-800">${problem.title.split('ï¼š')[1]}</h1>
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-4">
                    ${problem.desc}
                </div>
                <div class="rounded-xl overflow-hidden bg-white border border-gray-200 shadow-sm transition-transform hover:scale-[1.02] duration-300">
                    ${problem.svg}
                </div>
            `;

            // 2. æ¸²æŸ“å³å´æ­¥é©Ÿå€
            stepsArea.innerHTML = ''; // æ¸…ç©º
            
            problem.steps.forEach((step, stepIndex) => {
                const stepEl = document.createElement('div');
                stepEl.className = `step-container ${stepIndex === 0 ? 'active' : ''}`;
                stepEl.id = `step-${stepIndex}`;
                
                // é¸é …æŒ‰éˆ• HTML
                const optionsHtml = step.options.map((opt, i) => 
                    `<button class="option-btn" 
                        onclick="handleOptionClick(${stepIndex}, '${opt}', this)">
                        ${opt}
                     </button>`
                ).join('');

                stepEl.innerHTML = `
                    <div class="flex items-center justify-between mb-3 border-b border-gray-100 pb-2">
                        <div class="flex items-center gap-2">
                            <span class="bg-blue-600 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold shadow-md ring-2 ring-blue-100">${stepIndex + 1}</span>
                            <h3 class="font-bold text-lg text-gray-700">${step.title}</h3>
                        </div>
                        <span class="status-icon text-green-500 font-bold hidden flex items-center gap-1 bg-green-50 px-2 py-1 rounded-lg">
                            <span>âœ”</span> å®Œæˆ
                        </span>
                    </div>
                    
                    <p class="text-gray-500 mb-4 text-base bg-blue-50/50 p-3 rounded-lg border border-blue-100/50">
                        ğŸ’¡ ${step.instruction}
                    </p>
                    
                    <div class="py-2 mb-6 text-center select-none">
                        ${step.template}
                    </div>

                    <div class="options-wrapper transition-all duration-300 overflow-hidden">
                        <div class="flex flex-wrap gap-3 justify-center" id="options-${stepIndex}">
                            ${optionsHtml}
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-center h-12">
                        <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-8 rounded-full shadow-lg shadow-green-500/30 transition transform active:scale-95 hidden flex items-center gap-2 text-lg" 
                            id="check-btn-${stepIndex}" 
                            onclick="checkStep(${stepIndex})">
                            <span>âœ¨</span> æª¢æŸ¥ç­”æ¡ˆ
                        </button>
                    </div>
                `;
                stepsArea.appendChild(stepEl);
            });

            // ç¶å®š Slot é»æ“Šæ¸…é™¤äº‹ä»¶ (ä½¿ç”¨äº‹ä»¶å§”æ´¾)
            stepsArea.querySelectorAll('.slot').forEach(slot => {
                slot.addEventListener('click', function() {
                    if (this.classList.contains('correct')) return; // å·²æ­£ç¢ºé–å®š
                    
                    const val = this.innerText;
                    if (val) {
                        this.innerText = '';
                        this.classList.remove('filled');
                        // æ¢å¾©å°æ‡‰æŒ‰éˆ•
                        const stepIdx = this.closest('.step-container').id.split('-')[1];
                        const btn = Array.from(document.querySelectorAll(`#options-${stepIdx} .option-btn`))
                            .find(b => b.innerText === val && b.disabled);
                        if (btn) btn.disabled = false;

                        // éš±è—æª¢æŸ¥æŒ‰éˆ•
                        document.getElementById(`check-btn-${stepIdx}`).classList.add('hidden');
                    }
                });
            });
        }

        // --- äº’å‹•é‚è¼¯ï¼šé»æ“Šé¸é … ---
        function handleOptionClick(stepIndex, value, btnElement) {
            const stepEl = document.getElementById(`step-${stepIndex}`);
            const slots = Array.from(stepEl.querySelectorAll('.slot'));
            
            // æ‰¾åˆ°è©²æ­¥é©Ÿä¸­ã€Œç¬¬ä¸€å€‹å°šæœªå¡«å¯«ã€çš„ç©ºæ ¼
            const emptySlot = slots.find(s => s.innerText === '');
            
            if (emptySlot) {
                // å¡«å…¥æ•¸å€¼
                emptySlot.innerText = value;
                emptySlot.classList.add('filled');
                
                // å‹•ç•«æ•ˆæœ
                emptySlot.animate([
                    { transform: 'scale(1.2)' },
                    { transform: 'scale(1)' }
                ], { duration: 200 });

                // ç¦ç”¨æŒ‰éˆ•
                btnElement.disabled = true;

                // æª¢æŸ¥æ˜¯å¦å¡«æ»¿æ‰€æœ‰ç©ºæ ¼
                const allFilled = slots.every(s => s.innerText !== '');
                if (allFilled) {
                    const checkBtn = document.getElementById(`check-btn-${stepIndex}`);
                    checkBtn.classList.remove('hidden');
                    checkBtn.classList.add('pop-in');
                    // è‡ªå‹•æ²å‹•è®“æŒ‰éˆ•å¯è¦‹
                    checkBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            } else {
                showToast("ç©ºæ ¼éƒ½å¡«æ»¿å›‰ï¼è«‹å…ˆæŒ‰æª¢æŸ¥ï¼Œæˆ–é»æ“Šç©ºæ ¼æ¸…é™¤ã€‚");
            }
        }

        // --- äº’å‹•é‚è¼¯ï¼šæª¢æŸ¥ç­”æ¡ˆ ---
        function checkStep(stepIndex) {
            const stepEl = document.getElementById(`step-${stepIndex}`);
            const slots = stepEl.querySelectorAll('.slot');
            let isAllCorrect = true;

            slots.forEach(slot => {
                if (slot.innerText.trim() === slot.dataset.ans) {
                    slot.classList.add('correct');
                    slot.classList.remove('filled');
                } else {
                    isAllCorrect = false;
                    slot.classList.add('animate-tada');
                    // ç´…è‰²é–ƒçˆ
                    slot.style.borderColor = '#ef4444';
                    slot.style.color = '#ef4444';
                    setTimeout(() => { 
                        slot.classList.remove('animate-tada');
                        slot.style.borderColor = ''; 
                        slot.style.color = '';
                    }, 1000);
                }
            });

            if (isAllCorrect) {
                // 1. UI è®Šæ›´ï¼šéš±è—æŒ‰éˆ•èˆ‡é¸é …
                const checkBtn = document.getElementById(`check-btn-${stepIndex}`);
                checkBtn.innerHTML = "<span>ğŸ‰</span> æ­£ç¢ºï¼";
                checkBtn.classList.replace('bg-green-500', 'bg-gray-300');
                checkBtn.disabled = true;
                setTimeout(() => checkBtn.classList.add('hidden'), 1000);

                const optionsDiv = document.getElementById(`options-${stepIndex}`);
                optionsDiv.style.opacity = '0';
                optionsDiv.style.height = '0';
                
                stepEl.querySelector('.status-icon').classList.remove('hidden');
                stepEl.classList.add('done');
                
                // 2. è§£é–ä¸‹ä¸€æ­¥
                const nextStep = document.getElementById(`step-${stepIndex + 1}`);
                if (nextStep) {
                    setTimeout(() => {
                        nextStep.classList.add('active');
                        nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 600);
                } else {
                    // å…¨éƒ¨å®Œæˆ
                    setTimeout(() => {
                        showCompletionModal();
                    }, 800);
                }
            } else {
                showToast("æœ‰åœ°æ–¹æ€ªæ€ªçš„ï¼Œå†æª¢æŸ¥ä¸€ä¸‹ï¼");
            }
        }

        // --- è¼”åŠ©åŠŸèƒ½ï¼šToast æç¤º ---
        let toastTimeout;
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // --- è¼”åŠ©åŠŸèƒ½ï¼šå®Œæˆè¦–çª— ---
        function showCompletionModal() {
            const modal = document.getElementById('completion-modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            // å°å»¶é²è®“ display:block ç”Ÿæ•ˆå¾Œå†è·‘ opacity
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                content.classList.replace('scale-95', 'scale-100');
            }, 10);
            
            // æ’’èŠ±ç‰¹æ•ˆ (ç°¡å–®ç‰ˆ)
            createConfetti();
        }

        function closeModal() {
            const modal = document.getElementById('completion-modal');
            const content = document.getElementById('modal-content');
            modal.classList.add('opacity-0');
            content.classList.replace('scale-100', 'scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function resetCurrentProblem() {
            closeModal();
            setTimeout(() => {
                loadProblem(currentProblemIdx);
            }, 300);
        }

        function createConfetti() {
            // ç°¡å–®çš„æ’’èŠ±ç‰¹æ•ˆé‚è¼¯å¯åœ¨æ­¤æ“´å……ï¼Œç›®å‰ä»¥ emoji ä»£æ›¿
        }

    </script>
</body>
</html>