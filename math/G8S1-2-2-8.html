<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>步驟化學習：同類方根的合併</title>
    <link rel="icon" href="dog.png" type="image/png">
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 KaTeX 數學字型函式庫 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3NU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzQC9Tj+vBWPxIeG+YiwLTAoQAyYxzGMMId" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURPlLJSytFmsNldqaIFAdj7sdMzoVnwUjM/rN6RIIKYEtdMdcUAejs" crossorigin="anonymous"></script>
    
    <!-- 引入 Chiron GoRound TC 字型 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: "Chiron GoRound TC", sans-serif;
        font-weight: 400;
        font-style: normal;
        line-height: 1.8;
        background-color: #f8fafc;
      }
      
      /* 關鍵字螢光筆效果 */
      .highlight {
        background: linear-gradient(to top, #fef08a 50%, transparent 50%);
        padding: 0 0.2rem;
        border-radius: 3px;
      }

      /* 新增：紅色螢光筆 */
      .highlight-red {
        background: linear-gradient(to top, #fecaca 50%, transparent 50%); /* red-200 */
        padding: 0 0.2rem;
        border-radius: 3px;
      }
      
      /* 新增：藍色螢光筆 */
      .highlight-blue {
        background: linear-gradient(to top, #bfdbfe 50%, transparent 50%); /* blue-200 */
        padding: 0 0.2rem;
        border-radius: 3px;
      }

      /* 新增：球的樣式 */
      .ball {
          display: inline-block;
          width: 1.4rem;  /* 調整大小以符合文字 */
          height: 1.4rem;
          background-color: #3b82f6; /* 藍色 */
          border-radius: 50%;
          margin: 0 0.25rem;
          vertical-align: middle; /* 垂直置中 */
          transform: translateY(-2px); /* 稍微往下移一點對齊文字 */
      }
      
      /* 新增：紅色球的樣式 */
      .ball-red {
          background-color: #ef4444; /* 紅色 */
      }
      
      /* 步驟容器 */
      .step-container {
          background-color: white;
          border-radius: 0.75rem;
          border: 1px solid #e2e8f0;
          padding: 1.5rem;
          transition: all 0.3s ease-in-out;
          box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
          /* 加上動畫，讓步驟出現更流暢 */
          animation: fadeIn 0.5s ease-in-out;
      }
      
      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      /* 隱藏的步驟 */
      .step-hidden {
          display: none;
      }
      
      /* 導覽列按鈕 */
      .nav-btn {
          padding: 0.5rem 1rem;
          font-weight: 600;
          border-radius: 0.5rem;
          background-color: #e2e8f0;
          color: #475569;
          transition: all 0.2s;
          cursor: pointer;
      }
      .nav-btn:hover {
          background-color: #cbd5e1;
      }
      /* 導覽列啟用中按鈕 */
      .nav-btn-active {
          background-color: #3b82f6;
          color: white;
      }
      .nav-btn-active:hover {
          background-color: #2563eb;
      }

      /* 下一步按鈕 */
      .next-btn {
          background-color: #3b82f6; /* 藍色 */
          color: white;
          font-weight: 600;
          padding: 0.6rem 1.5rem;
          border-radius: 0.5rem;
          transition: background-color 0.2s;
          border: none;
          cursor: pointer;
      }
      .next-btn:hover {
          background-color: #2563eb;
      }
      .next-btn:disabled {
          background-color: #9ca3af;
          cursor: not-allowed;
          opacity: 0.7;
      }
      
      /* 最終按鈕 */
      .finish-btn {
           background-color: #10b981; /* 綠色 */
      }
      .finish-btn:hover {
           background-color: #059669;
      }
      
      /* 題目顯示區 */
      .katex-display-area {
          font-size: 2.25rem; 
          color: #1e293b;
          padding: 1.5rem;
          background-color: #f1f5f9;
          border-radius: 0.5rem;
          text-align: center;
          margin-bottom: 1rem;
          overflow-x: auto;
      }
      
      .step-title {
          font-size: 1.5rem;
          font-weight: 700;
          color: #1e293b;
          margin-bottom: 0.25rem;
      }
      
      .step-progress {
          font-size: 0.9rem;
          font-weight: 600;
          color: #64748b;
          margin-bottom: 1rem;
      }
      
      .step-instruction {
          color: #334155;
          font-size: 1.1rem;
          line-height: 1.8;
          margin-bottom: 1.5rem;
      }

    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4 md:p-8">

    <main class="w-full max-w-3xl bg-white rounded-xl shadow-lg p-6 md:p-10 space-y-8 mb-20">
        
        <!-- 導覽列 -->
        <nav class="flex justify-center flex-wrap gap-2 mb-8" id="nav-container">
            <button class="nav-btn" data-question-index="0">第 1 題</button>
            <button class="nav-btn" data-question-index="1">第 2 題</button>
            <button class="nav-btn" data-question-index="2">第 3 題</button>
            <button class="nav-btn" data-question-index="3">第 4 題</button>
            <button class="nav-btn" data-question-index="4">第 5 題</button>
            <button class="nav-btn" data-question-index="5">第 6 題</button>
            <button class="nav-btn" data-question-index="6">第 7 題</button>
            <button class="nav-btn" data-question-index="7">第 8 題</button>
            <button class="nav-btn" data-question-index="8">第 9 題</button>
            <button class="nav-btn" data-question-index="9">第 10 題</button>
            <button class="nav-btn" data-question-index="10">第 11 題</button>
            <!-- ===== 新增的按鈕 ===== -->
            <button class="nav-btn" data-question-index="11">第 12 題</button>
            <button class="nav-btn" data-question-index="12">第 13 題</button>
            <button class="nav-btn" data-question-index="13">第 14 題</button>
            <button class="nav-btn" data-question-index="14">第 15 題</button>
            <!-- ===================== -->
        </nav>

        <header class="text-center my-8">
            <h1 class="text-4xl font-bold text-slate-800">八、同類方根的合併</h1>
            <p class="text-lg text-slate-500 mt-2">點選範例，逐步查看計算過程</p>
        </header>

        <!-- 題目顯示區 (動態載入) -->
        <div class="katex-display-area" id="problem-area">
            <!-- JS will fill this -->
        </div>

        <!-- 動態概念區塊 (JS will fill this) -->
        <!-- 已移到題目下方 -->
        <div id="concept-area"></div>
        <!-- 概念區塊結束 -->

        <!-- 逐步解題容器 (動態載入) -->
        <div class="space-y-6" id="steps-container">
            <!-- JS will fill this -->
        </div>
            
        <!-- 完成訊息 -->
        <div id="completion-message" class="text-center mt-8 p-6 bg-green-100 border-2 border-green-400 rounded-lg step-hidden">
            <h2 class="text-3xl font-bold text-green-700">恭喜你，完成練習！</h2>
            <p class="mt-2 text-green-600 text-lg">你已經學會這題「同類方根合併」的技巧了！</p>
            <button id="next-question-btn" class="mt-4 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg transition-colors text-lg">
                下一題
            </button>
        </div>


    </main>

    <!-- 頁尾固定區塊 -->
    <footer class="fixed bottom-0 left-0 w-full text-center text-gray-400 text-sm bg-white bg-opacity-80 py-2 border-t border-gray-200 backdrop-blur-sm">
        © 2025 特教米克師｜採用 
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="text-sky-600 hover:underline">
            CC BY-NC-SA 4.0 創用CC授權
        </a>｜非商業用途歡迎轉載或改編，請保留署名並附上原始連結。
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        
        const katexOptions = {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            throwOnError: false
        };
        
        // --- 輔助函數：產生「想像一下」的 HTML ---
        function getConceptHtml(radicand, text, calcHtml) {
            // radicand: '2'
            // text: '那麼 $\\sqrt{2} + 3\\sqrt{2}$ 就等於...'
            // calcHtml: '<span> 1 顆 <span class="ball"></span></span> ...'
            return `
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-5 rounded-lg space-y-2 mb-8" style="animation: fadeIn 0.5s ease-in-out;">
                <h2 class="text-xl font-bold text-yellow-800 mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M12 21v-1m0-8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"></path>
                    </svg>
                    想像一下：把方根當作「同類型的球」
                </h2>
                <p class="text-lg text-slate-700">
                    把 $\\sqrt{${radicand}}$ 想像成 1 <span class="ball"></span>。
                </p>
                <p class="text-lg text-slate-700">
                    ${text}
                </p>
                <div class="text-2xl font-bold text-center py-2 flex items-center justify-center flex-wrap gap-2">
                    ${calcHtml}
                </div>
                <p class="text-lg text-slate-700">
                    <span class="highlight">重點：</span>只有「同一種類型」（根號內數字相同）的球，才能放在一起計算數量！
                </p>
            </div>`;
        }

        // --- 輔助函數：第 6 題專用的 HTML (不同種球) ---
        function getConceptHtmlQ6() {
            return `
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-5 rounded-lg space-y-2 mb-8" style="animation: fadeIn 0.5s ease-in-out;">
                <h2 class="text-xl font-bold text-yellow-800 mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M12 21v-1m0-8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"></path>
                    </svg>
                    想像一下：不同種類的球
                </h2>
                <p class="text-lg text-slate-700">
                    把 $\\sqrt{3}$ 想像成 1 <span class="ball"></span>。
                </p>
                <p class="text-lg text-slate-700">
                    把 $\\sqrt{2}$ 想像成 1 <span class="ball ball-red"></span> (紅球)。
                </p>
                <p class="text-lg text-slate-700">
                    那麼 $2\\sqrt{3} - \\sqrt{2} + \\sqrt{3}$ 就等於...
                </p>
                <div class="text-2xl font-bold text-center py-2 flex items-center justify-center flex-wrap gap-2">
                    <span> 2 <span class="ball"></span></span>
                    <span class="mx-1"> - </span>
                    <span> 1 <span class="ball ball-red"></span></span>
                    <span class="mx-1"> + </span>
                    <span> 1 <span class="ball"></span></span>
                </div>
                <p class="text-lg text-slate-700">
                    <span class="highlight">重點：</span>我們只能合併<span class="ball"></span>(藍球)，<span class="ball ball-red"></span>(紅球)要分開算！
                </p>
            </div>`;
        }
        
        // --- 輔助函數：多種球 (Q7, Q8) ---
        function getConceptHtmlTwoTypes(rad1, rad2, ball1Name, ball2Name, text, calcHtml) {
            return `
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-5 rounded-lg space-y-2 mb-8" style="animation: fadeIn 0.5s ease-in-out;">
                <h2 class="text-xl font-bold text-yellow-800 mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M12 21v-1m0-8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"></path>
                    </svg>
                    想像一下：不同種類的球
                </h2>
                <p class="text-lg text-slate-700">
                    把 $\\sqrt{${rad1}}$ 想像成 1 <span class="ball"></span> (${ball1Name})。
                </p>
                <p class="text-lg text-slate-700">
                    把 $\\sqrt{${rad2}}$ 想像成 1 <span class="ball ball-red"></span> (${ball2Name})。
                </p>
                <p class="text-lg text-slate-700">
                    ${text}
                </p>
                <div class="text-2xl font-bold text-center py-2 flex items-center justify-center flex-wrap gap-2">
                    ${calcHtml}
                </div>
                <p class="text-lg text-slate-700">
                    <span class="highlight">重點：</span>同種球（<span class="ball"></span>）跟同種球合併，不同種球（<span class="ball ball-red"></span>）要分開！
                </p>
            </div>`;
        }

        // --- 輔助函數：需要化簡 (Q9, Q10, Q11) ---
        function getConceptHtmlSimplify(text) {
             return `
            <div class="bg-blue-50 border-l-4 border-blue-400 p-5 rounded-lg space-y-2 mb-8" style="animation: fadeIn 0.5s ease-in-out;">
                <h2 class="text-xl font-bold text-blue-800 mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                         <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                    </svg>
                    注意：需要先化簡！
                </h2>
                <p class="text-lg text-slate-700">
                    ${text}
                </p>
                <p class="text-lg text-slate-700">
                    <span class="highlight">重點：</span>一定要先把所有方根化為「最簡根式」，才能正確找出同類方根！
                </p>
            </div>`;
        }


        // --- 1. 定義所有學習步驟 ---
        const questions = [
          { // 範例 1
            problemKatex: "$$\\sqrt{2} + 3\\sqrt{2}$$",
            conceptHtml: getConceptHtml('2', 
              '那麼 $\\sqrt{2} + 3\\sqrt{2}$ 就等於...', 
              '<span> 1 <span class="ball"></span></span> <span class="mx-1"> + </span> <span> 3 <span class="ball"></span></span> <span class="mx-1"> = </span> <span> 4 <span class="ball"></span></span>'
            ),
            steps: [
              {
                title: "步驟一：合併同類方根",
                instruction: "它們都是 $\\sqrt{2}$ (同類方根)，就像 1 顆<span class='ball'></span> 和 3 顆<span class='ball'></span>。<br>我們可以直接把外面的係數相加。",
                katexDisplay: "$$(1 + 3)\\sqrt{2}$$"
              },
              {
                title: "步驟二：寫下答案",
                instruction: "計算結果：",
                katexDisplay: "$$4\\sqrt{2}$$"
              }
            ]
          },
          { // 範例 2
            problemKatex: "$$2\\sqrt{5} + \\sqrt{5}$$",
            conceptHtml: getConceptHtml('5',
              '那麼 $2\\sqrt{5} + \\sqrt{5}$ 就等於...',
              '<span> 2 <span class="ball"></span></span> <span class="mx-1"> + </span> <span> 1 <span class="ball"></span></span> <span class="mx-1"> = </span> <span> 3 <span class="ball"></span></span>'
            ),
            steps: [
              {
                title: "步驟一：合併同類方根",
                instruction: "它們都是 $\\sqrt{5}$ (同類方根)。<br>我們可以直接把外面的係數 $2$ 和 $1$ 相加。",
                katexDisplay: "$$(2 + 1)\\sqrt{5}$$"
              },
              {
                title: "步驟二：寫下答案",
                instruction: "計算結果：",
                katexDisplay: "$$3\\sqrt{5}$$"
              }
            ]
          },
          { // 範例 3
            problemKatex: "$$12\\sqrt{6} - 4\\sqrt{6}$$",
            conceptHtml: getConceptHtml('6',
              '那麼 $12\\sqrt{6} - 4\\sqrt{6}$ 就等於...',
              '<span> 12 <span class="ball"></span></span> <span class="mx-1"> - </span> <span> 4 <span class="ball"></span></span> <span class="mx-1"> = </span> <span> 8 <span class="ball"></span></span>'
            ),
            steps: [
              {
                title: "步驟一：合併同類方根",
                instruction: "它們都是 $\\sqrt{6}$ (同類方根)。<br>我們可以直接把外面的係數 $12$ 和 $4$ 相減。",
                katexDisplay: "$$(12 - 4)\\sqrt{6}$$"
              },
              {
                title: "步驟二：寫下答案",
                instruction: "計算結果：",
                katexDisplay: "$$8\\sqrt{6}$$"
              }
            ]
          },
          { // 範例 4
            problemKatex: "$$9\\sqrt{7} - 17\\sqrt{7}$$",
            conceptHtml: getConceptHtml('7',
              '那麼 $9\\sqrt{7} - 17\\sqrt{7}$ 就等於...',
              '<span> 9 <span class="ball"></span></span> <span class="mx-1"> - </span> <span> 17 <span class="ball"></span></span> <span class="mx-1"> = </span> <span> -8 <span class="ball"></span></span>'
            ),
            steps: [
              {
                title: "步驟一：合併同類方根",
                instruction: "它們都是 $\\sqrt{7}$ (同類方根)。<br>我們可以直接把外面的係數 $9$ 和 $17$ 相減。",
                katexDisplay: "$$(9 - 17)\\sqrt{7}$$"
              },
              {
                title: "步驟二：寫下答案",
                instruction: "計算結果：",
                katexDisplay: "$$-8\\sqrt{7}$$"
              }
            ]
          },
          { // 範例 5
            problemKatex: "$$-\\sqrt{2} - \\sqrt{2} + 4\\sqrt{2}$$",
            conceptHtml: getConceptHtml('2',
              '那麼 $-\\sqrt{2} - \\sqrt{2} + 4\\sqrt{2}$ 就等於...',
              '<span> -1 <span class="ball"></span></span> <span class="mx-1"> - </span> <span> 1 <span class="ball"></span></span> <span class="mx-1"> + </span> <span> 4 <span class="ball"></span></span> <span class="mx-1"> = </span> <span> 2 <span class="ball"></span></span>'
            ),
            steps: [
              {
                title: "步驟一：合併同類方根",
                instruction: "它們都是 $\\sqrt{2}$ (同類方根)。<br>我們可以直接把外面的係數 $-1$、$-1$ 和 $4$ 相加。",
                katexDisplay: "$$(-1 - 1 + 4)\\sqrt{2}$$"
              },
              {
                title: "步驟二：計算係數",
                instruction: "先計算 $-1 - 1 = -2$：",
                katexDisplay: "$$(-2 + 4)\\sqrt{2}$$"
              },
              {
                title: "步驟三：寫下答案",
                instruction: "計算結果：",
                katexDisplay: "$$2\\sqrt{2}$$"
              }
            ]
          },
          { // 範例 6
            problemKatex: "$$2\\sqrt{3} - \\sqrt{2} + \\sqrt{3}$$",
            conceptHtml: null, // 從第六題開始移除概念卡
            steps: [
              {
                title: "步驟一：找出同類方根",
                instruction: "注意！只有 <span class='highlight'>$2\\sqrt{3}$</span> 和 <span class='highlight'>$\\sqrt{3}$</span> 是同類方根。<br> <span class='highlight-red'>$\\sqrt{2}$</span> 和它們不同類，不能一起算。",
                katexDisplay: "$$2\\sqrt{3} - \\sqrt{2} + \\sqrt{3}$$"
              },
              {
                title: "步驟二：重新排序",
                instruction: "我們先把同類的放在一起。",
                katexDisplay: "$$(2\\sqrt{3} + \\sqrt{3}) - \\sqrt{2}$$"
              },
              {
                title: "步驟三：寫下答案",
                instruction: "將 <span class='highlight'>$2\\sqrt{3}$</span> 和 <span class='highlight'>$\\sqrt{3}$</span> 合併 (2+1=3)，不同類的 <span class='highlight-red'>$\\sqrt{2}$</span> 照抄。",
                katexDisplay: "$$3\\sqrt{3} - \\sqrt{2}$$"
              }
            ]
          },
          { // 範例 7
            problemKatex: "$$-\\sqrt{7} - \\sqrt{2} + 4\\sqrt{7}$$",
            conceptHtml: null, // 移除概念卡
            steps: [
              {
                title: "步驟一：找出同類方根",
                instruction: "只有 <span class='highlight'>$-\\sqrt{7}$</span> 和 <span class='highlight'>$4\\sqrt{7}$</span> 是同類方根。<br> <span class='highlight-red'>$\\sqrt{2}$</span> 和它們不同類，要放旁邊。",
                katexDisplay: "$$-\\sqrt{7} - \\sqrt{2} + 4\\sqrt{7}$$"
              },
              {
                title: "步驟二：重新排序",
                instruction: "我們先把同類的放在一起。",
                katexDisplay: "$$(-\\sqrt{7} + 4\\sqrt{7}) - \\sqrt{2}$$"
              },
              {
                title: "步驟三：寫下答案",
                instruction: "將 <span class='highlight'>$-\\sqrt{7}$</span> 和 <span class='highlight'>$4\\sqrt{7}$</span> 合併 (-1+4=3)，不同類的 <span class='highlight-red'>$\\sqrt{2}$</span> 照抄。",
                katexDisplay: "$$3\\sqrt{7} - \\sqrt{2}$$"
              }
            ]
          },
          { // 範例 8
            problemKatex: "$$\\sqrt{3} - \\sqrt{5} + 2\\sqrt{5} + 6\\sqrt{3}$$",
            conceptHtml: null, // 移除概念卡
            steps: [
              {
                title: "步驟一：找出同類方根",
                instruction: "<span class='highlight'>$\\sqrt{3}$</span> 和 <span class='highlight'>$6\\sqrt{3}$</span> 是同類。<br> <span class='highlight-red'>$-\\sqrt{5}$</span> 和 <span class='highlight-red'>$2\\sqrt{5}$</span> 是另一組同類。",
                katexDisplay: "$$\\sqrt{3} - \\sqrt{5} + 2\\sqrt{5} + 6\\sqrt{3}$$"
              },
              {
                title: "步驟二：重新排序",
                instruction: "我們把 <span class='highlight'>$\\sqrt{3}$</span> 放一起，<span class='highlight-red'>$\\sqrt{5}$</span> 放一起。",
                katexDisplay: "$$(\\sqrt{3} + 6\\sqrt{3}) + (-\\sqrt{5} + 2\\sqrt{5})$$"
              },
              {
                title: "步驟三：寫下答案",
                instruction: "分別合併：<br><span class='highlight'>$(\\sqrt{3} + 6\\sqrt{3}) = 7\\sqrt{3}$</span>。<br><span class='highlight-red'>$(-\\sqrt{5} + 2\\sqrt{5}) = \\sqrt{5}$</span>。",
                katexDisplay: "$$7\\sqrt{3} + \\sqrt{5}$$"
              }
            ]
          },
          { // 範例 9
            problemKatex: "$$9\\sqrt{3} + 7\\sqrt{12}$$",
            conceptHtml: null, // 移除概念卡
            steps: [
              {
                title: "步驟一：找出需化簡的方根",
                instruction: "注意！<span class='highlight-red'>$\\sqrt{12}$</span> 不是最簡根式，要先化簡。",
                katexDisplay: "$$9\\sqrt{3} + 7\\sqrt{12}$$"
              },
              {
                title: "步驟二：化簡 $\\sqrt{12}$",
                instruction: "$\\sqrt{12} = \\sqrt{4 \\times 3} = \\sqrt{4} \\times \\sqrt{3} = 2\\sqrt{3}$",
                katexDisplay: "$$9\\sqrt{3} + 7(2\\sqrt{3})$$"
              },
              {
                title: "步驟三：乘開",
                instruction: "計算 $7 \\times (2\\sqrt{3}) = 14\\sqrt{3}$。",
                katexDisplay: "$$9\\sqrt{3} + 14\\sqrt{3}$$"
              },
              {
                title: "步驟四：寫下答案",
                instruction: "合併同類方根 <span class='highlight'>$9\\sqrt{3}$</span> 和 <span class='highlight'>$14\\sqrt{3}$</span> (9+14=23)。",
                katexDisplay: "$$23\\sqrt{3}$$"
              }
            ]
          },
          { // 範例 10
            problemKatex: "$$-7\\sqrt{18} + 5\\sqrt{2}$$",
            conceptHtml: null, // 移除概念卡
            steps: [
              {
                title: "步驟一：找出需化簡的方根",
                instruction: "注意！<span class='highlight-red'>$\\sqrt{18}$</span> 不是最簡根式，要先化簡。",
                katexDisplay: "$$-7\\sqrt{18} + 5\\sqrt{2}$$"
              },
              {
                title: "步驟二：化簡 $\\sqrt{18}$",
                instruction: "$\\sqrt{18} = \\sqrt{9 \\times 2} = \\sqrt{9} \\times \\sqrt{2} = 3\\sqrt{2}$",
                katexDisplay: "$$-7(3\\sqrt{2}) + 5\\sqrt{2}$$"
              },
              {
                title: "步驟三：乘開",
                instruction: "計算 $-7 \\times (3\\sqrt{2}) = -21\\sqrt{2}$。",
                katexDisplay: "$$-21\\sqrt{2} + 5\\sqrt{2}$$"
              },
              {
                title: "步驟四：寫下答案",
                instruction: "合併同類方根 <span class='highlight'>$-21\\sqrt{2}$</span> 和 <span class='highlight'>$5\\sqrt{2}$</span> (-21+5=-16)。",
                katexDisplay: "$$-16\\sqrt{2}$$"
              }
            ]
          },
          { // 範例 11
            problemKatex: "$$\\sqrt{45} + \\sqrt{20}$$",
            conceptHtml: null, // 移除概念卡
            steps: [
              {
                title: "步驟一：找出需化簡的方根",
                instruction: "注意！<span class='highlight-red'>$\\sqrt{45}$</span> 和 <span class='highlight-blue'>$\\sqrt{20}$</span> 都不是最簡根式。",
                katexDisplay: "$$\\sqrt{45} + \\sqrt{20}$$"
              },
              {
                title: "步驟二：化簡 $\\sqrt{45}$",
                instruction: "$\\sqrt{45} = \\sqrt{9 \\times 5} = \\sqrt{9} \\times \\sqrt{5} = 3\\sqrt{5}$",
                katexDisplay: "$$3\\sqrt{5} + \\sqrt{20}$$"
              },
              {
                title: "步驟三：化簡 $\\sqrt{20}$",
                instruction: "$\\sqrt{20} = \\sqrt{4 \\times 5} = \\sqrt{4} \\times \\sqrt{5} = 2\\sqrt{5}$",
                katexDisplay: "$$3\\sqrt{5} + 2\\sqrt{5}$$"
              },
              {
                title: "步驟四：寫下答案",
                instruction: "合併同類方根 <span class='highlight'>$3\\sqrt{5}$</span> 和 <span class='highlight'>$2\\sqrt{5}$</span> (3+2=5)。",
                katexDisplay: "$$5\\sqrt{5}$$"
              }
            ]
          },
        // ===== 新增的題目從這裡開始 =====
          { // 範例 12
            problemKatex: "$$\\frac{6}{\\sqrt{3}} - \\sqrt{27}$$",
            conceptHtml: null,
            steps: [
              {
                title: "步驟一：分析題目",
                instruction: "注意！<span class='highlight-red'>$\\frac{6}{\\sqrt{3}}$</span> 需要有理化分母，<span class='highlight-blue'>$\\sqrt{27}$</span> 需要化簡。",
                katexDisplay: "$$\\frac{6}{\\sqrt{3}} - \\sqrt{27}$$"
              },
              {
                title: "步驟二：有理化分母",
                instruction: "$\\frac{6}{\\sqrt{3}} = \\frac{6 \\times \\sqrt{3}}{\\sqrt{3} \\times \\sqrt{3}} = \\frac{6\\sqrt{3}}{3} = 2\\sqrt{3}$",
                katexDisplay: "$$2\\sqrt{3} - \\sqrt{27}$$"
              },
              {
                title: "步驟三：化簡根式",
                instruction: "$\\sqrt{27} = \\sqrt{9 \\times 3} = \\sqrt{9} \\times \\sqrt{3} = 3\\sqrt{3}$",
                katexDisplay: "$$2\\sqrt{3} - 3\\sqrt{3}$$"
              },
              {
                title: "步驟四：寫下答案",
                instruction: "合併同類方根 <span class='highlight'>$2\\sqrt{3}$</span> 和 <span class='highlight'>$-3\\sqrt{3}$</span> (2-3=-1)。",
                katexDisplay: "$$-\\sqrt{3}$$"
              }
            ]
          },
          { // 範例 13
            problemKatex: "$$\\frac{6}{\\sqrt{2}} + \\sqrt{32}$$",
            conceptHtml: null,
            steps: [
              {
                title: "步驟一：分析題目",
                instruction: "注意！<span class='highlight-red'>$\\frac{6}{\\sqrt{2}}$</span> 需要有理化分母，<span class='highlight-blue'>$\\sqrt{32}$</span> 需要化簡。",
                katexDisplay: "$$\\frac{6}{\\sqrt{2}} + \\sqrt{32}$$"
              },
              {
                title: "步驟二：有理化分母",
                instruction: "$\\frac{6}{\\sqrt{2}} = \\frac{6 \\times \\sqrt{2}}{\\sqrt{2} \\times \\sqrt{2}} = \\frac{6\\sqrt{2}}{2} = 3\\sqrt{2}$",
                katexDisplay: "$$3\\sqrt{2} + \\sqrt{32}$$"
              },
              {
                title: "步驟三：化簡根式",
                instruction: "$\\sqrt{32} = \\sqrt{16 \\times 2} = \\sqrt{16} \\times \\sqrt{2} = 4\\sqrt{2}$",
                katexDisplay: "$$3\\sqrt{2} + 4\\sqrt{2}$$"
              },
              {
                title: "步驟四：寫下答案",
                instruction: "合併同類方根 <span class='highlight'>$3\\sqrt{2}$</span> 和 <span class='highlight'>$4\\sqrt{2}$</span> (3+4=7)。",
                katexDisplay: "$$7\\sqrt{2}$$"
              }
            ]
          },
          { // 範例 14
            problemKatex: "$$\\sqrt{8} + \\sqrt{2} - \\sqrt{18}$$",
            conceptHtml: null,
            steps: [
              {
                title: "步驟一：分析題目",
                instruction: "注意！<span class='highlight-red'>$\\sqrt{8}$</span> 和 <span class='highlight-blue'>$\\sqrt{18}$</span> 都需要化簡。",
                katexDisplay: "$$\\sqrt{8} + \\sqrt{2} - \\sqrt{18}$$"
              },
              {
                title: "步驟二：化簡 $\\sqrt{8}$",
                instruction: "$\\sqrt{8} = \\sqrt{4 \\times 2} = \\sqrt{4} \\times \\sqrt{2} = 2\\sqrt{2}$",
                katexDisplay: "$$2\\sqrt{2} + \\sqrt{2} - \\sqrt{18}$$"
              },
              {
                title: "步驟三：化簡 $\\sqrt{18}$",
                instruction: "$\\sqrt{18} = \\sqrt{9 \\times 2} = \\sqrt{9} \\times \\sqrt{2} = 3\\sqrt{2}$",
                katexDisplay: "$$2\\sqrt{2} + \\sqrt{2} - 3\\sqrt{2}$$"
              },
              {
                title: "步驟四：寫下答案",
                instruction: "全部都是 $\\sqrt{2}$ 同類方根。合併係數 (2 + 1 - 3 = 0)。",
                katexDisplay: "$$(2 + 1 - 3)\\sqrt{2} = 0$$"
              }
            ]
          },
          { // 範例 15
            problemKatex: "$$\\frac{40}{\\sqrt{5}} - \\frac{10}{\\sqrt{2}} + \\sqrt{20}$$",
            conceptHtml: null,
            steps: [
              {
                title: "步驟一：分析題目",
                instruction: "這題比較複雜！<span class='highlight'>$\\frac{40}{\\sqrt{5}}$</span>、<span class='highlight-red'>$\\frac{10}{\\sqrt{2}}$</span> 需有理化，<span class='highlight-blue'>$\\sqrt{20}$</span> 需化簡。",
                katexDisplay: "$$\\frac{40}{\\sqrt{5}} - \\frac{10}{\\sqrt{2}} + \\sqrt{20}$$"
              },
              {
                title: "步驟二：有理化 $\\frac{40}{\\sqrt{5}}$",
                instruction: "$\\frac{40}{\\sqrt{5}} = \\frac{40 \\times \\sqrt{5}}{\\sqrt{5} \\times \\sqrt{5}} = \\frac{40\\sqrt{5}}{5} = 8\\sqrt{5}$",
                katexDisplay: "$$8\\sqrt{5} - \\frac{10}{\\sqrt{2}} + \\sqrt{20}$$"
              },
              {
                title: "步驟三：有理化 $\\frac{10}{\\sqrt{2}}$",
                instruction: "$\\frac{10}{\\sqrt{2}} = \\frac{10 \\times \\sqrt{2}}{\\sqrt{2} \\times \\sqrt{2}} = \\frac{10\\sqrt{2}}{2} = 5\\sqrt{2}$",
                katexDisplay: "$$8\\sqrt{5} - 5\\sqrt{2} + \\sqrt{20}$$"
              },
               {
                title: "步驟四：化簡 $\\sqrt{20}$",
                instruction: "$\\sqrt{20} = \\sqrt{4 \\times 5} = \\sqrt{4} \\times \\sqrt{5} = 2\\sqrt{5}$",
                katexDisplay: "$$8\\sqrt{5} - 5\\sqrt{2} + 2\\sqrt{5}$$"
              },
              {
                title: "步驟五：重新排序",
                instruction: "找出同類方根 <span class='highlight'>$\\sqrt{5}$</span> 並放在一起。",
                katexDisplay: "$$(8\\sqrt{5} + 2\\sqrt{5}) - 5\\sqrt{2}$$"
              },
              {
                title: "步驟六：寫下答案",
                instruction: "合併 $\\sqrt{5}$ (8+2=10)，$\\sqrt{2}$ 保持不變。",
                katexDisplay: "$$10\\sqrt{5} - 5\\sqrt{2}$$"
              }
            ]
          }
        // ===== 新增的題目到此結束 =====
        ];


        // --- 2. 獲取元素 ---
        const navContainer = document.getElementById('nav-container');
        const conceptArea = document.getElementById('concept-area'); // 概念區塊
        const problemArea = document.getElementById('problem-area');
        const stepsContainer = document.getElementById('steps-container');
        const completionMessage = document.getElementById('completion-message');
        const nextQuestionBtn = document.getElementById('next-question-btn'); // 修改 ID
        const navButtons = document.querySelectorAll('.nav-btn');

        let currentQuestionIndex = 0;
        let currentStepIndex = 0; // 這個變數會被 loadStep 控制

        // --- 3. 函數 ---
        
        // (移除 renderAllKatex)
        
        // 載入指定題目
        function loadQuestion(questionIndex) {
            currentQuestionIndex = questionIndex;
            currentStepIndex = 0;

            // 更新導覽列按鈕樣式
            navButtons.forEach((btn, index) => {
                if (index === questionIndex) {
                    btn.classList.add('nav-btn-active');
                } else {
                    btn.classList.remove('nav-btn-active');
                }
            });

            // 載入題目
            const question = questions[currentQuestionIndex];
            problemArea.innerHTML = question.problemKatex;
            renderMathInElement(problemArea, katexOptions); // 只渲染題目區塊

            // 載入對應的概念區塊
            if (question.conceptHtml) {
                conceptArea.innerHTML = question.conceptHtml;
                renderMathInElement(conceptArea, katexOptions); // 只渲染概念區塊
            } else {
                conceptArea.innerHTML = ''; // 如果沒有概念卡，就清空
            }

            // 清空舊步驟並隱藏完成訊息
            stepsContainer.innerHTML = '';
            completionMessage.classList.add('step-hidden');

            // 載入第一個步驟
            loadStep(0);
        }

        // 載入指定步驟
        function loadStep(stepIndex) {
            currentStepIndex = stepIndex;
            const question = questions[currentQuestionIndex];
            const step = question.steps[stepIndex];

            // 如果沒有下一個步驟，顯示完成訊息
            if (!step) {
                // 根據是否為最後一題，決定按鈕文字
                if (currentQuestionIndex === questions.length - 1) {
                    nextQuestionBtn.textContent = "回第一題"; // 修正文字
                } else {
                    nextQuestionBtn.textContent = "下一題";
                }
                completionMessage.classList.remove('step-hidden');
                completionMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            const totalSteps = question.steps.length;
            const isLastStep = stepIndex === totalSteps - 1;
            const btnText = isLastStep ? "完成！" : "下一步";
            const btnClass = isLastStep ? "next-btn finish-btn" : "next-btn";
            const nextBtnId = `next-btn-${stepIndex}`;

            // 組合步驟 HTML
            let stepHtml = `
                <div id="step-${stepIndex}" class="step-container">
                    <h2 class="step-title">${step.title}</h2>
                    <div class="step-progress">第 ${stepIndex + 1} 步 / 共 ${totalSteps} 步</div>
                    <p class="step-instruction">${step.instruction}</p>
            `;

            // (已移除 'solutionNum' 和 'solutionDen' 的邏輯)
            
            // 根據步驟類型加入不同的顯示
            if (step.katexDisplay) {
                stepHtml += `<div class="katex-display-area" style="font-size: 1.8rem;">${step.katexDisplay}</div>`;
            }

            stepHtml += `
                    <div class="text-center mt-8">
                        <button id="${nextBtnId}" class="${btnClass}">${btnText}</button>
                    </div>
                </div>
            `;

            // 插入 HTML 並滾動到新步驟
            stepsContainer.insertAdjacentHTML('beforeend', stepHtml);
            const newStepElement = document.getElementById(`step-${stepIndex}`); // 獲取新步驟的元素
            
            // 只有在載入第二步或之後的步驟時才滾動
            if (stepIndex > 0) {
                const newStepElement = document.getElementById(`step-${stepIndex}`);
                newStepElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // 重新渲染 KaTeX (只渲染剛加入的新步驟)
            renderMathInElement(newStepElement, katexOptions);

            // 幫新按鈕加上事件監聽
            document.getElementById(nextBtnId).addEventListener('click', (e) => {
                e.target.disabled = true; // 按過就禁用
                loadStep(stepIndex + 1); // 載入下一步
            });
        }

        // (移除 resetCurrentQuestion 函數)

        // --- 4. 初始設定 ---
        
        // 幫導覽列按鈕加上事件監聽
        navButtons.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                loadQuestion(index);
            });
        });

        // 幫「下一題」按鈕加上事件監聽
        nextQuestionBtn.addEventListener('click', () => {
            let nextIndex = currentQuestionIndex + 1;
            if (nextIndex >= questions.length) {
                nextIndex = 0; // 循環回到第一題
            }
            loadQuestion(nextIndex);
            // 換題時滾動到頁面頂部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // (移除 conceptBox 的初始渲染)

        // 頁面載入時，自動載入第一題
        loadQuestion(0);
      });
    </script>

</body>
</html>
