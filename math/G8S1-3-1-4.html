<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四、利用平方差公式因式分解</title>
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: "Chiron GoRound TC", sans-serif;
            background: #ecfeff; /* 淺藍色背景 */
            background-image: radial-gradient(#cffafe 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 100vh;
        }

        /* 題目容器 */
        .math-expression {
            font-family: "Chiron GoRound TC", monospace;
            letter-spacing: 0.05em;
        }

        /* 填空 Slot 樣式 */
        .slot {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 3rem;
            height: 3rem;
            border-bottom: 3px solid #cbd5e1;
            background-color: white;
            border-radius: 0.5rem 0.5rem 0 0;
            margin: 0.25rem;
            font-weight: bold;
            color: #334155;
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0 0.5rem;
            vertical-align: middle;
            white-space: nowrap;
        }
        .slot:hover { border-bottom-color: #06b6d4; background-color: #ecfeff; }
        .slot.filled { border-bottom-color: #06b6d4; color: #0891b2; }
        .slot.correct { border-bottom-color: #22c55e; color: #15803d; background-color: #dcfce7; pointer-events: none; }
        .slot.wrong { border-bottom-color: #ef4444; color: #b91c1c; background-color: #fee2e2; animation: shake 0.4s; }

        /* 選項按鈕 */
        .option-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 0.75rem 1.25rem;
            font-size: 1.4rem;
            font-weight: bold;
            color: #475569;
            box-shadow: 0 4px 0 #cbd5e1;
            cursor: pointer;
            transition: all 0.1s;
            user-select: none;
            margin: 0.25rem;
        }
        .option-card:active { transform: translateY(4px); box-shadow: none; }
        .option-card:hover { border-color: #94a3b8; background-color: #f8fafc; }
        .option-card.used { opacity: 0.4; cursor: not-allowed; background-color: #f1f5f9; box-shadow: none; transform: translateY(4px); }

        /* 步驟區塊 */
        .step-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 6px solid #cbd5e1;
            transition: all 0.5s ease;
        }
        .step-box.active { border-left-color: #06b6d4; transform: scale(1.02); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .step-box.done { border-left-color: #22c55e; opacity: 0.8; }
        .step-box.locked { opacity: 0.5; pointer-events: none; filter: grayscale(0.8); }

        /* 平方表樣式 */
        #square-table {
            transition: transform 0.3s ease-in-out, opacity 0.3s;
            transform-origin: top right;
        }
        #square-table.hidden-custom {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }
        
        /* 動畫 */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body class="flex flex-col items-center py-8 px-4 relative overflow-x-hidden">

    <!-- 右上角平方表按鈕 & 內容 -->
    <div class="fixed top-4 right-4 z-50 flex flex-col items-end">
        <button onclick="toggleSquareTable()" class="bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-2 px-4 rounded-full shadow-lg flex items-center transition transform hover:scale-105 border-2 border-white">
            <i class="fas fa-calculator mr-2"></i>平方表
        </button>
        
        <div id="square-table" class="hidden-custom mt-2 bg-white/95 backdrop-blur p-4 rounded-2xl shadow-2xl border-4 border-yellow-200 w-40 text-center">
            <h3 class="font-bold text-yellow-600 mb-2 border-b border-yellow-100 pb-1">平方數速查</h3>
            <div class="space-y-1 font-mono text-slate-600 font-bold text-lg">
                <div class="flex justify-between px-2"><span>1²</span><span>=</span><span>1</span></div>
                <div class="flex justify-between px-2"><span>2²</span><span>=</span><span>4</span></div>
                <div class="flex justify-between px-2"><span>3²</span><span>=</span><span>9</span></div>
                <div class="flex justify-between px-2"><span>4²</span><span>=</span><span>16</span></div>
                <div class="flex justify-between px-2"><span>5²</span><span>=</span><span>25</span></div>
                <div class="flex justify-between px-2"><span>6²</span><span>=</span><span>36</span></div>
                <div class="flex justify-between px-2"><span>7²</span><span>=</span><span>49</span></div>
                <div class="flex justify-between px-2"><span>8²</span><span>=</span><span>64</span></div>
                <div class="flex justify-between px-2"><span>9²</span><span>=</span><span>81</span></div>
                <div class="flex justify-between px-2"><span>10²</span><span>=</span><span>100</span></div>
            </div>
            <button onclick="toggleSquareTable()" class="mt-3 text-xs text-slate-400 hover:text-slate-600 underline">關閉</button>
        </div>
    </div>

    <header class="mb-8 text-center mt-8 md:mt-0">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2">
            <i class="fas fa-square-root-alt text-cyan-500 mr-2"></i>四、利用平方差公式因式分解
        </h1>
        <p class="text-slate-600 font-medium">利用 <span class="font-mono bg-cyan-100 px-1 rounded">a²-b² = (a+b)(a-b)</span> 來因式分解</p>
    </header>

    <!-- 進度條 -->
    <div class="w-full max-w-2xl mb-6 flex justify-between items-center text-slate-500 font-bold">
        <button id="prev-btn" class="hover:text-cyan-600 disabled:opacity-30"><i class="fas fa-chevron-left mr-1"></i>上一題</button>
        <span id="progress-text" class="bg-white px-4 py-1 rounded-full shadow-sm">第 1 / 8 題</span>
        <button id="next-btn" class="hover:text-cyan-600 disabled:opacity-30">下一題<i class="fas fa-chevron-right ml-1"></i></button>
    </div>

    <!-- 主要遊戲區 -->
    <main class="w-full max-w-3xl relative">
        
        <!-- 步驟一：找基底 -->
        <div id="step1-container" class="step-box active">
            <div class="flex justify-between items-start mb-4">
                <h2 class="text-xl font-bold text-slate-700 flex items-center">
                    <span class="bg-cyan-100 text-cyan-600 w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm">1</span>
                    第一步：找出平方的數字
                </h2>
                <i id="step1-icon" class="fas fa-search text-cyan-400 text-xl"></i>
            </div>
            
            <div class="text-center">
                <div class="text-3xl md:text-5xl mb-6 math-expression text-slate-800" id="question-display">
                    <!-- JS 填入 -->
                </div>
                
                <p class="text-slate-500 mb-2"><i class="fas fa-lightbulb text-yellow-400 mr-1"></i>是誰的平方減誰的平方呢？</p>

                <div class="text-2xl md:text-4xl math-expression flex flex-wrap justify-center items-center gap-2" id="step1-slots">
                    <!-- JS 填入 -->
                </div>
            </div>
        </div>

        <!-- 步驟二：套公式 -->
        <div id="step2-container" class="step-box locked">
            <div class="flex justify-between items-start mb-4">
                <h2 class="text-xl font-bold text-slate-700 flex items-center">
                    <span class="bg-green-100 text-green-600 w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm">2</span>
                    第二步：套用公式分解
                </h2>
                <i id="step2-icon" class="fas fa-lock text-slate-300 text-xl"></i>
            </div>

            <div class="text-center">
                <p class="text-slate-500 mb-4 text-lg">口訣：( 前 + 後 ) ( 前 - 後 )</p>
                <!-- 預覽第一步結果 -->
                <div class="text-2xl md:text-3xl mb-6 text-cyan-600 font-bold opacity-60 math-expression" id="step2-preview">
                    <!-- JS 填入 -->
                </div>

                <!-- 作答區 -->
                <div class="text-2xl md:text-3xl math-expression flex flex-wrap justify-center items-center gap-2" id="step2-slots">
                     <span class="text-slate-400">=</span>
                     <!-- JS 填入 -->
                </div>
            </div>
        </div>

        <!-- 選項區 -->
        <div class="fixed bottom-12 left-0 w-full bg-white/90 backdrop-blur-md border-t border-slate-200 p-4 shadow-[0_-4px_20px_rgba(0,0,0,0.1)] transition-transform duration-300 z-40" id="options-panel">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-slate-500 font-bold">請點選卡片填入空格：</span>
                    <button onclick="resetCurrentStep()" class="text-sm text-orange-500 font-bold hover:underline"><i class="fas fa-undo mr-1"></i>重填</button>
                </div>
                <div class="flex flex-wrap justify-center gap-2" id="options-container">
                    <!-- JS 生成選項 -->
                </div>
            </div>
        </div>

        <!-- 佔位符 -->
        <div class="h-48"></div>

    </main>

    <!-- 頁尾 -->
    <footer class="fixed bottom-0 left-0 w-full text-center text-gray-500 text-sm bg-white bg-opacity-80 py-2 border-t border-gray-200 backdrop-blur-sm z-30">
        © 2025 米克師｜採用 
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="text-cyan-600 hover:underline">
            CC BY-NC-SA 4.0 創用CC授權
        </a>｜非商業用途歡迎轉載或改編，請保留署名並附上原始連結。
    </footer>

    <!-- 恭喜過關 -->
    <div id="success-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm hidden">
        <div class="bg-white p-8 rounded-3xl shadow-2xl flex flex-col items-center animate-[popIn_0.4s_ease-out]">
            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-check text-5xl text-green-500"></i>
            </div>
            <h2 class="text-3xl font-bold text-slate-800 mb-2">正確！</h2>
            <p class="text-slate-500 mb-6">公式運用得很棒喔！</p>
            <button onclick="nextQuestion()" class="bg-cyan-500 hover:bg-cyan-600 text-white text-xl font-bold py-3 px-10 rounded-xl shadow-lg transition transform hover:scale-105">
                下一題
            </button>
        </div>
    </div>

    <script>
        // --- 題庫資料 ---
        const questions = [
            {
                // Q1: x^2 - 81
                display: `x<sup>2</sup> - 81`,
                step1: {
                    // (x)^2 - (9)^2
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', type: 'base', ans: 'x' },
                        { pre: '', post: ')<sup>2</sup>', type: 'base', ans: '9' }
                    ],
                    options: ['x', '9', '81', '1']
                },
                step2: {
                    // (x+9)(x-9)
                    slots: [
                        { pre: '(', type: 'term', ans: 'x' },
                        { pre: '', type: 'op', ans: '+' },
                        { pre: '', post: ')(', type: 'term', ans: '9' },
                        { pre: '', type: 'term', ans: 'x' },
                        { pre: '', type: 'op', ans: '-' },
                        { pre: '', post: ')', type: 'term', ans: '9' }
                    ],
                    options: ['x', '9', '+', '-', '81']
                }
            },
            {
                // Q2: x^2 - 16
                display: `x<sup>2</sup> - 16`,
                step1: {
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', ans: 'x' },
                        { pre: '', post: ')<sup>2</sup>', ans: '4' }
                    ],
                    options: ['x', '4', '16', '8']
                },
                step2: {
                    slots: [
                        { pre: '(', ans: 'x' }, { ans: '+' }, { pre: '', post: ')(', ans: '4' },
                        { pre: '', ans: 'x' }, { ans: '-' }, { pre: '', post: ')', ans: '4' }
                    ],
                    options: ['x', '4', '+', '-', '16']
                }
            },
            {
                // Q3: 4y^2 - 9
                display: `4y<sup>2</sup> - 9`,
                step1: {
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', ans: '2y' },
                        { pre: '', post: ')<sup>2</sup>', ans: '3' }
                    ],
                    options: ['2y', '3', '4y', '9', 'y']
                },
                step2: {
                    slots: [
                        { pre: '(', ans: '2y' }, { ans: '+' }, { pre: '', post: ')(', ans: '3' },
                        { pre: '', ans: '2y' }, { ans: '-' }, { pre: '', post: ')', ans: '3' }
                    ],
                    options: ['2y', '3', '+', '-', '4y']
                }
            },
            {
                // Q4: 36y^2 - 25
                display: `36y<sup>2</sup> - 25`,
                step1: {
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', ans: '6y' },
                        { pre: '', post: ')<sup>2</sup>', ans: '5' }
                    ],
                    options: ['6y', '5', '36y', '25', 'y']
                },
                step2: {
                    slots: [
                        { pre: '(', ans: '6y' }, { ans: '+' }, { pre: '', post: ')(', ans: '5' },
                        { pre: '', ans: '6y' }, { ans: '-' }, { pre: '', post: ')', ans: '5' }
                    ],
                    options: ['6y', '5', '+', '-', '25']
                }
            },
            {
                // Q5: 49x^2 - 1
                display: `49x<sup>2</sup> - 1`,
                step1: {
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', ans: '7x' },
                        { pre: '', post: ')<sup>2</sup>', ans: '1' }
                    ],
                    options: ['7x', '1', '49x', '7']
                },
                step2: {
                    slots: [
                        { pre: '(', ans: '7x' }, { ans: '+' }, { pre: '', post: ')(', ans: '1' },
                        { pre: '', ans: '7x' }, { ans: '-' }, { pre: '', post: ')', ans: '1' }
                    ],
                    options: ['7x', '1', '+', '-', '49']
                }
            },
            {
                // Q6: 9x^2 - 4
                display: `9x<sup>2</sup> - 4`,
                step1: {
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', ans: '3x' },
                        { pre: '', post: ')<sup>2</sup>', ans: '2' }
                    ],
                    options: ['3x', '2', '9x', '4', '3']
                },
                step2: {
                    slots: [
                        { pre: '(', ans: '3x' }, { ans: '+' }, { pre: '', post: ')(', ans: '2' },
                        { pre: '', ans: '3x' }, { ans: '-' }, { pre: '', post: ')', ans: '2' }
                    ],
                    options: ['3x', '2', '+', '-', '4']
                }
            },
            {
                // Q7: 81y^2 - 100
                display: `81y<sup>2</sup> - 100`,
                step1: {
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', ans: '9y' },
                        { pre: '', post: ')<sup>2</sup>', ans: '10' }
                    ],
                    options: ['9y', '10', '81y', '100', '9']
                },
                step2: {
                    slots: [
                        { pre: '(', ans: '9y' }, { ans: '+' }, { pre: '', post: ')(', ans: '10' },
                        { pre: '', ans: '9y' }, { ans: '-' }, { pre: '', post: ')', ans: '10' }
                    ],
                    options: ['9y', '10', '+', '-', '100']
                }
            },
            {
                // Q8: 100y^2 - 49
                display: `100y<sup>2</sup> - 49`,
                step1: {
                    slots: [
                        { pre: '(', post: ')<sup>2</sup> - (', ans: '10y' },
                        { pre: '', post: ')<sup>2</sup>', ans: '7' }
                    ],
                    options: ['10y', '7', '100y', '49', '10']
                },
                step2: {
                    slots: [
                        { pre: '(', ans: '10y' }, { ans: '+' }, { pre: '', post: ')(', ans: '7' },
                        { pre: '', ans: '10y' }, { ans: '-' }, { pre: '', post: ')', ans: '7' }
                    ],
                    options: ['10y', '7', '+', '-', '49']
                }
            }
        ];

        let currentQIdx = 0;
        let currentStep = 1;
        let filledSlots = {};

        // UI Elements
        const qDisplay = document.getElementById('question-display');
        const step1Box = document.getElementById('step1-container');
        const step1SlotsDiv = document.getElementById('step1-slots');
        const step2Box = document.getElementById('step2-container');
        const step2Preview = document.getElementById('step2-preview');
        const step2SlotsDiv = document.getElementById('step2-slots');
        const optionsContainer = document.getElementById('options-container');
        const progressText = document.getElementById('progress-text');
        const successOverlay = document.getElementById('success-overlay');
        const squareTable = document.getElementById('square-table');

        function toggleSquareTable() {
            squareTable.classList.toggle('hidden-custom');
        }

        function initGame() {
            loadQuestion(0);
            document.getElementById('prev-btn').onclick = () => {
                if(currentQIdx > 0) loadQuestion(currentQIdx - 1);
            };
            document.getElementById('next-btn').onclick = () => {
                if(currentQIdx < questions.length - 1) loadQuestion(currentQIdx + 1);
            };
        }

        function loadQuestion(idx) {
            currentQIdx = idx;
            currentStep = 1;
            filledSlots = {};
            
            progressText.innerText = `第 ${idx + 1} / ${questions.length} 題`;
            document.getElementById('prev-btn').disabled = idx === 0;
            document.getElementById('next-btn').disabled = idx === questions.length - 1;
            
            const q = questions[idx];
            qDisplay.innerHTML = q.display;

            // Reset UI
            step1Box.classList.remove('done', 'locked');
            step1Box.classList.add('active');
            document.getElementById('step1-icon').className = 'fas fa-search text-cyan-400 text-xl';
            
            step2Box.classList.remove('active', 'done');
            step2Box.classList.add('locked');
            document.getElementById('step2-icon').className = 'fas fa-lock text-slate-300 text-xl';
            step2Preview.innerHTML = '';

            renderStep1();
        }

        function renderStep1() {
            const q = questions[currentQIdx];
            step1SlotsDiv.innerHTML = '';
            
            q.step1.slots.forEach((slotData, i) => {
                if(slotData.pre) {
                    const sp = document.createElement('span');
                    sp.innerHTML = slotData.pre;
                    step1SlotsDiv.appendChild(sp);
                }
                
                const el = document.createElement('div');
                el.className = 'slot';
                el.dataset.idx = i;
                el.onclick = () => removeSlotValue(i);
                step1SlotsDiv.appendChild(el);
                
                if(slotData.post) {
                    const sp = document.createElement('span');
                    sp.innerHTML = slotData.post;
                    step1SlotsDiv.appendChild(sp);
                }
            });

            renderOptions(q.step1.options);
        }

        function renderStep2() {
            const q = questions[currentQIdx];
            step2SlotsDiv.innerHTML = '';
            
            // Preview Step 1 result
            let resultStr = "";
            q.step1.slots.forEach((s, i) => {
                const val = filledSlots[i] || s.ans; // Should be filled
                resultStr += (s.pre || "") + val + (s.post || "");
            });
            step2Preview.innerHTML = resultStr + " =";

            // Reset filled slots for step 2
            filledSlots = {}; 

            q.step2.slots.forEach((slotData, i) => {
                if(slotData.pre) {
                    const sp = document.createElement('span');
                    sp.innerHTML = slotData.pre;
                    step2SlotsDiv.appendChild(sp);
                }
                
                const el = document.createElement('div');
                el.className = 'slot';
                el.dataset.idx = i;
                el.onclick = () => removeSlotValue(i);
                step2SlotsDiv.appendChild(el);
                
                if(slotData.post) {
                    const sp = document.createElement('span');
                    sp.innerHTML = slotData.post;
                    step2SlotsDiv.appendChild(sp);
                }
            });

            renderOptions(q.step2.options);
        }

        function renderOptions(opts) {
            optionsContainer.innerHTML = '';
            const shuffled = [...opts].sort(() => Math.random() - 0.5);
            shuffled.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-card';
                btn.innerText = opt;
                btn.onclick = () => handleOptionClick(opt);
                optionsContainer.appendChild(btn);
            });
        }

        function handleOptionClick(val) {
            const container = currentStep === 1 ? step1SlotsDiv : step2SlotsDiv;
            const emptySlot = Array.from(container.querySelectorAll('.slot')).find(el => !el.innerText);
            
            if (emptySlot) {
                const idx = emptySlot.dataset.idx;
                filledSlots[idx] = val;
                emptySlot.innerText = val;
                emptySlot.classList.add('filled');
                
                // Check full
                const allSlots = container.querySelectorAll('.slot');
                const isFull = Array.from(allSlots).every(el => el.innerText);
                if (isFull) checkAnswer();
            }
        }

        function removeSlotValue(idx) {
            const container = currentStep === 1 ? step1SlotsDiv : step2SlotsDiv;
            const slot = container.querySelector(`.slot[data-idx="${idx}"]`);
            if (slot && !slot.classList.contains('correct')) {
                delete filledSlots[idx];
                slot.innerText = '';
                slot.classList.remove('filled', 'wrong');
            }
        }

        function resetCurrentStep() {
            filledSlots = {};
            if (currentStep === 1) renderStep1();
            else renderStep2();
        }

        function checkAnswer() {
            const q = questions[currentQIdx];
            const targetSlots = currentStep === 1 ? q.step1.slots : q.step2.slots;
            const container = currentStep === 1 ? step1SlotsDiv : step2SlotsDiv;
            const uiSlots = container.querySelectorAll('.slot');
            
            let allCorrect = true;
            
            // Step 2: Check flexible (a+b)(a-b) or (a-b)(a+b)
            // But here we provided slots for operators (+ and -).
            // The slots structure is: [term] [op] [term] [term] [op] [term]
            // Let's gather the filled values.
            const userVals = Array.from(uiSlots).map(s => s.innerText);
            
            if (currentStep === 1) {
                uiSlots.forEach((slot, i) => {
                    if(userVals[i] === targetSlots[i].ans) {
                        slot.classList.add('correct');
                        slot.classList.remove('filled');
                    } else {
                        slot.classList.add('wrong');
                        allCorrect = false;
                    }
                });
            } else {
                // Step 2
                // Expected: a, +, b, a, -, b OR a, -, b, a, +, b
                const a = targetSlots[0].ans; // 1st term
                const b = targetSlots[2].ans; // 2nd term (index 2 because index 1 is op)
                
                // Construct two possible valid arrays
                const valid1 = [a, '+', b, a, '-', b];
                const valid2 = [a, '-', b, a, '+', b];
                
                // Check exact match
                const match1 = userVals.every((v, i) => v === valid1[i]);
                const match2 = userVals.every((v, i) => v === valid2[i]);
                
                if (match1 || match2) {
                    uiSlots.forEach(slot => {
                        slot.classList.add('correct');
                        slot.classList.remove('filled');
                    });
                } else {
                    uiSlots.forEach(slot => slot.classList.add('wrong'));
                    allCorrect = false;
                }
            }

            if (allCorrect) {
                if (currentStep === 1) {
                    setTimeout(() => {
                        step1Box.classList.remove('active');
                        step1Box.classList.add('done');
                        document.getElementById('step1-icon').className = 'fas fa-check-circle text-green-500 text-xl';
                        
                        step2Box.classList.remove('locked');
                        step2Box.classList.add('active');
                        document.getElementById('step2-icon').className = 'fas fa-pen text-cyan-400 text-xl';
                        
                        currentStep = 2;
                        renderStep2();
                        step2Box.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 800);
                } else {
                    setTimeout(() => {
                         successOverlay.classList.remove('hidden');
                    }, 500);
                }
            } else {
                setTimeout(() => {
                    uiSlots.forEach(slot => {
                        if (slot.classList.contains('wrong')) {
                            slot.classList.remove('wrong');
                            slot.innerText = '';
                            delete filledSlots[slot.dataset.idx];
                        }
                    });
                }, 1000);
            }
        }

        function nextQuestion() {
            successOverlay.classList.add('hidden');
            if (currentQIdx < questions.length - 1) {
                loadQuestion(currentQIdx + 1);
            } else {
                alert("恭喜你！全數通關！");
            }
        }

        initGame();

    </script>
</body>
</html>