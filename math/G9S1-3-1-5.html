<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰è§’å½¢å…¨ç­‰è­‰æ˜äº’å‹•å­¸ç¿’å–®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            overscroll-behavior-y: none; /* é˜²æ­¢æ‰‹æ©Ÿä¸‹æ‹‰é‡æ•´ */
        }

        /* æ•¸å­¸ç¬¦è™Ÿå°ˆç”¨æ¨£å¼ */
        .math-text {
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }
        
        /* ç·šæ®µ (Overline) */
        .segment {
            text-decoration: overline;
            text-decoration-thickness: 1.5px;
            margin: 0 2px;
        }

        /* è§’åº¦ç¬¦è™Ÿä¿®æ­£ */
        .angle-sym {
            font-style: normal;
            margin-right: 2px;
        }

        /* å¡«ç­”æ ¼æ¨£å¼ */
        .slot {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            height: 40px;
            padding: 0 10px;
            border-bottom: 3px solid #94a3b8;
            background-color: #fff;
            color: #334155;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 4px;
            border-radius: 4px 4px 0 0;
            vertical-align: middle;
        }

        .slot:hover {
            background-color: #e2e8f0;
        }

        .slot.filled {
            border-bottom-color: #3b82f6;
            color: #2563eb;
        }

        .slot.correct {
            border-bottom-color: #22c55e;
            color: #15803d;
            background-color: #dcfce7;
            pointer-events: none; /* é–å®šæ­£ç¢ºç­”æ¡ˆ */
        }

        .slot.error {
            animation: shake 0.4s ease-in-out;
            border-bottom-color: #ef4444;
        }

        /* æ­¥é©Ÿå®¹å™¨éæ¸¡æ•ˆæœ */
        .step-container {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
            display: none; /* é è¨­éš±è— */
        }

        .step-container.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .step-container.completed {
            opacity: 0.7;
            pointer-events: none; /* å®Œæˆå¾Œç¦æ­¢æ“ä½œä½†å¯è¦‹ */
        }
        
        .step-container.completed .options-area {
            display: none; /* å®Œæˆå¾Œéš±è—é¸é …ï¼Œè®“ç•«é¢ä¹¾æ·¨ */
        }

        /* é¸é …æŒ‰éˆ•æ¨£å¼ */
        .option-btn {
            background-color: #fff;
            border: 2px solid #e5e7eb;
            box-shadow: 0 2px 0 #e5e7eb;
            color: #374151;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 12px;
            transition: all 0.1s;
            user-select: none;
        }

        .option-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .option-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: #f3f4f6;
            transform: none;
            box-shadow: none;
        }

        /* æ–æ™ƒå‹•ç•« */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* éš±è—æ²è»¸ä½†ä¿æŒåŠŸèƒ½ */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* å®Œæˆè¦–çª—å‹•ç•« */
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.3s, transform 0.3s;
        }

        /* é¡Œç›®åˆ‡æ›é¡¯ç¤º */
        .problem-wrapper {
            display: none;
        }
        .problem-wrapper.active-problem {
            display: flex;
        }
        
        /* å°è¦½åˆ—æŒ‰éˆ•æ¿€æ´»ç‹€æ…‹ */
        .nav-btn.active {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- é ‚éƒ¨å°è¦½åˆ— (å¤šé¡Œåˆ‡æ›) -->
    <nav class="bg-indigo-600 text-white shadow-md flex-none z-50">
        <div class="max-w-7xl mx-auto px-4 py-2 flex items-center overflow-x-auto hide-scrollbar" id="navbar">
            <span class="font-bold text-lg flex-shrink-0 mr-4">SPEDMIX æ•¸å­¸</span>
            <!-- é¡Œç›®æŒ‰éˆ•ç”± JS ç”Ÿæˆ -->
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div id="main-container" class="flex-1 relative overflow-hidden bg-gray-50">
        <!-- é¡Œç›®å…§å®¹å°‡ç”± JS å‹•æ…‹ç”Ÿæˆä¸¦æ§åˆ¶é¡¯ç¤º -->
    </div>

    <!-- å®Œæˆè¦–çª— (Modal) -->
    <div id="completion-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] hidden">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 text-center shadow-2xl transform transition-all modal-enter" id="modal-content">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">å¤ªæ£’äº†ï¼</h3>
            <p class="text-gray-600 mb-6">ä½ å·²ç¶“å®Œæˆé€™å€‹è­‰æ˜é¡Œï¼</p>
            <div class="flex gap-3 justify-center">
                <button onclick="resetCurrentProblem()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl transition shadow-lg shadow-indigo-200">
                    å†åšä¸€æ¬¡
                </button>
                <button onclick="closeModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-4 rounded-xl transition">
                    é—œé–‰
                </button>
            </div>
        </div>
    </div>

    <script>
        // === é¡Œç›®è³‡æ–™åº« ===
        const problems = [
            {
                id: 1,
                title: "1. SSSå…¨ç­‰è­‰æ˜",
                description: `å¦‚åœ–ï¼Œå·²çŸ¥ <span class="math-text"><span class="segment">AC</span> = <span class="segment">AD</span></span>ï¼Œ<span class="math-text"><span class="segment">BC</span> = <span class="segment">BD</span></span>ã€‚èªªæ˜ <span class="math-text">â–³ABC <span class="font-normal">â‰…</span> â–³ABD</span>ã€‚`,
                svgContent: `
                    <!-- ä¸‰è§’å½¢ ABC (ä¸Š) -->
                    <path d="M 20 90 L 120 20 L 220 90 Z" fill="#fce7f3" stroke="#4b5563" stroke-width="2" stroke-linejoin="round"/>
                    <!-- ä¸‰è§’å½¢ ABD (ä¸‹) -->
                    <path d="M 20 90 L 120 160 L 220 90 Z" fill="#fce7f3" stroke="#4b5563" stroke-width="2" stroke-linejoin="round"/>
                    <!-- å…¬ç”¨é‚Š AB -->
                    <line x1="20" y1="90" x2="220" y2="90" stroke="#000" stroke-width="2.5" />
                    <!-- é ‚é»æ¨™ç±¤ -->
                    <text x="10" y="95" class="math-text" font-size="16">A</text>
                    <text x="225" y="95" class="math-text" font-size="16">B</text>
                    <text x="115" y="15" class="math-text" font-size="16">C</text>
                    <text x="115" y="175" class="math-text" font-size="16">D</text>
                    <!-- AC=AD (å–®æ§“) -->
                    <line x1="65" y1="50" x2="75" y2="60" stroke="#be123c" stroke-width="2" />
                    <line x1="65" y1="130" x2="75" y2="120" stroke="#be123c" stroke-width="2" />
                    <!-- BC=BD (é›™æ§“) -->
                    <line x1="165" y1="50" x2="175" y2="60" stroke="#be123c" stroke-width="2" />
                    <line x1="168" y1="47" x2="178" y2="57" stroke="#be123c" stroke-width="2" />
                    <line x1="165" y1="130" x2="175" y2="120" stroke="#be123c" stroke-width="2" />
                    <line x1="168" y1="133" x2="178" y2="123" stroke="#be123c" stroke-width="2" />
                    <!-- AB å…¬ç”¨é‚Š (ä¸‰æ§“) -->
                    <line x1="117" y1="85" x2="117" y2="95" stroke="#be123c" stroke-width="2" />
                    <line x1="120" y1="85" x2="120" y2="95" stroke="#be123c" stroke-width="2" />
                    <line x1="123" y1="85" x2="123" y2="95" stroke="#be123c" stroke-width="2" />
                `,
                steps: [
                    {
                        instruction: "æ­¥é©Ÿ 1ï¼šå¡«å…¥ç¬¬ä¸€å€‹å·²çŸ¥æ¢ä»¶",
                        template: `<span class="math-text">âˆµ <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["AC", "AD", "å·²çŸ¥"],
                        options: [
                            { text: '<span class="segment">AC</span>', value: "AC" },
                            { text: '<span class="segment">AD</span>', value: "AD" },
                            { text: '<span class="segment">BC</span>', value: "BC" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" },
                            { text: "å…¬ç”¨é‚Š", value: "å…¬ç”¨é‚Š" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 2ï¼šå¡«å…¥ç¬¬äºŒå€‹å·²çŸ¥æ¢ä»¶",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["BC", "BD", "å·²çŸ¥"],
                        options: [
                            { text: '<span class="segment">BC</span>', value: "BC" },
                            { text: '<span class="segment">BD</span>', value: "BD" },
                            { text: '<span class="segment">AB</span>', value: "AB" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" },
                            { text: "å°æ‡‰é‚Š", value: "å°æ‡‰é‚Š" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 3ï¼šæ‰¾å‡ºéš±è—çš„å…¬ç”¨é‚Š",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["AB", "AB", "å…¬ç”¨é‚Š"],
                        options: [
                            { text: '<span class="segment">AB</span>', value: "AB" },
                            { text: '<span class="segment">AB</span>', value: "AB" },
                            { text: '<span class="segment">AC</span>', value: "AC" },
                            { text: "å…¬ç”¨é‚Š", value: "å…¬ç”¨é‚Š" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" },
                            { text: "å…¨ç­‰", value: "å…¨ç­‰" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 4ï¼šç¢ºèªå…¨ç­‰æ€§è³ª",
                        template: `<span class="math-text">âˆ´ â–³ABC â‰… â–³ABD ( <span class="slot" data-idx="0"></span> å…¨ç­‰æ€§è³ª )</span>`,
                        answers: ["SSS"],
                        options: [
                            { text: "SSS", value: "SSS" },
                            { text: "SAS", value: "SAS" },
                            { text: "ASA", value: "ASA" },
                            { text: "RHS", value: "RHS" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 5ï¼šæ¨å°çµè«–",
                        template: `<span class="math-text">æ•… <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> ç›¸ç­‰ )</span>`,
                        answers: ["âˆ ABC", "âˆ ABD", "å°æ‡‰è§’"],
                        options: [
                            { text: '<span class="angle-sym">âˆ </span>ABC', value: "âˆ ABC" },
                            { text: '<span class="angle-sym">âˆ </span>ABD', value: "âˆ ABD" },
                            { text: '<span class="angle-sym">âˆ </span>C', value: "âˆ C" },
                            { text: "å°æ‡‰è§’", value: "å°æ‡‰è§’" },
                            { text: "å°æ‡‰é‚Š", value: "å°æ‡‰é‚Š" }
                        ]
                    }
                ]
            },
            {
                id: 2,
                title: "2. SASå…¨ç­‰è­‰æ˜",
                description: `(æ‰¿ä¸Šé¡Œ) å·²çŸ¥ <span class="math-text"><span class="segment">BC</span> = <span class="segment">BD</span></span>ï¼Œä¸” <span class="math-text">âˆ ABC = âˆ ABD</span>ã€‚èªªæ˜ <span class="math-text">â–³EBC <span class="font-normal">â‰…</span> â–³EBD</span>ã€‚`,
                svgContent: `
                    <!-- è™›ç·šéƒ¨åˆ† -->
                    <path d="M 20 90 L 120 20" stroke="#9ca3af" stroke-width="1.5" stroke-dasharray="5,5" fill="none"/>
                    <path d="M 20 90 L 120 160" stroke="#9ca3af" stroke-width="1.5" stroke-dasharray="5,5" fill="none"/>
                    <line x1="20" y1="90" x2="80" y2="90" stroke="#9ca3af" stroke-width="1.5" stroke-dasharray="5,5" />
                    
                    <!-- å¯¦é«”ä¸‰è§’å½¢ EBC (ä¸Š) -->
                    <path d="M 80 90 L 120 20 L 220 90 Z" fill="#fce7f3" stroke="#4b5563" stroke-width="2" stroke-linejoin="round"/>
                    <!-- å¯¦é«”ä¸‰è§’å½¢ EBD (ä¸‹) -->
                    <path d="M 80 90 L 120 160 L 220 90 Z" fill="#fce7f3" stroke="#4b5563" stroke-width="2" stroke-linejoin="round"/>
                    
                    <!-- å…¬ç”¨é‚Š EB -->
                    <line x1="80" y1="90" x2="220" y2="90" stroke="#000" stroke-width="2.5" />

                    <!-- é ‚é»æ¨™ç±¤ -->
                    <text x="10" y="95" class="math-text" font-size="16" fill="#6b7280">A</text>
                    <text x="70" y="85" class="math-text" font-size="16">E</text>
                    <text x="225" y="95" class="math-text" font-size="16">B</text>
                    <text x="115" y="15" class="math-text" font-size="16">C</text>
                    <text x="115" y="175" class="math-text" font-size="16">D</text>

                    <!-- BC=BD (å–®æ§“) -->
                    <line x1="165" y1="50" x2="175" y2="60" stroke="#be123c" stroke-width="2" />
                    <line x1="165" y1="130" x2="175" y2="120" stroke="#be123c" stroke-width="2" />

                    <!-- è§’B ç›¸ç­‰ (å°åœˆ) -->
                    <circle cx="205" cy="83" r="3" stroke="#be123c" stroke-width="1.5" fill="none"/>
                    <circle cx="205" cy="97" r="3" stroke="#be123c" stroke-width="1.5" fill="none"/>

                    <!-- EB å…¬ç”¨é‚Š (é›™æ§“) -->
                    <line x1="150" y1="85" x2="150" y2="95" stroke="#be123c" stroke-width="2" />
                    <line x1="154" y1="85" x2="154" y2="95" stroke="#be123c" stroke-width="2" />
                `,
                steps: [
                    {
                        instruction: "æ­¥é©Ÿ 1ï¼šå¡«å…¥å·²çŸ¥é‚Šé•·æ¢ä»¶",
                        template: `<span class="math-text">âˆµ <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["BC", "BD", "å·²çŸ¥"],
                        options: [
                            { text: '<span class="segment">BC</span>', value: "BC" },
                            { text: '<span class="segment">BD</span>', value: "BD" },
                            { text: '<span class="segment">EC</span>', value: "EC" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" },
                            { text: "å…¬ç”¨é‚Š", value: "å…¬ç”¨é‚Š" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 2ï¼šå¡«å…¥è§’åº¦æ¢ä»¶ï¼ˆæ‰¿ä¸Šé¡Œï¼‰",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( ç”±(1)å¯çŸ¥ )</span>`,
                        answers: ["âˆ ABC", "âˆ ABD"],
                        options: [
                            { text: '<span class="angle-sym">âˆ </span>ABC', value: "âˆ ABC" },
                            { text: '<span class="angle-sym">âˆ </span>ABD', value: "âˆ ABD" },
                            { text: '<span class="angle-sym">âˆ </span>EBC', value: "âˆ ABC" },
                            { text: '<span class="angle-sym">âˆ </span>EBD', value: "âˆ ABD" },
                            { text: '<span class="segment">AB</span>', value: "AB" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 3ï¼šæ‰¾å‡ºéš±è—çš„å…¬ç”¨é‚Š",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["EB", "EB", "å…¬ç”¨é‚Š"],
                        options: [
                            { text: '<span class="segment">EB</span>', value: "EB" },
                            { text: '<span class="segment">EB</span>', value: "EB" },
                            { text: '<span class="segment">AB</span>', value: "AB" },
                            { text: "å…¬ç”¨é‚Š", value: "å…¬ç”¨é‚Š" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 4ï¼šç¢ºèªå…¨ç­‰æ€§è³ª",
                        template: `<span class="math-text">âˆ´ â–³EBC â‰… â–³EBD ( <span class="slot" data-idx="0"></span> å…¨ç­‰æ€§è³ª )</span>`,
                        answers: ["SAS"],
                        options: [
                            { text: "SAS", value: "SAS" },
                            { text: "SSS", value: "SSS" },
                            { text: "AAS", value: "AAS" },
                            { text: "RHS", value: "RHS" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 5ï¼šæ¨å°çµè«–ï¼ˆå°æ‡‰é‚Šç›¸ç­‰ï¼‰",
                        template: `<span class="math-text">æ•… <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> ç›¸ç­‰ )</span>`,
                        answers: ["EC", "ED", "å°æ‡‰é‚Š"],
                        options: [
                            { text: '<span class="segment">EC</span>', value: "EC" },
                            { text: '<span class="segment">ED</span>', value: "ED" },
                            { text: '<span class="segment">BC</span>', value: "BC" },
                            { text: "å°æ‡‰é‚Š", value: "å°æ‡‰é‚Š" },
                            { text: "å°æ‡‰è§’", value: "å°æ‡‰è§’" }
                        ]
                    }
                ]
            },
            {
                id: 3,
                title: "3. AASå…¨ç­‰è­‰æ˜",
                description: `åœ¨ <span class="math-text">â–³ABD</span> èˆ‡ <span class="math-text">â–³ACE</span> ä¸­ï¼Œå·²çŸ¥ <span class="math-text"><span class="segment">AB</span> = <span class="segment">AC</span></span>ï¼Œ<span class="math-text">âˆ ADB = âˆ AEC = 90Â°</span>ï¼Œä¸” <span class="math-text">âˆ BAD = âˆ CAE</span>ã€‚èªªæ˜ <span class="math-text">â–³ABD <span class="font-normal">â‰…</span> â–³ACE</span>ã€‚`,
                svgContent: `
                    <!-- ä¿®æ­£å¾Œçš„å°ç¨±ç›´è§’ä¸‰è§’å½¢ -->
                    <!-- A(30, 90) -->
                    <!-- Top: D(110, 30), B(170, 110) -->
                    <!-- Bottom: E(110, 150), C(170, 70) -->
                    
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                        </marker>
                    </defs>
                    
                    <!-- Triangle ABD (Dæ˜¯ç›´è§’) -->
                    <path d="M 30 90 L 110 30 L 170 110 Z" fill="#fce7f3" stroke="#be123c" stroke-width="2" stroke-linejoin="round"/>
                    
                    <!-- Triangle ACE (Eæ˜¯ç›´è§’) -->
                    <path d="M 30 90 L 110 150 L 170 70 Z" fill="#fce7f3" stroke="#be123c" stroke-width="2" stroke-linejoin="round"/>
                    
                    <!-- ç‚ºäº†è¦–è¦ºæ¸…æ™°ï¼Œé‡ç¹ªé‡ç–Šéƒ¨åˆ†é‚Šæ¡† -->
                    <path d="M 30 90 L 110 30" stroke="#be123c" stroke-width="2" fill="none"/>
                    <path d="M 30 90 L 110 150" stroke="#be123c" stroke-width="2" fill="none"/>
                    
                    <!-- ç›´è§’è¨˜è™Ÿ D -->
                    <path d="M 105 34 L 109 39 L 114 35" fill="none" stroke="#be123c" stroke-width="1.5"/>
                    
                    <!-- ç›´è§’è¨˜è™Ÿ E -->
                    <path d="M 105 146 L 109 141 L 114 145" fill="none" stroke="#be123c" stroke-width="1.5"/>

                    <!-- é ‚é»æ¨™ç±¤ -->
                    <text x="10" y="95" class="math-text" font-size="16">A</text>
                    <text x="175" y="115" class="math-text" font-size="16">B</text>
                    <text x="175" y="75" class="math-text" font-size="16">C</text>
                    <text x="105" y="25" class="math-text" font-size="16">D</text>
                    <text x="105" y="170" class="math-text" font-size="16">E</text>
                    
                    <!-- AB = AC (é›™æ§“ï¼Œåœ¨æ–œé‚Šä¸Š) -->
                    <line x1="138" y1="98" x2="142" y2="102" stroke="#be123c" stroke-width="2"/>
                    <line x1="141" y1="95" x2="145" y2="99" stroke="#be123c" stroke-width="2"/>
                    
                    <line x1="138" y1="82" x2="142" y2="78" stroke="#be123c" stroke-width="2"/>
                    <line x1="141" y1="85" x2="145" y2="81" stroke="#be123c" stroke-width="2"/>
                `,
                steps: [
                    {
                        instruction: "æ­¥é©Ÿ 1ï¼šå¡«å…¥å·²çŸ¥é‚Šé•·æ¢ä»¶",
                        template: `<span class="math-text">âˆµ <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["AB", "AC", "å·²çŸ¥"],
                        options: [
                            { text: '<span class="segment">AB</span>', value: "AB" },
                            { text: '<span class="segment">AC</span>', value: "AC" },
                            { text: '<span class="segment">AD</span>', value: "AD" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" },
                            { text: "å…¬ç”¨é‚Š", value: "å…¬ç”¨é‚Š" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 2ï¼šå¡«å…¥ç›´è§’æ¢ä»¶",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> = 90Â°</span>`,
                        answers: ["âˆ ADB", "âˆ AEC"],
                        options: [
                            { text: '<span class="angle-sym">âˆ </span>ADB', value: "âˆ ADB" },
                            { text: '<span class="angle-sym">âˆ </span>AEC', value: "âˆ AEC" },
                            { text: '<span class="angle-sym">âˆ </span>ABC', value: "âˆ ABC" },
                            { text: '<span class="angle-sym">âˆ </span>ACB', value: "âˆ ACB" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 3ï¼šå¡«å…¥å·²çŸ¥è§’åº¦æ¢ä»¶",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["âˆ BAD", "âˆ CAE", "å·²çŸ¥"],
                        options: [
                            { text: '<span class="angle-sym">âˆ </span>BAD', value: "âˆ BAD" },
                            { text: '<span class="angle-sym">âˆ </span>CAE', value: "âˆ CAE" },
                            { text: '<span class="angle-sym">âˆ </span>BAC', value: "âˆ BAC" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" },
                            { text: "å°æ‡‰è§’", value: "å°æ‡‰è§’" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 4ï¼šç¢ºèªå…¨ç­‰æ€§è³ª",
                        template: `<span class="math-text">âˆ´ â–³ABD â‰… â–³ACE ( <span class="slot" data-idx="0"></span> å…¨ç­‰æ€§è³ª )</span>`,
                        answers: ["AAS"],
                        options: [
                            { text: "AAS", value: "AAS" },
                            { text: "SAS", value: "SAS" },
                            { text: "ASA", value: "ASA" },
                            { text: "RHS", value: "RHS" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 5ï¼šæ¨å°çµè«–ï¼ˆå°æ‡‰é‚Šç›¸ç­‰ï¼‰",
                        template: `<span class="math-text">æ•… <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> ç›¸ç­‰ )</span>`,
                        answers: ["AD", "AE", "å°æ‡‰é‚Š"],
                        options: [
                            { text: '<span class="segment">AD</span>', value: "AD" },
                            { text: '<span class="segment">AE</span>', value: "AE" },
                            { text: '<span class="segment">BD</span>', value: "BD" },
                            { text: "å°æ‡‰é‚Š", value: "å°æ‡‰é‚Š" },
                            { text: "å°æ‡‰è§’", value: "å°æ‡‰è§’" }
                        ]
                    }
                ]
            },
            {
                id: 4,
                title: "4. RHSå…¨ç­‰è­‰æ˜",
                description: `åœ¨ <span class="math-text">â–³AEF</span> èˆ‡ <span class="math-text">â–³ADF</span> ä¸­ï¼Œå·²çŸ¥ <span class="math-text"><span class="segment">AE</span> = <span class="segment">AD</span></span>ï¼Œ<span class="math-text">âˆ AEF = âˆ ADF = 90Â°</span>ã€‚èªªæ˜ <span class="math-text">â–³AEF <span class="font-normal">â‰…</span> â–³ADF</span>ã€‚`,
                svgContent: `
                    <!-- ç®å½¢çµæ§‹ï¼Œä¿è­‰ AE âŠ¥ EF, AD âŠ¥ DF -->
                    <!-- A(20, 90), F(220, 90) -->
                    <!-- E(180, 10), D(180, 170) -->
                    
                    <!-- Triangle AEF (ä¸Š) -->
                    <path d="M 20 90 L 180 10 L 220 90 Z" fill="#fce7f3" stroke="#be123c" stroke-width="2" stroke-linejoin="round"/>
                    
                    <!-- Triangle ADF (ä¸‹) -->
                    <path d="M 20 90 L 180 170 L 220 90 Z" fill="#fce7f3" stroke="#be123c" stroke-width="2" stroke-linejoin="round"/>
                    
                    <!-- å…±ç”¨é‚Š AF -->
                    <line x1="20" y1="90" x2="220" y2="90" stroke="#000" stroke-width="1.5" stroke-dasharray="4,2"/>

                    <!-- ç›´è§’è¨˜è™Ÿ E -->
                    <path d="M 176 12 L 180 20 L 188 16" fill="none" stroke="#be123c" stroke-width="1.5"/>

                    <!-- ç›´è§’è¨˜è™Ÿ D -->
                    <path d="M 176 168 L 180 160 L 188 164" fill="none" stroke="#be123c" stroke-width="1.5"/>
                    
                    <!-- AE = AD (å–®æ§“) -->
                    <line x1="100" y1="45" x2="108" y2="55" stroke="#be123c" stroke-width="2"/>
                    <line x1="100" y1="135" x2="108" y2="125" stroke="#be123c" stroke-width="2"/>

                    <!-- é ‚é»æ¨™ç±¤ -->
                    <text x="5" y="95" class="math-text" font-size="16">A</text>
                    <text x="225" y="95" class="math-text" font-size="16">F</text>
                    <text x="180" y="5" class="math-text" font-size="16">E</text>
                    <text x="180" y="190" class="math-text" font-size="16">D</text>
                    
                    <!-- è§’1, è§’2 -->
                    <text x="40" y="85" class="math-text" font-size="12" fill="#be123c">1</text>
                    <text x="40" y="105" class="math-text" font-size="12" fill="#be123c">2</text>
                `,
                steps: [
                    {
                        instruction: "æ­¥é©Ÿ 1ï¼šå¡«å…¥å·²çŸ¥é‚Šé•·",
                        template: `<span class="math-text">âˆµ <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["AE", "AD", "å·²çŸ¥"],
                        options: [
                            { text: '<span class="segment">AE</span>', value: "AE" },
                            { text: '<span class="segment">AD</span>', value: "AD" },
                            { text: '<span class="segment">EF</span>', value: "EF" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" },
                            { text: "å…±ç”¨é‚Š", value: "å…±ç”¨é‚Š" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 2ï¼šç¢ºèªç›´è§’æ¢ä»¶",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> = 90Â°</span>`,
                        answers: ["âˆ AEF", "âˆ ADF"],
                        options: [
                            { text: '<span class="angle-sym">âˆ </span>AEF', value: "âˆ AEF" },
                            { text: '<span class="angle-sym">âˆ </span>ADF', value: "âˆ ADF" },
                            { text: '<span class="angle-sym">âˆ </span>EAF', value: "âˆ EAF" },
                            { text: '<span class="angle-sym">âˆ </span>DAF', value: "âˆ DAF" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 3ï¼šæ‰¾å‡ºéš±è—çš„æ–œé‚Š",
                        template: `<span class="math-text"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> )</span>`,
                        answers: ["AF", "AF", "å…±ç”¨é‚Š"],
                        options: [
                            { text: '<span class="segment">AF</span>', value: "AF" },
                            { text: '<span class="segment">AF</span>', value: "AF" },
                            { text: '<span class="segment">EF</span>', value: "EF" },
                            { text: "å…±ç”¨é‚Š", value: "å…±ç”¨é‚Š" },
                            { text: "å·²çŸ¥", value: "å·²çŸ¥" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 4ï¼šç¢ºèªå…¨ç­‰æ€§è³ª",
                        template: `<span class="math-text">âˆ´ â–³AEF â‰… â–³ADF ( <span class="slot" data-idx="0"></span> å…¨ç­‰æ€§è³ª )</span>`,
                        answers: ["RHS"],
                        options: [
                            { text: "RHS", value: "RHS" },
                            { text: "SAS", value: "SAS" },
                            { text: "SSS", value: "SSS" },
                            { text: "AAS", value: "AAS" }
                        ]
                    },
                    {
                        instruction: "æ­¥é©Ÿ 5ï¼šæ¨å°çµè«–ï¼ˆå°æ‡‰è§’ç›¸ç­‰ï¼‰",
                        template: `<span class="math-text">æ•… <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( <span class="slot" data-idx="2"></span> ç›¸ç­‰ )</span>`,
                        answers: ["âˆ 1", "âˆ 2", "å°æ‡‰è§’"],
                        options: [
                            { text: '<span class="angle-sym">âˆ </span>1', value: "âˆ 1" },
                            { text: '<span class="angle-sym">âˆ </span>2', value: "âˆ 2" },
                            { text: '<span class="angle-sym">âˆ </span>E', value: "âˆ E" },
                            { text: "å°æ‡‰è§’", value: "å°æ‡‰è§’" },
                            { text: "å°æ‡‰é‚Š", value: "å°æ‡‰é‚Š" }
                        ]
                    }
                ]
            }
        ];

        // === ç‹€æ…‹ç®¡ç† ===
        let currentProblemId = 1;
        // ç´€éŒ„é€²åº¦ï¼š { problemId: currentStepIndex }
        let progressState = { 1: 0, 2: 0, 3: 0, 4: 0 }; 
        
        // === åˆå§‹åŒ– ===
        document.addEventListener('DOMContentLoaded', () => {
            initNavbar();
            initAllProblems();
            switchProblem(1);
        });

        function initNavbar() {
            const navbar = document.getElementById('navbar');
            navbar.innerHTML = '<span class="font-bold text-lg flex-shrink-0 mr-4">SPEDMIX æ•¸å­¸</span>';
            
            problems.forEach(p => {
                const btn = document.createElement('button');
                btn.id = `nav-btn-${p.id}`;
                btn.className = "nav-btn px-4 py-1.5 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full text-sm font-medium whitespace-nowrap transition border border-white border-opacity-30 mr-2";
                btn.innerText = p.title;
                btn.onclick = () => switchProblem(p.id);
                navbar.appendChild(btn);
            });
        }

        // ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰é¡Œç›®çš„ DOM çµæ§‹ï¼Œç”¨ CSS æ§åˆ¶é¡¯ç¤º
        function initAllProblems() {
            const mainContainer = document.getElementById('main-container');
            mainContainer.innerHTML = '';

            problems.forEach(problem => {
                const wrapper = document.createElement('div');
                wrapper.id = `problem-${problem.id}`;
                wrapper.className = "problem-wrapper w-full h-full flex-col md:flex-row";
                
                // === å·¦å´ï¼šé¡Œç›®å€ ===
                const leftCol = document.createElement('div');
                leftCol.className = "w-full md:w-1/3 bg-white border-b md:border-b-0 md:border-r border-gray-200 flex flex-col z-10 shadow-sm md:shadow-none";
                leftCol.innerHTML = `
                    <div class="p-4 md:p-6 overflow-y-auto">
                        <div class="mb-4">
                            <span class="inline-block px-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-bold rounded mb-2">è­‰æ˜é¡Œ</span>
                            <h2 class="text-xl font-bold text-gray-800 leading-tight">${problem.description}</h2>
                        </div>
                        <div class="flex justify-center my-2">
                            <svg width="280" height="220" viewBox="0 0 240 200" class="filter drop-shadow-sm">
                                ${problem.svgContent}
                            </svg>
                        </div>
                        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800">
                            <p class="font-bold flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                æç¤ºï¼š
                            </p>
                            <ul class="list-disc list-inside ml-1 mt-1 space-y-1">
                                <li>æ‰¾å‡ºå·²çŸ¥çš„ç­‰é•·é‚Šã€‚</li>
                                <li>è§€å¯Ÿæ˜¯å¦æœ‰ç›´è§’æˆ–å…±ç”¨é‚Šã€‚</li>
                                <li>ç¢ºèªå…¨ç­‰æ€§è³ª (SSS, SAS, AAS, RHS, ASA)ã€‚</li>
                            </ul>
                        </div>
                    </div>
                `;
                wrapper.appendChild(leftCol);

                // === å³å´ï¼šæ­¥é©Ÿå€ ===
                const rightCol = document.createElement('div');
                rightCol.className = "w-full md:w-2/3 bg-gray-50 flex flex-col relative";
                
                const stepsArea = document.createElement('div');
                stepsArea.id = `steps-area-${problem.id}`;
                stepsArea.className = "flex-1 overflow-y-auto p-4 md:p-8 space-y-6 pb-24 scroll-smooth";
                
                // æ¸²æŸ“æ­¥é©Ÿ
                problem.steps.forEach((step, sIdx) => {
                    const stepEl = document.createElement('div');
                    stepEl.id = `p${problem.id}-step-${sIdx}`;
                    stepEl.className = `step-container bg-white p-5 rounded-2xl shadow-sm border border-gray-100 ${sIdx === 0 ? 'active' : ''}`;
                    
                    // æ¨™é¡Œ
                    stepEl.innerHTML = `
                        <div class="flex justify-between items-center mb-4 border-b border-gray-100 pb-2">
                            <h3 class="font-bold text-gray-700 text-lg flex items-center">
                                <span class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mr-2 text-sm">${sIdx + 1}</span>
                                ${step.instruction}
                            </h3>
                            <span class="status-badge hidden px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">âœ” å®Œæˆ</span>
                        </div>
                    `;

                    // å¡«ç­”å…§å®¹
                    const content = document.createElement('div');
                    content.className = "mb-6 text-xl md:text-2xl leading-loose pl-2";
                    content.innerHTML = step.template;
                    // ç¶å®š Slot é»æ“Šäº‹ä»¶
                    content.querySelectorAll('.slot').forEach(slot => {
                        slot.dataset.pId = problem.id;
                        slot.dataset.sIdx = sIdx;
                        slot.addEventListener('click', function() {
                             clearSlot(this);
                        });
                    });
                    stepEl.appendChild(content);

                    // é¸é …å€
                    const optionsArea = document.createElement('div');
                    optionsArea.className = "options-area";
                    
                    const btnsContainer = document.createElement('div');
                    btnsContainer.className = "flex flex-wrap gap-3 mb-4";
                    
                    step.options.forEach(opt => {
                        const btn = document.createElement('button');
                        btn.className = "option-btn";
                        btn.innerHTML = opt.text;
                        btn.dataset.value = opt.value;
                        btn.onclick = function() { handleOptionClick(problem.id, sIdx, opt.value, this); };
                        btnsContainer.appendChild(btn);
                    });
                    optionsArea.appendChild(btnsContainer);

                    // æª¢æŸ¥æŒ‰éˆ•
                    const checkBtn = document.createElement('button');
                    checkBtn.className = "w-full py-3 rounded-xl font-bold text-white bg-gray-400 cursor-not-allowed transition shadow-sm";
                    checkBtn.innerText = "æª¢æŸ¥ç­”æ¡ˆ";
                    checkBtn.disabled = true;
                    checkBtn.id = `p${problem.id}-check-${sIdx}`;
                    checkBtn.onclick = function() { checkAnswer(problem.id, sIdx); };
                    optionsArea.appendChild(checkBtn);

                    // è¨Šæ¯å€
                    const msgBox = document.createElement('div');
                    msgBox.id = `p${problem.id}-msg-${sIdx}`;
                    msgBox.className = "mt-3 text-center text-sm font-bold min-h-[20px]";
                    optionsArea.appendChild(msgBox);

                    stepEl.appendChild(optionsArea);
                    stepsArea.appendChild(stepEl);
                });

                rightCol.appendChild(stepsArea);
                wrapper.appendChild(rightCol);
                mainContainer.appendChild(wrapper);
            });
        }

        function switchProblem(id) {
            currentProblemId = id;
            
            // UI åˆ‡æ›
            document.querySelectorAll('.problem-wrapper').forEach(el => el.classList.remove('active-problem'));
            document.getElementById(`problem-${id}`).classList.add('active-problem');

            // å°è¦½åˆ—ç‹€æ…‹æ›´æ–°
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-btn-${id}`).classList.add('active');

            // ç¢ºä¿ç•¶å‰é€²åº¦çš„æ­¥é©Ÿæ˜¯è§£é–ç‹€æ…‹
            const stepIdx = progressState[id];
            unlockStep(id, stepIdx);
        }

        // === äº’å‹•é‚è¼¯ ===
        
        function unlockStep(pId, stepIdx) {
            const stepEl = document.getElementById(`p${pId}-step-${stepIdx}`);
            if(stepEl) {
                stepEl.classList.add('active');
                setTimeout(() => {
                    if(document.getElementById(`problem-${pId}`).classList.contains('active-problem')){
                        stepEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            }
        }

        function handleOptionClick(pId, sIdx, value, btn) {
            const stepEl = document.getElementById(`p${pId}-step-${sIdx}`);
            const slots = Array.from(stepEl.querySelectorAll('.slot'));
            const emptySlot = slots.find(s => !s.dataset.value);

            if (emptySlot) {
                // å¡«å…¥é‚è¼¯
                const problem = problems.find(p => p.id === pId);
                const optData = problem.steps[sIdx].options.find(o => o.value === value);
                
                emptySlot.innerHTML = optData.text;
                emptySlot.dataset.value = value;
                emptySlot.classList.add('filled');
                
                // æ¨™è¨˜è©² slot æ˜¯ç”±å“ªå€‹æŒ‰éˆ•è§¸ç™¼ï¼ˆç”¨æ–¼æ¢å¾©ï¼‰
                btn.disabled = true;

                // æª¢æŸ¥æ˜¯å¦å…¨å¡«æ»¿
                const allFilled = slots.every(s => s.dataset.value);
                const checkBtn = document.getElementById(`p${pId}-check-${sIdx}`);
                if (allFilled) {
                    checkBtn.disabled = false;
                    checkBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    checkBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700', 'shadow-indigo-200');
                }
                
                playSound('pop');
            }
        }

        function clearSlot(slot) {
            if (slot.classList.contains('correct')) return;
            if (!slot.dataset.value) return;

            const pId = slot.dataset.pId;
            const sIdx = slot.dataset.sIdx;
            const val = slot.dataset.value;

            // æ¢å¾©å°æ‡‰çš„æŒ‰éˆ•
            const stepEl = document.getElementById(`p${pId}-step-${sIdx}`);
            const btn = Array.from(stepEl.querySelectorAll('.option-btn')).find(b => b.dataset.value === val && b.disabled);
            if (btn) btn.disabled = false;

            // æ¸…ç©º
            slot.innerHTML = '';
            delete slot.dataset.value;
            slot.classList.remove('filled', 'error');

            // ç¦ç”¨æª¢æŸ¥æŒ‰éˆ•
            const checkBtn = document.getElementById(`p${pId}-check-${sIdx}`);
            checkBtn.disabled = true;
            checkBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
            checkBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
            
            document.getElementById(`p${pId}-msg-${sIdx}`).innerText = '';
        }

        function checkAnswer(pId, sIdx) {
            const problem = problems.find(p => p.id === pId);
            const stepEl = document.getElementById(`p${pId}-step-${sIdx}`);
            const slots = stepEl.querySelectorAll('.slot');
            const correctAns = problem.steps[sIdx].answers;
            const msgBox = document.getElementById(`p${pId}-msg-${sIdx}`);

            let isCorrect = true;
            slots.forEach((slot, i) => {
                if (slot.dataset.value !== correctAns[i]) {
                    isCorrect = false;
                    slot.classList.add('error');
                    setTimeout(() => slot.classList.remove('error'), 500);
                }
            });

            if (isCorrect) {
                // æ­£ç¢º
                slots.forEach(s => s.classList.add('correct'));
                msgBox.innerHTML = '<span class="text-green-600">ğŸ‰ ç­”å°äº†ï¼</span>';
                stepEl.classList.add('completed');
                stepEl.querySelector('.status-badge').classList.remove('hidden');

                const nextIdx = sIdx + 1;
                if (nextIdx < problem.steps.length) {
                    progressState[pId] = nextIdx;
                    setTimeout(() => unlockStep(pId, nextIdx), 600);
                } else {
                    setTimeout(showCompletionModal, 800);
                }
                playSound('success');
            } else {
                msgBox.innerHTML = '<span class="text-red-500">ğŸ¤” å†æƒ³æƒ³çœ‹å–”ï¼</span>';
                playSound('error');
            }
        }

        // === æ¨¡æ…‹çª—èˆ‡é‡ç½® ===
        function showCompletionModal() {
            const modal = document.getElementById('completion-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('modal-content').classList.add('modal-enter-active');
            }, 10);
            createConfetti();
        }

        function closeModal() {
            document.getElementById('completion-modal').classList.add('hidden');
        }

        function resetCurrentProblem() {
            closeModal();
            const pId = currentProblemId;
            progressState[pId] = 0;
            
            const problem = problems.find(p => p.id === pId);
            const stepsArea = document.getElementById(`steps-area-${pId}`);
            
            const stepEls = stepsArea.querySelectorAll('.step-container');
            stepEls.forEach((el, idx) => {
                el.classList.remove('active', 'completed');
                if (idx === 0) el.classList.add('active');
                
                el.querySelector('.status-badge').classList.add('hidden');
                el.querySelector('.options-area').style.display = '';

                const slots = el.querySelectorAll('.slot');
                slots.forEach(s => {
                    s.innerHTML = '';
                    delete s.dataset.value;
                    s.classList.remove('filled', 'correct', 'error');
                });

                const btns = el.querySelectorAll('.option-btn');
                btns.forEach(b => b.disabled = false);

                const checkBtn = el.querySelector('button[id^="p"][id*="-check-"]');
                checkBtn.disabled = true;
                checkBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                checkBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');

                el.querySelector('div[id^="p"][id*="-msg-"]').innerHTML = '';
            });
            
            stepsArea.scrollTop = 0;
            setTimeout(() => unlockStep(pId, 0), 100);
        }

        function playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'pop') {
                osc.frequency.setValueAtTime(600, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.start(); osc.stop(ctx.currentTime + 0.1);
            } else if (type === 'success') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, ctx.currentTime);
                osc.frequency.setValueAtTime(600, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.3);
                osc.start(); osc.stop(ctx.currentTime + 0.3);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, ctx.currentTime);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.2);
                osc.start(); osc.stop(ctx.currentTime + 0.2);
            }
        }

        function createConfetti() {
            const colors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'];
            for(let i=0; i<30; i++) {
                const el = document.createElement('div');
                Object.assign(el.style, {
                    position: 'fixed', left: '50%', top: '50%', width: '10px', height: '10px',
                    backgroundColor: colors[Math.floor(Math.random()*colors.length)], zIndex: '101'
                });
                document.body.appendChild(el);
                const angle = Math.random() * Math.PI * 2;
                el.animate([
                    { transform: `translate(0,0) scale(1)`, opacity: 1 },
                    { transform: `translate(${Math.cos(angle)*200}px, ${Math.sin(angle)*200}px) scale(0)`, opacity: 0 }
                ], { duration: 1000 + Math.random() * 500, fill: 'forwards' }).onfinish = () => el.remove();
            }
        }
    </script>
</body>
</html>