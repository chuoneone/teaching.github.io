<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”ã€	åˆ¤åˆ¥å¤§å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            overscroll-behavior: none;
        }

        /* äº’å‹•å…ƒä»¶æ¨£å¼ - é…åˆ KaTeX èª¿æ•´å°é½Š */
        .slot {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 3.5rem;
            height: 3rem;
            border-bottom: 3px solid #94a3b8;
            background-color: #f8fafc;
            color: #334155;
            font-weight: bold;
            font-size: 1.5rem;
            margin: 0 4px;
            cursor: pointer;
            transition: all 0.2s;
            vertical-align: middle; /* é…åˆ KaTeX å‚ç›´ç½®ä¸­ */
            border-radius: 4px 4px 0 0;
            position: relative;
            top: -2px; /* å¾®èª¿ä»¥å°é½Šæ•¸å­¸å¼åŸºç·š */
        }
        
        .slot.filled {
            border-color: #3b82f6;
            background-color: #eff6ff;
            color: #1d4ed8;
        }

        .slot.correct {
            border-color: #22c55e;
            background-color: #f0fdf4;
            color: #15803d;
        }

        /* é¸é …æŒ‰éˆ•æ¨£å¼ */
        .option-btn {
            touch-action: manipulation;
            user-select: none;
            transition: all 0.1s;
            box-shadow: 0 2px 0 #cbd5e1;
            font-family: 'KaTeX_Main', 'Times New Roman', serif; /* è®“æ•¸å­—å­—é«”èˆ‡æ•¸å­¸å¼ä¸€è‡´ */
        }
        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: none;
        }
        .option-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            background-color: #e2e8f0;
            color: #94a3b8;
            border-color: transparent;
        }

        /* å‹•ç•« */
        @keyframes tada {
            0% { transform: scale(1); }
            10%, 20% { transform: scale(0.9) rotate(-3deg); }
            30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
            40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
            100% { transform: scale(1) rotate(0); }
        }
        .animate-tada {
            animation: tada 1s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.4s;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* è®“ KaTeX çš„å­—é«”ç¨å¾®å¤§ä¸€é»ä»¥ç¬¦åˆæ•™å­¸éœ€æ±‚ */
        .katex {
            font-size: 1.3em !important;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col overflow-hidden text-gray-800">

    <!-- å°è¦½åˆ— -->
    <header class="bg-white shadow-sm z-20 shrink-0">
        <div class="flex items-center overflow-x-auto no-scrollbar py-3 px-4 gap-3 border-b border-gray-200">
            <span class="font-bold text-gray-700 whitespace-nowrap px-2 border-r border-gray-300 pr-4">
                äº”ã€åˆ¤åˆ¥å¤§å°
            </span>
            <div id="nav-container" class="flex gap-2">
                <!-- JS å‹•æ…‹ç”Ÿæˆé¡Œç›®æŒ‰éˆ• -->
            </div>
        </div>
    </header>

    <!-- ä¸»å…§å®¹å€ -->
    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <!-- å·¦å´ï¼šé¡Œç›®å€ -->
        <section class="md:w-1/3 bg-slate-50 border-r border-gray-200 flex flex-col shrink-0 md:h-full max-h-[35vh] md:max-h-full overflow-y-auto z-10 shadow-md md:shadow-none">
            <div class="p-6 sticky top-0">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-800 mb-3 flex items-center gap-2">
                        <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm shrink-0">Q</span>
                        <span id="question-title">é¡Œç›®è¼‰å…¥ä¸­...</span>
                    </h2>
                    <div id="question-content" class="text-lg leading-loose text-slate-700 space-y-2">
                        <!-- é¡Œç›®å…§å®¹ -->
                    </div>
                </div>
                <div class="mt-4 p-4 bg-blue-50 rounded-lg text-blue-800 text-sm">
                    <p class="font-bold mb-1">ğŸ’¡ æç¤ºï¼š</p>
                    <p>è«‹ä¾ç…§å³å´(æˆ–ä¸‹æ–¹)çš„æ­¥é©Ÿï¼Œé»æ“Šé¸é …å®Œæˆè§£é¡Œã€‚</p>
                </div>
            </div>
        </section>

        <!-- å³å´ï¼šæ­¥é©Ÿè§£é¡Œå€ -->
        <section id="steps-container" class="flex-1 bg-gray-50/50 p-4 md:p-8 overflow-y-auto scroll-smooth pb-32">
            <!-- JS å‹•æ…‹ç”Ÿæˆæ­¥é©Ÿå¡ç‰‡ -->
        </section>

    </main>

    <!-- å®Œæˆè¦–çª— (Modal) -->
    <div id="completion-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center transform scale-90 transition-transform duration-300" id="modal-content">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">å¤ªæ£’äº†ï¼å®Œæˆï¼</h3>
            <p class="text-gray-500 mb-6">ä½ å·²ç¶“å®Œæˆäº†é€™é¡Œçš„æ‰€æœ‰æ­¥é©Ÿã€‚</p>
            <div class="flex flex-col gap-3">
                <button onclick="app.resetCurrentQuestion()" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition shadow-lg active:scale-95">
                    å†åšä¸€æ¬¡
                </button>
                <button onclick="app.closeModal()" class="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-bold transition active:scale-95">
                    é—œé–‰è¦–çª— (ä¿ç•™ç´€éŒ„)
                </button>
            </div>
        </div>
    </div>

    <!-- è…³æœ¬ -->
    <script>
        // è³‡æ–™å®šç¾© (ä½¿ç”¨ LaTeX èªæ³•)
        const questions = [
            {
                id: 1,
                title: "åˆ¤åˆ¥å¹³æ–¹å¤§å°",
                content: `
                    <p>åœ¨ä¸‹åˆ—ç©ºæ ¼å¡«å…¥ <span class="text-blue-600 font-bold">ï¼</span>ã€<span class="text-blue-600 font-bold">ï¼</span> æˆ– <span class="text-blue-600 font-bold">ï¼œ</span>ï¼š</p>
                    <div class="mt-2 pl-2 border-l-4 border-blue-400">
                        <p>1. å·²çŸ¥ \\(a, b\\) ç‚º<mark class="bg-yellow-200 px-1 rounded">æ­£æ•¸</mark>ä¸” \\(a > b\\)</p>
                        <p class="ml-4">å‰‡ \\(a^2\\) ______ \\(b^2\\)ã€‚</p>
                    </div>
                    <div class="mt-2 pl-2 border-l-4 border-red-400">
                        <p>2. å·²çŸ¥ \\(a, b\\) ç‚º<mark class="bg-red-200 px-1 rounded">è² æ•¸</mark>ä¸” \\(a < b\\)</p>
                        <p class="ml-4">å‰‡ \\(a^2\\) ______ \\(b^2\\)ã€‚</p>
                    </div>
                `,
                steps: [
                    {
                        instruction: "ã€ç·´ç¿’1ã€‘å‡è¨­æ­£æ•¸ \\(a=3, b=2\\) (ç¬¦åˆ \\(a>b\\))ï¼Œç®—å‡ºå¹³æ–¹ï¼š",
                        slots: [
                            { correct: "9", type: "text" },
                            { correct: "4", type: "text" },
                            { correct: "ï¼", type: "symbol" }
                        ],
                        // Slot æ”¾åœ¨ LaTeX å¤–éƒ¨ï¼Œæˆ–åœ¨ LaTeX ä¸­æ–·è™•æ’å…¥
                        template: "\\(3^2 = \\) {0} ï¼Œ \\(2^2 = \\) {1} <br>æ‰€ä»¥ \\(9\\) {2} \\(4\\)",
                        options: ["9", "4", "ï¼", "ï¼œ", "ï¼"]
                    },
                    {
                        instruction: "ã€çµè«–1ã€‘æ­£æ•¸æ¯”è¼ƒï¼šè‹¥ \\(a > b\\)ï¼Œå‰‡ï¼š",
                        slots: [
                            { correct: "ï¼", type: "symbol" }
                        ],
                        template: "\\(a^2\\) {0} \\(b^2\\)",
                        options: ["ï¼", "ï¼œ", "ï¼"]
                    },
                    {
                        instruction: "ã€ç·´ç¿’2ã€‘å‡è¨­è² æ•¸ \\(a=-3, b=-2\\) (ç¬¦åˆ \\(a<b\\))ï¼Œç®—å‡ºå¹³æ–¹ï¼š",
                        slots: [
                            { correct: "9", type: "text" },
                            { correct: "4", type: "text" },
                            { correct: "ï¼", type: "symbol" }
                        ],
                        template: "\\((-3)^2 = \\) {0} ï¼Œ \\((-2)^2 = \\) {1} <br>æ‰€ä»¥ \\(9\\) {2} \\(4\\)",
                        options: ["9", "-9", "4", "-4", "ï¼", "ï¼œ"]
                    },
                    {
                        instruction: "ã€çµè«–2ã€‘è² æ•¸æ¯”è¼ƒï¼šè‹¥ \\(a, b\\) è² æ•¸ä¸” \\(a < b\\)ï¼Œå¹³æ–¹å¾Œï¼š",
                        slots: [
                            { correct: "ï¼", type: "symbol" }
                        ],
                        template: "\\(a^2\\) {0} \\(b^2\\) <span class='text-sm text-gray-500'>(è² è² å¾—æ­£ï¼Œæ•¸å­—å¤§çš„å¹³æ–¹æ›´å¤§)</span>",
                        options: ["ï¼", "ï¼œ", "ï¼"]
                    }
                ]
            },
            {
                id: 2,
                title: "åˆ¤åˆ¥æ ¹è™Ÿèˆ‡çµ•å°å€¼",
                content: `
                    <p>åœ¨ä¸‹åˆ—ç©ºæ ¼å¡«å…¥ <span class="text-blue-600 font-bold">ï¼</span>ã€<span class="text-blue-600 font-bold">ï¼</span> æˆ– <span class="text-blue-600 font-bold">ï¼œ</span>ï¼š</p>
                    <div class="mt-2 pl-2 border-l-4 border-blue-400">
                        <p>1. å·²çŸ¥ \\(a, b\\) ç‚º<mark class="bg-yellow-200 px-1 rounded">æ­£æ•¸</mark>ä¸” \\(a > b\\)</p>
                        <p class="ml-4">å‰‡ \\(\\sqrt{a}\\) ______ \\(\\sqrt{b}\\)ã€‚</p>
                    </div>
                    <div class="mt-2 pl-2 border-l-4 border-red-400">
                        <p>2. å·²çŸ¥ \\(a, b\\) ç‚º<mark class="bg-red-200 px-1 rounded">è² æ•¸</mark>ä¸” \\(a < b\\)</p>
                        <p class="ml-4">å‰‡ \\(|a|\\) ______ \\(|b|\\)ã€‚</p>
                    </div>
                `,
                steps: [
                    {
                        instruction: "ã€ç·´ç¿’1ã€‘å‡è¨­æ­£æ•¸ \\(a=16, b=9\\) (ç¬¦åˆ \\(a>b\\))ï¼Œé–‹æ ¹è™Ÿï¼š",
                        slots: [
                            { correct: "4", type: "text" },
                            { correct: "3", type: "text" },
                            { correct: "ï¼", type: "symbol" }
                        ],
                        template: "\\(\\sqrt{16} = \\) {0} ï¼Œ \\(\\sqrt{9} = \\) {1} <br>æ‰€ä»¥ \\(4\\) {2} \\(3\\)",
                        options: ["4", "3", "ï¼", "ï¼œ", "ï¼"]
                    },
                    {
                        instruction: "ã€çµè«–1ã€‘æ­£æ•¸é–‹æ ¹è™Ÿï¼šè‹¥ \\(a > b\\)ï¼Œå‰‡ï¼š",
                        slots: [
                            { correct: "ï¼", type: "symbol" }
                        ],
                        template: "\\(\\sqrt{a}\\) {0} \\(\\sqrt{b}\\)",
                        options: ["ï¼", "ï¼œ", "ï¼"]
                    },
                    {
                        instruction: "ã€ç·´ç¿’2ã€‘æ¯”è¼ƒçµ•å°å€¼ (è·é›¢)ï¼šå‡è¨­ \\(a=-5, b=-2\\) (ç¬¦åˆ \\(a<b\\))ï¼š",
                        slots: [
                            { correct: "5", type: "text" },
                            { correct: "2", type: "text" },
                            { correct: "ï¼", type: "symbol" }
                        ],
                        template: "\\(|-5| = \\) {0} ï¼Œ \\(|-2| = \\) {1} <br>æ‰€ä»¥ \\(5\\) {2} \\(2\\)",
                        options: ["5", "-5", "2", "-2", "ï¼", "ï¼œ"]
                    },
                    {
                        instruction: "ã€çµè«–2ã€‘è² æ•¸çµ•å°å€¼ï¼šè‹¥ \\(a, b\\) è² æ•¸ä¸” \\(a < b\\) (aæ¯”è¼ƒå°ï¼Œé›¢0æ¯”è¼ƒé )ï¼š",
                        slots: [
                            { correct: "ï¼", type: "symbol" }
                        ],
                        template: "\\(|a|\\) {0} \\(|b|\\)",
                        options: ["ï¼", "ï¼œ", "ï¼"]
                    }
                ]
            }
        ];

        class App {
            constructor() {
                this.currentQuestionIdx = 0;
                this.currentStepIdx = 0;
                this.answers = {};
                
                this.navContainer = document.getElementById('nav-container');
                this.questionTitle = document.getElementById('question-title');
                this.questionContent = document.getElementById('question-content');
                this.stepsContainer = document.getElementById('steps-container');
                this.completionModal = document.getElementById('completion-modal');
                this.modalContent = document.getElementById('modal-content');

                this.init();
            }

            init() {
                this.renderNav();
                this.loadQuestion(0);
            }
            
            // è¼”åŠ©å‡½å¼ï¼šæ¸²æŸ“æ•¸å­¸å¼
            renderMath(element) {
                if (window.renderMathInElement) {
                    renderMathInElement(element, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '\\(', right: '\\)', display: false}
                        ],
                        throwOnError: false
                    });
                } else {
                    // è‹¥ KaTeX å°šæœªè¼‰å…¥å®Œæˆï¼Œå»¶é²é‡è©¦
                    setTimeout(() => this.renderMath(element), 100);
                }
            }

            renderNav() {
                this.navContainer.innerHTML = '';
                questions.forEach((q, idx) => {
                    const btn = document.createElement('button');
                    btn.className = `px-4 py-2 rounded-full text-sm font-bold transition whitespace-nowrap ${
                        idx === this.currentQuestionIdx 
                        ? 'bg-blue-600 text-white shadow-md' 
                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                    }`;
                    btn.textContent = `é¡Œç›® ${idx + 1}`;
                    btn.onclick = () => this.switchQuestion(idx);
                    this.navContainer.appendChild(btn);
                });
            }

            switchQuestion(idx) {
                if (idx === this.currentQuestionIdx) return;
                this.currentQuestionIdx = idx;
                this.renderNav();
                this.loadQuestion(idx);
            }

            loadQuestion(idx) {
                const q = questions[idx];
                this.currentStepIdx = 0;
                this.answers = {};
                
                this.questionTitle.textContent = q.title;
                this.questionContent.innerHTML = q.content;
                
                // æ¸²æŸ“é¡Œç›®çš„æ•¸å­¸å¼
                this.renderMath(this.questionContent);

                this.renderSteps();
                
                this.stepsContainer.scrollTop = 0;
                document.querySelector('section.overflow-y-auto').scrollTop = 0;
            }
            
            resetCurrentQuestion() {
                this.closeModal();
                this.loadQuestion(this.currentQuestionIdx);
            }

            renderSteps() {
                this.stepsContainer.innerHTML = '';
                const q = questions[this.currentQuestionIdx];

                q.steps.forEach((step, stepIdx) => {
                    const isLocked = stepIdx > this.currentStepIdx;
                    const isCompleted = stepIdx < this.currentStepIdx;
                    const isCurrent = stepIdx === this.currentStepIdx;

                    const card = document.createElement('div');
                    card.className = `bg-white rounded-xl shadow-sm border-2 p-5 mb-6 transition-all duration-500 ${
                        isLocked ? 'opacity-40 blur-[1px] pointer-events-none border-gray-100' : 
                        isCompleted ? 'border-green-400 bg-green-50/30' : 
                        'border-blue-500 shadow-md ring-4 ring-blue-50'
                    }`;
                    
                    if (isCurrent) {
                        card.id = `step-card-${stepIdx}`;
                    }

                    let headerHtml = `<div class="flex justify-between items-center mb-4">
                        <span class="font-bold text-lg ${isCurrent ? 'text-blue-700' : 'text-gray-700'}">Step ${stepIdx + 1}</span>
                        ${isCompleted ? '<span class="text-green-600 font-bold flex items-center gap-1"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg> å®Œæˆ</span>' : ''}
                    </div>`;

                    let instructionHtml = `<div class="mb-4 text-gray-800 font-medium text-lg">${step.instruction}</div>`;

                    let contentHtml = step.template;
                    step.slots.forEach((slot, slotIdx) => {
                        const savedVal = (this.answers[stepIdx] && this.answers[stepIdx][slotIdx]) || "";
                        const isFilled = savedVal !== "";
                        
                        const slotHtml = `<div class="slot ${isFilled ? 'filled' : ''} ${isCompleted ? 'correct border-b-0' : ''}" 
                            data-step="${stepIdx}" 
                            data-slot="${slotIdx}"
                            onclick="app.handleSlotClick(${stepIdx}, ${slotIdx})">
                            ${savedVal}
                        </div>`;
                        
                        contentHtml = contentHtml.replace(`{${slotIdx}}`, slotHtml);
                    });

                    let optionsHtml = '';
                    if (!isCompleted) {
                        optionsHtml = `<div class="mt-6 pt-4 border-t border-gray-100 grid grid-cols-4 md:flex md:flex-wrap gap-3" id="options-${stepIdx}">
                            ${step.options.map((opt) => {
                                // åˆ¤æ–·æ˜¯å¦ç‚ºæ•¸å­—é‚„æ˜¯ç¬¦è™Ÿï¼Œèª¿æ•´é¡¯ç¤ºå­—é«” (KaTeX å­—é«”é€šå¸¸æ¯”è¼ƒå¥½çœ‹)
                                return `<button class="option-btn bg-white border-2 border-slate-200 text-slate-700 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 py-2 px-4 rounded-lg text-xl font-bold"
                                    onclick="app.handleOptionClick(${stepIdx}, '${opt}', this)"
                                    data-val="${opt}">
                                    ${opt}
                                </button>`;
                            }).join('')}
                        </div>`;
                        
                        optionsHtml += `<div class="mt-4 flex gap-3">
                            <button onclick="app.checkStep(${stepIdx})" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md active:scale-95 transition text-lg tracking-wide">
                                æª¢æŸ¥ç­”æ¡ˆ
                            </button>
                        </div>
                        <div id="feedback-${stepIdx}" class="mt-2 text-center font-bold min-h-[1.5rem] text-red-500"></div>`;
                    }

                    card.innerHTML = headerHtml + instructionHtml + `<div class="bg-white/50 rounded-lg py-2 leading-relaxed text-xl">${contentHtml}</div>` + optionsHtml;
                    this.stepsContainer.appendChild(card);
                    
                    if (!isCompleted && !isLocked) {
                        this.updateOptionStates(stepIdx);
                    }
                });

                // æ­¥é©Ÿæ¸²æŸ“å®Œç•¢å¾Œï¼ŒåŸ·è¡Œ KaTeX è½‰æ›
                this.renderMath(this.stepsContainer);
            }

            handleOptionClick(stepIdx, val, btnElem) {
                const slots = document.querySelectorAll(`.slot[data-step="${stepIdx}"]`);
                let targetSlot = null;
                let targetSlotIdx = -1;

                if (!this.answers[stepIdx]) this.answers[stepIdx] = [];
                
                for (let i = 0; i < slots.length; i++) {
                    if (!this.answers[stepIdx][i]) {
                        targetSlot = slots[i];
                        targetSlotIdx = i;
                        break;
                    }
                }

                if (targetSlot) {
                    this.answers[stepIdx][targetSlotIdx] = val;
                    targetSlot.textContent = val;
                    targetSlot.classList.add('filled', 'animate-tada');
                    setTimeout(() => targetSlot.classList.remove('animate-tada'), 500);
                    btnElem.disabled = true;
                    
                    const feedback = document.getElementById(`feedback-${stepIdx}`);
                    if(feedback) feedback.textContent = '';
                }
            }

            handleSlotClick(stepIdx, slotIdx) {
                if (stepIdx !== this.currentStepIdx) return;
                
                const currentVal = this.answers[stepIdx]?.[slotIdx];
                if (!currentVal) return;

                this.answers[stepIdx][slotIdx] = null;
                const slot = document.querySelector(`.slot[data-step="${stepIdx}"][data-slot="${slotIdx}"]`);
                if(slot) {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
                this.updateOptionStates(stepIdx);
            }

            updateOptionStates(stepIdx) {
                const usedValues = this.answers[stepIdx] ? [...this.answers[stepIdx]] : [];
                const buttons = document.querySelectorAll(`#options-${stepIdx} .option-btn`);
                
                buttons.forEach(btn => btn.disabled = false);

                usedValues.forEach(val => {
                    if (val) {
                        for (let btn of buttons) {
                            if (btn.dataset.val === val && !btn.disabled) {
                                btn.disabled = true;
                                break;
                            }
                        }
                    }
                });
            }

            checkStep(stepIdx) {
                const q = questions[this.currentQuestionIdx];
                const step = q.steps[stepIdx];
                const userAns = this.answers[stepIdx] || [];
                const feedback = document.getElementById(`feedback-${stepIdx}`);
                const card = document.getElementById(`step-card-${stepIdx}`);

                if (userAns.filter(v => v).length < step.slots.length) {
                    feedback.textContent = "è«‹å¡«æ»¿æ‰€æœ‰ç©ºæ ¼å–”ï¼";
                    card.classList.add('animate-shake');
                    setTimeout(() => card.classList.remove('animate-shake'), 400);
                    return;
                }

                let allCorrect = true;
                step.slots.forEach((slotCfg, i) => {
                    if (userAns[i] !== slotCfg.correct) {
                        allCorrect = false;
                    }
                });

                if (allCorrect) {
                    feedback.className = "mt-2 text-center font-bold text-green-600";
                    feedback.innerHTML = "ğŸ‰ ç­”å°äº†ï¼";
                    
                    setTimeout(() => {
                        this.currentStepIdx++;
                        if (this.currentStepIdx >= q.steps.length) {
                            this.showCompletion();
                        }
                        this.renderSteps();
                        
                        if (this.currentStepIdx < q.steps.length) {
                            setTimeout(() => {
                                const nextCard = document.getElementById(`step-card-${this.currentStepIdx}`);
                                if(nextCard) nextCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 100);
                        }
                    }, 800);

                } else {
                    feedback.className = "mt-2 text-center font-bold text-red-500";
                    feedback.textContent = "å†æƒ³æƒ³çœ‹ï¼ŒåŠ æ²¹ï¼";
                    card.classList.add('animate-shake');
                    setTimeout(() => card.classList.remove('animate-shake'), 400);
                }
            }

            showCompletion() {
                this.completionModal.classList.remove('hidden');
                setTimeout(() => {
                    this.completionModal.classList.remove('opacity-0');
                    this.modalContent.classList.remove('scale-90');
                    this.modalContent.classList.add('scale-100');
                }, 10);
            }

            closeModal() {
                this.completionModal.classList.add('opacity-0');
                this.modalContent.classList.remove('scale-100');
                this.modalContent.classList.add('scale-90');
                setTimeout(() => {
                    this.completionModal.classList.add('hidden');
                }, 300);
            }
        }

        const app = new App();
    </script>
</body>
</html>