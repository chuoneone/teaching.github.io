 <!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動學習單：因數的應用</title>
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Chiron GoRound TC", sans-serif;
        }
        .step-container {
            transition: all 0.5s ease-in-out;
        }
        .step-locked {
            opacity: 0.3;
            pointer-events: none;
        }
        .feedback-message {
            transition: opacity 0.3s;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 500;
        }
        .feedback-correct {
            background-color: #d1fae5;
            color: #065f46;
        }
        .feedback-incorrect {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .highlight {
            background: linear-gradient(to top, #fefce8 60%, transparent 60%);
            padding: 0 0.2rem;
            font-weight: 700;
        }
        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .nav-btn.active {
            background-color: #60a5fa;
            color: white;
            border-color: #2563eb;
        }
        .nav-btn:not(.active) {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .pair-input {
             width: 6rem;
             text-align: center;
             font-size: 1.125rem;
             padding: 0.5rem;
             border-radius: 0.375rem;
             border: 1px solid #9ca3af;
        }
    </style>
</head>
<body class="bg-blue-50 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-8">
        <!-- 題庫導覽 -->
        <div id="question-nav" class="flex justify-center items-center flex-wrap gap-3 mb-6 border-b-2 border-gray-200 pb-4">
            <!-- Navigation buttons will be inserted by JavaScript -->
        </div>

        <!-- 標題部分 -->
        <div class="text-center mb-8">
            <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-gray-800">因數的應用</h1>
            <p class="text-gray-500 mt-2 text-lg">互動式練習</p>
        </div>

        <div id="prompt-container" class="bg-gray-100 p-5 rounded-lg mb-8">
            <p id="prompt-text" class="text-gray-800 leading-relaxed text-xl text-center">
                <!-- Prompt will be inserted by JavaScript -->
            </p>
        </div>

        <div id="global-feedback" class="text-center h-14 mb-4"></div>

        <!-- 解題步驟 -->
        <div class="space-y-6">
            <!-- 步驟一：找乘法組合 -->
            <div id="step1" class="step-container p-6 border-2 border-dashed rounded-lg bg-white">
                <h3 class="font-bold text-2xl text-blue-700 mb-3">步驟一：找出相乘的組合</h3>
                <p class="text-base text-gray-600 mb-6">請找出所有相乘後等於 <strong id="s1-target" class="text-2xl text-red-500"></strong> 的組合。</p>
                <div id="s1-pairs-container" class="flex flex-col items-center gap-y-4">
                    <!-- Pair inputs will be inserted by JavaScript -->
                </div>
                <div class="text-center mt-6">
                    <button id="check-s1-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-8 rounded-lg transition-colors text-lg">檢查組合</button>
                </div>
            </div>

            <!-- 步驟二：整理所有因數 -->
            <div id="step2" class="step-container p-6 border-2 border-dashed rounded-lg bg-white">
                <h3 class="font-bold text-2xl text-green-700 mb-3">步驟二：寫下所有因數</h3>
                <p class="text-base text-gray-600 mb-6">做得好！現在，請把上面所有出現過的數字<span class="highlight">由小到大</span>排列出來，用逗號「,」隔開。</p>
                <div class="flex items-center justify-center">
                    <span class="text-xl font-medium mr-3">因數 ➜</span>
                    <input id="s2-factors" type="text" class="w-full max-w-md p-3 border rounded text-lg" placeholder="例如：1,2,3...">
                </div>
                <div class="text-center mt-6">
                    <button id="check-s2-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-8 rounded-lg transition-colors text-lg">提交答案</button>
                </div>
            </div>
        </div>

        <!-- 完成訊息 -->
        <div id="completion-message" class="text-center mt-10 p-8 bg-yellow-100 border-2 border-yellow-400 rounded-lg" style="display: none;">
            <h2 class="text-3xl font-bold text-yellow-800">恭喜你，完全正確！</h2>
            <p class="mt-3 text-yellow-700 text-lg">你已經學會如何找出一個數的所有因數了！</p>
            <button id="next-q-btn" class="mt-6 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg transition-colors text-xl">下一題</button>
        </div>

     <footer class="text-center text-gray-400 text-sm mt-8 leading-relaxed">
© 2025 特教米克師｜採用 
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" 
   target="_blank" class="text-sky-600 hover:underline">
CC BY-NC-SA 4.0 創用CC授權
</a><br>
非商業用途歡迎轉載或改編，請保留署名並附上原始連結。
</footer>

    </div>

    <script>
        // --- 資料庫 ---
        const questions = [
            {
                targetNumber: 44,
                pairs: [[1, 44], [2, 22], [4, 11]],
                factors: [1, 2, 4, 11, 22, 44]
            },
            {
                targetNumber: 28,
                pairs: [[1, 28], [2, 14], [4, 7]],
                factors: [1, 2, 4, 7, 14, 28]
            },
            {
                targetNumber: 36,
                pairs: [[1, 36], [2, 18], [3, 12], [4, 9], [6, 6]],
                factors: [1, 2, 3, 4, 6, 9, 12, 18, 36]
            },
            {
                targetNumber: 50,
                pairs: [[1, 50], [2, 25], [5, 10]],
                factors: [1, 2, 5, 10, 25, 50]
            }
        ];
        let currentQuestionIndex = 0;

        // --- DOM 元素 ---
        const feedbackEl = document.getElementById('global-feedback');
        const s1PairsContainer = document.getElementById('s1-pairs-container');

        // --- 功能函數 ---
        function showFeedback(message, isCorrect) {
            feedbackEl.innerHTML = `<div class="feedback-message ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}">${message}</div>`;
            setTimeout(() => {
                if (feedbackEl.firstChild) {
                    feedbackEl.firstChild.style.opacity = '0';
                }
            }, 2500);
            setTimeout(() => { feedbackEl.innerHTML = ''; }, 2800);
        }

        function setStepLock(stepId, locked) {
            const step = document.getElementById(stepId);
            if (locked) {
                step.classList.add('step-locked');
            } else {
                step.classList.remove('step-locked');
                const firstInput = step.querySelector('input');
                if (firstInput) firstInput.focus();
            }
        }
        
        function loadQuestion(index) {
            currentQuestionIndex = index;
            const data = questions[index];

            document.querySelectorAll('#question-nav .nav-btn').forEach((btn, i) => btn.classList.toggle('active', i === index));
            
            const promptHTML = `將 <span class="highlight text-2xl">${data.targetNumber}</span> 寫成 a × b，其中 a、b 為正整數，並<span class="highlight">由小到大</span>寫出 ${data.targetNumber} 的所有因數。`;
            document.getElementById('prompt-text').innerHTML = promptHTML;
            document.getElementById('s1-target').innerText = data.targetNumber;

            // 產生步驟一的輸入框
            s1PairsContainer.innerHTML = '';
            data.pairs.forEach((_, i) => {
                const pairDiv = document.createElement('div');
                pairDiv.className = 'flex items-center gap-2';
                pairDiv.innerHTML = `
                    <input type="number" class="pair-input s1-input" data-pair-index="${i}" data-value-index="0">
                    <span class="text-xl font-bold">×</span>
                    <input type="number" class="pair-input s1-input" data-pair-index="${i}" data-value-index="1">
                `;
                s1PairsContainer.appendChild(pairDiv);
            });

            resetCurrentQuestionState();
            
            // 綁定 Enter 鍵事件
            document.querySelectorAll('.s1-input').forEach(input => {
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') document.getElementById('check-s1-btn').click();
                });
            });
            document.getElementById('s2-factors').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') document.getElementById('check-s2-btn').click();
            });
        }
        
        function resetCurrentQuestionState() {
            setStepLock('step1', false);
            setStepLock('step2', true);

            document.getElementById('completion-message').style.display = 'none';
            document.getElementById('next-q-btn').style.display = 'block';
            if (currentQuestionIndex === questions.length - 1) {
                 document.getElementById('next-q-btn').innerText = "全部完成！";
                 document.getElementById('next-q-btn').disabled = true;
            } else {
                 document.getElementById('next-q-btn').innerText = "下一題";
                 document.getElementById('next-q-btn').disabled = false;
            }

            s1PairsContainer.querySelectorAll('input').forEach(input => input.value = '');
            document.getElementById('s2-factors').value = '';
            
            showFeedback(`第 ${currentQuestionIndex + 1} 題載入完成！`, true);
        }

        function checkStep1() {
            const data = questions[currentQuestionIndex];
            const correctPairs = data.pairs.map(p => p.slice().sort((a, b) => a - b));
            
            const userPairElements = Array.from(s1PairsContainer.children);
            let userPairs = [];
            let allInputsFilled = true;

            userPairElements.forEach(div => {
                const inputs = div.querySelectorAll('input');
                const val1 = parseInt(inputs[0].value, 10);
                const val2 = parseInt(inputs[1].value, 10);

                if (isNaN(val1) || isNaN(val2)) {
                    allInputsFilled = false;
                }
                userPairs.push([val1, val2].sort((a, b) => a - b));
            });

            if (!allInputsFilled) {
                showFeedback('請將所有空格都填上數字喔！', false);
                return;
            }

            // 檢查乘積是否正確
            const productIsCorrect = userPairs.every(pair => pair[0] * pair[1] === data.targetNumber);
            if (!productIsCorrect) {
                showFeedback('有些組合相乘後不等於 ' + data.targetNumber + ' 喔，請檢查一下！', false);
                return;
            }

            // 檢查組合是否都正確
            const correctSet = new Set(correctPairs.map(p => JSON.stringify(p)));
            const userSet = new Set(userPairs.map(p => JSON.stringify(p)));
            
            if (correctSet.size === userSet.size && [...correctSet].every(p => userSet.has(p))) {
                 showFeedback('太棒了！所有組合都正確！', true);
                 setStepLock('step1', true);
                 setStepLock('step2', false);
            } else {
                 showFeedback('組合好像不太對喔，再想想看有沒有漏掉的？', false);
            }
        }
        
        function checkStep2() {
            const data = questions[currentQuestionIndex];
            const userInput = document.getElementById('s2-factors').value.trim();
            
            if (userInput === '') {
                showFeedback('請輸入答案喔！', false);
                return;
            }
            
            const userFactors = userInput.split(/,|，/).map(s => parseInt(s.trim(), 10)).filter(n => !isNaN(n));
            
            const correctFactors = data.factors;

            if (JSON.stringify(userFactors) === JSON.stringify(correctFactors)) {
                showFeedback('完全正確！你太厲害了！', true);
                setStepLock('step2', true);
                document.getElementById('completion-message').style.display = 'block';
                document.getElementById('completion-message').scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                showFeedback('答案不對喔，檢查看看是不是有漏掉的數字，或排列順序不對？', false);
            }
        }
        
        // --- 初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            const navContainer = document.getElementById('question-nav');
            questions.forEach((q, i) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.innerText = `第 ${i + 1} 題`;
                btn.onclick = () => loadQuestion(i);
                navContainer.appendChild(btn);
            });

            document.getElementById('check-s1-btn').onclick = checkStep1;
            document.getElementById('check-s2-btn').onclick = checkStep2;
            document.getElementById('next-q-btn').onclick = () => {
                if (currentQuestionIndex < questions.length - 1) {
                    loadQuestion(currentQuestionIndex + 1);
                }
            };
            
            loadQuestion(0);
        });

    </script>
</body>
</html>


