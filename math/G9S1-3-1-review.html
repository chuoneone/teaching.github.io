<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3-1 æ¨ç†è­‰æ˜è¤‡ç¿’ - éŠæˆ²åŒ–å­¸ç¿’å¹³å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ Chart.js ç”¨æ–¼é›·é”åœ– -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8; /* æ›´æ¸…çˆ½çš„èƒŒæ™¯ */
            overscroll-behavior-y: none;
        }

        /* === æ•¸å­¸ç¬¦è™Ÿæ¨£å¼ === */
        .math-serif { font-family: 'Times New Roman', serif; font-style: italic; }
        .math-normal { font-family: 'Times New Roman', serif; font-style: normal; }
        .segment {
            text-decoration: overline;
            text-decoration-thickness: 1.5px;
            margin: 0 2px;
            display: inline-block;
        }
        
        /* è¼”åŠ©ç·šç‰¹æ®Šæ¨£å¼ */
        .aux-line-hidden { opacity: 0.2; transition: opacity 1s ease-in-out, stroke-width 0.5s; }
        .aux-line-visible { opacity: 1; stroke-width: 2.5; }

        /* === é€šç”¨å¡«ç­”æ ¼æ¨£å¼ === */
        .slot {
            display: inline-flex; align-items: center; justify-content: center;
            min-width: 60px; height: 42px; padding: 0 12px;
            border-bottom: 3px solid #cbd5e1; background-color: #fff;
            color: #334155; font-weight: bold; font-size: 1.1rem;
            cursor: pointer; transition: all 0.2s; margin: 0 4px;
            border-radius: 6px 6px 0 0; vertical-align: middle;
        }
        .slot:hover:not(.correct):not(.filled) { background-color: #f1f5f9; border-bottom-color: #94a3b8; }
        .slot.filled { border-bottom-color: #3b82f6; background-color: #eff6ff; color: #2563eb; }
        .slot.correct { border-bottom-color: #22c55e; color: #15803d; background-color: #dcfce7; pointer-events: none; cursor: default; }
        .slot.error { animation: shake 0.4s ease-in-out; border-bottom-color: #ef4444; background-color: #fef2f2; }

        /* === é¸é …æŒ‰éˆ• === */
        .option-btn {
            background-color: #fff; border: 2px solid #e2e8f0; box-shadow: 0 3px 0 #e2e8f0;
            color: #475569; font-weight: 600; padding: 10px 18px; border-radius: 12px;
            transition: all 0.1s; user-select: none; display: inline-flex;
            align-items: center; justify-content: center;
        }
        .option-btn:active { transform: translateY(3px); box-shadow: none; }
        .option-btn:disabled { opacity: 0.5; cursor: not-allowed; background-color: #f8fafc; transform: none; box-shadow: none; border-color: #e2e8f0; }

        /* === å¯µç‰©å¡ç‰‡ç‰¹æ•ˆ === */
        .pet-card {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .pet-card:hover { transform: translateY(-5px) scale(1.02); }
        .pet-locked { filter: grayscale(100%) opacity(0.6); }
        .pet-unlocked { animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }

        /* === å‹•ç•«èˆ‡ç‰¹æ•ˆ === */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        .timer-urgent {
            animation: pulse-red 1s infinite;
            color: #ef4444;
            border-color: #ef4444;
        }

        .step-container { opacity: 0.5; pointer-events: none; filter: grayscale(100%); transition: all 0.4s ease-out; transform: translateY(10px); }
        .step-container.active { opacity: 1; pointer-events: auto; filter: grayscale(0%); transform: translateY(0); }
        .step-container.completed { opacity: 0.8; pointer-events: none; border-color: #86efac; }
        .step-container.completed .options-area { display: none; }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .view-section { display: none; height: 100%; }
        .view-section.active { display: flex; }
    </style>
</head>
<body class="h-screen flex flex-col text-slate-800">

    <!-- é ‚éƒ¨å°è¦½åˆ— -->
    <nav class="bg-slate-800 text-white shadow-lg flex-none z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center cursor-pointer hover:opacity-90 transition" onclick="showDashboard()">
                <div class="bg-indigo-500 p-2 rounded-lg mr-3 shadow-lg shadow-indigo-500/50">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                </div>
                <div>
                    <h1 class="font-black text-xl tracking-wide leading-none text-transparent bg-clip-text bg-gradient-to-r from-indigo-200 to-cyan-200">3-1 æ¨ç†è­‰æ˜è¤‡ç¿’</h1>
                    <span class="text-xs text-slate-400 font-medium tracking-wider">GAMIFIED LEARNING</span>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- è¨ˆæ™‚å™¨é¡¯ç¤º (åƒ…åœ¨é¡Œç›®ä»‹é¢é¡¯ç¤º) -->
                <div id="timer-display" class="hidden bg-slate-700 px-4 py-1.5 rounded-full font-mono text-xl font-bold border border-slate-600 shadow-inner flex items-center gap-2">
                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span id="time-text">05:00</span>
                </div>

                <button onclick="showDashboard()" class="text-sm bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-full transition shadow-md flex items-center gap-2 font-bold">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    ç¸½éƒ¨
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <main class="flex-1 overflow-hidden relative bg-slate-100">
        
        <!-- 1. å„€è¡¨æ¿è¦–åœ– (Dashboard) -->
        <div id="dashboard-view" class="view-section active flex-col p-4 md:p-6 overflow-y-auto">
            <div class="max-w-7xl mx-auto w-full">
                
                <div class="flex flex-col lg:flex-row gap-6 mb-8">
                    <!-- å·¦å´ï¼šèƒ½åŠ›åˆ†æé›·é”åœ– -->
                    <div class="lg:w-1/3 bg-white rounded-3xl p-6 shadow-sm border border-slate-200">
                        <h2 class="text-lg font-bold text-slate-700 mb-4 flex items-center">
                            <span class="w-2 h-6 bg-indigo-500 rounded-full mr-2"></span>
                            èƒ½åŠ›åˆ†æé›·é”
                        </h2>
                        <div class="relative w-full aspect-square max-h-[300px] mx-auto">
                            <canvas id="skillsRadar"></canvas>
                        </div>
                        <div class="mt-4 text-center">
                            <p class="text-sm text-slate-500">
                                ğŸ† é‡‘ç‰Œæ¢ä»¶ï¼š<span class="font-bold text-indigo-600">5åˆ†é˜å…§</span> ä¸” <span class="font-bold text-indigo-600">ç„¡ä»»ä½•éŒ¯èª¤</span>
                            </p>
                        </div>
                    </div>

                    <!-- å³å´ï¼šæ€ªç¸åœ–é‘‘ (Collection) -->
                    <div class="lg:w-2/3 bg-white rounded-3xl p-6 shadow-sm border border-slate-200 flex flex-col">
                        <h2 class="text-lg font-bold text-slate-700 mb-4 flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="w-2 h-6 bg-rose-500 rounded-full mr-2"></span>
                                æˆ‘çš„æ€ªç¸åœ–é‘‘
                            </div>
                            <span class="text-xs bg-slate-100 px-2 py-1 rounded text-slate-500" id="collection-count">0/5 è§£é–</span>
                        </h2>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 flex-1" id="pet-collection-grid">
                            <!-- å¯µç‰©å¡ç‰‡ç”± JS ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- ä»»å‹™åˆ—è¡¨ -->
                <h2 class="text-xl font-bold text-slate-800 mb-4 px-2">æ¯æ—¥ç‰¹è¨“ä»»å‹™</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-10">
                    <!-- ä»»å‹™å¡ç‰‡ç”± JS ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- 2. é¡Œç›®ç·´ç¿’è¦–åœ– (Problem View) -->
        <div id="problem-view" class="view-section flex-col md:flex-row bg-slate-50 h-full">
            <!-- å·¦å´ï¼šé¡Œç›®æè¿° -->
            <div class="w-full md:w-5/12 lg:w-1/3 bg-white border-b md:border-b-0 md:border-r border-slate-200 flex flex-col z-10 shadow-lg md:shadow-none h-2/5 md:h-full shrink-0">
                <div class="p-6 overflow-y-auto h-full custom-scrollbar" id="problem-left-content"></div>
            </div>
            <!-- å³å´ï¼šäº’å‹•æ­¥é©Ÿ -->
            <div class="flex-1 bg-slate-100 relative flex flex-col h-3/5 md:h-full overflow-hidden">
                <div class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 pb-32" id="problem-steps-area"></div>
            </div>
        </div>

    </main>

    <!-- å¯µç‰©è§£é–è¦–çª— (Modal) -->
    <div id="completion-modal" class="fixed inset-0 bg-slate-900/90 flex items-center justify-center z-[100] hidden backdrop-blur-md">
        <div class="bg-white rounded-[2rem] p-8 max-w-md w-full mx-4 text-center shadow-2xl transform transition-all scale-95 opacity-0 relative overflow-hidden" id="modal-content">
            <!-- èƒŒæ™¯å…‰æ•ˆ -->
            <div class="absolute inset-0 bg-gradient-to-b from-yellow-50 to-white -z-10"></div>
            <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-yellow-100/50 to-transparent -z-10"></div>

            <div class="mb-6 relative">
                <div class="text-6xl animate-bounce mb-2" id="modal-pet-icon">ğŸ¥š</div>
                <div class="text-sm font-bold text-yellow-600 bg-yellow-100 inline-block px-3 py-1 rounded-full mb-2 border border-yellow-200">
                    NEW PET UNLOCKED!
                </div>
                <h3 class="text-2xl font-black text-slate-800" id="modal-pet-name">ç¥ç§˜å¯µç‰©</h3>
                <p class="text-slate-500 text-sm" id="modal-pet-desc">...</p>
            </div>

            <div class="flex justify-center gap-4 mb-8 text-sm">
                <div class="bg-slate-50 p-3 rounded-xl border border-slate-200 w-1/2">
                    <div class="text-slate-400 font-bold text-xs uppercase">Time Used</div>
                    <div class="text-xl font-mono font-bold text-slate-700" id="modal-time">00:00</div>
                </div>
                <div class="bg-slate-50 p-3 rounded-xl border border-slate-200 w-1/2">
                    <div class="text-slate-400 font-bold text-xs uppercase">Rank</div>
                    <div class="text-xl font-black text-yellow-500" id="modal-rank">GOLD</div>
                </div>
            </div>

            <button onclick="showDashboard(true)" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl transition shadow-lg shadow-slate-300 transform hover:scale-[1.02] active:scale-95">
                æ”¶æœä¸¦è¿”å›ç¸½éƒ¨
            </button>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. è³‡æ–™çµæ§‹ (é¡Œç›® + å¯µç‰©è¨­å®š)
        // ==========================================
        const problems = [
            {
                id: 1,
                title: "SSSå…¨ç­‰è­‰æ˜",
                category: "å…¨ç­‰",
                statType: "congruence", // å°æ‡‰é›·é”åœ–
                description: `å¦‚åœ–ï¼Œ<span class="math-serif">â–³ABC</span> èˆ‡ <span class="math-serif">â–³ABD</span> ä¸­ï¼Œ<span class="segment text-rose-600 font-bold">AC</span> = <span class="segment text-rose-600 font-bold">AD</span>ï¼Œ<span class="segment text-rose-600 font-bold">BC</span> = <span class="segment text-rose-600 font-bold">BD</span>ï¼Œæ±‚è­‰ <span class="math-serif">âˆ ABC = âˆ ABD</span>ã€‚`,
                hint: "æ‰¾å‡ºå·²çŸ¥çš„ç­‰é•·é‚Šï¼Œä¸¦è§€å¯Ÿæ˜¯å¦æœ‰å…±ç”¨çš„é‚Šé•·ã€‚",
                pet: {
                    name: "ä¸‰è§’è¡›å£« (Tri-Guard)",
                    icon: "ğŸ›¡ï¸",
                    desc: "å …ä¸å¯æ‘§çš„ç›¾ç‰Œï¼Œè±¡å¾µSSSå…¨ç­‰çš„ç©©å›ºã€‚",
                    color: "blue"
                },
                svgContent: `<svg width="240" height="200" viewBox="0 0 240 200" class="mx-auto drop-shadow-sm"><path d="M 20 90 L 120 20 L 220 90 Z" fill="#eff6ff" stroke="#475569" stroke-width="2"/><path d="M 20 90 L 120 160 L 220 90 Z" fill="#eff6ff" stroke="#475569" stroke-width="2"/><line x1="20" y1="90" x2="220" y2="90" stroke="#1e293b" stroke-width="2"/><text x="10" y="95" class="math-serif">A</text><text x="225" y="95" class="math-serif">B</text><text x="115" y="15" class="math-serif">C</text><text x="115" y="175" class="math-serif">D</text><line x1="65" y1="50" x2="75" y2="60" stroke="#dc2626" stroke-width="2"/><line x1="65" y1="130" x2="75" y2="120" stroke="#dc2626" stroke-width="2"/><line x1="165" y1="50" x2="175" y2="60" stroke="#dc2626" stroke-width="2"/><line x1="168" y1="47" x2="178" y2="57" stroke="#dc2626" stroke-width="2"/><line x1="165" y1="130" x2="175" y2="120" stroke="#dc2626" stroke-width="2"/><line x1="168" y1="133" x2="178" y2="123" stroke="#dc2626" stroke-width="2"/></svg>`,
                steps: [
                    { instruction: "å¡«å…¥å·²çŸ¥æ¢ä»¶", template: `<span class="math-serif">âˆµ <span class="slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( å·²çŸ¥ )</span>`, answers: ["AC", "AD"], options: ["AC", "AD", "BC"], checkType: "seq" },
                    { instruction: "å¡«å…¥ç¬¬äºŒå€‹å·²çŸ¥æ¢ä»¶", template: `<span class="math-serif"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( å·²çŸ¥ )</span>`, answers: ["BC", "BD"], options: ["BC", "BD", "AB"], checkType: "seq" },
                    // ä¿®æ”¹ï¼šç‚ºå…¬ç”¨é‚Šæä¾›å…©å€‹ AB é¸é …ï¼Œè®“å­¸ç”Ÿèƒ½å¡«æ»¿å…©æ ¼
                    { instruction: "æ‰¾å‡ºéš±è—å…¬ç”¨é‚Š", template: `<span class="math-serif"><span class="ml-6 slot" data-idx="0"></span> = <span class="slot" data-idx="1"></span> ( å…¬ç”¨é‚Š )</span>`, answers: ["AB", "AB"], options: ["AB", "AB", "AC"], checkType: "seq" },
                    { instruction: "ç¢ºèªå…¨ç­‰æ€§è³ª", template: `<span class="math-serif">âˆ´ â–³ABC â‰… â–³ABD ( <span class="slot" data-idx="0"></span> )</span>`, answers: ["SSS"], options: ["SSS", "SAS", "RHS"], checkType: "seq" }
                ]
            },
            {
                id: 2,
                title: "å¹³è¡Œç·šèˆ‡ç›¸ä¼¼å½¢",
                category: "ç›¸ä¼¼",
                statType: "similarity",
                description: `å¦‚åœ–ï¼Œ<span class="math-serif">â–³ABC</span> èˆ‡ <span class="math-serif">â–³CEF</span> ä¸­ï¼Œ<span class="segment">AB</span> // <span class="segment">CE</span>ï¼Œ<span class="segment">BC</span> // <span class="segment">EF</span>ï¼Œæ±‚è­‰ <span class="math-serif">â–³ABC</span> ~ <span class="math-serif">â–³CEF</span>ã€‚`,
                hint: "åˆ©ç”¨å¹³è¡Œç·šçš„æˆªè§’æ€§è³ªï¼ˆå…§éŒ¯è§’ã€åŒä½è§’ï¼‰ã€‚",
                pet: {
                    name: "é¡åƒé›™å­ (Twin Fox)",
                    icon: "ğŸ¦Š",
                    desc: "é›–ç„¶å¤§å°ä¸åŒï¼Œä½†å½¢ç‹€å®Œç¾ç›¸ä¼¼çš„é›™èƒèƒã€‚",
                    color: "emerald"
                },
                svgContent: `<svg width="240" height="150" viewBox="0 0 300 200" class="mx-auto"><path d="M80 40 L40 160 L200 160 Z" fill="none" stroke="#334155" stroke-width="2"/><path d="M200 160 L220 100 L140 100 Z" fill="rgba(34, 197, 94, 0.1)" stroke="#16a34a" stroke-width="2"/><text x="75" y="30" font-weight="bold">A</text><text x="20" y="165" font-weight="bold">B</text><text x="205" y="170" font-weight="bold">C</text><text x="125" y="90" font-weight="bold">F</text><text x="225" y="100" font-weight="bold">E</text><path d="M58 95 L55 105 L65 102" fill="none" stroke="#ef4444" stroke-width="2"/><path d="M208 125 L205 135 L215 132" fill="none" stroke="#ef4444" stroke-width="2"/><path d="M120 160 L110 155 M120 160 L110 165" fill="none" stroke="#3b82f6" stroke-width="2"/><path d="M180 100 L170 95 M180 100 L170 105" fill="none" stroke="#3b82f6" stroke-width="2"/></svg>`,
                steps: [
                    { instruction: "è­‰æ˜ç¬¬ä¸€çµ„è§’ (å…§éŒ¯è§’)", template: `âˆµ AB // CE <br>âˆ´ âˆ BAC = <span class="slot" data-idx="0"></span>`, answers: ["âˆ ECF"], options: ["âˆ ECF", "âˆ ACB"], checkType: "seq" },
                    { instruction: "è­‰æ˜ç¬¬äºŒçµ„è§’ (åŒä½è§’)", template: `âˆµ BC // EF <br>âˆ´ <span class="slot" data-idx="0"></span> = âˆ EFC`, answers: ["âˆ ACB"], options: ["âˆ ACB", "âˆ ABC"], checkType: "seq" },
                    { instruction: "çµè«–", template: `æ•… â–³ABC ~ â–³CEF ( <span class="slot" data-idx="0"></span> ç›¸ä¼¼ )`, answers: ["AA"], options: ["AA", "SAS"], checkType: "seq" }
                ]
            },
            {
                id: 3,
                title: "è¼”åŠ©ç·šçš„æ‡‰ç”¨",
                category: "æŠ€å·§",
                statType: "technique",
                description: `å·²çŸ¥ <span class="math-serif segment">AB</span> = <span class="math-serif segment">AC</span>ï¼Œ<span class="math-serif segment">BD</span> = <span class="math-serif segment">CD</span>ã€‚æ±‚è­‰ï¼š <span class="math-serif">âˆ ABD = âˆ ACD</span>ã€‚`,
                hint: "åœ–å½¢æ¢ä»¶ä¸è¶³ï¼Œè©¦è‘—é€£æ¥ ADã€‚",
                pet: {
                    name: "ç·šæ¢æ³•å¸« (Line Wiz)",
                    icon: "ğŸª„",
                    desc: "èƒ½çœ‹è¦‹çœ‹ä¸è¦‹çš„ç·šï¼Œå‰µé€ è§£é¡Œçš„å¥‡è¹Ÿã€‚",
                    color: "rose"
                },
                svgContent: `<svg width="240" height="180" viewBox="0 0 280 220" class="mx-auto"><path d="M140 20 L40 160 L140 120 L240 160 Z" fill="#fff1f2" stroke="#334155" stroke-width="2.5"/><line id="aux-line" class="aux-line-hidden" x1="140" y1="20" x2="140" y2="120" stroke="#ef4444" stroke-dasharray="8,4"/><text x="140" y="15" text-anchor="middle" font-weight="bold">A</text><text x="30" y="170" text-anchor="middle" font-weight="bold">B</text><text x="250" y="170" text-anchor="middle" font-weight="bold">C</text><text x="140" y="145" text-anchor="middle" font-weight="bold">D</text></svg>`,
                steps: [
                    { instruction: "ä½œè¼”åŠ©ç·š", template: `é€£æ¥ <span class="slot" data-idx="0"></span>`, answers: ["AD"], options: ["AB", "AD", "BC"], checkType: "seq" },
                    { instruction: "æ‰¾å‡ºå…¬ç”¨é‚Š", template: `<span class="math-serif"><span class="slot" data-idx="0"></span> = AD (å…¬ç”¨é‚Š)</span>`, answers: ["AD"], options: ["AD", "BC"], checkType: "seq" },
                    { instruction: "å…¨ç­‰çµè«–", template: `âˆ´ â–³ABD â‰… â–³ACD (<span class="slot" data-idx="0"></span>)`, answers: ["SSS"], options: ["SSS", "SAS"], checkType: "seq" }
                ]
            },
            {
                id: 4,
                title: "å¥‡å¶æ•¸çš„åˆ¤åˆ¥",
                category: "ä»£æ•¸",
                statType: "algebra",
                description: `å·²çŸ¥ <span class="math-serif">a</span> ç‚º <span class="font-bold text-rose-600">å¥‡æ•¸</span>ï¼Œè«‹åˆ¤åˆ¥ä¸‹åˆ—å„å€‹æ•¸å€¼ç‚ºå¥‡æ•¸æˆ–å¶æ•¸ã€‚`,
                hint: "ä»£å…¥æ³•ï¼šè©¦è‘—æŠŠ a ç•¶ä½œ 1 ä»£å…¥è¨ˆç®—ï¼",
                pet: {
                    name: "é‚è¼¯æ©Ÿå…µ (Logic Bot)",
                    icon: "ğŸ¤–",
                    desc: "é‹ç®—ç²¾æº–ï¼Œçµ•å°ä¸æœƒæéŒ¯å¥‡æ•¸èˆ‡å¶æ•¸ã€‚",
                    color: "violet"
                },
                svgContent: `<svg width="240" height="150" viewBox="0 0 240 200" class="mx-auto"><g fill="#8b5cf6" opacity="0.8"><rect x="70" y="60" width="40" height="40" rx="8"/><rect x="120" y="60" width="40" height="40" rx="8"/><text x="115" y="50" text-anchor="middle" fill="#6b21a8" font-size="14" font-weight="bold">2k (å¶)</text></g><rect x="95" y="110" width="40" height="40" rx="8" fill="#f43f5e"/><text x="115" y="165" text-anchor="middle" fill="#be123c" font-size="14" font-weight="bold">+1 (å¥‡)</text></svg>`,
                steps: [
                    { instruction: "åˆ¤æ–· a + 1", template: `<span class="math-serif">a + 1</span> æ˜¯ <span class="slot" data-idx="0"></span>`, answers: ["å¶æ•¸"], options: ["å¥‡æ•¸", "å¶æ•¸"], checkType: "seq" },
                    { instruction: "åˆ¤æ–· 2a - 4", template: `<span class="math-serif">2a - 4</span> æ˜¯ <span class="slot" data-idx="0"></span>`, answers: ["å¶æ•¸"], options: ["å¥‡æ•¸", "å¶æ•¸"], checkType: "seq" },
                    { instruction: "åˆ¤æ–· 3a - 5", template: `<span class="math-serif">3a - 5</span> æ˜¯ <span class="slot" data-idx="0"></span>`, answers: ["å¶æ•¸"], options: ["å¥‡æ•¸", "å¶æ•¸"], checkType: "seq" }
                ]
            },
            {
                id: 5,
                title: "åˆ¤åˆ¥å¤§å°ï¼šå¹³æ–¹",
                category: "ä¸ç­‰å¼",
                statType: "inequality",
                description: `å·²çŸ¥ <span class="math-serif">a, b</span> çš„å¤§å°é—œä¿‚ï¼Œåˆ¤æ–·å®ƒå€‘å¹³æ–¹å¾Œçš„å¤§å°ã€‚ç‰¹åˆ¥æ³¨æ„<span class="font-bold text-rose-600">è² æ•¸</span>æƒ…å½¢ï¼`,
                hint: "ä»£å…¥æ•¸å­—çœ‹çœ‹ï¼Œä¾‹å¦‚ -2 èˆ‡ -3ã€‚",
                pet: {
                    name: "å¹³è¡¡é¾ (Scale Dragon)",
                    icon: "âš–ï¸",
                    desc: "å®ˆè­·è‘—å¤©å¹³ï¼Œå°å¤§å°é—œä¿‚æ¥µåº¦æ•æ„Ÿã€‚",
                    color: "orange"
                },
                svgContent: `<svg width="280" height="120" viewBox="0 0 280 150" class="mx-auto"><line x1="20" y1="120" x2="260" y2="120" stroke="#94a3b8" stroke-width="2"/><circle cx="50" cy="120" r="4" fill="#ef4444"/><text x="50" y="140" text-anchor="middle" fill="#ef4444">-3</text><circle cx="80" cy="120" r="4" fill="#ef4444"/><text x="80" y="140" text-anchor="middle" fill="#ef4444">-2</text><path d="M 50 110 Q 95 40 230 110" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="4,4"/><text x="140" y="60" text-anchor="middle" fill="#ef4444" font-size="10">å¹³æ–¹ (-3)Â² = 9</text></svg>`,
                steps: [
                    { instruction: "æ­£æ•¸æ¯”è¼ƒ a > b > 0", template: `å‰‡ <span class="math-serif">a<sup>2</sup></span> <span class="slot" data-idx="0"></span> <span class="math-serif">b<sup>2</sup></span>`, answers: [">"], options: [">", "<", "="], checkType: "seq" },
                    { instruction: "è² æ•¸æ¯”è¼ƒ a < b < 0", template: `å‰‡ <span class="math-serif">a<sup>2</sup></span> <span class="slot" data-idx="0"></span> <span class="math-serif">b<sup>2</sup></span>`, answers: [">"], options: [">", "<", "="], checkType: "seq" }
                ]
            }
        ];

        // ==========================================
        // 2. ç‹€æ…‹èˆ‡é‚è¼¯
        // ==========================================
        let appState = {
            unlockedPets: {}, // { problemId: { time: 120, rank: 'GOLD' } }
            timer: null,
            timeElapsed: 0,
            activeProblemId: null,
            hasError: false // æ–°å¢ï¼šç´€éŒ„ç•¶å‰é¡Œç›®æ˜¯å¦æœ‰ç­”éŒ¯
        };
        
        let radarChart = null;

        // --- åˆå§‹åŒ– ---
        window.onload = function() {
            initRadarChart();
            renderDashboard();
        };

        function initRadarChart() {
            const ctx = document.getElementById('skillsRadar').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['å…¨ç­‰', 'ç›¸ä¼¼', 'æŠ€å·§', 'ä»£æ•¸', 'ä¸ç­‰å¼'],
                    datasets: [{
                        label: 'èƒ½åŠ›å€¼',
                        data: [0, 0, 0, 0, 0], // åˆå§‹å€¼
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(99, 102, 241, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            pointLabels: {
                                font: { size: 14, weight: 'bold', family: "'Noto Sans TC', sans-serif" },
                                color: '#475569'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false } // éš±è—åˆ»åº¦æ•¸å­—æ›´ç°¡æ½”
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- è¦–åœ–æ§åˆ¶ ---
        function showDashboard(fromComplete = false) {
            clearInterval(appState.timer);
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('dashboard-view').classList.add('active');
            document.getElementById('timer-display').classList.add('hidden'); // éš±è—è¨ˆæ™‚å™¨

            if (fromComplete) {
                closeModal();
                createConfetti();
            }
            renderDashboard();
        }

        function startProblem(id) {
            appState.activeProblemId = id;
            appState.timeElapsed = 0; // é‡ç½®æ™‚é–“ (å–®ä½ï¼šç§’)
            appState.hasError = false; // é‡ç½®éŒ¯èª¤ç‹€æ…‹
            
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('problem-view').classList.add('active');
            
            // å•Ÿå‹•è¨ˆæ™‚å™¨ (å€’æ•¸ 5 åˆ†é˜ = 300ç§’)
            document.getElementById('timer-display').classList.remove('hidden');
            updateTimerDisplay();
            clearInterval(appState.timer);
            appState.timer = setInterval(() => {
                appState.timeElapsed++;
                updateTimerDisplay();
            }, 1000);

            renderProblem(id);
        }

        function updateTimerDisplay() {
            const limit = 300; // 5åˆ†é˜
            const remaining = limit - appState.timeElapsed;
            const isOvertime = remaining < 0;
            
            const absTime = Math.abs(remaining);
            const mins = Math.floor(absTime / 60).toString().padStart(2, '0');
            const secs = (absTime % 60).toString().padStart(2, '0');
            
            const timerEl = document.getElementById('timer-display');
            const textEl = document.getElementById('time-text');

            if (isOvertime) {
                textEl.innerText = `-${mins}:${secs}`;
                timerEl.classList.add('timer-urgent'); // ç´…è‰²é–ƒçˆ
            } else {
                textEl.innerText = `${mins}:${secs}`;
                if (remaining < 60) {
                    timerEl.classList.add('text-orange-400'); // æœ€å¾Œä¸€åˆ†é˜è®Šè‰²
                } else {
                    timerEl.className = "bg-slate-700 px-4 py-1.5 rounded-full font-mono text-xl font-bold border border-slate-600 shadow-inner flex items-center gap-2";
                }
            }
        }

        // --- æ¸²æŸ“å„€è¡¨æ¿ ---
        function renderDashboard() {
            // 1. æ›´æ–°ä»»å‹™å¡ç‰‡
            const grid = document.querySelector('.grid.grid-cols-1');
            grid.innerHTML = '';
            
            problems.forEach(p => {
                const unlocked = appState.unlockedPets[p.id];
                const statusColor = unlocked ? (unlocked.rank === 'GOLD' ? 'border-yellow-400' : 'border-slate-300') : 'border-slate-200';
                const statusBg = unlocked ? (unlocked.rank === 'GOLD' ? 'bg-yellow-50' : 'bg-slate-50') : 'bg-white';
                const statusBadge = unlocked 
                    ? `<span class="px-2 py-1 rounded text-xs font-bold ${unlocked.rank === 'GOLD' ? 'bg-yellow-100 text-yellow-700' : 'bg-slate-200 text-slate-600'}">${unlocked.rank === 'GOLD' ? 'ğŸ† é‡‘ç‰Œé”æˆ' : 'âœ“ å·²å®Œæˆ'}</span>`
                    : `<span class="px-2 py-1 rounded text-xs font-bold bg-slate-100 text-slate-400">æœªé–‹å§‹</span>`;

                grid.innerHTML += `
                    <div class="rounded-2xl shadow-sm border-2 ${statusColor} ${statusBg} p-5 hover:shadow-md transition group flex flex-col h-full relative overflow-hidden">
                        ${unlocked ? '<div class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl from-white/50 to-transparent -mr-4 -mt-4 rotate-45"></div>' : ''}
                        <div class="flex justify-between items-start mb-3">
                            <span class="text-xs font-bold px-2 py-1 rounded bg-slate-200 text-slate-600">${p.category}</span>
                            ${statusBadge}
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2 group-hover:text-indigo-600 transition">${p.title}</h3>
                        <p class="text-slate-500 text-sm mb-4 flex-1 line-clamp-2">${p.description.replace(/<[^>]*>?/gm, '')}</p>
                        <button onclick="startProblem(${p.id})" class="w-full py-2.5 rounded-xl font-bold text-sm transition ${unlocked ? 'bg-white border-2 border-indigo-100 text-indigo-600 hover:bg-indigo-50' : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg shadow-indigo-200'}">
                            ${unlocked ? 'å†æ¬¡æŒ‘æˆ°' : 'é–‹å§‹ä»»å‹™'}
                        </button>
                    </div>
                `;
            });

            // 2. æ›´æ–°é›·é”åœ–æ•¸æ“š
            const stats = [0, 0, 0, 0, 0]; // é †åºå°æ‡‰: å…¨ç­‰, ç›¸ä¼¼, æŠ€å·§, ä»£æ•¸, ä¸ç­‰å¼
            const typeMap = { 'congruence': 0, 'similarity': 1, 'technique': 2, 'algebra': 3, 'inequality': 4 };
            
            Object.keys(appState.unlockedPets).forEach(pid => {
                const p = problems.find(prob => prob.id == pid);
                if (p) {
                    const idx = typeMap[p.statType];
                    const rank = appState.unlockedPets[pid].rank;
                    stats[idx] = rank === 'GOLD' ? 100 : 70; // é‡‘ç‰Œ100åˆ†ï¼ŒéŠ€ç‰Œ70åˆ†
                }
            });
            
            radarChart.data.datasets[0].data = stats;
            radarChart.update();

            // 3. æ›´æ–°æ€ªç¸åœ–é‘‘
            const petGrid = document.getElementById('pet-collection-grid');
            petGrid.innerHTML = '';
            let unlockedCount = 0;
            
            problems.forEach(p => {
                const unlocked = appState.unlockedPets[p.id];
                if (unlocked) unlockedCount++;
                
                petGrid.innerHTML += `
                    <div class="aspect-square rounded-2xl border-2 ${unlocked ? 'border-' + p.pet.color + '-200 bg-' + p.pet.color + '-50' : 'border-slate-100 bg-slate-50'} flex flex-col items-center justify-center p-2 text-center transition pet-card relative overflow-hidden group">
                        ${!unlocked ? '<div class="absolute inset-0 bg-slate-100 z-10 opacity-50 flex items-center justify-center"><span class="text-2xl opacity-30">ğŸ”’</span></div>' : ''}
                        <div class="text-4xl mb-2 transform transition group-hover:scale-110 ${unlocked ? 'pet-unlocked' : 'pet-locked'}">${p.pet.icon}</div>
                        <div class="text-xs font-bold ${unlocked ? 'text-slate-800' : 'text-slate-400'} line-clamp-1">${unlocked ? p.pet.name : '???'}</div>
                        ${unlocked && unlocked.rank === 'GOLD' ? '<div class="absolute top-1 right-1 text-xs">ğŸ‘‘</div>' : ''}
                    </div>
                `;
            });
            document.getElementById('collection-count').innerText = `${unlockedCount}/${problems.length} è§£é–`;
        }

        // --- é¡Œç›®æ¸²æŸ“é‚è¼¯ ---
        function renderProblem(id) {
            const problem = problems.find(p => p.id === id);
            
            // å·¦å´
            document.getElementById('problem-left-content').innerHTML = `
                <div class="mb-4">
                    <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 text-xs font-bold rounded-full mb-3">æŒ‘æˆ°é—œå¡ ${id}</span>
                    <h2 class="text-xl font-bold text-slate-800 leading-relaxed">${problem.description}</h2>
                </div>
                <div class="flex justify-center my-6 bg-white rounded-2xl p-4 shadow-inner border border-slate-100">
                    ${problem.svgContent}
                </div>
                <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-xl text-sm text-yellow-800">
                    <p class="font-bold mb-1">ğŸ’¡ æç¤ºï¼š</p>
                    <p>${problem.hint}</p>
                </div>
            `;

            // å³å´æ­¥é©Ÿ
            const area = document.getElementById('problem-steps-area');
            area.innerHTML = '';
            
            problem.steps.forEach((step, idx) => {
                const el = document.createElement('div');
                el.id = `step-${idx}`;
                el.className = `step-container bg-white p-6 rounded-2xl shadow-sm border border-slate-200 ${idx === 0 ? 'active' : ''}`;
                
                el.innerHTML = `
                    <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
                        <h3 class="font-bold text-slate-700 text-lg flex items-center">
                            <span class="w-8 h-8 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center mr-3 text-sm font-bold shadow-sm">${idx + 1}</span>
                            ${step.instruction}
                        </h3>
                    </div>
                    <div class="mb-6 text-xl leading-loose pl-2 content-area font-medium text-slate-700">
                        ${step.template}
                    </div>
                    <div class="options-area">
                        <div class="flex flex-wrap gap-2 mb-4" id="options-${idx}">
                            <!-- Options JS Generated -->
                        </div>
                        <div class="flex items-center justify-between mt-4">
                            <div id="msg-${idx}" class="text-sm font-bold h-6"></div>
                            <button onclick="checkAnswer(${id}, ${idx})" id="check-btn-${idx}" disabled class="bg-slate-200 text-slate-400 font-bold py-2 px-6 rounded-xl transition cursor-not-allowed">æª¢æŸ¥</button>
                        </div>
                    </div>
                `;
                
                // é¸é …æŒ‰éˆ•
                const optContainer = el.querySelector(`#options-${idx}`);
                step.options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn hover:bg-indigo-50 hover:border-indigo-300';
                    btn.innerHTML = formatMath(opt);
                    btn.onclick = () => fillSlot(idx, opt, btn);
                    optContainer.appendChild(btn);
                });

                // Slot ç¶å®š
                el.querySelectorAll('.slot').forEach(slot => {
                    slot.onclick = () => clearSlot(idx, slot);
                });

                area.appendChild(el);
            });
            
            // ç‰¹æ®Šè™•ç†ï¼šè¼”åŠ©ç·šé¡Œç›®
            if(id === 3) {
                // ç­‰åˆ°ç‰¹å®šæ­¥é©Ÿå®Œæˆå†é¡¯ç¤º
            }
        }

        // --- äº’å‹•é‚è¼¯ ---
        function fillSlot(stepIdx, val, btn) {
            const stepEl = document.getElementById(`step-${stepIdx}`);
            const emptySlot = Array.from(stepEl.querySelectorAll('.slot')).find(s => !s.dataset.value);
            
            if (emptySlot) {
                emptySlot.innerHTML = formatMath(val);
                emptySlot.dataset.value = val;
                emptySlot.classList.add('filled');
                btn.disabled = true;
                
                const allFilled = Array.from(stepEl.querySelectorAll('.slot')).every(s => s.dataset.value);
                const checkBtn = document.getElementById(`check-btn-${stepIdx}`);
                if (allFilled) {
                    checkBtn.disabled = false;
                    checkBtn.classList.replace('bg-slate-200', 'bg-indigo-600');
                    checkBtn.classList.replace('text-slate-400', 'text-white');
                    checkBtn.classList.remove('cursor-not-allowed');
                }
                playSound('pop');
            }
        }

        function clearSlot(stepIdx, slot) {
            if (!slot.dataset.value || slot.classList.contains('correct')) return;
            const val = slot.dataset.value;
            slot.innerHTML = '';
            delete slot.dataset.value;
            slot.classList.remove('filled', 'error');
            
            // æ¢å¾©æŒ‰éˆ• (è™•ç†é‡è¤‡é¸é …ï¼šåªæ¢å¾©ç¬¬ä¸€å€‹åŒ¹é…ä¸”ç¦ç”¨çš„æŒ‰éˆ•)
            const btns = document.querySelectorAll(`#options-${stepIdx} .option-btn`);
            for (let btn of btns) {
                if (btn.disabled && (btn.innerText === val || btn.innerHTML.includes(val))) {
                    btn.disabled = false;
                    break;
                }
            }
            
            const checkBtn = document.getElementById(`check-btn-${stepIdx}`);
            checkBtn.disabled = true;
            checkBtn.classList.replace('bg-indigo-600', 'bg-slate-200');
            checkBtn.classList.replace('text-white', 'text-slate-400');
            checkBtn.classList.add('cursor-not-allowed');
        }

        function checkAnswer(pId, sIdx) {
            const problem = problems.find(p => p.id === pId);
            const step = problem.steps[sIdx];
            const stepEl = document.getElementById(`step-${sIdx}`);
            const userVals = Array.from(stepEl.querySelectorAll('.slot')).map(s => s.dataset.value);
            const correctVals = step.answers;
            
            let isCorrect = true;
            // ç°¡åŒ–æª¢æŸ¥ï¼šåš´æ ¼é †åº
            userVals.forEach((v, i) => { if(v !== correctVals[i]) isCorrect = false; });

            if (isCorrect) {
                playSound('success');
                stepEl.classList.add('completed');
                stepEl.querySelectorAll('.slot').forEach(s => s.classList.add('correct'));
                
                // ç‰¹æ®Šï¼šè¼”åŠ©ç·š
                if(pId === 3 && sIdx === 0) {
                     const line = document.getElementById('aux-line');
                     if(line) { line.classList.remove('aux-line-hidden'); line.classList.add('aux-line-visible'); }
                }

                const nextIdx = sIdx + 1;
                if (nextIdx < problem.steps.length) {
                    const nextStep = document.getElementById(`step-${nextIdx}`);
                    nextStep.classList.add('active');
                    nextStep.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    // å®Œæˆå…¨éƒ¨æ­¥é©Ÿ
                    clearInterval(appState.timer);
                    finishProblem(pId);
                }
            } else {
                // ç­”éŒ¯é‚è¼¯
                playSound('error');
                appState.hasError = true; // æ¨™è¨˜æ­¤é¡Œæœ‰å¤±èª¤
                
                stepEl.querySelectorAll('.slot').forEach(s => {
                    s.classList.add('error');
                    setTimeout(() => s.classList.remove('error'), 500);
                });
                document.getElementById(`msg-${sIdx}`).innerHTML = '<span class="text-red-500">é †åºæˆ–ç­”æ¡ˆæœ‰èª¤</span>';
            }
        }

        function finishProblem(pId) {
            const timeUsed = appState.timeElapsed;
            // é‡‘ç‰Œæ¢ä»¶ï¼šæ™‚é–“å…§(300s) ä¸” ç„¡éŒ¯èª¤
            const rank = (timeUsed <= 300 && !appState.hasError) ? 'GOLD' : 'SILVER';
            
            appState.unlockedPets[pId] = { time: timeUsed, rank: rank };
            const problem = problems.find(p => p.id === pId);

            // Modal Content Update
            document.getElementById('modal-pet-icon').innerText = problem.pet.icon;
            document.getElementById('modal-pet-name').innerText = problem.pet.name;
            document.getElementById('modal-pet-desc').innerText = problem.pet.desc;
            
            const mins = Math.floor(timeUsed / 60).toString().padStart(2, '0');
            const secs = (timeUsed % 60).toString().padStart(2, '0');
            document.getElementById('modal-time').innerText = `${mins}:${secs}`;
            
            const rankEl = document.getElementById('modal-rank');
            rankEl.innerText = rank;
            rankEl.className = `text-xl font-black ${rank === 'GOLD' ? 'text-yellow-500' : 'text-slate-400'}`;

            showModal();
        }

        function formatMath(text) {
            if (/^[A-Z]{2}$/.test(text) && text !== "AA") return `<span class="segment">${text}</span>`;
            if (text.includes("â–³") || text.includes("âˆ ")) return `<span class="math-serif">${text}</span>`;
            return text;
        }

        // --- UI Utils ---
        function showModal() {
            const modal = document.getElementById('completion-modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('opacity-0', 'scale-95');
                content.classList.add('opacity-100', 'scale-100');
            }, 10);
            createConfetti();
        }
        
        function closeModal() {
            const modal = document.getElementById('completion-modal');
            const content = document.getElementById('modal-content');
            content.classList.remove('opacity-100', 'scale-100');
            content.classList.add('opacity-0', 'scale-95');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function playSound(type) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            const now = ctx.currentTime;
            if (type === 'pop') {
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'success') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(600, now + 0.1);
                osc.frequency.linearRampToValueAtTime(800, now + 0.2);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now); osc.stop(now + 0.4);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            }
        }

        function createConfetti() {
            const colors = ['#f43f5e', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'];
            for(let i=0; i<40; i++) {
                const el = document.createElement('div');
                el.style.cssText = `position:fixed;left:50%;top:50%;width:8px;height:8px;z-index:101;background:${colors[Math.floor(Math.random()*colors.length)]}`;
                document.body.appendChild(el);
                const angle = Math.random() * Math.PI * 2;
                const dist = 100 + Math.random() * 200;
                el.animate([
                    { transform: `translate(0,0) scale(1)`, opacity: 1 },
                    { transform: `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px) scale(0)`, opacity: 0 }
                ], { duration: 800 + Math.random() * 800, fill: 'forwards' }).onfinish = () => el.remove();
            }
        }
    </script>
</body>
</html>