<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WMNZ6FESH7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WMNZ6FESH7');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三、連比的運算3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }
        .input-correct { animation: correct-pulse 0.5s ease; }
        .input-incorrect { animation: incorrect-shake 0.5s ease; }
        @keyframes correct-pulse {
            0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); }
            100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
        }
        @keyframes incorrect-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .eq-blue { color: #2563eb; }
        .eq-green { color: #16a34a; }
        .speaker-btn:hover { background-color: rgba(0,0,0,0.1); }
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: scale(1);
        }
        .nav-btn {
             background-color: #4f46e5;
             color: white;
             font-weight: bold;
             padding: 8px 16px;
             border-radius: 9999px;
             transition: all 0.2s;
        }
        .nav-btn:not(:disabled):hover {
            background-color: #4338ca;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl min-h-screen flex flex-col justify-center">

        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-600">三、連比的運算3</h1>
        </header>

        <div id="hint-sidebar" class="bg-white p-6 rounded-2xl shadow-xl mb-8">
             <div class="flex flex-col md:flex-row md:items-center gap-4">
                <h3 class="text-2xl font-bold text-indigo-600 flex items-center shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                    解題小幫手
                </h3>
                <div id="hint-content-container" class="w-full bg-indigo-50 p-4 rounded-lg text-lg flex items-center justify-between gap-4 min-h-[72px]">
                </div>
            </div>
        </div>

        <main>
            <div id="quiz-card" class="bg-white p-6 md:p-8 rounded-2xl shadow-xl transition-all duration-500">
                <div id="question-container" class="mb-6">
                    <p id="question-title" class="text-gray-600 text-lg font-semibold mb-4 text-center">
                        第 <span id="question-number">1</span> 題：已知 x、y、z 皆不等於 0，且 <b id="eq1" class="eq-blue"></b>，<b id="eq2" class="eq-green"></b>，求 x : y : z。
                    </p>
                    
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 my-6 max-w-md mx-auto">
                        <p class="text-sm text-center text-gray-500 mb-4">請先在下方空格中，填入由方程式換算出的兩個比例，再算出最終答案。</p>
                        <div class="grid grid-cols-5 gap-2 items-center text-center font-bold text-2xl text-gray-500">
                            <span>x</span><span>:</span><span>y</span><span>:</span><span>z</span>
                        </div>
                        <hr class="my-3 border-t-2 border-gray-300">
                        
                        <div id="bridge-x-inputs">
                            <div class="grid grid-cols-5 gap-2 items-center text-center text-4xl font-bold mb-2">
                                <input name="x_for_xy_x" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-blue-300 rounded-lg focus:ring-4 focus:ring-blue-200 transition-all" placeholder="x">
                                <span class="text-gray-400">:</span>
                                <input name="y_for_xy_x" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-blue-300 rounded-lg focus:ring-4 focus:ring-blue-200 transition-all" placeholder="y">
                            </div>
                            <div class="grid grid-cols-5 gap-2 items-center text-center text-4xl font-bold">
                                <input name="x_for_xz_x" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-green-300 rounded-lg focus:ring-4 focus:ring-green-200 transition-all" placeholder="x">
                                <span></span><span></span>
                                <span class="text-gray-400">:</span>
                                <input name="z_for_xz_x" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-green-300 rounded-lg focus:ring-4 focus:ring-green-200 transition-all" placeholder="z">
                            </div>
                        </div>

                        <div id="bridge-y-inputs" class="hidden">
                             <div class="grid grid-cols-5 gap-2 items-center text-center text-4xl font-bold mb-2">
                                <input name="x_for_xy_y" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-blue-300 rounded-lg focus:ring-4 focus:ring-blue-200 transition-all" placeholder="x">
                                <span class="text-gray-400">:</span>
                                <input name="y_for_xy_y" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-blue-300 rounded-lg focus:ring-4 focus:ring-blue-200 transition-all" placeholder="y">
                            </div>
                             <div class="grid grid-cols-5 gap-2 items-center text-center text-4xl font-bold">
                                <span></span>
                                <span></span>
                                <input name="y_for_yz_y" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-green-300 rounded-lg focus:ring-4 focus:ring-green-200 transition-all" placeholder="y">
                                <span class="text-gray-400">:</span>
                                <input name="z_for_yz_y" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-green-300 rounded-lg focus:ring-4 focus:ring-green-200 transition-all" placeholder="z">
                            </div>
                        </div>

                        <div id="bridge-z-inputs" class="hidden">
                             <div class="grid grid-cols-5 gap-2 items-center text-center text-4xl font-bold mb-2">
                                <input name="x_for_xz_z" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-blue-300 rounded-lg focus:ring-4 focus:ring-blue-200 transition-all" placeholder="x">
                                <span></span><span></span>
                                <span class="text-gray-400">:</span>
                                <input name="z_for_xz_z" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-blue-300 rounded-lg focus:ring-4 focus:ring-blue-200 transition-all" placeholder="z">
                            </div>
                            <div class="grid grid-cols-5 gap-2 items-center text-center text-4xl font-bold">
                                <span></span>
                                <span></span>
                                <input name="y_for_yz_z" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-green-300 rounded-lg focus:ring-4 focus:ring-green-200 transition-all" placeholder="y">
                                <span class="text-gray-400">:</span>
                                <input name="z_for_yz_z" type="number" class="w-full h-16 text-center text-3xl font-bold border-2 border-green-300 rounded-lg focus:ring-4 focus:ring-green-200 transition-all" placeholder="z">
                            </div>
                        </div>

                        <hr class="my-3 border-t-2 border-black">

                        <div id="final-answer-container" class="grid grid-cols-5 gap-2 items-center">
                            <input name="finalX" type="number" class="w-full h-20 text-center text-3xl font-bold border-2 border-gray-400 rounded-lg focus:ring-4 focus:ring-indigo-300 transition-all">
                            <span class="text-3xl font-bold text-gray-400 text-center">:</span>
                            <input name="finalY" type="number" class="w-full h-20 text-center text-3xl font-bold border-2 border-gray-400 rounded-lg focus:ring-4 focus:ring-indigo-300 transition-all">
                            <span class="text-3xl font-bold text-gray-400 text-center">:</span>
                            <input name="finalZ" type="number" class="w-full h-20 text-center text-3xl font-bold border-2 border-gray-400 rounded-lg focus:ring-4 focus:ring-indigo-300 transition-all">
                        </div>
                    </div>
                </div>

                <div class="flex justify-center space-x-4 mb-6">
                    <button id="check-btn" class="w-48 py-3 px-6 bg-indigo-500 text-white font-bold text-lg rounded-full hover:bg-indigo-600 transform hover:scale-105 transition-all duration-300 shadow-lg">檢查答案</button>
                </div>

                <div id="final-feedback-container" class="p-4 rounded-lg bg-gray-100 min-h-[80px] transition-all duration-300">
                </div>

                 <div class="flex justify-between items-center mt-8">
                    <button id="prev-btn" class="nav-btn">上一題</button>
                    <span id="question-counter" class="text-gray-600 font-semibold"></span>
                    <button id="next-btn" class="nav-btn">下一題</button>
                </div>
            </div>
        </main>
    </div>

<script>
    const questions = [
        {
            bridge: 'x',
            equations: { eq1: '3x = 2y', eq2: '4x = 3z' },
            intermediateRatios: { x_for_xy_x: 2, y_for_xy_x: 3, x_for_xz_x: 3, z_for_xz_x: 4 },
            finalAnswer: { finalX: 6, finalY: 9, finalZ: 8 },
            hints: {
                default: `<p class="text-gray-500">點擊題目下方的空格開始作答，提示會出現在這裡喔！</p>`,
                ratio1: `<b>步驟一：</b> 將方程式 <b class="eq-blue">3x = 2y</b> 轉為 x:y 的比例式。`,
                ratio2: `<b>步驟二：</b> 將方程式 <b class="eq-green">4x = 3z</b> 轉為 x:z 的比例式。`,
                final: `<b>步驟三：</b> 找出橋樑 <b>x</b> 的最小公倍數 (2和3)，並將兩個比例放大，合併成最終答案！`
            }
        },
        {
            bridge: 'z',
            equations: { eq1: '6x = 7z', eq2: '5y = 4z' },
            intermediateRatios: { x_for_xz_z: 7, z_for_xz_z: 6, y_for_yz_z: 4, z_for_yz_z: 5 },
            finalAnswer: { finalX: 35, finalY: 24, finalZ: 30 },
            hints: {
                default: `<p class="text-gray-500">試著找出 x, y, z 的關係吧！</p>`,
                ratio1: `<b>步驟一：</b> 將方程式 <b class="eq-blue">6x = 7z</b> 轉為 x:z 的比例式。`,
                ratio2: `<b>步驟二：</b> 將方程式 <b class="eq-green">5y = 4z</b> 轉為 y:z 的比例式。`,
                final: `<b>步驟三：</b>找出橋樑 <b>z</b> 的最小公倍數 (6和5)，合併成最終答案！`
            }
        },
        {
            bridge: 'y',
            equations: { eq1: '3x = 2y', eq2: '3y = 5z' },
            intermediateRatios: { x_for_xy_y: 2, y_for_xy_y: 3, y_for_yz_y: 5, z_for_yz_y: 3 },
            finalAnswer: { finalX: 10, finalY: 15, finalZ: 9 },
            hints: {
                default: `<p class="text-gray-500">這次的橋樑是 y 喔！</p>`,
                ratio1: `<b>步驟一：</b> 將方程式 <b class="eq-blue">3x = 2y</b> 轉為 x:y 的比例式。`,
                ratio2: `<b>步驟二：</b> 將方程式 <b class="eq-green">3y = 5z</b> 轉為 y:z 的比例式。`,
                final: `<b>步驟三：</b> 找出橋樑 <b>y</b> 的最小公倍數 (3和5)，合併成最終答案！`
            }
        }
    ];
    
    let currentQuestionIndex = 0;
    let allInputs; 

    const eq1El = document.getElementById('eq1');
    const eq2El = document.getElementById('eq2');
    const questionNumberEl = document.getElementById('question-number');
    const questionCounterEl = document.getElementById('question-counter');
    const checkBtn = document.getElementById('check-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const hintContainer = document.getElementById('hint-content-container');
    const finalFeedbackContainer = document.getElementById('final-feedback-container');
    const finalInputs = document.querySelectorAll('#final-answer-container input');
    
    const inputBlocks = {
        x: document.getElementById('bridge-x-inputs'),
        y: document.getElementById('bridge-y-inputs'),
        z: document.getElementById('bridge-z-inputs')
    };

    let currentHintText = '';

    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-TW';
        utterance.rate = 1.1;
        window.speechSynthesis.speak(utterance);
    }
    
    function stripHtml(html){
       let tmp = document.createElement("DIV");
       tmp.innerHTML = html;
       return tmp.textContent || tmp.innerText || "";
    }

    function showHint(hintKey) {
        if (checkBtn.disabled && hintKey !== 'default') {
            if (finalFeedbackContainer.innerHTML !== '') return;
        }
        
        const currentQuestion = questions[currentQuestionIndex];
        const hintHTML = currentQuestion.hints[hintKey];
        currentHintText = stripHtml(hintHTML.replace(/<br.*?>/g, '。'));
        
        hintContainer.innerHTML = `
            <div class="text-left flex-grow">${hintHTML}</div>
            <div class="shrink-0">
                <button id="speak-btn" class="p-2 rounded-full speaker-btn" title="再聽一次">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                </button>
            </div>
        `;
        
        document.getElementById('speak-btn').addEventListener('click', () => speak(currentHintText));
    }
    
    function checkAnswer() {
        let allCorrect = true;
        const userAnswers = {};
        allInputs.forEach(input => {
            userAnswers[input.name] = parseInt(input.value, 10);
        });

        const currentQuestion = questions[currentQuestionIndex];

        allInputs.forEach(input => {
            const name = input.name;
            const isIntermediate = currentQuestion.intermediateRatios.hasOwnProperty(name);
            const correctAnswer = isIntermediate ? currentQuestion.intermediateRatios[name] : currentQuestion.finalAnswer[name];
            
            input.disabled = true;
            input.classList.remove('border-blue-300', 'border-green-300', 'border-gray-400', 'focus:ring-blue-200', 'focus:ring-green-200', 'focus:ring-indigo-300');

            if (userAnswers[name] === correctAnswer) {
                input.classList.add('input-correct', 'border-green-500');
            } else {
                input.classList.add('input-incorrect', 'border-red-500');
                allCorrect = false;
            }
        });

        if (allCorrect) {
            finalFeedbackContainer.className = 'p-4 rounded-lg bg-green-100 text-green-800 transition-all duration-300 text-center';
            finalFeedbackContainer.innerHTML = `<h3 class="font-bold text-lg">🎉 完全正確！太厲害了！</h3>`;
        } else {
            finalFeedbackContainer.className = 'p-4 rounded-lg bg-red-100 text-red-800 transition-all duration-300 text-center';
            const finalAnswerString = Object.values(currentQuestion.finalAnswer).join(' : ');
            finalFeedbackContainer.innerHTML = `<h3 class="font-bold text-lg">再檢查一下喔！</h3><p>最終的正確答案是 <b class="text-red-600">${finalAnswerString}</b>。</p>`;
        }
        
        hintContainer.innerHTML = '';
        checkBtn.disabled = true;
        checkBtn.classList.add('opacity-50', 'cursor-not-allowed');
    }

    function resetUI() {
        finalFeedbackContainer.className = 'p-4 rounded-lg bg-gray-100 min-h-[80px] transition-all duration-300';
        finalFeedbackContainer.innerHTML = '';
        
        document.querySelectorAll('#bridge-x-inputs input, #bridge-y-inputs input, #bridge-z-inputs input, #final-answer-container input').forEach(input => {
            input.value = '';
            input.disabled = false;
            input.classList.remove('input-correct', 'input-incorrect', 'border-green-500', 'border-red-500');
        });

        checkBtn.disabled = false;
        checkBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    }

    function loadQuestion(index) {
        currentQuestionIndex = index;
        const question = questions[index];
        
        resetUI();

        questionNumberEl.textContent = index + 1;
        eq1El.textContent = question.equations.eq1;
        eq2El.textContent = question.equations.eq2;
        questionCounterEl.textContent = `第 ${index + 1} / ${questions.length} 題`;

        Object.values(inputBlocks).forEach(block => block.classList.add('hidden'));
        inputBlocks[question.bridge].classList.remove('hidden');

        allInputs = document.querySelectorAll(`#bridge-${question.bridge}-inputs input, #final-answer-container input`);

        const currentBlock = inputBlocks[question.bridge];
        const ratioInputs1 = currentBlock.querySelectorAll('.grid:first-child input');
        const ratioInputs2 = currentBlock.querySelectorAll('.grid:last-child input');
        ratioInputs1.forEach(input => input.addEventListener('focus', () => showHint('ratio1')));
        ratioInputs2.forEach(input => input.addEventListener('focus', () => showHint('ratio2')));
        
        prevBtn.disabled = (index === 0);
        nextBtn.disabled = (index === questions.length - 1);

        showHint('default');

        if(allInputs.length > 0) {
            allInputs[0].focus();
        }
    }

    checkBtn.addEventListener('click', checkAnswer);
    prevBtn.addEventListener('click', () => {
        if (currentQuestionIndex > 0) {
            loadQuestion(currentQuestionIndex - 1);
        }
    });
    nextBtn.addEventListener('click', () => {
        if (currentQuestionIndex < questions.length - 1) {
            loadQuestion(currentQuestionIndex + 1);
        }
    });
    
    document.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !checkBtn.disabled) {
            checkAnswer();
        }
    });
    
    finalInputs.forEach(input => input.addEventListener('focus', () => showHint('final')));

    loadQuestion(0);

</script>
</body>
</html>