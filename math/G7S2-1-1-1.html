<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒå…ƒä¸€æ¬¡å¼ï¼šç´”ç²¹åˆ—å¼å¯¦é©—å®¤</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Noto Sans TC"', 'sans-serif'] },
                    colors: {
                        stone: { 50: '#fafaf9', 100: '#f5f5f4', 200: '#e7e5e4', 300: '#d6d3d1', 400: '#a8a29e', 500: '#78716c', 600: '#57534e', 700: '#44403c', 800: '#292524', 900: '#1c1917' },
                        accent: { light: '#fdba74', DEFAULT: '#f97316', dark: '#c2410c' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f5f5f4; }
        .token-btn { transition: all 0.2s; border: 1px solid #d6d3d1; }
        .token-btn:hover { transform: translateY(-2px); background-color: #f97316; color: white; border-color: #f97316; box-shadow: 0 4px 10px rgba(249, 115, 22, 0.15); }
        .token-btn:active { transform: translateY(0); }
        .builder-display { min-height: 100px; display: flex; align-items: center; justify-content: center; border: 2px dashed #d6d3d1; background: #fff; border-radius: 1.5rem; position: relative; transition: all 0.3s; }
        .builder-display::before { content: 'ç®—å¼é è¦½ AREA'; position: absolute; top: 10px; left: 20px; font-size: 9px; color: #a8a29e; font-weight: 900; letter-spacing: 0.15em; }
        .builder-display.active { border-style: solid; border-color: #f97316; background: #fffaf5; }
        .katex { font-size: 1.6em; }
        .problem-nav-btn.active { background-color: #f97316; color: white; border-color: #f97316; }
    </style>
    
    <!-- Chosen Palette: Stone & Safety Orange (Modern Academic) -->
    <!-- Application Structure Plan: 
         1. å·¦å³åˆ†å‰²å¸ƒå±€ï¼š
            - å·¦æ¬„ (Left)ï¼šé¡Œç›®æ–‡å­—ã€æƒ…å¢ƒåˆ†æè¡¨ã€‚
            - å³æ¬„ (Right)ï¼šç®—å¼é è¦½è¦–çª—ã€äº¤äº’å¼æ¨™ç±¤éµç›¤ã€‚
         2. å„ªé»ï¼šåœ¨ç­†è¨˜å‹é›»è…¦è¢å¹•ä¸Šå¯ä¸€è¦½å…¨è²Œï¼Œç„¡éœ€ä¸Šä¸‹æ»¾å‹•ï¼Œæ“ä½œæ›´ç›´è¦ºã€‚
         3. éŸ¿æ‡‰å¼ï¼šåœ¨è¡Œå‹•è£ç½®è‡ªå‹•åˆ‡æ›å›å‚ç›´å †ç–Šã€‚
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="text-stone-800 font-sans antialiased min-h-screen flex flex-col">

    <header class="bg-white border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-[1400px] mx-auto px-6 py-3 flex justify-between items-center">
            <h1 class="text-sm font-black text-stone-600 tracking-tighter uppercase flex items-center">
                <span class="w-2 h-2 bg-accent rounded-full mr-2"></span> Algebra Lab <span class="ml-2 font-normal text-stone-400">| äºŒå…ƒä¸€æ¬¡å¼å¯¦é©—å®¤</span>
            </h1>
            <div class="flex gap-2" id="nav-buttons">
                <!-- Nav Buttons -->
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-[1400px] mx-auto px-6 py-6 w-full">
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 h-full items-start">
            
            <!-- LEFT COLUMN: Problem & Analysis -->
            <div class="space-y-6">
                <div class="bg-white rounded-[2rem] shadow-sm border border-stone-200 p-8 min-h-[500px] flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-[10px] font-black text-stone-400 uppercase tracking-widest" id="problem-id-label">Task 01</span>
                        <span class="px-3 py-1 bg-stone-50 rounded text-[10px] font-bold text-stone-500 border border-stone-200" id="problem-type">ç¸½å’Œè¨ˆç®—</span>
                    </div>

                    <h2 class="text-2xl font-bold text-stone-800 mb-4" id="problem-title">è®€å–ä¸­...</h2>
                    
                    <div id="question-box" class="text-xl leading-relaxed text-stone-600 mb-8 p-6 bg-stone-50 rounded-2xl italic">
                        <!-- Question Text -->
                    </div>

                    <div class="mt-auto">
                        <p class="text-[10px] font-black text-stone-400 uppercase tracking-widest mb-3">é‚è¼¯æ‹†è§£èˆ‡åƒè€ƒ</p>
                        <div class="overflow-hidden rounded-xl border border-stone-100">
                            <table class="w-full text-center text-sm">
                                <thead class="bg-stone-50 text-stone-400 text-[10px] font-black uppercase">
                                    <tr>
                                        <th class="p-3">é …ç›®</th>
                                        <th class="p-3">æ•¸å€¼</th>
                                        <th class="p-3">æœªçŸ¥æ•¸</th>
                                        <th class="p-3 text-accent">å°æ‡‰é …</th>
                                    </tr>
                                </thead>
                                <tbody id="table-body" class="divide-y divide-stone-50">
                                    <!-- Rows -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: Builder & Keyboard -->
            <div class="space-y-6">
                
                <!-- Builder Area -->
                <div class="bg-white rounded-[2rem] shadow-sm border border-stone-200 p-8 flex flex-col gap-8">
                    
                    <div id="builder-display" class="builder-display shadow-inner p-6">
                        <!-- Formula Output -->
                    </div>

                    <div class="space-y-6 bg-stone-50 p-6 rounded-2xl">
                        <div class="grid grid-cols-1 gap-6">
                            <!-- Items -->
                            <div class="space-y-3">
                                <h4 class="text-[10px] font-black text-stone-400 uppercase tracking-widest">ä»£æ•¸å…ƒä»¶ (Click to add)</h4>
                                <div class="flex flex-wrap gap-2" id="btn-group-vars">
                                    <!-- Token Buttons -->
                                </div>
                            </div>

                            <!-- Operators -->
                            <div class="space-y-3">
                                <h4 class="text-[10px] font-black text-stone-400 uppercase tracking-widest">é‹ç®—ç¬¦è™Ÿ</h4>
                                <div class="flex gap-2">
                                    <button onclick="app.addToken('+')" class="token-btn w-12 h-12 bg-white rounded-xl shadow-sm text-xl font-bold text-stone-600">+</button>
                                    <button onclick="app.addToken('-')" class="token-btn w-12 h-12 bg-white rounded-xl shadow-sm text-xl font-bold text-stone-600">-</button>
                                </div>
                            </div>
                        </div>

                        <!-- System Actions -->
                        <div class="flex flex-wrap gap-3 pt-6 border-t border-stone-200">
                            <button onclick="app.backspace()" class="flex-grow py-3 px-4 bg-white border border-stone-200 rounded-xl text-stone-600 text-xs font-bold hover:bg-stone-100 transition">å›é€€</button>
                            <button onclick="app.clear()" class="flex-grow py-3 px-4 bg-white border border-stone-200 rounded-xl text-stone-600 text-xs font-bold hover:bg-stone-100 transition uppercase">Clear</button>
                            <button onclick="app.checkAnswer()" class="w-full py-4 bg-stone-800 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-stone-700 transition">æäº¤ç­”æ¡ˆæª¢æŸ¥</button>
                        </div>
                    </div>

                    <div class="text-center text-[10px] text-stone-400 font-medium">
                        * æç¤ºï¼šè«‹ä¾ç…§é¡Œç›®é‚è¼¯å°‡æ•¸å­—ã€è®Šæ•¸èˆ‡ç¬¦è™Ÿçµ„åˆèµ·ä¾†
                    </div>
                </div>

            </div>

        </div>
    </main>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="fixed inset-0 bg-stone-900/40 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-6">
        <div class="bg-white rounded-[2.5rem] p-10 max-w-sm w-full text-center shadow-2xl scale-up">
            <div id="modal-icon" class="text-7xl mb-6">âœ¨</div>
            <h4 id="modal-title" class="text-2xl font-bold text-stone-800 mb-2">æ­£ç¢ºï¼</h4>
            <p id="modal-text" class="text-stone-500 mb-8 text-sm">ä½ æˆåŠŸå°‡ç”Ÿæ´»æƒ…å¢ƒè½‰åŒ–ç‚ºæ•¸å­¸åˆ—å¼ã€‚</p>
            <button onclick="app.closeModal()" class="w-full py-4 bg-accent text-white rounded-xl font-bold hover:bg-accent-dark transition">ç¹¼çºŒæŒ‘æˆ°</button>
        </div>
    </div>

    <script>
        const problems = [
            {
                id: 1, title: "æŠ•ç±ƒå¾—åˆ†è¨ˆç®—", type: "ç¸½å’Œåˆ—å¼",
                desc: "æ¢“è¯æŠ•é€²äº† **å…©åˆ†çƒ $x$ å€‹** èˆ‡ **ä¸‰åˆ†çƒ $y$ å€‹**ï¼Œå…±å¾—å¹¾åˆ†ï¼Ÿ",
                tokens: ["2", "x", "3", "y"],
                answer: "2x+3y",
                rows: [["å…©åˆ†çƒ", "2", "x", "2x"], ["ä¸‰åˆ†çƒ", "3", "y", "3y"]]
            },
            {
                id: 2, title: "æµ·å ±èˆ‡éº¥å…‹ç­†", type: "ç¸½å’Œåˆ—å¼",
                desc: "ç³ç³è²·äº† **10å…ƒçš„æµ·å ± $x$ å¼µ** èˆ‡ **25å…ƒçš„éº¥å…‹ç­† $y$ æ**ï¼Œå…±èŠ±å¤šå°‘å…ƒï¼Ÿ",
                tokens: ["10", "x", "25", "y"],
                answer: "10x+25y",
                rows: [["æµ·å ±ç´™", "10", "x", "10x"], ["éº¥å…‹ç­†", "25", "y", "25y"]]
            },
            {
                id: 3, title: "å°èŠ³çš„æ–‡å…·èŠ±è²»", type: "æ‰£æ¸›åˆ—å¼",
                desc: "**åŸæœ‰ 200 å…ƒ**ï¼Œè²·äº† 3 æ **æ¯æ $x$ å…ƒ** çš„è‡ªå‹•é‰›ç­†èˆ‡ 4 æ **æ¯æ $y$ å…ƒ** çš„åŸå­ç­†å¾Œï¼Œå‰©å¤šå°‘å…ƒï¼Ÿ",
                tokens: ["200", "3", "x", "4", "y"],
                answer: "200-3x-4y",
                rows: [["è‡ªå‹•é‰›ç­†", "x", "3", "3x"], ["åŸå­ç­†", "y", "4", "4y"], ["åŸæœ‰åŸºæº–", "200", "-", "-"]]
            },
            {
                id: 4, title: "ä¾¿åˆ©å•†åº—æ‰¾é›¶", type: "æ‰£æ¸›åˆ—å¼",
                desc: "**èº«ä¸Šæœ‰ 300 å…ƒ**ï¼Œè²·äº† $x$ ç“¶ **æ¯ç“¶ 25 å…ƒ** çš„æœæ±èˆ‡ $y$ å€‹ **æ¯å€‹ 12 å…ƒ** çš„å¸ƒä¸ï¼Œå‰©å¤šå°‘å…ƒï¼Ÿ",
                tokens: ["300", "25", "x", "12", "y"],
                answer: "300-25x-12y",
                rows: [["æœèœæ±", "25", "x", "25x"], ["å¸ƒä¸", "12", "y", "12y"], ["åˆå§‹ç¾é‡‘", "300", "-", "-"]]
            },
            {
                id: 5, title: "å›æ¨åŸæœ¬å¸¶çš„éŒ¢", type: "ç¸½å’Œå›æ¨",
                desc: "è²·äº† 4 é¡† **æ¯é¡† $x$ å…ƒ** çš„è˜‹æœèˆ‡ 3 é¡† **æ¯é¡† $y$ å…ƒ** çš„èŠ­æ¨‚å¾Œï¼Œé‚„ **å‰©ä¸‹ 20 å…ƒ**ï¼ŒåŸæœ¬å¸¶å¹¾å…ƒï¼Ÿ",
                tokens: ["4", "x", "3", "y", "20"],
                answer: "4x+3y+20",
                rows: [["è˜‹æœ", "x", "4", "4x"], ["èŠ­æ¨‚", "y", "3", "3y"], ["å‰©é¤˜é¤˜é¡", "20", "-", "-"]]
            }
        ];

        const app = {
            pIdx: 0,
            userTokens: [],

            init() {
                this.renderNav();
                this.loadProblem(0);
            },

            renderNav() {
                const nav = document.getElementById('nav-buttons');
                nav.innerHTML = problems.map((p, i) => `
                    <button onclick="app.loadProblem(${i})" class="problem-nav-btn w-8 h-8 rounded-lg border border-stone-200 transition-all font-bold text-[10px] flex items-center justify-center ${this.pIdx === i ? 'active' : 'bg-white text-stone-400 hover:border-stone-400'}">
                        ${p.id}
                    </button>
                `).join('');
            },

            loadProblem(idx) {
                this.pIdx = idx;
                this.userTokens = [];
                const p = problems[idx];
                this.renderNav();

                document.getElementById('problem-id-label').innerText = `Task 0${p.id}`;
                document.getElementById('problem-title').innerText = p.title;
                document.getElementById('problem-type').innerText = p.type;
                
                const questionHtml = p.desc.replace(/\*\*(.*?)\*\*/g, '<strong class="text-stone-800">$1</strong>');
                document.getElementById('question-box').innerHTML = questionHtml;

                const tbody = document.getElementById('table-body');
                tbody.innerHTML = p.rows.map(r => `
                    <tr>
                        <td class="p-3 text-xs font-bold text-stone-700">${r[0]}</td>
                        <td class="p-3 text-xs text-stone-400">${this.renderKatexInline(r[1])}</td>
                        <td class="p-3 text-xs text-stone-400">${this.renderKatexInline(r[2])}</td>
                        <td class="p-3 text-xs font-mono font-bold text-accent">${this.renderKatexInline(r[3])}</td>
                    </tr>
                `).join('');

                const btnGroup = document.getElementById('btn-group-vars');
                btnGroup.innerHTML = p.tokens.map(t => `
                    <button onclick="app.addToken('${t}')" class="token-btn px-4 py-3 bg-white rounded-xl shadow-sm font-bold text-stone-800 text-sm border-stone-200">${this.renderKatexInline(t)}</button>
                `).join('');

                this.updateBuilder();
                this.renderMathOnPage();
            },

            renderKatexInline(text) {
                if (text === '-' || !text) return text;
                try { return katex.renderToString(text, { throwOnError: false }); } 
                catch (e) { return text; }
            },

            renderMathOnPage() {
                const targets = document.querySelectorAll('#question-box');
                targets.forEach(el => {
                    el.innerHTML = el.innerHTML.replace(/\$(.*?)\$/g, (m, p1) => this.renderKatexInline(p1));
                });
            },

            addToken(t) {
                this.userTokens.push(t);
                this.updateBuilder();
            },

            backspace() {
                this.userTokens.pop();
                this.updateBuilder();
            },

            clear() {
                this.userTokens = [];
                this.updateBuilder();
            },

            updateBuilder() {
                const display = document.getElementById('builder-display');
                if (this.userTokens.length === 0) {
                    display.innerHTML = '<span class="text-stone-300 text-xs font-medium">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é€²è¡Œçµ„åˆ...</span>';
                    display.classList.remove('active');
                    return;
                }
                display.classList.add('active');
                const formula = this.userTokens.join('');
                display.innerHTML = this.renderKatexInline(formula);
            },

            checkAnswer() {
                const p = problems[this.pIdx];
                const input = this.userTokens.join('').replace(/\s/g, '');
                
                let isCorrect = (input === p.answer);
                
                // Commutative Check
                if (!isCorrect && p.answer.includes('+')) {
                    const parts = p.answer.split('+');
                    if (input === parts[1] + '+' + parts[0]) isCorrect = true;
                    if (p.id === 5) {
                        const userParts = input.split('+');
                        if (userParts.length === 3 && userParts.includes('4x') && userParts.includes('3y') && userParts.includes('20')) isCorrect = true;
                    }
                }

                this.showModal(isCorrect);
            },

            showModal(success) {
                const modal = document.getElementById('feedback-modal');
                const title = document.getElementById('modal-title');
                const text = document.getElementById('modal-text');
                const icon = document.getElementById('modal-icon');

                modal.classList.remove('hidden');
                if (success) {
                    icon.innerText = 'âœ¨';
                    title.innerText = 'å®Œå…¨æ­£ç¢ºï¼';
                    text.innerText = 'ä½ å·²ç¶“æŒæ¡äº†å°‡æƒ…å¢ƒè½‰æ›ç‚ºä»£æ•¸å¼çš„ç²¾é«“ã€‚';
                } else {
                    icon.innerText = 'ğŸ”';
                    title.innerText = 'å†æª¢æŸ¥ä¸€ä¸‹';
                    text.innerText = 'è«‹æ³¨æ„è®Šæ•¸ã€æ•¸å­—ä»¥åŠåŠ æ¸›è™Ÿçš„é †åºèˆ‡å®Œæ•´æ€§ã€‚';
                }
            },

            closeModal() {
                document.getElementById('feedback-modal').classList.add('hidden');
            }
        };

        window.onload = () => app.init();
    </script>
</body>
</html>