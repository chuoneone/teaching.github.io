<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動學習：2-1 點、線、圓</title>
    <link rel="icon" href="dog.png" type="image/png">
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入字型 Chiron GoRound TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- [修正] 補上 family= -->
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&display=swap" rel="stylesheet">
    
    <!-- [修正] 引入 KaTeX 數學公式函式庫 (修正 integrity 拼寫) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" xintegrity="sha384-Ld2+S9GfA/sdyOeC7R5O/SwC/NPfK/2S+sB/eXJjlA/tq/hSdV2QhR/1T/cRTcSB" crossorigin="anonymous">
    <!-- [修正] 將 xintegrity 改為 integrity，並加上 defer -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" xintegrity="sha384-hNlLflKaM0Yv3jT1Rba3lCW+nBqDHWb/iA+1QfOMjQ+jM/mB/DaP/T2bxoU+qM/H" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" xintegrity="sha384-48SVGFYoG/cOKr+n+BwCyPaY/1HotfwRABEo/YAp/C/n1iK2E4fV4BpT/t1/zi+N" crossorigin="anonymous"></script>
    
    <style>
        /* 應用全域字型 */
        body {
            font-family: "Chiron GoRound TC", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        
        /* 關鍵字螢光筆效果 */
        .highlight {
            background: linear-gradient(to top, transparent 10%, #fef9c3 10% 80%, transparent 80%); /* bg-yellow-100 */
        }
        
        /* [新]  concepto-btn 樣式 */
        .concept-btn {
            padding: 0.5rem 1.5rem; /* py-2 px-6 */
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            border-radius: 0.5rem; /* rounded-lg */
            border: 2px solid #d1d5db; /* border-gray-300 */
            background-color: #f9fafb; /* bg-gray-50 */
            color: #4b5563; /* text-gray-600 */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .concept-btn.active {
            background-color: #3b82f6; /* bg-blue-500 */
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3); /* shadow-lg */
        }
        .concept-btn:not(.active):hover {
            background-color: #ffffff;
            border-color: #9ca3af; /* border-gray-400 */
        }
        /* [新] 禁用按鈕的樣式 */
        .concept-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* SVG 圖形樣式 */
        .svg-circle {
            fill: none;
            stroke: #9ca3af; /* stroke-gray-400 */
            stroke-width: 2;
        }
        .svg-point {
            fill: #ef4444; /* fill-red-500 */
            stroke: none;
        }
        .svg-line {
            fill: none;
            stroke: #3b82f6; /* stroke-blue-500 */
            stroke-width: 2.5;
            stroke-linecap: round;
        }
        .svg-angle-fill {
            fill: #bfdbfe; /* fill-blue-200 */
            stroke: #3b82f6; /* stroke-blue-500 */
            stroke-width: 1;
            opacity: 0.7;
        }
        .svg-arc-minor {
            fill: none;
            stroke: #1d4ed8; /* stroke-blue-800 */
            stroke-width: 3;
        }
        .svg-arc-major {
            fill: none;
            stroke: #60a5fa; /* stroke-blue-400 */
            stroke-width: 3;
        }
        
        /* 答案輸入框樣式 (下拉選單) */
        .answer-select {
            width: 200px; 
            text-align: left;
            font-size: 1.125rem; /* text-lg */
            border: 2px solid #cbd5e1; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem; /* p-2 */
            background-color: white;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path stroke="%236B7280" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 8l4 4 4-4"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem; /* 預留箭頭空間 */
            cursor: pointer;
        }
        .answer-select:focus {
            outline: none;
            border-color: #3b82f6; /* border-blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* ring-2 ring-blue-500 */
        }
        .answer-select:disabled {
            background-color: #f3f4f6; /* bg-gray-100 */
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        /* 頁籤按鈕樣式 (已無使用，可保留) */
        .tab-btn {
            padding: 0.5rem 1rem; /* py-2 px-4 */
            font-weight: 600; /* font-semibold */
            border-radius: 0.5rem 0.5rem 0 0; /* rounded-t-lg */
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-bottom: none;
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #6b7280; /* text-gray-500 */
            cursor: not-allowed;
            opacity: 0.6;
        }
        .tab-btn.active {
            background-color: #ffffff; /* bg-white */
            color: #1d4ed8; /* text-blue-700 */
            border-bottom: 1px solid #ffffff;
            margin-bottom: -1px; /* 蓋掉下方的 border */
            opacity: 1;
            cursor: pointer;
        }
        .tab-btn:not(:disabled):not(.active):hover {
            background-color: #e5e7eb; /* bg-gray-200 */
        }
        .tab-btn:disabled:not(.active) {
            color: #9ca3af; /* text-gray-400 */
        }

        /* --- 
           計算題的輸入框樣式
        --- */
        .calc-input {
            width: 3rem; /* w-12 */
            text-align: center;
            font-size: 1.125rem; /* text-lg */
            border: 2px solid #cbd5e1; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.25rem; /* p-1 */
            background-color: white;
            transition: border-color 0.2s;
        }
        .calc-input:focus {
            outline: none;
            border-color: #3b82f6; /* border-blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* ring-2 ring-blue-500 */
        }
        .calc-input:disabled {
            background-color: #f3f4f6; /* bg-gray-100 */
            opacity: 1; 
            color: #1f2937; /* text-gray-800 */
            border-style: dashed; 
        }
        /* 答對時的樣式 (由 JS 控制) */
        .calc-input.correct {
            border-color: #22c55e; /* border-green-500 */
            color: #166534; /* text-green-800 */
            font-weight: 600;
        }
        .calc-input:disabled.correct {
            color: #166534; /* text-green-800 */
            font-weight: 600;
            border-color: #22c55e;
            border-style: solid; /* 實線 */
        }
        /* 答錯時的樣式 (由 JS 控制) */
        .calc-input.incorrect {
            border-color: #ef4444; /* border-red-500 */
            color: #b91c1c; /* text-red-800 */
            font-weight: 600;
        }

        /* KaTeX 數學公式樣式 */
        .katex {
            font-size: 1.1em; 
            display: inline-block;
            vertical-align: middle;
        }

        /* 分數顯示樣式 */
        .fraction {
            display: inline-flex;
            flex-direction: column;
            vertical-align: middle;
            margin: 0 0.25rem; /* mx-1 */
            text-align: center;
        }
        .fraction-bar {
            height: 2px;
            background-color: #1f2937; /* gray-800 */
            width: 100%; 
            margin: 2px 0;
        }
        .fraction input.calc-input {
            margin: 0.1rem 0;
        }

        /* 步驟化計算的樣式 */
        .calc-step.hidden {
            display: none;
        }
        .step-check-btn {
            padding: 0.25rem 0.75rem; /* py-1 px-3 */
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            transition: background-color 0.2s;
        }
        .step-check-btn:disabled {
            background-color: #d1d5db; /* bg-gray-300 */
            cursor: not-allowed;
            opacity: 0.7;
        }

        #completion-message, #completion-message-point-1, #completion-message-point-2, #completion-message-point-3, 
        #completion-message-ring-1, #completion-message-ring-2, #completion-message-ring-3 {
            /* 樣式由 Tailwind class .hidden 和 .p-6 .bg-green-100 等控制 */
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen pb-24"> <!-- 預留 footer 空間 -->

    <div class="container max-w-3xl mx-auto p-4 md:p-8">
        <header class="text-center mb-6">
            <!-- [更新] 標題 -->
            <h1 class="text-3xl font-bold text-blue-800">2-1 點、線、圓</h1>
        </header>

        <!-- [更新] 概念切換導覽列 (移除 5) -->
        <nav class="flex justify-center gap-4 mb-8 flex-wrap">
            <!-- [更新] 按鈕 3 設為 active -->
            <button id="concept-btn-3" class="concept-btn active" onclick="switchConcept(3)">
                (三) 扇形的應用
            </button>
            <button id="concept-btn-4" class="concept-btn" onclick="switchConcept(4)">
                (四) 點與圓
            </button>
        </nav>

        <!-- [移除] 概念一 (定義) 內容 -->
        
        <!-- [移除] 概念二 (計算) 內容 -->

        <!-- 
          ==========================
          (三) 扇形的應用
          ==========================
        -->
        <!-- [更新] 預設顯示，移除 hidden -->
        <div id="concept-3-content" class="">
            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg mt-8">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">三、扇形的應用</h2>
                
                <!-- 
                  =================
                  扇形應用 題目 1
                  =================
                -->
                <div class="space-y-6">
                    <p class="text-xl leading-relaxed font-semibold">
                        1. 扇形 $AOB$ 與扇形 $COD$ 中，$\overline{OA}=4$, $\overline{OC}=8$，圓心角為 $30^\circ$，求灰色區域面積。
                    </p>

                    <!-- 互動區 Q1 -->
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <!-- 左側：SVG 圖 Q1 -->
                        <div class="w-full md:w-1/2 text-center">
                             <!-- SVG 圖形 Q1 (30°) (修正版) -->
                             <svg class="w-64 h-48 mx-auto" viewBox="0 0 120 70">
                                <style>
                                    .svg-text-ring { font-size: 8px; font-family: "Chiron GoRound TC", sans-serif; }
                                    .svg-line-stroke { stroke: #000; stroke-width: 1.5; }
                                    .svg-arc-stroke { stroke: #000; stroke-width: 1.5; fill: none; }
                                    .svg-fill-grey { fill: #e5e7eb; } /* bg-gray-200 */
                                </style>
                                <!--
                                  O = (10, 60)
                                  Angle = 30 deg
                                  r (AOB) = 40
                                  R (COD) = 80
                                  
                                  cos(30) = 0.866, sin(30) = 0.5
                                  B = (10 + 40, 60) = (50, 60)
                                  D = (10 + 80, 60) = (90, 60)
                                  A = (10 + 40*cos(30), 60 - 40*sin(30)) = (10 + 34.6, 60 - 20) = (44.6, 40)
                                  C = (10 + 80*cos(30), 60 - 80*sin(30)) = (10 + 69.2, 60 - 40) = (79.2, 20)
                                -->
                                
                                <!-- 灰色填充區域 Path: B -> D -> Arc C -> L A -> Arc B -->
                                <path d="M 50 60 L 90 60 A 80 80 0 0 0 79.2 20 L 44.6 40 A 40 40 0 0 1 50 60 Z" class="svg-fill-grey" />
                                
                                <!-- 線條 -->
                                <line x1="10" y1="60" x2="90" y2="60" class="svg-line-stroke" /> <!-- O-D -->
                                <line x1="10" y1="60" x2="79.2" y2="20" class="svg-line-stroke" /> <!-- O-C -->
                                
                                <!-- 弧線 -->
                                <!-- [修正] 弧線 A-B (sweep-flag 1 -> 0) -->
                                <path d="M 50 60 A 40 40 0 0 0 44.6 40" class="svg-arc-stroke" /> <!-- Arc A-B -->
                                <path d="M 90 60 A 80 80 0 0 0 79.2 20" class="svg-arc-stroke" /> <!-- Arc C-D -->

                                <!-- 標示文字 -->
                                <text x="0" y="63" class="svg-text-ring">O</text>
                                <text x="38" y="38" class="svg-text-ring">A</text>
                                <text x="48" y="65" class="svg-text-ring">B</text>
                                <text x="78" y="18" class="svg-text-ring">C</text>
                                <text x="88" y="65" class="svg-text-ring">D</text>
                                
                                <!-- 角度 (移除小弧線, 調整文字位置) -->
                                <text x="28" y="48" class="svg-text-ring">30°</text>
                            </svg>
                        </div>
                        
                        <!-- 右側：步驟檢查 Q1 -->
                        <div class="w-full md:w-1/2 space-y-3">
                            <!-- [更新] 步驟 1: 大圓 - 小圓 -->
                            <div id="ring-step-1-q1" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：半徑平方差 (大圓 - 小圓)</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-ring-q1-1" class="calc-input" aria-label="大扇形半徑平方"> ) $\pi$ - 
                                    ( <input type="text" id="calc-ring-q1-2" class="calc-input" aria-label="小扇形半徑平方"> ) $\pi$
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-1-q1" onclick="checkRingStep(1, 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-ring-1-q1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- [更新] 步驟 2: 乘以角度 -->
                            <div id="ring-step-2-q1" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：乘以角度比例 (× 角度)</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-ring-q1-3" class="calc-input" aria-label="半徑平方差"> ) $\pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-ring-q1-4" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-ring-q1-5" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-2-q1" onclick="checkRingStep(1, 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-ring-2-q1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            
                            <!-- [更新] 步驟 3: 答案 -->
                            <div id="ring-step-3-q1" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-ring-q1-6" class="calc-input w-16" aria-label="最終答案"> $\pi$
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-3-q1" onclick="checkRingStep(1, 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">檢查</button>
                                    <div id="feedback-ring-3-q1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- (步驟 4, 5 移除) -->

                            <!-- 完成訊息 Q1 -->
                            <div id="completion-message-ring-1" class="hidden text-center p-6 bg-green-100 border border-green-300 rounded-lg">
                                <h3 class="text-2xl font-bold text-green-700">太棒了！</h3>
                                <p class="text-lg text-green-600 mt-2">你學會扇形環狀面積了！</e>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 
                  =================
                  [新] 扇形應用 題目 2
                  =================
                -->
                <div class="space-y-6 pt-8 mt-8 border-t border-gray-300">
                    <p class="text-xl leading-relaxed font-semibold">
                        2. 扇形 $AOB$ 與扇形 $COD$ 中，$\overline{OA}=3$, $\overline{OC}=9$，圓心角為 $75^\circ$，求灰色區域面積。
                    </p>

                    <!-- 互動區 Q2 -->
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <!-- [更新] 左側：SVG 圖 Q2 (75°) -->
                        <div class="w-full md:w-1/2 text-center">
                             <svg class="w-64 h-64 mx-auto" viewBox="0 0 80 100">
                                <style>
                                    .svg-text-ring-q2 { font-size: 8px; font-family: "Chiron GoRound TC", sans-serif; }
                                    .svg-line-stroke { stroke: #000; stroke-width: 1.5; }
                                    .svg-arc-stroke { stroke: #000; stroke-width: 1.5; fill: none; }
                                    .svg-fill-grey { fill: #e5e7eb; } /* bg-gray-200 */
                                </style>
                                <!--
                                  O = (10, 90)
                                  Angle = 75 deg
                                  r (AOB) = 30
                                  R (COD) = 70
                                  cos(75) = 0.2588, sin(75) = 0.9659
                                  B = (10 + 30, 90) = (40, 90)
                                  D = (10 + 70, 90) = (80, 90)
                                  A = (10 + 30*cos(75), 90 - 30*sin(75)) = (17.8, 61.0)
                                  C = (10 + 70*cos(75), 90 - 70*sin(75)) = (28.1, 22.4)
                                -->
                                <!-- 灰色填充區域 Path: B -> D -> Arc C -> L A -> Arc B -->
                                <path d="M 40 90 L 80 90 A 70 70 0 0 0 28.1 22.4 L 17.8 61.0 A 30 30 0 0 1 40 90 Z" class="svg-fill-grey" />
                                
                                <!-- 線條 -->
                                <line x1="10" y1="90" x2="80" y2="90" class="svg-line-stroke" /> <!-- O-D -->
                                <line x1="10" y1="90" x2="28.1" y2="22.4" class="svg-line-stroke" /> <!-- O-C -->
                                
                                <!-- 弧線 -->
                                <!-- [修正] 弧線 A-B (sweep-flag 1 -> 0) -->
                                <path d="M 40 90 A 30 30 0 0 0 17.8 61.0" class="svg-arc-stroke" /> <!-- Arc A-B -->
                                <path d="M 80 90 A 70 70 0 0 0 28.1 22.4" class="svg-arc-stroke" /> <!-- Arc C-D -->

                                <!-- 角度弧線 -->
                                <path d="M 25 90 A 15 15 0 0 0 13.9 76.0" class="svg-arc-stroke" stroke-width="1" />
                                <text x="22" y="78" class="svg-text-ring-q2">75°</text>

                                <!-- 標示文字 -->
                                <text x="0" y="93" class="svg-text-ring-q2">O</text>
                                <text x="15" y="58" class="svg-text-ring-q2">A</text>
                                <text x="38" y="95" class="svg-text-ring-q2">B</text>
                                <text x="25" y="18" class="svg-text-ring-q2">C</text>
                                <text x="78" y="95" class="svg-text-ring-q2">D</text>
                            </svg>
                        </div>
                        
                        <!-- 右側：步驟檢查 Q2 -->
                        <div class="w-full md:w-1/2 space-y-3">
                            <!-- [更新] 步驟 1: 大圓 - 小圓 -->
                            <div id="ring-step-1-q2" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：半徑平方差 (大圓 - 小圓)</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-ring-q2-1" class="calc-input" aria-label="大扇形半徑平方"> ) $\pi$ - 
                                    ( <input type="text" id="calc-ring-q2-2" class="calc-input" aria-label="小扇形半徑平方"> ) $\pi$
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-1-q2" onclick="checkRingStep(2, 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-ring-1-q2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- [更新] 步驟 2: 乘以角度 -->
                            <div id="ring-step-2-q2" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：乘以角度比例 (× 角度)</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-ring-q2-3" class="calc-input" aria-label="半徑平方差"> ) $\pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-ring-q2-4" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-ring-q2-5" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-2-q2" onclick="checkRingStep(2, 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-ring-2-q2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            
                            <!-- [更新] 步驟 3: 答案 -->
                            <div id="ring-step-3-q2" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-ring-q2-6" class="calc-input w-16" aria-label="最終答案"> $\pi$
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-3-q2" onclick="checkRingStep(2, 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">檢查</button>
                                    <div id="feedback-ring-3-q2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- (步驟 4, 5 移除) -->

                            <!-- 完成訊息 Q2 -->
                            <div id="completion-message-ring-2" class="hidden text-center p-6 bg-green-100 border border-green-300 rounded-lg">
                                <h3 class="text-2xl font-bold text-green-700">太棒了！</h3>
                                <p class="text-lg text-green-600 mt-2">第二題也完成了！</e>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 
                  =================
                  [新] 扇形應用 題目 3
                  =================
                -->
                <div class="space-y-6 pt-8 mt-8 border-t border-gray-300">
                    <!-- [更新] 移除 "如圖" -->
                    <p class="text-xl leading-relaxed font-semibold">
                        3. 扇形 $AOB$ 與扇形 $COD$ 中，$\overline{OA}=8$, $\overline{OC}=12$，圓心角為 $135^\circ$，求灰色區域面積。
                    </p>

                    <!-- 互動區 Q3 -->
                    <!-- [更新] 移除 md:flex-row，讓計算步驟置中 -->
                    <div class="flex flex-col gap-6 items-center">
                        
                        <!-- [移除] 左側：SVG 圖 Q3 (135°) -->
                        
                        <!-- [更新] 右側：步驟檢查 Q3 (置中並加寬) -->
                        <div class="w-full md:w-2/3 space-y-3">
                            <!-- [更新] 步驟 1: 大圓 - 小圓 -->
                            <div id="ring-step-1-q3" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：半徑平方差 (大圓 - 小圓)</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    ( <input type="text" id="calc-ring-q3-1" class="calc-input" aria-label="大扇形半徑平方"> ) $\pi$ - 
                                    ( <input type="text" id="calc-ring-q3-2" class="calc-input" aria-label="小扇形半徑平方"> ) $\pi$
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-1-q3" onclick="checkRingStep(3, 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-ring-1-q3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>

                            <!-- [更新] 步驟 2: 乘以角度 -->
                            <div id="ring-step-2-q3" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：乘以角度比例 (× 角度)</p>
                                <div class="flex items-center justify-center gap-2 text-lg flex-wrap">
                                    = ( <input type="text" id="calc-ring-q3-3" class="calc-input" aria-label="半徑平方差"> ) $\pi \times$
                                    <span class="fraction">
                                        <input type="text" id="calc-ring-q3-4" class="calc-input" aria-label="圓心角">
                                        <span class="fraction-bar"></span>
                                        <input type="text" id="calc-ring-q3-5" class="calc-input" aria-label="總角度">
                                    </span>
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-2-q3" onclick="checkRingStep(3, 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-ring-2-q3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            
                            <!-- [更新] 步驟 3: 答案 -->
                            <div id="ring-step-3-q3" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：算出答案</p>
                                <div class="flex items-center justify-center gap-2 text-xl font-semibold">
                                    = <input type="text" id="calc-ring-q3-6" class="calc-input w-16" aria-label="最終答案"> $\pi$
                                </div>
                                <div class="text-center">
                                    <button id="btn-ring-3-q3" onclick="checkRingStep(3, 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">檢查</button>
                                    <div id="feedback-ring-3-q3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            
                            <!-- (步驟 4, 5 移除) -->

                            <!-- 完成訊息 Q3 -->
                            <div id="completion-message-ring-3" class="hidden text-center p-6 bg-green-100 border border-green-300 rounded-lg">
                                <h3 class="text-2xl font-bold text-green-700">恭喜！</h3>
                                <p class="text-lg text-green-600 mt-2">全部的扇形應用題都完成了！</e>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- [更新] (四) 點與圓 -->
        <div id="concept-4-content" class="hidden">
            <!-- 
            ==========================
            (四) 點與圓的位置關係
            ==========================
            -->
            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg mt-8">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">四、點與圓的位置關係</h2>

                <!-- 重點整理 -->
                <div class="bg-gray-100 p-4 rounded-lg mb-6 space-y-2">
                    <p class="text-lg font-semibold text-gray-800">重點整理：</p>
                    <ul class="list-disc list-inside space-y-1">
                        <li class="text-lg">圓心距離 $ > $ 半徑 $\rightarrow$ <span class="font-semibold text-red-600">圓外</span></li>
                        <li class="text-lg">圓心距離 $ = $ 半徑 $\rightarrow$ <span class="font-semibold text-blue-600">圓上</span></li>
                        <li class="text-lg">圓心距離 $ < $ 半徑 $\rightarrow$ <span class="font-semibold text-green-600">圓內</span></li>
                    </ul>
                </div>

                <!--
                  =================
                  點與圓 題目 1
                  =================
                -->
                <div class="space-y-6">
                    <p class="text-xl leading-relaxed font-semibold">
                        1. 已知圓 $O$ 半徑為 $4$，$A, B, C$ 三點與圓心 $O$ の距離分別為 $3, 4, 5$，判別 $A, B, C$ 三點與圓 $O$ の位置關係。
                    </p>
                    
                    <!-- 互動區 Q1 -->
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <!-- 左側：SVG 圖 Q1 -->
                        <div class="w-full md:w-1/2 text-center">
                            <svg class="w-64 h-64 mx-auto" viewBox="0 0 100 100">
                                <style>
                                    .svg-text-point { font-size: 5px; }
                                </style>
                                <!-- 半徑 4 (40) -->
                                <circle class="svg-circle" cx="50" cy="50" r="40" stroke-dasharray="4 4" />
                                <circle class="svg-point" cx="50" cy="50" r="2.5" />
                                <text x="52" y="52" class="svg-text-point">O</text>
                                
                                <!-- A 點: 距離 3 (30) -> 圓內 -->
                                <circle id="point-a-1" class="svg-point hidden" cx="50" cy="20" r="3" style="fill: #22c55e;" />
                                <text id="text-a-1" x="52" y="22" class="svg-text-point hidden" style="fill: #22c55e;">A (3)</text>
                                
                                <!-- B 點: 距離 4 (40) -> 圓上 -->
                                <circle id="point-b-1" class="svg-point hidden" cx="90" cy="50" r="3" style="fill: #3b82f6;" />
                                <text id="text-b-1" x="92" y="52" class="svg-text-point hidden" style="fill: #3b82f6;">B (4)</text>
                                
                                <!-- C 點: 距離 5 (50) -> 圓外 -->
                                <circle id="point-c-1" class="svg-point hidden" cx="20" cy="80" r="3" style="fill: #ef4444;" />
                                <text id="text-c-1" x="22" y="82" class="svg-text-point hidden" style="fill: #ef4444;">C (5)</text>
                            </svg>
                        </div>
                        
                        <!-- 右側：步驟檢查 Q1 -->
                        <div class="w-full md:w-1/2 space-y-3">
                            <!-- 步驟 1: A 點 -->
                            <div id="point-step-1-1" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：判斷 A 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>A 點 (距離 $3$) $\rightarrow$</span>
                                    <select id="select-a-1" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-a-1" onclick="checkPointStep(1, 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-a-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 步驟 2: B 點 -->
                            <div id="point-step-2-1" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：判斷 B 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>B 點 (距離 $4$) $\rightarrow$</span>
                                    <select id="select-b-1" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-b-1" onclick="checkPointStep(1, 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-b-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 步驟 3: C 點 -->
                            <div id="point-step-3-1" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：判斷 C 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>C 點 (距離 $5$) $\rightarrow$</span>
                                    <select id="select-c-1" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-c-1" onclick="checkPointStep(1, 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">檢查</button>
                                    <div id="feedback-c-1" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 完成訊息 Q1 -->
                            <div id="completion-message-point-1" class="hidden text-center p-6 bg-green-100 border border-green-300 rounded-lg">
                                <h3 class="text-2xl font-bold text-green-700">太棒了！</h3>
                                <p class="text-lg text-green-600 mt-2">你學會點與圓的關係了！</e>
                            </div>
                        </div>
                    </div>
                </div>

                <!--
                  =================
                  [新] 點與圓 題目 2
                  =================
                -->
                <div class="space-y-6 pt-8 mt-8 border-t border-gray-300">
                    <p class="text-xl leading-relaxed font-semibold">
                        2. 已知圓 $O$ 半徑為 $5$，$A, B, C$ 三點與圓心 $O$ の距離分別為 $6, 5, 4$，判別 $A, B, C$ 三點與圓 $O$ の位置關係。
                    </p>
                    
                    <!-- 互動區 Q2 -->
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <!-- 左側：SVG 圖 Q2 -->
                        <div class="w-full md:w-1/2 text-center">
                            <svg class="w-64 h-64 mx-auto" viewBox="0 0 100 100">
                                <!-- 半徑 5 (50) -->
                                <circle class="svg-circle" cx="50" cy="50" r="50" stroke-dasharray="4 4" />
                                <circle class="svg-point" cx="50" cy="50" r="2.5" />
                                <text x="52" y="52" class="svg-text-point">O</text>
                                
                                <!-- A 點: 距離 6 (60) -> 圓外 -->
                                <circle id="point-a-2" class="svg-point hidden" cx="80" cy="20" r="3" style="fill: #ef4444;" />
                                <text id="text-a-2" x="82" y="22" class="svg-text-point hidden" style="fill: #ef4444;">A (6)</text>
                                
                                <!-- B 點: 距離 5 (50) -> 圓上 -->
                                <circle id="point-b-2" class="svg-point hidden" cx="0" cy="50" r="3" style="fill: #3b82f6;" />
                                <text id="text-b-2" x="2" y="52" class="svg-text-point hidden" style="fill: #3b82f6;">B (5)</text>
                                
                                <!-- C 點: 距離 4 (40) -> 圓內 -->
                                <circle id="point-c-2" class="svg-point hidden" cx="70" cy="60" r="3" style="fill: #22c55e;" />
                                <text id="text-c-2" x="72" y="62" class="svg-text-point hidden" style="fill: #22c55e;">C (4)</text>
                            </svg>
                        </div>
                        
                        <!-- 右側：步驟檢查 Q2 -->
                        <div class="w-full md:w-1/2 space-y-3">
                            <!-- 步驟 1: A 點 -->
                            <div id="point-step-1-2" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 3 步：判斷 A 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>A 點 (距離 $6$) $\rightarrow$</span>
                                    <select id="select-a-2" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-a-2" onclick="checkPointStep(2, 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-a-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 步驟 2: B 點 -->
                            <div id="point-step-2-2" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 3 步：判斷 B 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>B 點 (距離 $5$) $\rightarrow$</span>
                                    <select id="select-b-2" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-b-2" onclick="checkPointStep(2, 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-b-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 步驟 3: C 點 -->
                            <div id="point-step-3-2" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 3 步：判斷 C 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>C 點 (距離 $4$) $\rightarrow$</span>
                                    <select id="select-c-2" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-c-2" onclick="checkPointStep(2, 3)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">檢查</button>
                                    <div id="feedback-c-2" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 完成訊息 Q2 -->
                            <div id="completion-message-point-2" class="hidden text-center p-6 bg-green-100 border border-green-300 rounded-lg">
                                <h3 class="text-2xl font-bold text-green-700">做得好！</h3>
                                <p class="text-lg text-green-600 mt-2">第二題也答對了！</e>
                            </div>
                        </div>
                    </div>
                </div>

                <!--
                  =================
                  [新] 點與圓 題目 3
                  =================
                -->
                <div class="space-y-6 pt-8 mt-8 border-t border-gray-300">
                    <p class="text-xl leading-relaxed font-semibold">
                        3. 已知圓 $O$ 半徑為 $6$，$A, B, C, D$ 四點與圓心 $O$ の距離分別為 $10, 8, 6, 2$，判別 $A, B, C, D$ 四點與圓 $O$ の位置關係。
                    </p>
                    
                    <!-- 互動區 Q3 -->
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <!-- 左側：SVG 圖 Q3 -->
                        <div class="w-full md:w-1/2 text-center">
                            <svg class="w-64 h-64 mx-auto" viewBox="0 0 100 100">
                                <!-- 半徑 6 (30 * 2 = 60) -> 30 -->
                                <circle class="svg-circle" cx="50" cy="50" r="30" stroke-dasharray="4 4" />
                                <circle class="svg-point" cx="50" cy="50" r="2.5" />
                                <text x="52" y="52" class="svg-text-point">O</text>
                                
                                <!-- A 點: 距離 10 (50) -> 圓外 -->
                                <circle id="point-a-3" class="svg-point hidden" cx="90" cy="30" r="3" style="fill: #ef4444;" />
                                <text id="text-a-3" x="92" y="32" class="svg-text-point hidden" style="fill: #ef4444;">A (10)</text>
                                
                                <!-- B 點: 距離 8 (40) -> 圓外 -->
                                <circle id="point-b-3" class="svg-point hidden" cx="10" cy="50" r="3" style="fill: #ef4444;" />
                                <text id="text-b-3" x="12" y="52" class="svg-text-point hidden" style="fill: #ef4444;">B (8)</text>
                                
                                <!-- C 點: 距離 6 (30) -> 圓上 -->
                                <circle id="point-c-3" class="svg-point hidden" cx="50" cy="80" r="3" style="fill: #3b82f6;" />
                                <text id="text-c-3" x="52" y="82" class="svg-text-point hidden" style="fill: #3b82f6;">C (6)</text>
                                
                                <!-- D 點: 距離 2 (10) -> 圓內 -->
                                <circle id="point-d-3" class="svg-point hidden" cx="40" cy="40" r="3" style="fill: #22c55e;" />
                                <text id="text-d-3" x="42" y="42" class="svg-text-point hidden" style="fill: #22c55e;">D (2)</text>
                            </svg>
                        </div>
                        
                        <!-- 右側：步驟檢查 Q3 -->
                        <div class="w-full md:w-1/2 space-y-3">
                            <!-- 步驟 1: A 點 -->
                            <div id="point-step-1-3" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300">
                                <p class="text-sm font-semibold text-gray-600">第 1 步 / 共 4 步：判斷 A 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>A 點 (距離 $10$) $\rightarrow$</span>
                                    <select id="select-a-3" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-a-3" onclick="checkPointStep(3, 1)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-a-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 步驟 2: B 點 -->
                            <div id="point-step-2-3" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 2 步 / 共 4 步：判斷 B 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>B 點 (距離 $8$) $\rightarrow$</span>
                                    <select id="select-b-3" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-b-3" onclick="checkPointStep(3, 2)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-b-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 步驟 3: C 點 -->
                            <div id="point-step-3-3" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 3 步 / 共 4 步：判斷 C 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>C 點 (距離 $6$) $\rightarrow$</span>
                                    <select id="select-c-3" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-c-3" onclick="checkPointStep(3, 3)" class="step-check-btn bg-blue-600 text-white hover:bg-blue-700">檢查</button>
                                    <div id="feedback-c-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 步驟 4: D 點 -->
                            <div id="point-step-4-3" class="calc-step p-3 bg-gray-50 rounded-lg border border-gray-300 hidden">
                                <p class="text-sm font-semibold text-gray-600">第 4 步 / 共 4 步：判斷 D 點</p>
                                <div class="flex items-center justify-start gap-3 text-lg">
                                    <span>D 點 (距離 $2$) $\rightarrow$</span>
                                    <select id="select-d-3" class="answer-select w-32 text-base"></select>
                                </div>
                                <div class="text-center">
                                    <button id="btn-d-3" onclick="checkPointStep(3, 4)" class="step-check-btn bg-green-600 text-white hover:bg-green-700">檢查</button>
                                    <div id="feedback-d-3" class="h-4 text-sm mt-1"></div>
                                </div>
                            </div>
                            <!-- 完成訊息 Q3 -->
                            <div id="completion-message-point-3" class="hidden text-center p-6 bg-green-100 border border-green-300 rounded-lg">
                                <h3 class="text-2xl font-bold text-green-700">恭喜！</h3>
                                <p class="text-lg text-green-600 mt-2">全部的點與圓練習都完成了！</e>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>


        <!-- [更新] (五) 直線與圓 -->
        <div id="concept-5-content" class="hidden">
            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg mt-8">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">五、直線與圓 (待)</h2>
                <p class="text-lg text-gray-500">這個單元即將推出！</p>
            </div>
        <!-- [移除] (五) 直線與圓 -->

    </div>

    <!-- 頁尾固定區塊 -->
    <footer class="fixed bottom-0 left-0 w-full text-center text-gray-400 text-sm bg-white bg-opacity-80 py-2 border-t border-gray-200 backdrop-blur-sm">
      © 2025 特教米克師｜採用 
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="text-sky-600 hover:underline">
        CC BY-NC-SA 4.0 創用CC授權
      </a>｜非商業用途歡迎轉載或改編，請保留署名並附上原始連結。
    </footer>

    <script>
        // [更新] (全域) 概念切換函式
        function switchConcept(conceptNumber) {
            // 隱藏所有概念內容
            document.getElementById('concept-3-content').classList.add('hidden');
            document.getElementById('concept-4-content').classList.add('hidden');
            
            // 移除所有按鈕的 'active' 狀態
            document.getElementById('concept-btn-3').classList.remove('active');
            document.getElementById('concept-btn-4').classList.remove('active');

            // 顯示指定的概念內容
            const activeContent = document.getElementById(`concept-${conceptNumber}-content`);
            if (activeContent) {
                activeContent.classList.remove('hidden');
            }
            
            // 標記指定的按鈕為 'active'
            const activeBtn = document.getElementById(`concept-btn-${conceptNumber}`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }


        // [移除] (一) 圓的定義 相關 SCRIPT
        
        // [移除] (二) 計算題 相關 SCRIPT
        
        
        // === (三) 扇形應用 ===

        // [更新] 計算題的正確 *列式* 答案
        const correctFormulaAnswers = {
            // [更新] (三) 扇形應用 (R=8, r=4, a=30) - Q1
            'calc-ring-q1-1': '64',   // 8*8
            'calc-ring-q1-2': '16',   // 4*4
            'calc-ring-q1-3': '48',   // 64-16
            'calc-ring-q1-4': '30',
            'calc-ring-q1-5': '360',
            'calc-ring-q1-6': '4',    // 48 * (30/360) = 4
            
            // [更新] (三) 扇形應用 (R=9, r=3, a=75) - Q2
            'calc-ring-q2-1': '81',   // 9*9
            'calc-ring-q2-2': '9',    // 3*3
            'calc-ring-q2-3': '72',   // 81-9
            'calc-ring-q2-4': '75',
            'calc-ring-q2-5': '360',
            'calc-ring-q2-6': '15',   // 72 * (75/360) = 15
            
            // [更新] (三) 扇形應用 (R=12, r=8, a=135) - Q3
            'calc-ring-q3-1': '144',  // 12*12
            'calc-ring-q3-2': '64',   // 8*8
            'calc-ring-q3-3': '80',   // 144-64
            'calc-ring-q3-4': '135',
            'calc-ring-q3-5': '360',
            'calc-ring-q3-6': '30'    // 80 * (135/360) = 30
        };

        // 追蹤三題的進度
        let ringProgress = {
            q1: 1,
            q2: 1,
            q3: 1
        };

        // [更新] 檢查函式以 qNum 區分題目，改為 3 步驟
        function checkRingStep(qNum, step) {
            let fieldsToCheck = [];
            let isStepCorrect = true;
            
            // [更新] 決定要檢查的欄位 ID
            if (step === 1) fieldsToCheck = [`calc-ring-q${qNum}-1`, `calc-ring-q${qNum}-2`];
            else if (step === 2) fieldsToCheck = [`calc-ring-q${qNum}-3`, `calc-ring-q${qNum}-4`, `calc-ring-q${qNum}-5`];
            else if (step === 3) fieldsToCheck = [`calc-ring-q${qNum}-6`];

            const feedbackEl = document.getElementById(`feedback-ring-${step}-q${qNum}`);
            
            fieldsToCheck.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                el.classList.remove('correct', 'incorrect');
                // 答案 key (e.g., calc-ring-q2-1)
                if (el.value.trim() === correctFormulaAnswers[id]) {
                    el.classList.add('correct');
                } else {
                    el.classList.add('incorrect');
                    isStepCorrect = false;
                }
            });

            if (isStepCorrect) {
                feedbackEl.textContent = '太棒了！答對了！';
                feedbackEl.className = 'h-4 text-sm mt-1 text-green-600 font-semibold';
                fieldsToCheck.forEach(id => document.getElementById(id).disabled = true);
                document.getElementById(`btn-ring-${step}-q${qNum}`).disabled = true;

                ringProgress['q' + qNum] = step + 1;
                const nextStep = step + 1;
                
                // [更新] 總步驟為 3
                if (nextStep <= 3) {
                    document.getElementById(`ring-step-${nextStep}-q${qNum}`).classList.remove('hidden');
                } else {
                    document.getElementById(`completion-message-ring-${qNum}`).classList.remove('hidden');
                }
            } else {
                feedbackEl.textContent = '噢！再檢查看看紅色的格子！';
                feedbackEl.className = 'h-4 text-sm mt-1 text-red-500 font-semibold';
            }
        }


        // === (四) 點與圓 ===
        
        // 選項
        const pointOptions = [
            { value: "", text: "請選擇..." },
            { value: "inside", text: "圓內" },
            { value: "on", text: "圓上" },
            { value: "outside", text: "圓外" }
        ];

        // 答案
        const pointCorrectAnswers = {
            'q1': { 1: 'inside', 2: 'on', 3: 'outside' }, // R=4. A:3, B:4, C:5
            'q2': { 1: 'outside', 2: 'on', 3: 'inside' }, // R=5. A:6, B:5, C:4
            'q3': { 1: 'outside', 2: 'outside', 3: 'on', 4: 'inside' } // R=6. A:10, B:8, C:6, D:2
        };

        // 檢查
        function checkPointStep(qNum, step) {
            // qNum: 1, 2, 3
            // step: 1(A), 2(B), 3(C), 4(D)
            
            let pointChar = String.fromCharCode(96 + step); // 1->a, 2->b, 3->c, 4->d
            let nextStep = step + 1;

            let selectId = `select-${pointChar}-${qNum}`;
            let feedbackId = `feedback-${pointChar}-${qNum}`;
            let nextStepId = `point-step-${nextStep}-${qNum}`;
            let pointId = `point-${pointChar}-${qNum}`;
            let textId = `text-${pointChar}-${qNum}`;
            let btnId = `btn-${pointChar}-${qNum}`;

            // 處理最後一步
            if (qNum === 1 && step === 3) nextStepId = `completion-message-point-1`;
            if (qNum === 2 && step === 3) nextStepId = `completion-message-point-2`;
            if (qNum === 3 && step === 4) nextStepId = `completion-message-point-3`;

            const selectEl = document.getElementById(selectId);
            const feedbackEl = document.getElementById(feedbackId);
            let isCorrect = false;
            
            if (selectEl.value === pointCorrectAnswers['q' + qNum][step]) {
                isCorrect = true;
            }

            if (isCorrect) {
                feedbackEl.textContent = '答對了！';
                feedbackEl.className = 'h-4 text-sm mt-1 text-green-600 font-semibold';
                selectEl.disabled = true;
                document.getElementById(btnId).disabled = true;
                
                // 顯示 SVG 上的點
                document.getElementById(pointId).classList.remove('hidden');
                document.getElementById(textId).classList.remove('hidden');
                
                // 顯示下一步
                document.getElementById(nextStepId).classList.remove('hidden');
            } else {
                feedbackEl.textContent = '再想一想... 距離和半徑比比看。';
                feedbackEl.className = 'h-4 text-sm mt-1 text-red-500 font-semibold';
            }
        }


        // === 頁面載入時執行 ===
        document.addEventListener('DOMContentLoaded', () => {
            
            // [移除] (一) 動態填入所有下拉選單的選項

            // (四) 動態填入「點與圓」下拉選單
            const pointSelects = [
                'select-a-1', 'select-b-1', 'select-c-1',
                'select-a-2', 'select-b-2', 'select-c-2',
                'select-a-3', 'select-b-3', 'select-c-3', 'select-d-3'
            ];
            pointSelects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    pointOptions.forEach(opt => {
                        const optionEl = document.createElement('option');
                        optionEl.value = opt.value;
                        optionEl.textContent = opt.text;
                        select.appendChild(optionEl);
                    });
                }
            });

            // (共用) 執行 KaTeX 渲染
            try {
                if (typeof renderMathInElement === 'function') {
                    renderMathInElement(document.body, {
                        delimiters: [
                            {left: '$', right: '$', display: false},
                            {left: '$$', right: '$$', display: true}
                        ],
                        throwOnError: false
                    });
                } else {
                    // [修正] 移除 setTimeout 重試, defer 應可解決
                    console.error("KaTeX 函式庫尚未載入。");
                }
            } catch (error) {
                console.error("KaTeX 渲染失敗:", error);
            }
        });

    </script>
</body>
</html>