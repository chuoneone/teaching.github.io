<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å› æ•¸èˆ‡å…¬å› æ•¸ äº’å‹•ç·´ç¿’</title>
    <link rel="icon" href="dog.png" type="image/png">
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 
      *** ä¿®æ­£ ***
      å°‡ "xintegrity" ä¿®æ­£ç‚º "integrity"ã€‚
      "xintegrity" ä¸æ˜¯ä¸€å€‹æ¨™æº–çš„ HTML å±¬æ€§ã€‚
      ä¸¦ç‚º <script> æ¨™ç±¤åŠ ä¸Š "defer" å±¬æ€§ï¼Œç¢ºä¿ DOM è¼‰å…¥å¾Œæ‰åŸ·è¡Œã€‚
    -->
    <!-- å¼•å…¥ KaTeX (æ•¸å­¸ç¬¦è™Ÿåº«) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" xintegrity="sha384-KiWOVVjnN8qwKLnOfUAUPPU+RmmCgatMasLBIenUAKCLjFzFNTYoW+NLimr9C+GZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" xintegrity="sha384-hIoPscM/ceQ82HjGMngEvyA2xKMS/JDaIuATBXTBDkNp4RBGJcGsftS+LALBCGAd" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6UfDk4_D/OqIe/S0SvpLIfknWssHBsZqiVYRgbQn+IcsEzhCAsnBiE/fX" crossorigin="anonymous"></script>

    <!-- å¼•å…¥ å­—å‹ Chiron GoRound TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&display=swap" rel="stylesheet">
    
    <style>
        /* è¨­ç½®åŸºæœ¬å­—å‹ */
        body {
            font-family: "Chiron GoRound TC", sans-serif;
            font-weight: 500; /* ä½¿ç”¨ç¨ç²—çš„å­—é‡å¢åŠ æ˜“è®€æ€§ */
            font-style: normal;
            background-color: #f8f9fa; /* æŸ”å’Œçš„èƒŒæ™¯è‰² */
        }
        
        /* éš±è—çš„æ­¥é©Ÿ */
        .step.hidden {
            display: none;
        }

        /* é—œéµå­—è¢å…‰ç­†æ•ˆæœ */
        .highlight {
            background: linear-gradient(to top, #fff380 50%, transparent 50%);
            padding: 0 2px;
        }
        
        /* å°ˆç‚ºç‰¹æ•™è¨­è¨ˆçš„æŒ‰éˆ•æ¨£å¼ (ç”¨æ–¼æ­¥é©Ÿ 5 & 9) */
        .btn-check {
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .btn-check-default {
            background-color: #0ea5e9;
            color: white;
        }
        .btn-check-default:hover {
            background-color: #0284c7;
        }
        .btn-check-default:disabled {
            background-color: #e0f2fe;
            color: #7dd3fc;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn-check-success {
            background-color: #22c55e;
            color: white;
        }
        .btn-check-error {
            background-color: #ef4444;
            color: white;
        }

        /* æ­¥é©Ÿ 5 & 9 çš„è¼¸å…¥æ¡†æ¨£å¼ */
        .input-answer {
            width: 100%;
            padding: 12px 16px;
            font-size: 1.1rem;
            border-radius: 12px;
            border: 2px solid #cbd5e1;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-answer:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        /* --- æ ¼å­çš„æ¨£å¼ --- */
        .factor-input {
            width: 4rem; /* 64px */
            height: 4rem; /* 64px */
            text-align: center;
            font-size: 1.25rem; /* text-lg */
            font-weight: 700; /* font-bold */
            border-radius: 8px; /* rounded-lg */
            border: 2px solid #cbd5e1; /* slate-300 */
            transition: all 0.2s;
            -moz-appearance: textfield; /* éš±è— Firefox çš„ number arrows */
        }
        .factor-input:focus {
            outline: none;
            border-color: #0ea5e9; /* sky-500 */
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }
        .factor-input.correct {
            background-color: #dcfce7; /* green-100 */
            border-color: #22c55e; /* green-500 */
            color: #166534; /* green-800 */
            pointer-events: none; /* ç­”å°å¾Œé–å®š */
        }
        /* éš±è— Chrome, Safari, Edge çš„ number arrows */
        .factor-input::-webkit-outer-spin-button,
        .factor-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- ä¸»è¦å…§å®¹å®¹å™¨ -->
    <main class="max-w-2xl mx-auto p-4 md:p-8 min-h-screen pb-24">
        
        <!-- æ¨™é¡Œå€ -->
        <header class="mb-6 border-b-2 border-gray-200 pb-4">
            <h1 class="text-3xl font-bold text-sky-700">å› æ•¸èˆ‡å…¬å› æ•¸</h1>
            <p class="text-lg text-gray-600 mt-2">æˆ‘å€‘ä¾†ä¸€æ­¥ä¸€æ­¥æ‰¾å‡º (30, 60, 90) å’Œ (24, 32) çš„<span class="highlight">å› æ•¸</span>èˆ‡<span class="highlight">å…¬å› æ•¸</span>å§ï¼</p>
        </header>

        <!-- *** æ–°å¢ï¼šå¿«é€Ÿå°è¦½æŒ‰éˆ• *** -->
        <nav class="flex justify-center gap-4 mb-6">
            <button onclick="jumpToSection(1)" class="w-full md:w-auto flex-1 px-6 py-3 bg-white border-2 border-sky-500 text-sky-600 font-bold rounded-xl shadow-sm hover:bg-sky-50 transition-all focus:outline-none focus:ring-2 focus:ring-sky-300">
                è·³è‡³ç¬¬ä¸€é¡Œ (30, 60, 90)
            </button>
            <button onclick="jumpToSection(2)" class="w-full md:w-auto flex-1 px-6 py-3 bg-white border-2 border-gray-400 text-gray-600 font-bold rounded-xl shadow-sm hover:bg-gray-100 transition-all focus:outline-none focus:ring-2 focus:ring-gray-300">
                è·³è‡³ç¬¬äºŒé¡Œ (24, 32)
            </button>
        </nav>

        <!-- é€²åº¦æç¤º -->
        <div id="progress-indicator" class="text-center text-lg font-semibold text-gray-600 mb-6 p-3 bg-white rounded-xl shadow-sm border border-gray-200">
            è¼‰å…¥ä¸­...
        </div>

        <!-- å­¸ç¿’æ­¥é©Ÿå€ -->
        <div class="space-y-8">
            
            <!-- æ­¥é©Ÿ 1: 30 çš„å› æ•¸ -->
            <section id="step-1" class="step p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬ä¸€é¡Œ (1)ï¼šæ‰¾å‡º 30 çš„å› æ•¸ (å…± 8 å€‹)</h2>
                <p class="text-gray-700 text-lg">
                    è«‹æ‰¾å‡º <span class="highlight">30</span> çš„æ‰€æœ‰å› æ•¸ã€‚
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹ç”±å°åˆ°å¤§ï¼Œä¸€å€‹ä¸€å€‹å¡«å…¥ä¸‹æ–¹çš„æ ¼å­ä¸­ã€‚</small>
                </p>
                <div id="input-grid-1" class="flex flex-wrap gap-3 justify-center">
                    <!-- è¼¸å…¥æ¡†å°‡ç”± JS è‡ªå‹•ç”Ÿæˆ -->
                </div>
                <div id="feedback-1" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>

            <!-- æ­¥é©Ÿ 2: 60 çš„å› æ•¸ -->
            <section id="step-2" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬ä¸€é¡Œ (1)ï¼šæ‰¾å‡º 60 çš„å› æ•¸ (å…± 12 å€‹)</h2>
                <p class="text-gray-700 text-lg">
                    è«‹æ‰¾å‡º <span class="highlight">60</span> çš„æ‰€æœ‰å› æ•¸ã€‚
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹ç”±å°åˆ°å¤§ï¼Œä¸€å€‹ä¸€å€‹å¡«å…¥ä¸‹æ–¹çš„æ ¼å­ä¸­ã€‚</small>
                </p>
                <div id="input-grid-2" class="flex flex-wrap gap-3 justify-center">
                    <!-- è¼¸å…¥æ¡†å°‡ç”± JS è‡ªå‹•ç”Ÿæˆ -->
                </div>
                <div id="feedback-2" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>

            <!-- æ­¥é©Ÿ 3: 90 çš„å› æ•¸ -->
            <section id="step-3" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬ä¸€é¡Œ (1)ï¼šæ‰¾å‡º 90 çš„å› æ•¸ (å…± 12 å€‹)</h2>
                <p class="text-gray-700 text-lg">
                    è«‹æ‰¾å‡º <span class="highlight">90</span> çš„æ‰€æœ‰å› æ•¸ã€‚
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹ç”±å°åˆ°å¤§ï¼Œä¸€å€‹ä¸€å€‹å¡«å…¥ä¸‹æ–¹çš„æ ¼å­ä¸­ã€‚</small>
                </p>
                <div id="input-grid-3" class="flex flex-wrap gap-3 justify-center">
                    <!-- è¼¸å…¥æ¡†å°‡ç”± JS è‡ªå‹•ç”Ÿæˆ -->
                </div>
                <div id="feedback-3" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>

            <!-- æ­¥é©Ÿ 4: æ‰¾å‡º (30, 60, 90) å…¬å› æ•¸ -->
            <section id="step-4" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬ä¸€é¡Œ (2)ï¼šåˆ—å‡º (30, 60, 90) å…¬å› æ•¸ (å…± 8 å€‹)</h2>
                <p class="text-gray-700 text-lg">
                    ä½ éƒ½æ‰¾å‡ºä¾†äº†ï¼æˆ‘å€‘ä¾†è¤‡ç¿’ä¸€ä¸‹ï¼š
                </p>
                <ul class="list-disc list-inside space-y-2 text-lg bg-gray-50 p-4 rounded-lg border">
                    <li><b>30 çš„å› æ•¸ï¼š</b><span id="list-30" class="font-mono"></span></li>
                    <li><b>60 çš„å› æ•¸ï¼š</b><span id="list-60" class="font-mono"></span></li>
                    <li><b>90 çš„å› æ•¸ï¼š</b><span id="list-90" class="font-mono"></span></li>
                </ul>
                <p class="text-gray-700 text-lg">
                    è«‹å¾ä¸Šé¢ä¸‰å€‹åˆ—è¡¨æ‰¾å‡º<span class="highlight">å…±åŒéƒ½æœ‰</span>çš„å› æ•¸ (å…¬å› æ•¸)ã€‚
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹ç”±å°åˆ°å¤§ï¼Œä¸€å€‹ä¸€å€‹å¡«å…¥ä¸‹æ–¹çš„æ ¼å­ä¸­ã€‚</small>
                </p>
                <div id="input-grid-4" class="flex flex-wrap gap-3 justify-center">
                    <!-- è¼¸å…¥æ¡†å°‡ç”± JS è‡ªå‹•ç”Ÿæˆ -->
                </div>
                <div id="feedback-4" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>
            
            <!-- æ­¥é©Ÿ 5: æ‰¾å‡º (30, 60, 90) æœ€å¤§å…¬å› æ•¸ (GCD) -->
            <section id="step-5" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬ä¸€é¡Œ (3)ï¼šæ‰¾å‡º (30, 60, 90) æœ€å¤§å…¬å› æ•¸</h2>
                <p class="text-gray-700 text-lg">
                    å¤ªå²å®³äº†ï¼ä½ æ‰¾å‡ºçš„<span class="highlight">å…¬å› æ•¸</span>æœ‰ï¼š
                </p>
                <div class="text-center text-xl font-bold text-sky-600 bg-sky-50 p-4 rounded-lg border border-sky-200">
                    <span id="list-common" class="font-mono"></span>
                </div>
                <p class="text-gray-700 text-lg">
                    é‚£éº¼ï¼Œ(30, 60, 90) çš„<span class="highlight">æœ€å¤§å…¬å› æ•¸</span>æ˜¯å¤šå°‘å‘¢ï¼Ÿ
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹å¡«å…¥å…¬å› æ•¸ä¸­ï¼Œæœ€å¤§çš„é‚£ä¸€å€‹æ•¸å­—ã€‚</small>
                </p>
                <div>
                    <input type="number" id="answer-5" class="input-answer" placeholder="æœ€å¤§çš„æ•¸å­—æ˜¯ï¼Ÿ">
                </div>
                <button id="btn-5" class="btn-check btn-check-default" onclick="checkStep(5)">æª¢æŸ¥ç­”æ¡ˆ (ç¬¬ä¸€é¡Œ)</button>
                <div id="feedback-5" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>

            <!-- === æ–°å¢çš„æ­¥é©Ÿ === -->

            <!-- æ­¥é©Ÿ 6: 24 çš„å› æ•¸ -->
            <section id="step-6" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬äºŒé¡Œ (1)ï¼šæ‰¾å‡º 24 çš„å› æ•¸ (å…± 8 å€‹)</h2>
                <p class="text-gray-700 text-lg">
                    å¤ªæ£’äº†ï¼Œç¬¬ä¸€é¡Œå®Œæˆäº†ï¼æˆ‘å€‘ä¾†æŒ‘æˆ°ç¬¬äºŒé¡Œï¼
                    <br>
                    è«‹æ‰¾å‡º <span class="highlight">24</span> çš„æ‰€æœ‰å› æ•¸ã€‚
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹ç”±å°åˆ°å¤§ï¼Œä¸€å€‹ä¸€å€‹å¡«å…¥ä¸‹æ–¹çš„æ ¼å­ä¸­ã€‚</small>
                </p>
                <div id="input-grid-6" class="flex flex-wrap gap-3 justify-center">
                    <!-- è¼¸å…¥æ¡†å°‡ç”± JS è‡ªå‹•ç”Ÿæˆ -->
                </div>
                <div id="feedback-6" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>

            <!-- æ­¥é©Ÿ 7: 32 çš„å› æ•¸ -->
            <section id="step-7" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬äºŒé¡Œ (1)ï¼šæ‰¾å‡º 32 çš„å› æ•¸ (å…± 6 å€‹)</h2>
                <p class="text-gray-700 text-lg">
                    è«‹æ‰¾å‡º <span class="highlight">32</span> çš„æ‰€æœ‰å› æ•¸ã€‚
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹ç”±å°åˆ°å¤§ï¼Œä¸€å€‹ä¸€å€‹å¡«å…¥ä¸‹æ–¹çš„æ ¼å­ä¸­ã€‚</small>
                </p>
                <div id="input-grid-7" class="flex flex-wrap gap-3 justify-center">
                    <!-- è¼¸å…¥æ¡†å°‡ç”± JS è‡ªå‹•ç”Ÿæˆ -->
                </div>
                <div id="feedback-7" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>

            <!-- æ­¥é©Ÿ 8: æ‰¾å‡º (24, 32) å…¬å› æ•¸ -->
            <section id="step-8" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬äºŒé¡Œ (2)ï¼šåˆ—å‡º (24, 32) å…¬å› æ•¸ (å…± 4 å€‹)</h2>
                <p class="text-gray-700 text-lg">
                    ä½ éƒ½æ‰¾å‡ºä¾†äº†ï¼æˆ‘å€‘ä¾†è¤‡ç¿’ä¸€ä¸‹ï¼š
                </p>
                <ul class="list-disc list-inside space-y-2 text-lg bg-gray-50 p-4 rounded-lg border">
                    <li><b>24 çš„å› æ•¸ï¼š</b><span id="list-24" class="font-mono"></span></li>
                    <li><b>32 çš„å› æ•¸ï¼š</b><span id="list-32" class="font-mono"></span></li>
                </ul>
                <p class="text-gray-700 text-lg">
                    è«‹å¾ä¸Šé¢äºŒå€‹åˆ—è¡¨æ‰¾å‡º<span class="highlight">å…±åŒéƒ½æœ‰</span>çš„å› æ•¸ (å…¬å› æ•¸)ã€‚
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹ç”±å°åˆ°å¤§ï¼Œä¸€å€‹ä¸€å€‹å¡«å…¥ä¸‹æ–¹çš„æ ¼å­ä¸­ã€‚</small>
                </p>
                <div id="input-grid-8" class="flex flex-wrap gap-3 justify-center">
                    <!-- è¼¸å…¥æ¡†å°‡ç”± JS è‡ªå‹•ç”Ÿæˆ -->
                </div>
                <div id="feedback-8" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>
            
            <!-- æ­¥é©Ÿ 9: æ‰¾å‡º (24, 32) æœ€å¤§å…¬å› æ•¸ (GCD) -->
            <section id="step-9" class="step hidden p-6 bg-white rounded-2xl shadow-lg border border-gray-200 space-y-5">
                <h2 class="text-xl font-bold">ç¬¬äºŒé¡Œ (3)ï¼šæ‰¾å‡º (24, 32) æœ€å¤§å…¬å› æ•¸</h2>
                <p class="text-gray-700 text-lg">
                    å¤ªå²å®³äº†ï¼ä½ æ‰¾å‡ºçš„<span class="highlight">å…¬å› æ•¸</span>æœ‰ï¼š
                </p>
                <div class="text-center text-xl font-bold text-sky-600 bg-sky-50 p-4 rounded-lg border border-sky-200">
                    <span id="list-common-24-32" class="font-mono"></span>
                </div>
                <p class="text-gray-700 text-lg">
                    é‚£éº¼ï¼Œ(24, 32) çš„<span class="highlight">æœ€å¤§å…¬å› æ•¸</span>æ˜¯å¤šå°‘å‘¢ï¼Ÿ
                    <br>
                    <small class="text-gray-500">æç¤ºï¼šè«‹å¡«å…¥å…¬å› æ•¸ä¸­ï¼Œæœ€å¤§çš„é‚£ä¸€å€‹æ•¸å­—ã€‚</small>
                </p>
                <div>
                    <input type="number" id="answer-9" class="input-answer" placeholder="æœ€å¤§çš„æ•¸å­—æ˜¯ï¼Ÿ">
                </div>
                <button id="btn-9" class="btn-check btn-check-default" onclick="checkStep(9)">æª¢æŸ¥ç­”æ¡ˆ (å®Œæˆç·´ç¿’)</button>
                <div id="feedback-9" class="text-center text-lg font-bold min-h-[1.5em] mt-2"></div>
            </section>

            <!-- === çµæŸ === -->


            <!-- å®Œæˆè¨Šæ¯ (ç§»åˆ°æœ€å¾Œ) -->
            <section id="completion-message" class="hidden p-8 bg-green-50 rounded-2xl shadow-lg border-2 border-green-300 text-center space-y-4">
                <h2 class="text-3xl font-bold text-green-700">ğŸ‰ æ­å–œä½ ï¼å…¨éƒ¨å®Œæˆäº†ï¼ ğŸ‰</h2>
                <p class="text-xl text-green-600">
                    ä½ å·²ç¶“å­¸æœƒäº†å¦‚ä½•æ‰¾å‡ºå› æ•¸ã€å…¬å› æ•¸ï¼Œå’Œæœ€å¤§å…¬å› æ•¸ï¼
                    <br>
                    çœŸæ˜¯å¤ªæ£’äº†ï¼
                </p>
                <button class="btn-check bg-sky-500 text-white hover:bg-sky-600" onclick="location.reload()">
                    å†ç·´ç¿’ä¸€æ¬¡
                </button>
            </section>

        </div>
    </main>

    <!-- é å°¾å›ºå®šå€å¡Š -->
    <footer class="fixed bottom-0 left-0 w-full text-center text-gray-500 text-sm bg-white bg-opacity-80 py-2 border-t border-gray-200 backdrop-blur-sm">
      Â© 2025 ç‰¹æ•™ç±³å…‹å¸«ï½œæ¡ç”¨ 
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="text-sky-600 hover:underline">
        CC BY-NC-SA 4.0 å‰µç”¨CCæˆæ¬Š
      </a>ï½œéå•†æ¥­ç”¨é€”æ­¡è¿è½‰è¼‰æˆ–æ”¹ç·¨ï¼Œè«‹ä¿ç•™ç½²åä¸¦é™„ä¸ŠåŸå§‹é€£çµã€‚
    </footer>

    <script>
        // ç¸½æ­¥é©Ÿæ•¸ (5 + 4 = 9)
        const totalSteps = 9;

        // æ­£ç¢ºç­”æ¡ˆ
        const correctAnswers = {
            1: ["1", "2", "3", "5", "6", "10", "15", "30"],
            2: ["1", "2", "3", "4", "5", "6", "10", "12", "15", "20", "30", "60"],
            3: ["1", "2", "3", "5", "6", "9", "10", "15", "18", "30", "45", "90"],
            4: ["1", "2", "3", "5", "6", "10", "15", "30"],
            5: "30", // æ­¥é©Ÿ 5 æ˜¯æŒ‰éˆ•
            // --- æ–°å¢ç­”æ¡ˆ ---
            6: ["1", "2", "3", "4", "6", "8", "12", "24"],
            7: ["1", "2", "4", "8", "16", "32"],
            8: ["1", "2", "4", "8"],
            9: "8" // æ­¥é©Ÿ 9 æ˜¯æŒ‰éˆ•
        };
        
        // æ­£å‘å›é¥‹è¨Šæ¯
        const positiveFeedbacks = [
            "å¤ªæ£’äº†ï¼ç¹¼çºŒåŠ æ²¹ï½",
            "åšå¾—å¥½ï¼Œé€²å…¥ä¸‹ä¸€æ­¥å§ï¼",
            "å®Œå…¨æ­£ç¢ºï¼ä½ è¶Šä¾†è¶Šç†Ÿç·´äº†ï¼",
            "ç­”å°äº†ï¼æˆ‘å€‘ä¾†çœ‹ä¸‹ä¸€é¡Œï¼"
        ];
        
        // éŒ¯èª¤å›é¥‹è¨Šæ¯
        const negativeFeedbacks = [
            "å—¯...ç­”æ¡ˆä¸å¤ªå°å–”ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼",
            "æ ¼å¼æˆ–æ•¸å­—å¥½åƒæ€ªæ€ªçš„ï¼Ÿ",
            "åˆ¥ç°å¿ƒï¼Œå†ä»”ç´°æª¢æŸ¥ä¸€éï¼"
        ];

        // é é¢è¼‰å…¥æ™‚
        document.addEventListener("DOMContentLoaded", function() {
            // æ¸²æŸ“æ•¸å­¸å…¬å¼ (å¦‚æœæœ‰çš„è©±)
            if (typeof renderMathInElement === 'function') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false}
                    ]
                });
            }
            
            // --- è‡ªå‹•ç”Ÿæˆæ ¼å­èˆ‡åŠ å…¥ç›£è½ ---
            generateInputGrids();
            addInputListeners();

            updateProgress(1); // åˆå§‹é€²åº¦ç‚ºç¬¬ 1 æ­¥
            
            // è‡ªå‹• focus ç¬¬ä¸€å€‹æ ¼å­
            document.getElementById('input-1-0')?.focus();
        });

        // *** æ–°å¢ï¼šè·³è½‰åˆ°æŒ‡å®šé¡Œç›®çš„å‡½æ•¸ ***
        function jumpToSection(questionNumber) {
            // éš±è—æ‰€æœ‰æ­¥é©Ÿå’Œå®Œæˆè¨Šæ¯
            document.querySelectorAll('.step').forEach(step => {
                step.classList.add('hidden');
            });
            document.getElementById('completion-message').classList.add('hidden');

            let startStep;
            if (questionNumber === 1) {
                startStep = 1;
            } else if (questionNumber === 2) {
                startStep = 6;
            } else {
                return; // éŒ¯èª¤çš„é¡Œè™Ÿ
            }

            // é¡¯ç¤ºç›®æ¨™æ­¥é©Ÿ
            const stepEl = document.getElementById(`step-${startStep}`);
            if (stepEl) {
                stepEl.classList.remove('hidden');
                updateProgress(startStep); // æ›´æ–°é€²åº¦æ¢
                
                // è‡ªå‹• focus
                const firstInput = document.getElementById(`input-${startStep}-0`) || document.getElementById(`answer-${startStep}`);
                if (firstInput) {
                    firstInput.focus();
                }
            }
        }


        /**
         * æ­¥é©Ÿ 1-4, 6-8ï¼šè‡ªå‹•ç”Ÿæˆè¼¸å…¥æ¡†
         */
        function generateInputGrids() {
            // å®šç¾©å“ªäº›æ­¥é©Ÿéœ€è¦æ ¼å­
            const gridSteps = [1, 2, 3, 4, 6, 7, 8];
            
            gridSteps.forEach(i => {
                const grid = document.getElementById(`input-grid-${i}`);
                if (grid) { 
                    const answers = correctAnswers[i];
                    answers.forEach((answer, index) => {
                        const input = document.createElement('input');
                        input.type = "number";
                        input.className = "factor-input";
                        input.dataset.step = i;
                        input.dataset.index = index;
                        input.dataset.answer = answer;
                        input.id = `input-${i}-${index}`;
                        input.setAttribute("aria-label", `æ­¥é©Ÿ ${i} ç­”æ¡ˆ ${index + 1}`);
                        grid.appendChild(input);
                    });
                }
            });
        }

        /**
         * æ­¥é©Ÿ 1-4, 6-8ï¼šç‚ºæ¯å€‹æ ¼å­åŠ å…¥ç›£è½
         */
        function addInputListeners() {
            const inputs = document.querySelectorAll('.factor-input');
            inputs.forEach(input => {
                input.addEventListener('input', handleFactorInput);
                // ç›£è½ Enter éµ
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (input.value === input.dataset.answer) {
                            const nextInput = getNextInput(input.dataset.step, input.dataset.index);
                            if (nextInput) {
                                nextInput.focus();
                            } else {
                                const firstEmptyInput = document.querySelector(`#input-grid-${input.dataset.step} .factor-input:not(.correct)`);
                                if (firstEmptyInput) {
                                    firstEmptyInput.focus();
                                }
                            }
                        }
                    }
                });
            });
        }

        /**
         * ç²å–ä¸‹ä¸€å€‹è¼¸å…¥æ¡†
         */
        function getNextInput(step, index) {
            const nextIndex = parseInt(index) + 1;
            return document.getElementById(`input-${step}-${nextIndex}`);
        }

        /**
         * æ­¥é©Ÿ 1-4, 6-8ï¼šè™•ç†æ ¼å­è¼¸å…¥çš„æ ¸å¿ƒé‚è¼¯
         */
        function handleFactorInput(event) {
            const input = event.target;
            const value = input.value;
            const step = input.dataset.step;
            const index = input.dataset.index;
            const answer = input.dataset.answer;
            const feedbackEl = document.getElementById(`feedback-${step}`);

            if (value === answer) {
                // --- ç­”å°äº† ---
                input.classList.add('correct');
                input.disabled = true; // é–å®š
                feedbackEl.innerHTML = `<span class="text-green-600">ç­”å°äº†ï¼</span>`;
                
                const nextInput = getNextInput(step, index);
                if (nextInput) {
                    // --- è·³åˆ°ä¸‹ä¸€æ ¼ ---
                    nextInput.focus();
                } else {
                    // --- å¦‚æœæ˜¯æœ€å¾Œä¸€æ ¼ï¼Œè©¦è‘— focus ç¬¬ä¸€å€‹é‚„æ²’å¡«çš„ ---
                    const firstEmptyInput = document.querySelector(`#input-grid-${step} .factor-input:not(.correct)`);
                    if(firstEmptyInput) {
                        firstEmptyInput.focus();
                    }
                }

                // --- é—œéµæ›´å‹•ï¼šæ¯æ¬¡ç­”å°éƒ½æª¢æŸ¥ *æ•´æ­¥é©Ÿ* æ˜¯å¦å®Œæˆ ---
                checkStepCompletion(step);

            } else {
                // --- ç­”éŒ¯äº† ---
                feedbackEl.innerHTML = `<span class="text-red-600">ä¸å°å–”...</span>`;
                // å¦‚æœè¼¸å…¥çš„é•·åº¦è¶³å¤ é•·ä½†é‚„æ˜¯éŒ¯ï¼Œ1ç§’å¾Œæ¸…ç©º
                if (value.length >= answer.length) {
                    setTimeout(() => {
                        if (!input.classList.contains('correct')) { // å†æ¬¡ç¢ºèªæ˜¯å¦å·²ä¿®æ­£
                            input.value = "";
                            feedbackEl.textContent = "";
                        }
                    }, 1000);
                }
            }
        }
        
        /**
         * æ­¥é©Ÿ 1-4, 6-8ï¼šæª¢æŸ¥æ˜¯å¦è©²æ­¥é©Ÿçš„æ‰€æœ‰æ ¼å­éƒ½å·²å®Œæˆ
         */
        function checkStepCompletion(step) {
            const answers = correctAnswers[step]; // è©²æ­¥é©Ÿçš„æ¨™æº–ç­”æ¡ˆé™£åˆ—
            const inputs = document.querySelectorAll(`#input-grid-${step} .factor-input`); // è©²æ­¥é©Ÿçš„æ‰€æœ‰è¼¸å…¥æ¡†
            
            // æª¢æŸ¥æ˜¯å¦ *æ‰€æœ‰* æ ¼å­éƒ½ç­”å°äº†
            let allCorrect = true;
            if (inputs.length !== answers.length) { // æ•¸é‡ä¸å°ï¼Œç›´æ¥ return
                allCorrect = false;
            } else {
                for (let input of inputs) {
                    if (!input.classList.contains('correct')) {
                        allCorrect = false; // åªè¦æœ‰ä¸€å€‹æ ¼å­é‚„æ²’ç­”å°
                        break;
                    }
                }
            }

            // --- å¦‚æœå…¨éƒ¨ç­”å°ï¼Œæ‰é€²å…¥ä¸‹ä¸€æ­¥ ---
            if (allCorrect) {
                const feedbackEl = document.getElementById(`feedback-${step}`);
                const feedbackText = positiveFeedbacks[Math.floor(Math.random() * positiveFeedbacks.length)];
                
                feedbackEl.innerHTML = `<span class="text-green-600">${feedbackText}</span>`;
                
                // å»¶é² 1.5 ç§’å¾Œè‡ªå‹•è·³åˆ°ä¸‹ä¸€æ­¥
                setTimeout(() => moveToNextStep(parseInt(step)), 1500);
            }
        }


        /**
         * (æ ¼å­/æŒ‰éˆ•)æ­¥é©Ÿå®Œæˆå¾Œï¼Œç§»å‹•åˆ°ä¸‹ä¸€æ­¥
         */
        function moveToNextStep(stepNumber) {
            document.getElementById(`step-${stepNumber}`).classList.add('hidden');
            
            const nextStep = stepNumber + 1;
            
            // ç‰¹æ®Šè™•ç†ï¼šé€²å…¥æ­¥é©Ÿ 4, 5, 8, 9 æ™‚ï¼Œå¡«å…¥å‰é¢æ­¥é©Ÿçš„ç­”æ¡ˆ
            if (nextStep === 4) {
                document.getElementById('list-30').textContent = correctAnswers[1].join(', ');
                document.getElementById('list-60').textContent = correctAnswers[2].join(', ');
                document.getElementById('list-90').textContent = correctAnswers[3].join(', ');
            }
            if (nextStep === 5) {
                document.getElementById('list-common').textContent = correctAnswers[4].join(', ');
            }
            // --- æ–°å¢ ---
            if (nextStep === 8) {
                document.getElementById('list-24').textContent = correctAnswers[6].join(', ');
                document.getElementById('list-32').textContent = correctAnswers[7].join(', ');
            }
            if (nextStep === 9) {
                document.getElementById('list-common-24-32').textContent = correctAnswers[8].join(', ');
            }
            // --- çµæŸ ---
            
            // é¡¯ç¤ºä¸‹ä¸€æ­¥
            const nextStepEl = document.getElementById(`step-${nextStep}`);
            if (nextStepEl) {
                nextStepEl.classList.remove('hidden');
                updateProgress(nextStep);

                // è‡ªå‹• focus ä¸‹ä¸€æ­¥é©Ÿçš„ç¬¬ä¸€å€‹æ ¼å­ (å¦‚æœå­˜åœ¨)
                const firstInputOfNextStep = document.getElementById(`input-${nextStep}-0`);
                if (firstInputOfNextStep) {
                    firstInputOfNextStep.focus();
                } else {
                    // å¦‚æœä¸‹ä¸€æ­¥æ˜¯æŒ‰éˆ•æ­¥é©Ÿ (5 æˆ– 9)ï¼Œfocus å®ƒçš„è¼¸å…¥æ¡†
                    document.getElementById(`answer-${nextStep}`)?.focus();
                }
            }
        }


        /**
         * æª¢æŸ¥ç­”æ¡ˆçš„å‡½æ•¸ (***ç¾åœ¨ç”¨æ–¼æ­¥é©Ÿ 5 å’Œ 9***)
         * @param {number} stepNumber - ç›®å‰çš„æ­¥é©Ÿç·¨è™Ÿ (5 æˆ– 9)
         */
        function checkStep(stepNumber) {
            // é˜²å‘†ï¼šåªè™•ç† 5 å’Œ 9
            if (stepNumber !== 5 && stepNumber !== 9) return;

            const answerInput = document.getElementById(`answer-${stepNumber}`);
            const feedbackEl = document.getElementById(`feedback-${stepNumber}`);
            const button = document.getElementById(`btn-${stepNumber}`);

            const userAnswer = answerInput.value.trim().replace(/\s+/g, '').replace(/ï¼Œ/g, ',');
            const correctAnswer = correctAnswers[stepNumber];

            if (userAnswer === correctAnswer) {
                // --- ç­”å°äº† (æ­¥é©Ÿ 5 æˆ– 9) ---
                const feedbackText = positiveFeedbacks[Math.floor(Math.random() * positiveFeedbacks.length)];
                feedbackEl.innerHTML = `<span class="text-green-600">${feedbackText}</span>`;
                
                button.className = "btn-check btn-check-success";
                button.disabled = true;
                answerInput.disabled = true;
                answerInput.classList.add("border-green-500", "bg-green-50");

                if (stepNumber === 5) {
                    // --- ç­”å°ç¬¬ 1 é¡Œ, é€²å…¥ç¬¬ 2 é¡Œ (æ­¥é©Ÿ 6) ---
                    setTimeout(() => moveToNextStep(stepNumber), 1500);
                } else if (stepNumber === 9) {
                    // --- ç­”å°ç¬¬ 2 é¡Œ, å…¨éƒ¨å®Œæˆ ---
                    setTimeout(() => {
                        document.getElementById(`step-${stepNumber}`).classList.add('hidden');
                        document.getElementById('completion-message').classList.remove('hidden');
                        updateProgress(stepNumber, true); // æ¨™è¨˜ç‚ºå®Œæˆ
                    }, 1500);
                }

            } else {
                // --- æ­¥é©Ÿ 5 æˆ– 9 ç­”éŒ¯äº† ---
                const feedbackText = negativeFeedbacks[Math.floor(Math.random() * negativeFeedbacks.length)];
                feedbackEl.innerHTML = `<span class="text-red-600">${feedbackText}</span>`;
                
                button.className = "btn-check btn-check-error";
                setTimeout(() => {
                    button.className = "btn-check btn-check-default";
                }, 2000);
            }
        }

        /**
         * æ›´æ–°é€²åº¦æç¤º
         * @param {number} currentStep - ç›®å‰æ­¥é©Ÿ
         * @param {boolean} isComplete - æ˜¯å¦å·²å®Œæˆ
         */
        function updateProgress(currentStep, isComplete = false) {
            const indicator = document.getElementById('progress-indicator');
            if (isComplete) {
                indicator.textContent = `ğŸ‰ å…¨éƒ¨å®Œæˆï¼ (${totalSteps} / ${totalSteps} æ­¥) ğŸ‰`;
                indicator.classList.add("bg-green-100", "text-green-700", "border-green-300");
            } else {
                // ä¿®æ­£éŒ¯å­—ï¼š Fæ­¥ -> æ­¥
                indicator.textContent = `ç¬¬ ${currentStep} æ­¥ / å…± ${totalSteps} æ­¥`;
            }
        }
    </script>
</body>
</html>