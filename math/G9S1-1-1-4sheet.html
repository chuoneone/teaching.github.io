<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WMNZ6FESH7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WMNZ6FESH7');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四、連比例式的運算</title>
    <link rel="icon" href="images/dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .input-field {
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .correct {
            border-color: #10b981 !important;
            background-color: #ecfdf5;
        }
        .incorrect {
            border-color: #ef4444 !important;
            background-color: #fef2f2;
        }
        .step-card {
            background: linear-gradient(#ffffff 100%);
            color: rgb(0, 0, 0);
            border: 1px solid #1a2437;
        }
        .celebration {
            animation: bounce 0.6s ease-in-out;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .step-container {
            transition: all 0.3s ease;
        }
        .locked {
            opacity: 0.6;
            pointer-events: none;
        }
        .locked input {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 標題 -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">🧮四、 連比例式的運算</h1>
            
            <!-- 題目選擇器 -->
            <div class="mb-6">
                <div class="flex justify-center space-x-4 mb-4">
                    <button id="problem-1" class="problem-btn bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200 hover:bg-blue-700">題目 1</button>
                    <button id="problem-2" class="problem-btn bg-gray-400 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200 hover:bg-gray-500">題目 2</button>
                    <button id="problem-3" class="problem-btn bg-gray-400 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200 hover:bg-gray-500">題目 3</button>
                </div>
            </div>
            
            <div class="step-card rounded-xl p-6 shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">題目：比例問題</h2>
                <p id="problem-text" class="text-2xl">如果 x : y : z = 5 : 4 : 3，且 x − y + z = 60，求 x、y、z 的值。</p>
            </div>
        </div>

        <!-- 解題步驟 -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- 步驟1：假設 -->
            <div id="step-1" class="step-container bg-white rounded-xl p-6 shadow-lg border-l-4 border-blue-500 min-h-[400px] lg:col-span-3">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">📝 步驟1：假設</h3>
                <div class="space-y-3">
                    <div class="flex items-center space-x-1">
                        <span id="step1-x-text" class="text-base">設 x = 5r</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="text-base">y = </span>
                        <input type="text" id="step1-y" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                        <span class="text-base">r</span>
                        <span id="step1-y-feedback" class="ml-1"></span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <span class="text-base">z = </span>
                        <input type="text" id="step1-z" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                        <span class="text-base">r</span>
                        <span id="step1-z-feedback" class="ml-1"></span>
                    </div>
                </div>
            </div>

            <!-- 步驟2：代入方程式並計算r -->
            <div id="step-2" class="step-container bg-gray-100 rounded-xl p-6 shadow-lg border-l-4 border-gray-400 locked min-h-[400px] lg:col-span-5">
                <div class="flex items-center mb-4">
                    <span class="text-2xl mr-3">🔒</span>
                    <h3 class="text-xl font-semibold text-gray-500">步驟2：代入方程式並計算 r</h3>
                </div>
                <p class="text-gray-500">請先完成步驟1</p>
                <div class="hidden step-content">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">🔄 步驟2：代入方程式並計算 r</h3>
                    <p id="step2-description" class="text-gray-600 mb-3">將 x, y, z 的假設代入 x − y + z = 60</p>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-1 flex-wrap">
                            <input type="text" id="step2-x" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step2-operator1" class="text-base">r − </span>
                            <input type="text" id="step2-y" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step2-operator2" class="text-base">r + </span>
                            <input type="text" id="step2-z" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step2-result" class="text-base">r = 60</span>
                            <span id="step2-feedback" class="ml-1"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <input type="text" id="step3-coefficient" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step3-result" class="text-base">r = 60</span>
                            <span id="step3-coeff-feedback" class="ml-1"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-base">r = </span>
                            <input type="text" id="step3-r" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step3-r-feedback" class="ml-1"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 步驟3：求出x,y,z -->
            <div id="step-3" class="step-container bg-gray-100 rounded-xl p-6 shadow-lg border-l-4 border-gray-400 locked min-h-[400px] lg:col-span-4">
                <div class="flex items-center mb-4">
                    <span class="text-2xl mr-3">🔒</span>
                    <h3 class="text-xl font-semibold text-gray-500">步驟3：求出 x, y, z</h3>
                </div>
                <p class="text-gray-500">請先完成步驟2</p>
                <div class="hidden step-content">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">🎯 步驟3：求出 x, y, z</h3>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-1">
                            <span id="step4-x-text" class="text-base">x = 5 × </span>
                            <input type="text" id="step4-r1" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span class="text-base"> = </span>
                            <input type="text" id="step4-x" class="input-field w-14 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step4-x-feedback" class="ml-1"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span id="step4-y-text" class="text-base">y = 4 × </span>
                            <input type="text" id="step4-r2" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span class="text-base"> = </span>
                            <input type="text" id="step4-y" class="input-field w-14 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step4-y-feedback" class="ml-1"></span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span id="step4-z-text" class="text-base">z = 3 × </span>
                            <input type="text" id="step4-r3" class="input-field w-12 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span class="text-base"> = </span>
                            <input type="text" id="step4-z" class="input-field w-14 px-1 py-1 rounded text-center text-sm" placeholder="?">
                            <span id="step4-z-feedback" class="ml-1"></span>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- 進度條 -->
        <div class="mt-8 bg-white rounded-xl p-6 shadow-lg">
            <h3 class="text-lg font-semibold mb-3">📊 完成進度</h3>
            <div class="bg-gray-200 rounded-full h-4 mb-2">
                <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <p id="progress-text" class="text-sm text-gray-600">0/10 個答案正確</p>
        </div>

        <!-- 慶祝訊息 -->
        <div id="celebration" class="hidden mt-6 bg-gradient-to-r from-green-400 to-blue-500 text-white rounded-xl p-6 text-center shadow-lg">
            <h3 class="text-2xl font-bold mb-2">🎉 恭喜完成！</h3>
            <p id="celebration-text" class="text-lg">你已經成功解決了這個比例問題！x = 75, y = 60, z = 45</p>
        </div>

        <!-- 重置按鈕 -->
        <div class="text-center mt-6">
            <button id="reset-btn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-200">
                🔄 重新開始
            </button>
        </div>
    </div>

    <script>
        // 題目數據
        const problems = {
            1: {
                text: "如果 x : y : z = 5 : 4 : 3，且 x − y + z = 60，求 x、y、z 的值。",
                ratios: [5, 4, 3],
                equation: "x − y + z = 60",
                operators: ["r − ", "r + "],
                result: 60,
                answers: {
                    'step1-y': '4',
                    'step1-z': '3',
                    'step2-x': '5',
                    'step2-y': '4',
                    'step2-z': '3',
                    'step3-coefficient': '4',
                    'step3-r': '15',
                    'step4-r1': '15',
                    'step4-x': '75',
                    'step4-r2': '15',
                    'step4-y': '60',
                    'step4-r3': '15',
                    'step4-z': '45'
                },
                celebration: "你已經成功解決了這個比例問題！x = 75, y = 60, z = 45"
            },
            2: {
                text: "如果 x : y : z = 4 : 6 : 5，且 x + y + z = 120，求 x、y、z 的值。",
                ratios: [4, 6, 5],
                equation: "x + y + z = 120",
                operators: ["r + ", "r + "],
                result: 120,
                answers: {
                    'step1-y': '6',
                    'step1-z': '5',
                    'step2-x': '4',
                    'step2-y': '6',
                    'step2-z': '5',
                    'step3-coefficient': '15',
                    'step3-r': '8',
                    'step4-r1': '8',
                    'step4-x': '32',
                    'step4-r2': '8',
                    'step4-y': '48',
                    'step4-r3': '8',
                    'step4-z': '40'
                },
                celebration: "你已經成功解決了這個比例問題！x = 32, y = 48, z = 40"
            },
            3: {
                text: "如果 x : y : z = 4 : 7 : 8，且 x + y + z = 190，求 x、y、z 的值。",
                ratios: [4, 7, 8],
                equation: "x + y + z = 190",
                operators: ["r + ", "r + "],
                result: 190,
                answers: {
                    'step1-y': '7',
                    'step1-z': '8',
                    'step2-x': '4',
                    'step2-y': '7',
                    'step2-z': '8',
                    'step3-coefficient': '19',
                    'step3-r': '10',
                    'step4-r1': '10',
                    'step4-x': '40',
                    'step4-r2': '10',
                    'step4-y': '70',
                    'step4-r3': '10',
                    'step4-z': '80'
                },
                celebration: "你已經成功解決了這個比例問題！x = 40, y = 70, z = 80"
            }
        };

        let currentProblem = 1;
        let answers = problems[currentProblem].answers;

        // 步驟分組
        const stepGroups = {
            1: ['step1-y', 'step1-z'],
            2: ['step2-x', 'step2-y', 'step2-z', 'step3-coefficient', 'step3-r'],
            3: ['step4-r1', 'step4-x', 'step4-r2', 'step4-y', 'step4-r3', 'step4-z']
        };

        let correctCount = 0;
        let totalAnswers = Object.keys(answers).length;

        // 切換題目功能
        function switchProblem(problemNumber) {
            currentProblem = problemNumber;
            answers = problems[currentProblem].answers;
            totalAnswers = Object.keys(answers).length;
            
            // 更新題目按鈕樣式
            document.querySelectorAll('.problem-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                btn.classList.add('bg-gray-400', 'hover:bg-gray-500');
            });
            document.getElementById(`problem-${problemNumber}`).classList.remove('bg-gray-400', 'hover:bg-gray-500');
            document.getElementById(`problem-${problemNumber}`).classList.add('bg-blue-600', 'hover:bg-blue-700');
            
            // 更新題目內容
            updateProblemContent();
            
            // 重置所有輸入
            resetAllInputs();
        }

        // 更新題目內容
        function updateProblemContent() {
            const problem = problems[currentProblem];
            
            // 更新題目文字
            document.getElementById('problem-text').textContent = problem.text;
            
            // 更新步驟1
            document.getElementById('step1-x-text').textContent = `設 x = ${problem.ratios[0]}r`;
            
            // 更新步驟2
            document.getElementById('step2-description').textContent = `將 x, y, z 的假設代入 ${problem.equation}`;
            document.getElementById('step2-operator1').textContent = problem.operators[0];
            document.getElementById('step2-operator2').textContent = problem.operators[1];
            document.getElementById('step2-result').textContent = `r = ${problem.result}`;
            document.getElementById('step3-result').textContent = `r = ${problem.result}`;
            
            // 更新步驟3
            document.getElementById('step4-x-text').textContent = `x = ${problem.ratios[0]} × `;
            document.getElementById('step4-y-text').textContent = `y = ${problem.ratios[1]} × `;
            document.getElementById('step4-z-text').textContent = `z = ${problem.ratios[2]} × `;
            
            // 更新慶祝訊息
            document.getElementById('celebration-text').textContent = problem.celebration;
        }

        // 重置所有輸入
        function resetAllInputs() {
            Object.keys(problems[1].answers).forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.value = '';
                    input.classList.remove('correct', 'incorrect');
                }
                const feedback = document.getElementById(inputId + '-feedback') || 
                               document.getElementById(inputId.replace(/-(x|y|z|coefficient|r\d*)$/, '-feedback'));
                if (feedback) {
                    feedback.innerHTML = '';
                }
            });
            
            // 重置所有步驟狀態
            for (let step = 2; step <= 3; step++) {
                lockStep(step);
            }
            
            correctCount = 0;
            updateProgress();
            document.getElementById('celebration').classList.add('hidden');
        }

        // 檢查答案函數
        function checkAnswer(inputId) {
            const input = document.getElementById(inputId);
            const feedback = document.getElementById(inputId + '-feedback') || 
                           document.getElementById(inputId.replace(/-(x|y|z|coefficient|r\d*)$/, '-feedback'));
            
            if (input.value.trim() === answers[inputId]) {
                input.classList.remove('incorrect');
                input.classList.add('correct');
                if (feedback) {
                    feedback.innerHTML = '<span class="text-green-600 font-semibold">✓</span>';
                }
                return true;
            } else if (input.value.trim() !== '') {
                input.classList.remove('correct');
                input.classList.add('incorrect');
                if (feedback) {
                    feedback.innerHTML = '<span class="text-red-600 font-semibold">✗</span>';
                }
                return false;
            } else {
                input.classList.remove('correct', 'incorrect');
                if (feedback) {
                    feedback.innerHTML = '';
                }
                return false;
            }
        }

        // 檢查步驟是否完成
        function isStepCompleted(stepNumber) {
            const stepInputs = stepGroups[stepNumber];
            return stepInputs.every(inputId => {
                const input = document.getElementById(inputId);
                return input && input.value.trim() === answers[inputId];
            });
        }

        // 解鎖步驟
        function unlockStep(stepNumber) {
            const stepElement = document.getElementById(`step-${stepNumber}`);
            if (stepElement) {
                stepElement.classList.remove('locked', 'bg-gray-100', 'border-gray-400');
                
                // 根據步驟設置不同顏色
                const colors = {
                    2: ['bg-white', 'border-green-500'],
                    3: ['bg-white', 'border-orange-500'],
                    4: ['bg-white', 'border-red-500']
                };
                
                if (colors[stepNumber]) {
                    stepElement.classList.add(...colors[stepNumber]);
                }
                
                // 顯示步驟內容
                const stepContent = stepElement.querySelector('.step-content');
                if (stepContent) {
                    stepContent.classList.remove('hidden');
                }
                
                // 隱藏鎖定提示
                const lockMessage = stepElement.querySelector('.flex.items-center');
                if (lockMessage) {
                    lockMessage.style.display = 'none';
                }
                
                const lockText = stepElement.querySelector('p.text-gray-500');
                if (lockText) {
                    lockText.style.display = 'none';
                }

                // 添加解鎖動畫
                stepElement.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    stepElement.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // 鎖定步驟
        function lockStep(stepNumber) {
            const stepElement = document.getElementById(`step-${stepNumber}`);
            if (stepElement) {
                stepElement.classList.add('locked', 'bg-gray-100', 'border-gray-400');
                stepElement.classList.remove('bg-white', 'border-green-500', 'border-orange-500', 'border-red-500');
                
                // 隱藏步驟內容
                const stepContent = stepElement.querySelector('.step-content');
                if (stepContent) {
                    stepContent.classList.add('hidden');
                }
                
                // 顯示鎖定提示
                const lockMessage = stepElement.querySelector('.flex.items-center');
                if (lockMessage) {
                    lockMessage.style.display = 'flex';
                }
                
                const lockText = stepElement.querySelector('p.text-gray-500');
                if (lockText) {
                    lockText.style.display = 'block';
                }
            }
        }

        // 更新步驟狀態
        function updateStepStates() {
            for (let step = 1; step <= 3; step++) {
                if (step === 1) continue; // 第一步始終解鎖
                
                const previousStep = step - 1;
                if (isStepCompleted(previousStep)) {
                    unlockStep(step);
                } else {
                    lockStep(step);
                }
            }
        }

        // 更新進度
        function updateProgress() {
            correctCount = 0;
            Object.keys(answers).forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input && input.value.trim() === answers[inputId]) {
                    correctCount++;
                }
            });

            const percentage = (correctCount / totalAnswers) * 100;
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = `${correctCount}/${totalAnswers} 個答案正確`;

            // 檢查是否全部完成
            if (correctCount === totalAnswers) {
                const celebration = document.getElementById('celebration');
                celebration.classList.remove('hidden');
                celebration.classList.add('celebration');
            } else {
                document.getElementById('celebration').classList.add('hidden');
            }

            // 更新步驟狀態
            updateStepStates();
        }

        // 為所有輸入框添加事件監聽器
        function addInputListeners() {
            Object.keys(problems[1].answers).forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', () => {
                        checkAnswer(inputId);
                        updateProgress();
                    });
                }
            });
        }

        // 為題目按鈕添加事件監聽器
        document.getElementById('problem-1').addEventListener('click', () => switchProblem(1));
        document.getElementById('problem-2').addEventListener('click', () => switchProblem(2));
        document.getElementById('problem-3').addEventListener('click', () => switchProblem(3));

        // 重置功能
        document.getElementById('reset-btn').addEventListener('click', () => {
            resetAllInputs();
        });

        // 初始化
        addInputListeners();
        updateProblemContent();
        updateProgress();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97f8208eb4e3826b',t:'MTc1NzkzOTM0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
