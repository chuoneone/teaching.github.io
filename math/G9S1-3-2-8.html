<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三角形重心與面積互動解題</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            overscroll-behavior: none;
        }

        /* 數學式樣式 */
        .math-text {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            font-weight: bold;
        }
        
        .math-symbol {
            font-family: 'Times New Roman', serif;
            font-weight: bold;
        }

        /* 填答格樣式 */
        .slot {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            height: 45px;
            border-bottom: 3px solid #94a3b8;
            background-color: #ffffff;
            color: #334155;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px 4px 0 0;
            padding: 0 10px;
        }

        .slot.filled {
            border-color: #3b82f6;
            background-color: #eff6ff;
            color: #1d4ed8;
        }

        .slot.correct {
            border-color: #22c55e;
            background-color: #dcfce7;
            color: #15803d;
        }

        .slot.error {
            border-color: #ef4444;
            background-color: #fee2e2;
            animation: shake 0.5s;
        }

        /* 選項按鈕樣式 */
        .option-btn {
            background-color: #fff;
            border: 2px solid #3b82f6;
            color: #3b82f6;
            padding: 8px 16px;
            font-size: 1.25rem;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #2563eb;
            user-select: none;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #2563eb;
        }

        .option-btn:disabled {
            background-color: #e2e8f0;
            border-color: #cbd5e1;
            color: #94a3b8;
            box-shadow: none;
            cursor: not-allowed;
            transform: translateY(4px);
        }

        /* 動畫 */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes tada {
            0% { transform: scale(1); }
            10% { transform: scale(0.9) rotate(-3deg); }
            20% { transform: scale(0.9) rotate(-3deg); }
            30% { transform: scale(1.1) rotate(3deg); }
            40% { transform: scale(1.1) rotate(-3deg); }
            50% { transform: scale(1.1) rotate(3deg); }
            60% { transform: scale(1.1) rotate(-3deg); }
            70% { transform: scale(1.1) rotate(3deg); }
            80% { transform: scale(1.1) rotate(-3deg); }
            90% { transform: scale(1.1) rotate(3deg); }
            100% { transform: scale(1) rotate(0); }
        }

        .animate-tada {
            animation: tada 1s;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 隱藏捲軸但保留功能 */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* SVG 樣式 */
        svg text {
            font-family: 'Times New Roman', serif;
            font-weight: bold;
            font-style: italic;
            font-size: 18px;
        }
        
        .highlight-area {
            fill: rgba(59, 130, 246, 0.3);
            stroke: #2563eb;
            stroke-width: 2;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden text-slate-800">

    <nav class="bg-slate-800 text-white shadow-md z-20 flex-none">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center h-16 space-x-4 overflow-x-auto hide-scrollbar whitespace-nowrap" id="nav-container">
                <span class="font-bold text-lg text-yellow-400 mr-2 sticky left-0 bg-slate-800 px-2">八、重心與面積</span>
                </div>
        </div>
    </nav>

    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <section class="w-full md:w-5/12 bg-white border-b md:border-b-0 md:border-r border-slate-200 flex flex-col z-10 shadow-sm">
            <div class="p-6 overflow-y-auto flex-1">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-r-lg">
                    <h2 class="text-xl font-bold mb-2 text-blue-800" id="problem-title">題目 1</h2>
                    <p class="text-lg leading-relaxed text-slate-700" id="problem-text">
                        </p>
                </div>
                
                <div class="flex justify-center items-center bg-slate-50 rounded-xl border border-slate-200 p-4" id="svg-container">
                    </div>
            </div>
        </section>

        <section class="w-full md:w-7/12 bg-slate-50 relative flex flex-col">
            <div id="steps-container" class="flex-1 overflow-y-auto p-6 space-y-6 pb-24 scroll-smooth">
                </div>
        </section>

    </main>

    <div id="completion-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 shadow-2xl transform scale-95 opacity-0 transition-all duration-300" id="modal-content">
            <div class="text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-tada">
                    <svg class="w-12 h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-slate-800 mb-2">太棒了！</h3>
                <p class="text-slate-600 mb-6">你已經成功解出這題的答案！</p>
                <div class="flex flex-col gap-3">
                    <button onclick="resetCurrentProblem()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl transition shadow-[0_4px_0_rgb(29,78,216)] active:shadow-none active:translate-y-1">
                        再做一次
                    </button>
                    <button onclick="closeModal()" class="w-full bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 px-6 rounded-xl transition">
                        關閉視窗
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 資料定義 ---
        const problems = [
            {
                id: 1,
                title: "題目 1",
                text: `如圖，<span class="math-text">△ABC</span> 的三條中線交於 <span class="math-text">G</span> 點，若 <span class="math-text">△ABC</span> 的面積為 <mark class="bg-yellow-200 px-1 rounded">48</mark>，求 <span class="math-text">△BFG</span> 的面積。`,
                highlightArea: 'BFG',
                steps: [
                    {
                        instruction: "題目給的總面積是多少？",
                        slots: [
                            { answer: "48" }
                        ],
                        options: ["6", "24", "48"]
                    },
                    {
                        instruction: "計算 △BFG 的面積：(總面積 ÷ 6)",
                        slots: [
                            { answer: "48" },
                            { answer: "6" },
                            { answer: "8" }
                        ],
                        template: "{0} ÷ {1} = {2}",
                        options: ["6", "8", "48"]
                    }
                ]
            },
            {
                id: 2,
                title: "題目 2",
                text: `如圖，<span class="math-text">△ABC</span> 的三條中線 <span class="math-text">AD</span>、<span class="math-text">BE</span>、<span class="math-text">CF</span> 交於 <span class="math-text">G</span> 點，若 <span class="math-text">△ABC</span> 的面積為 <mark class="bg-yellow-200 px-1 rounded">24</mark>，求 <span class="math-text">△AGE</span> 的面積。`,
                highlightArea: 'AGE', 
                steps: [
                    {
                        instruction: "重心 G 將大三角形切分成幾個面積相等的小三角形？",
                        slots: [
                            { answer: "6" }
                        ],
                        options: ["3", "6", "9"],
                        suffix: "個"
                    },
                    {
                        instruction: "計算 △AGE 的面積：(總面積 ÷ 6)",
                        slots: [
                            { answer: "24" },
                            { answer: "6" },
                            { answer: "4" }
                        ],
                        template: "{0} ÷ {1} = {2}",
                        options: ["4", "6", "24"]
                    }
                ]
            },
            {
                id: 3,
                title: "題目 3",
                text: `如圖，<span class="math-text">△ABC</span> 的三條中線交於 <span class="math-text">G</span> 點，若 <span class="math-text">△AFG</span> 的面積為 <mark class="bg-yellow-200 px-1 rounded">12</mark>，求：<br>(1) 四邊形 <span class="math-text">BFGD</span> 的面積。<br>(2) <span class="math-text">△ABC</span> 的面積。`,
                highlightArea: 'AFG',
                steps: [
                    {
                        instruction: "已知 △AFG 面積是 12。四邊形 BFGD 包含幾個這樣的小三角形？",
                        slots: [
                            { answer: "2" }
                        ],
                        options: ["1", "2", "3"],
                        suffix: "個"
                    },
                    {
                        instruction: "計算 (1) 四邊形 BFGD 的面積：",
                        slots: [
                            { answer: "12" },
                            { answer: "2" },
                            { answer: "24" }
                        ],
                        template: "{0} × {1} = {2}",
                        options: ["2", "12", "24"]
                    },
                    {
                        instruction: "重心將 △ABC 分成 6 等份，計算 (2) △ABC 總面積：",
                        slots: [
                            { answer: "12" },
                            { answer: "6" },
                            { answer: "72" }
                        ],
                        template: "{0} × {1} = {2}",
                        options: ["6", "12", "72"]
                    }
                ]
            }
        ];

        // --- 狀態變數 ---
        let currentProblemIdx = 0;
        let currentStepIdx = 0;
        let stepState = []; // 紀錄當前題目的步驟狀態

        // --- 初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            renderNav();
            loadProblem(0);
        });

        // --- 核心功能 ---

        function renderNav() {
            const container = document.getElementById('nav-container');
            // 保留標題，移除舊按鈕
            const title = container.firstElementChild;
            container.innerHTML = '';
            container.appendChild(title);

            problems.forEach((prob, idx) => {
                const btn = document.createElement('button');
                btn.className = `px-4 py-2 rounded-full text-sm font-bold transition whitespace-nowrap ${
                    idx === currentProblemIdx 
                    ? 'bg-blue-500 text-white shadow-md' 
                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                }`;
                btn.innerText = prob.title;
                btn.onclick = () => loadProblem(idx);
                container.appendChild(btn);
            });
        }

        function loadProblem(idx) {
            currentProblemIdx = idx;
            currentStepIdx = 0;
            stepState = [];
            
            // 更新導覽列樣式
            renderNav();

            // 更新題目區
            const prob = problems[idx];
            document.getElementById('problem-title').innerText = prob.title;
            document.getElementById('problem-text').innerHTML = prob.text;
            document.getElementById('svg-container').innerHTML = generateSVG(prob.highlightArea);

            // 清空並初始化步驟
            const stepsContainer = document.getElementById('steps-container');
            stepsContainer.innerHTML = '';
            
            // 初始化步驟狀態
            prob.steps.forEach((step, sIdx) => {
                stepState.push({
                    slotsFilled: new Array(step.slots.length).fill(null),
                    isCompleted: false
                });
            });

            // 渲染第一個步驟
            renderStep(0);
        }

        function generateSVG(highlightArea) {
            // 定義座標
            const A = {x: 150, y: 20};
            const B = {x: 50, y: 180};
            const C = {x: 250, y: 180};
            const D = {x: 150, y: 180}; // BC中點
            const E = {x: 200, y: 100}; // AC中點
            const F = {x: 100, y: 100}; // AB中點
            const G = {x: 150, y: 126.6}; // 重心

            // 定義區域路徑字串
            const paths = {
                'AGE': `M${A.x},${A.y} L${G.x},${G.y} L${E.x},${E.y} Z`,
                'AFG': `M${A.x},${A.y} L${F.x},${F.y} L${G.x},${G.y} Z`,
                'BFG': `M${B.x},${B.y} L${F.x},${F.y} L${G.x},${G.y} Z`,
                'BDG': `M${B.x},${B.y} L${D.x},${D.y} L${G.x},${G.y} Z`,
                'CDG': `M${C.x},${C.y} L${D.x},${D.y} L${G.x},${G.y} Z`,
                'CEG': `M${C.x},${C.y} L${E.x},${E.y} L${G.x},${G.y} Z`
            };

            let highlightPath = '';
            if (highlightArea === 'AGE') highlightPath = `<path d="${paths.AGE}" class="highlight-area" />`;
            if (highlightArea === 'AFG') highlightPath = `<path d="${paths.AFG}" class="highlight-area" />`;
            if (highlightArea === 'BFG') highlightPath = `<path d="${paths.BFG}" class="highlight-area" />`;

            return `
            <svg width="300" height="200" viewBox="0 0 300 200" xmlns="http://www.w3.org/2000/svg">
                ${highlightPath}
                
                <path d="M150,20 L50,180 L250,180 Z" fill="none" stroke="#334155" stroke-width="2"/>
                
                <line x1="150" y1="20" x2="150" y2="180" stroke="#64748b" stroke-width="1.5" />
                <line x1="50" y1="180" x2="200" y2="100" stroke="#64748b" stroke-width="1.5" />
                <line x1="250" y1="180" x2="100" y2="100" stroke="#64748b" stroke-width="1.5" />
                
                <text x="145" y="15">A</text>
                <text x="35" y="190">B</text>
                <text x="255" y="190">C</text>
                <text x="145" y="195">D</text>
                <text x="205" y="95">E</text>
                <text x="85" y="95">F</text>
                <text x="155" y="125">G</text>
            </svg>
            `;
        }

        function renderStep(stepIdx) {
            const prob = problems[currentProblemIdx];
            const step = prob.steps[stepIdx];
            const container = document.getElementById('steps-container');

            const stepDiv = document.createElement('div');
            stepDiv.id = `step-${stepIdx}`;
            stepDiv.className = "bg-white p-5 rounded-2xl shadow-sm border border-slate-200 fade-in";
            
            // 標題
            const headerHtml = `
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-slate-700 flex items-center gap-2">
                        <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">
                            ${stepIdx + 1}
                        </span>
                        <span>步驟 ${stepIdx + 1}</span>
                    </h3>
                    <span id="check-icon-${stepIdx}" class="text-green-500 hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </span>
                </div>
            `;

            // 指令
            const instructionHtml = `<p class="text-lg text-slate-800 mb-4 font-medium">${step.instruction}</p>`;

            // 算式區域 (Slots)
            let slotsHtml = '';
            if (step.template) {
                // 如果有模板 (如 "{0} + {1} = {2}")
                let html = step.template;
                step.slots.forEach((_, sIdx) => {
                    html = html.replace(`{${sIdx}}`, `<div class="slot" id="slot-${stepIdx}-${sIdx}" onclick="clearSlot(${stepIdx}, ${sIdx})"></div>`);
                });
                slotsHtml = `<div class="flex flex-wrap items-center gap-2 mb-6 text-2xl font-bold text-slate-600 math-text justify-center md:justify-start bg-slate-50 p-4 rounded-xl border border-slate-100">${html}</div>`;
            } else {
                // 預設 (單一 Slot)
                slotsHtml = `<div class="flex items-center gap-3 mb-6 justify-center md:justify-start">
                    <div class="slot" id="slot-${stepIdx}-0" onclick="clearSlot(${stepIdx}, 0)"></div>
                    ${step.suffix ? `<span class="text-xl font-bold text-slate-600">${step.suffix}</span>` : ''}
                </div>`;
            }

            // 選項按鈕
            let optionsHtml = `<div class="flex flex-wrap gap-3" id="options-${stepIdx}">
                ${step.options.map((opt, i) => `
                    <button class="option-btn" id="opt-${stepIdx}-${i}" onclick="fillSlot(${stepIdx}, '${opt}', this)">
                        ${opt}
                    </button>
                `).join('')}
            </div>`;

            // 檢查按鈕與訊息
            const footerHtml = `
                <div class="mt-6 flex items-center gap-4 border-t pt-4 border-slate-100">
                    <button id="check-btn-${stepIdx}" onclick="checkAnswer(${stepIdx})" class="bg-green-500 hover:bg-green-600 text-white text-lg font-bold py-2 px-6 rounded-xl shadow-[0_4px_0_rgb(21,128,61)] active:shadow-none active:translate-y-1 transition w-full md:w-auto">
                        檢查答案
                    </button>
                    <span id="msg-${stepIdx}" class="text-lg font-bold hidden"></span>
                </div>
            `;

            stepDiv.innerHTML = headerHtml + instructionHtml + slotsHtml + optionsHtml + footerHtml;
            container.appendChild(stepDiv);

            // 捲動到底部
            setTimeout(() => {
                stepDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function fillSlot(stepIdx, value, btnElem) {
            const prob = problems[currentProblemIdx];
            const step = prob.steps[stepIdx];
            const state = stepState[stepIdx];

            // 找到第一個空的 slot
            const emptySlotIdx = state.slotsFilled.findIndex(val => val === null);

            if (emptySlotIdx !== -1) {
                // 更新狀態
                state.slotsFilled[emptySlotIdx] = { value: value, btnId: btnElem.id };
                
                // 更新 UI
                const slotElem = document.getElementById(`slot-${stepIdx}-${emptySlotIdx}`);
                slotElem.innerText = value;
                slotElem.classList.add('filled');
                slotElem.classList.remove('error');

                // 禁用按鈕
                btnElem.disabled = true;

                // 隱藏提示訊息
                const msgElem = document.getElementById(`msg-${stepIdx}`);
                msgElem.classList.add('hidden');
            }
        }

        function clearSlot(stepIdx, slotIdx) {
            const state = stepState[stepIdx];
            if (state.isCompleted) return; // 已完成不可清除

            const slotData = state.slotsFilled[slotIdx];
            if (slotData) {
                // 恢復按鈕
                const btnElem = document.getElementById(slotData.btnId);
                if (btnElem) btnElem.disabled = false;

                // 清除狀態
                state.slotsFilled[slotIdx] = null;

                // 更新 UI
                const slotElem = document.getElementById(`slot-${stepIdx}-${slotIdx}`);
                slotElem.innerText = '';
                slotElem.classList.remove('filled', 'error');

                // 隱藏提示訊息
                const msgElem = document.getElementById(`msg-${stepIdx}`);
                msgElem.classList.add('hidden');
            }
        }

        function checkAnswer(stepIdx) {
            const prob = problems[currentProblemIdx];
            const step = prob.steps[stepIdx];
            const state = stepState[stepIdx];
            const msgElem = document.getElementById(`msg-${stepIdx}`);

            // 檢查是否填滿
            if (state.slotsFilled.includes(null)) {
                msgElem.innerText = "請填滿所有空格";
                msgElem.className = "text-lg font-bold text-orange-500 animate-pulse";
                msgElem.classList.remove('hidden');
                return;
            }

            // 檢查答案是否正確
            let allCorrect = true;
            state.slotsFilled.forEach((data, idx) => {
                if (data.value !== step.slots[idx].answer) {
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                // 正確處理
                state.isCompleted = true;
                
                // UI 變更
                msgElem.innerText = "答對了！";
                msgElem.className = "text-lg font-bold text-green-600";
                msgElem.classList.remove('hidden');

                document.getElementById(`check-btn-${stepIdx}`).classList.add('hidden');
                document.getElementById(`check-icon-${stepIdx}`).classList.remove('hidden');
                document.getElementById(`options-${stepIdx}`).classList.add('hidden'); // 隱藏選項讓畫面乾淨

                // Slot 變綠
                step.slots.forEach((_, idx) => {
                    const slot = document.getElementById(`slot-${stepIdx}-${idx}`);
                    slot.classList.add('correct');
                });

                // 解鎖下一步或完成
                if (stepIdx < prob.steps.length - 1) {
                    setTimeout(() => {
                        currentStepIdx++;
                        renderStep(currentStepIdx);
                    }, 800);
                } else {
                    setTimeout(() => {
                        showCompletionModal();
                    }, 500);
                }

            } else {
                // 錯誤處理
                msgElem.innerText = "再想想看...";
                msgElem.className = "text-lg font-bold text-red-500";
                msgElem.classList.remove('hidden');

                // Slot 變紅搖晃
                step.slots.forEach((_, idx) => {
                    const slot = document.getElementById(`slot-${stepIdx}-${idx}`);
                    slot.classList.add('error');
                    setTimeout(() => slot.classList.remove('error'), 500);
                });
            }
        }

        function showCompletionModal() {
            const modal = document.getElementById('completion-modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            
            // 簡單的淡入動畫
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('completion-modal');
            const content = document.getElementById('modal-content');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function resetCurrentProblem() {
            closeModal();
            loadProblem(currentProblemIdx);
        }

    </script>
</body>
</html>