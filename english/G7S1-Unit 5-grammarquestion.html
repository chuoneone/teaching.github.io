<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼è‹±æ–‡æ¸¬é©— - Unit 5</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Canvas Confetti CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* åŸºç¤è¨­å®š */
        body {
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }

        /* äº’å‹•å–®å­—æ¨£å¼ - æ›´æ˜é¡¯çš„äº’å‹•æ„Ÿ */
        .word {
            position: relative;
            cursor: pointer;
            border-bottom: 2px dotted #cbd5e1; /* slate-300 */
            transition: all 0.2s ease;
            padding-bottom: 1px;
        }

        .word:hover {
            color: #ea580c; /* orange-600 */
            border-bottom-color: #ea580c;
            background-color: rgba(255, 237, 213, 0.3); /* orange-100 with opacity */
        }

        /* Tooltip å„ªåŒ– */
        .word .tooltip {
            visibility: hidden;
            width: max-content;
            background-color: #1e293b; /* slate-800 */
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 6px 12px;
            position: absolute;
            z-index: 20;
            bottom: 140%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            font-size: 0.9rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .word .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }

        .word:hover .tooltip {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* å°è¦½åˆ—æ¨£å¼ */
        .nav-item {
            transition: all 0.2s;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .nav-item:hover:not(.active) {
            background-color: #f1f5f9; /* slate-100 */
        }
        .nav-item.active {
            background-color: #f59e0b; /* amber-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.3);
        }

        /* å‹•ç•«ç‰¹æ•ˆ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .animate-pop {
            animation: pop 0.2s ease-out;
        }

        /* è¡¨æ ¼å„ªåŒ– */
        .schedule-table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .schedule-table th, .schedule-table td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: center;
            background-color: white;
        }
        .schedule-table th {
            font-weight: 600;
        }

        /* è‡ªå®šç¾©æ²è»¸ (é‡å° Chrome/Safari) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col md:flex-row text-slate-800">

    <!-- å´é‚Šå°è¦½åˆ— -->
    <nav class="bg-white shadow-lg w-full md:w-72 md:min-h-screen flex-shrink-0 md:flex md:flex-col z-20 sticky top-0 md:fixed md:h-screen">
        <div class="p-5 border-b border-slate-100 flex items-center justify-between bg-white z-30">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ğŸ“…</span>
                <div>
                    <h1 class="text-lg font-bold text-slate-800 leading-tight">Unit 5 æ–‡æ³•ç·´ç¿’</h1>
                    <p class="text-xs text-slate-500">Date & Time</p>
                </div>
            </div>
        </div>
        
        <!-- å°è¦½æŒ‰éˆ•å€ -->
        <div class="flex md:flex-col overflow-x-auto md:overflow-y-auto p-3 gap-2 hide-scrollbar">
            <button onclick="switchSection('A')" id="nav-A" class="nav-item active flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                <div>
                    <span class="block text-sm font-bold">åŸºç¤è§€å¿µ</span>
                    <span class="block text-xs opacity-80">Basic Concepts</span>
                </div>
            </button>
            <button onclick="switchSection('B')" id="nav-B" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-purple-100 text-purple-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">2</span>
                <div>
                    <span class="block text-sm font-bold">æ—¥æœŸè¡¨é”</span>
                    <span class="block text-xs opacity-80">Reading Dates</span>
                </div>
            </button>
            <button onclick="switchSection('C')" id="nav-C" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-green-100 text-green-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                <div>
                    <span class="block text-sm font-bold">é€²éšæ‡‰ç”¨</span>
                    <span class="block text-xs opacity-80">Prepositions & Q&A</span>
                </div>
            </button>
        </div>
        
        <div class="mt-auto p-5 hidden md:block border-t border-slate-100">
            <div class="flex items-center justify-between text-xs text-slate-400">
                <span>Unit 5</span>
                <span>Pro Edition âœ¨</span>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="flex-1 p-4 md:p-8 md:ml-72 flex flex-col items-center min-h-screen">
        <div id="quiz-container" class="bg-white p-6 sm:p-10 rounded-3xl shadow-xl w-full max-w-4xl transition-all duration-300 border border-slate-100 relative overflow-hidden mb-8">
            
            <!-- é ‚éƒ¨è³‡è¨Šåˆ— -->
            <div class="flex justify-between items-end mb-8 border-b border-slate-100 pb-4">
                <div>
                    <p class="text-sm text-amber-500 font-bold uppercase tracking-wider mb-1" id="section-tag">Section A</p>
                    <h2 id="section-title" class="text-3xl font-extrabold text-slate-800">åŸºç¤è§€å¿µ</h2>
                </div>
                <div class="text-right">
                    <span id="question-counter" class="text-2xl font-bold text-slate-700">1</span>
                    <span class="text-slate-400 text-lg">/3</span>
                </div>
            </div>
            
            <!-- é€²åº¦æ¢ -->
            <div class="w-full bg-slate-100 rounded-full h-3 mb-8 overflow-hidden">
                <div id="progress-bar" class="bg-amber-500 h-full rounded-full transition-all duration-700 ease-out shadow-[0_0_10px_rgba(245,158,11,0.5)]" style="width: 0%"></div>
            </div>
            
            <!-- é¡Œç›®å€åŸŸ -->
            <div id="questions-wrapper" class="min-h-[200px]"></div>

            <!-- æ§åˆ¶å€ -->
            <div id="controls" class="mt-10 text-center"></div>
            
            <!-- åˆ†æ•¸é¡¯ç¤ºå€ -->
            <div id="score-display" class="mt-6 text-center hidden animate-fade-in"></div>
        </div>

        <!-- é å°¾ -->
        <footer class="container mx-auto px-4 py-6 text-center text-gray-500 text-xs mt-auto">
            <p>&copy; 2025 ç±³å…‹å¸«</p>
            <p>æœ¬ä½œå“æ¡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="underline hover:text-amber-500 transition-colors">CC BY-NC-SA 4.0 å‰µç”¨CCæˆæ¬Š</a>ã€‚</p>
            <p>æ­¡è¿éå•†æ¥­ç”¨é€”è½‰è¼‰ã€å¼•ç”¨æˆ–æ”¹ç·¨ï¼Œè«‹ä¿ç•™ã€Œç±³å…‹å¸«ã€ç½²åï¼Œä¸¦é™„ä¸Šæœ¬ä½œå“åŸå§‹é€£çµã€‚</p>
        </footer>
    </main>

    <!-- æç¤º Modal -->
    <div id="alert-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-sm text-center transform scale-100 transition-transform duration-300 animate-pop">
            <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-3xl">âš ï¸</span>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">æç¤º</h3>
            <p id="alert-message" class="text-slate-600 mb-6">è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼</p>
            <button id="close-alert-btn" class="w-full bg-amber-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-amber-600 active:scale-95 transition-all shadow-lg shadow-amber-500/30">çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // --- éŸ³æ•ˆç³»çµ± (Web Audio API) ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                // æ¸…è„†çš„å®å’šè²
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.exponentialRampToValueAtTime(1046.5, audioContext.currentTime + 0.1); // C6
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'wrong') {
                // ä½æ²‰çš„å—¡å—¡è²
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'click') {
                 // è¼•å¾®é»æ“Šè²
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.05);
            }
        }

        // --- è³‡æ–™å®šç¾©å€ ---
        const translations = {
            // åŸºç¤èˆ‡ Unit 5 å–®å­—
            "what's": "æ˜¯ä»€éº¼", "the": "é€™å€‹", "date": "æ—¥æœŸ", "today": "ä»Šå¤©", 
            "is": "æ˜¯", "august": "å…«æœˆ", "eighth": "ç¬¬å…«", "month": "æœˆä»½", "of": "çš„", "year": "å¹´",
            "march": "ä¸‰æœˆ", "first": "ç¬¬ä¸€/ä¸€è™Ÿ", "it's": "å®ƒæ˜¯/ç¾åœ¨æ˜¯",
            "nine": "ä¹", "thirty": "ä¸‰å", "january": "ä¸€æœˆ", "may": "äº”æœˆ", "ten": "å",
            "october": "åæœˆ", "february": "äºŒæœˆ", "twelve": "åäºŒ", "april": "å››æœˆ", "third": "ç¬¬ä¸‰/ä¸‰è™Ÿ", 
            "july": "ä¸ƒæœˆ", "four": "å››", "june": "å…­æœˆ", "sixth": "ç¬¬å…­/å…­è™Ÿ", "eight": "å…«",
            "december": "åäºŒæœˆ", "twenty": "äºŒå", 
            "her": "å¥¹çš„", "school": "å­¸æ ¡", "day": "æ—¥å­", "november": "åä¸€æœˆ",
            "when": "ä½•æ™‚", "your": "ä½ çš„", "birthday": "ç”Ÿæ—¥", "new": "æ–°", "year's": "å¹´çš„",
            "also": "ä¹Ÿæ˜¯", "basketball": "ç±ƒçƒ", "game": "æ¯”è³½", "christmas": "è–èª•ç¯€",
            "joe's": "Joeçš„", "party": "æ´¾å°", "eric": "è‰¾ç‘å…‹", "flora": "å¼—æ´›æ‹‰",
            "steve": "å²è’‚å¤«", "jerry": "å‚‘ç‘"
        };

        // é¡Œåº«è³‡æ–™ (Unit 5)
        const quizSections = {
            'A': {
                title: "åŸºç¤è§€å¿µ",
                subtitle: "Basic Concepts: The & Date",
                data: [
                    {
                        type: "choice",
                        question: "August is _______ eighth month of the year.",
                        options: ["X", "an", "the", "a"],
                        answer: "C",
                        hint: "August æ˜¯å”¯ä¸€çš„å…«æœˆï¼Œã€Œç¬¬å…«å€‹æœˆä»½ã€æ˜¯ç‰¹å®šçš„é †åºï¼Œå› æ­¤è¦ç”¨ the + åºæ•¸ã€‚<br>âœ” the eighth month"
                    },
                    {
                        type: "choice",
                        question: "Eric: Whatâ€™s ______ today?<br>Flora: Itâ€™s March first.",
                        options: ["date", "the date", "a date", "the day"],
                        answer: "B",
                        hint: "å•æ—¥æœŸè¦ç”¨å›ºå®šå¥å‹ï¼šWhatâ€™s the date today?<br>æ‰€ä»¥ç©ºæ ¼æ‡‰å¡« the dateã€‚"
                    },
                    {
                        type: "choice",
                        question: "A: Whatâ€™s the date today?<br>B: Itâ€™s ___________.",
                        options: ["nine thirty", "on January first", "May ten", "January first"],
                        answer: "D",
                        hint: "å›ç­”æ—¥æœŸæ™‚ä¸åŠ  onï¼ˆå› ç‚ºæ˜¯ todayï¼‰ï¼Œæ ¼å¼ç‚ºï¼šæœˆä»½ + åºæ•¸ã€‚<br>(A) æ™‚é–“ä¸å° (B) æœ‰onä¸å¯ (C) æ‡‰ç‚ºtenth"
                    }
                ]
            },
            'B': {
                title: "æ—¥æœŸè¡¨é”",
                subtitle: "Reading Dates Correctly",
                data: [
                    {
                        type: "choice",
                        question: "A: Whatâ€™s the date today?<br>B: Itâ€™s ___________.",
                        options: ["October thirty", "February twelve", "April third", "July four"],
                        answer: "C",
                        hint: "æ—¥æœŸï¼šæœˆä»½ï¼‹åºæ•¸ã€‚<br>(A) æ‡‰æ˜¯ thirtieth<br>(B) æ‡‰æ˜¯ twelfth<br>(D) æ‡‰æ˜¯ fourth"
                    },
                    {
                        type: "choice",
                        question: "A: Whatâ€™s the date today?<br>B: Itâ€™s ___________.",
                        options: ["June sixth", "October eight", "December thirty", "February twenty"],
                        answer: "A",
                        hint: "åªæœ‰ (A) sixth æ˜¯æ­£ç¢ºåºæ•¸ã€‚<br>(B) æ‡‰æ˜¯ eighth<br>(C) æ‡‰æ˜¯ thirtieth<br>(D) æ‡‰æ˜¯ twentieth"
                    },
                    {
                        type: "choice",
                        question: "A: _____ is her school day?<br>B: Itâ€™s _____ November 14.",
                        options: ["What time; on", "What day; X", "When; on", "What date; in"],
                        answer: "C",
                        hint: "å•æ—¥æœŸå¯ç”¨ Whenã€‚<br>å¾Œé¢æ¥åˆ°ä¸€å€‹ç‰¹å®šæ—¥æœŸ November 14ï¼Œå‰é¢è¦åŠ  onã€‚<br>âœ” When is her school day? âœ” Itâ€™s on November 14."
                    }
                ]
            },
            'C': {
                title: "é€²éšæ‡‰ç”¨",
                subtitle: "Prepositions & Dialogues",
                data: [
                    {
                        type: "choice",
                        question: "A: When is your birthday?<br>B: Itâ€™s _____.<br>A: Oh, itâ€™s also New Yearâ€™s Day.",
                        options: ["at nine thirty", "on January first", "January first", "in 2020"],
                        answer: "B",
                        hint: "å•ç”Ÿæ—¥ç”¨ Whenã€‚å›ç­”ã€Œç‰¹å®šæ—¥æœŸã€ â†’ è¦ç”¨ on + æœˆ + æ—¥åºæ•¸ã€‚<br>(C) ç¼ºäº†ä»‹ä¿‚è© onã€‚"
                    },
                    {
                        type: "choice",
                        question: "Steve: _____ is the basketball game?<br>Jerry: Itâ€™s ______ April first.",
                        options: ["What day; in", "What date; in", "When; on", "When; X"],
                        answer: "C",
                        hint: "å•æ´»å‹•æ—¥æœŸä¹Ÿç”¨ Whenã€‚<br>April first æ˜¯ã€Œç‰¹å®šæ—¥æœŸã€â†’ å‰é¢åŠ  onã€‚<br>âœ” Itâ€™s on April first."
                    },
                    {
                        type: "choice",
                        question: "Christmas is _____ December.",
                        options: ["in", "on", "X", "of"],
                        answer: "A",
                        hint: "åªæœ‰æœˆä»½ (December) æ™‚ï¼Œå‰é¢è¦ç”¨ä»‹ä¿‚è© inã€‚<br>âœ” Christmas is in December."
                    },
                    {
                        type: "choice",
                        question: "A: When is Joeâ€™s birthday party? (7/1)<br>B: Itâ€™s _________.",
                        options: ["in May two", "on July first", "in July three", "on May first"],
                        answer: "B",
                        hint: "ç‰¹å®šæ—¥æœŸ (7æœˆ1æ—¥) è¦ç”¨ on + æœˆä»½ + åºæ•¸ã€‚<br>(B) on July first æ˜¯æ­£ç¢ºå¯«æ³•ã€‚<br>(D) æ—¥æœŸä¸ç¬¦ (é¡Œç›®æç¤ºç‚º 7/1)ã€‚"
                    }
                ]
            }
        };

        // --- å…¨åŸŸè®Šæ•¸ ---
        let currentSectionId = 'A';
        let currentData = quizSections['A'].data;
        let currentQuestionIndex = 0;
        let score = 0;

        // --- DOM å…ƒç´  ---
        const questionsWrapper = document.getElementById('questions-wrapper');
        const controlsContainer = document.getElementById('controls');
        const scoreDisplay = document.getElementById('score-display');
        const progressBar = document.getElementById('progress-bar');
        const sectionTitle = document.getElementById('section-title');
        const sectionTag = document.getElementById('section-tag');
        const questionCounter = document.getElementById('question-counter');
        const alertModal = document.getElementById('alert-modal');
        const alertMessage = document.getElementById('alert-message');
        const closeAlertBtn = document.getElementById('close-alert-btn');
        const quizContainer = document.getElementById('quiz-container');

        // --- æ ¸å¿ƒåŠŸèƒ½å‡½å¼ ---
        function createInteractiveText(text) {
            // åˆ†å‰²æ–‡å­—ä¿ç•™æ¨™é»èˆ‡æ‹¬è™Ÿï¼Œä¸¦ä¸ç ´å£HTMLæ¨™ç±¤
            const parts = text.split(/([a-zA-Z'â€™\-]+)/);
            return parts.map(part => {
                // è·³éHTMLæ¨™ç±¤
                if (part.match(/[<>]/)) return part;

                const cleanPart = part.toLowerCase().replace(/â€™/g, "'").replace(/[^a-z\-]/g, "");
                if (translations[cleanPart]) {
                    return `<span class="word" onclick="event.stopPropagation(); speak('${part}')">${part}<span class="tooltip">${translations[cleanPart]}</span></span>`;
                }
                return part;
            }).join('');
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const cleanText = text.replace(/<[^>]*>/g, "");
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                // å˜—è©¦è¨­å®šè‹±æ–‡èªéŸ³
                const voices = window.speechSynthesis.getVoices();
                const enVoice = voices.find(v => v.lang.includes('en-US') || v.lang.includes('en-GB'));
                if (enVoice) utterance.voice = enVoice;
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function createSpeakerIcon(textToSpeak) {
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "h-6 w-6 text-amber-500 hover:text-amber-600 cursor-pointer flex-shrink-0 transition-transform hover:scale-110");
            svg.setAttribute("viewBox", "0 0 20 20");
            svg.setAttribute("fill", "currentColor");
            
            const path = document.createElementNS(svgNS, "path");
            path.setAttribute("fill-rule", "evenodd");
            path.setAttribute("d", "M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.016 5.39a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 11-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026zM14.07 3.33a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 01-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026z");
            path.setAttribute("clip-rule", "evenodd");
            svg.appendChild(path);
            
            svg.onclick = (e) => { 
                e.stopPropagation(); 
                speak(textToSpeak); 
            };
            return svg;
        }

        // --- å°è¦½èˆ‡ç‹€æ…‹åˆ‡æ› ---
        window.switchSection = function(sectionId) {
            currentSectionId = sectionId;
            
            if (!quizSections[sectionId]) return;

            currentData = quizSections[sectionId].data;
            currentQuestionIndex = 0;
            score = 0;
            
            // æ›´æ–°æ¨™é¡Œ
            sectionTitle.textContent = quizSections[sectionId].title;
            sectionTag.textContent = quizSections[sectionId].subtitle;
            
            // æ›´æ–°é¸å–®ç‹€æ…‹
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
            });
            
            const activeBtn = document.getElementById(`nav-${sectionId}`);
            if(activeBtn) activeBtn.classList.add('active');

            // é‡ç½®é¡¯ç¤º
            scoreDisplay.classList.add('hidden');
            questionsWrapper.classList.remove('hidden');
            controlsContainer.classList.remove('hidden');
            
            displayQuestion(0);
            playSound('click');
        };

        function displayQuestion(index) {
            questionsWrapper.innerHTML = '';
            controlsContainer.innerHTML = '';
            questionCounter.textContent = `${index + 1}`;
            
            // å¹³æ»‘é€²åº¦æ¢
            const progressPercentage = (index / currentData.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;

            const q = currentData[index];

            const questionBlock = document.createElement('div');
            questionBlock.className = 'animate-fade-in';
            
            // é¡Œç›®å¡ç‰‡
            const card = document.createElement('div');
            card.className = "bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow duration-300";

            // é¡Œç›®æ–‡å­—
            const questionText = document.createElement('div');
            questionText.className = 'flex items-start gap-4 mb-6';
            
            // æ¸…ç†æ–‡å­—ä»¥ä¾›èªéŸ³æœ—è®€ (å»é™¤åº•ç·šç­‰ç¬¦è™Ÿ)
            let cleanQText = q.question.replace(/<br>/g, ' ').replace(/_______/g, 'blank').replace(/_____/g, 'blank');
            const speaker = createSpeakerIcon(cleanQText);
            
            const textSpan = document.createElement('h3');
            textSpan.className = "text-xl text-slate-800 font-semibold leading-relaxed mt-1";
            textSpan.innerHTML = `${createInteractiveText(q.question)}`;
            
            questionText.appendChild(speaker);
            questionText.appendChild(textSpan);
            card.appendChild(questionText);

            // æ¸²æŸ“é¸é …
            renderChoiceOptions(q, index, card);

            // æç¤ºæŒ‰éˆ•
            renderHint(q, card);

            questionBlock.appendChild(card);
            questionsWrapper.appendChild(questionBlock);

            // æäº¤æŒ‰éˆ•
            const submitButton = document.createElement('button');
            submitButton.className = 'w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-10 rounded-xl hover:bg-amber-600 hover:scale-105 active:scale-95 transition-all shadow-lg shadow-amber-500/30 text-lg';
            submitButton.textContent = 'æª¢æŸ¥ç­”æ¡ˆ';
            submitButton.onclick = () => checkAnswer(index);
            controlsContainer.appendChild(submitButton);
        }

        function renderChoiceOptions(q, index, container) {
            const optionsGrid = document.createElement('div');
            const isLongOption = q.options.some(opt => opt.length > 20);
            optionsGrid.className = `grid ${isLongOption ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-2'} gap-4 mb-6`;
            
            q.options.forEach((option, i) => {
                const optionChar = String.fromCharCode(65 + i);
                const optionContainer = document.createElement('div');
                optionContainer.className = 'group relative flex items-center p-4 border-2 border-slate-200 rounded-xl transition-all cursor-pointer hover:border-amber-400 hover:bg-amber-50';
                optionContainer.setAttribute('role', 'button');
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.id = `q${index}-opt${optionChar}`;
                radio.name = `q${index}`;
                radio.value = optionChar;
                radio.className = 'opacity-0 absolute w-0 h-0';

                // è‡ªå®šç¾© Radio UI
                const radioUI = document.createElement('div');
                radioUI.className = "w-6 h-6 rounded-full border-2 border-slate-300 group-hover:border-amber-500 mr-4 flex items-center justify-center flex-shrink-0 transition-colors";
                const radioDot = document.createElement('div');
                radioDot.className = "w-3 h-3 rounded-full bg-amber-500 transform scale-0 transition-transform duration-200";
                radioUI.appendChild(radioDot);

                const label = document.createElement('label');
                label.htmlFor = `q${index}-opt${optionChar}`;
                label.className = 'block text-lg text-slate-700 flex-1 cursor-pointer flex items-center gap-3';
                
                // é¸é …è‹¥ä¸ç‚º X æ‰åŠ èªéŸ³ï¼Œä¸¦å¿½ç•¥éçŸ­å…§å®¹
                if(option !== 'X') {
                    label.appendChild(createSpeakerIcon(option));
                }
                const textSpan = document.createElement('span');
                textSpan.innerHTML = `${createInteractiveText(option)}`;
                label.appendChild(textSpan);

                // é»æ“Šäº‹ä»¶
                optionContainer.onclick = () => { 
                    container.querySelectorAll('.border-amber-500').forEach(el => {
                        el.classList.remove('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
                        el.classList.add('border-slate-200');
                    });
                    container.querySelectorAll('.scale-100').forEach(el => el.classList.remove('scale-100'));

                    radio.checked = true; 
                    optionContainer.classList.remove('border-slate-200');
                    optionContainer.classList.add('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
                    radioDot.classList.add('scale-100');
                    playSound('click');
                };

                optionContainer.appendChild(radio);
                optionContainer.appendChild(radioUI);
                optionContainer.appendChild(label);
                optionsGrid.appendChild(optionContainer);
            });
            container.appendChild(optionsGrid);
        }

        function renderHint(q, container) {
            const hintContainer = document.createElement('div');
            hintContainer.className = 'mt-4';
            
            const hintButton = document.createElement('button');
            hintButton.className = 'text-sm text-amber-600 hover:text-amber-800 flex items-center gap-2 font-bold transition-colors';
            hintButton.innerHTML = '<span class="bg-amber-100 rounded-full w-6 h-6 flex items-center justify-center">ğŸ’¡</span> æŸ¥çœ‹æç¤º';
            
            const hintText = document.createElement('div');
            hintText.className = 'hint-content hidden mt-3 text-base text-slate-600 bg-amber-50 border border-amber-100 p-4 rounded-xl animate-fade-in';
            hintText.innerHTML = `<p>${q.hint}</p>`;
            
            hintButton.onclick = () => {
                hintText.classList.toggle('hidden');
                playSound('click');
            };
            
            hintContainer.appendChild(hintButton);
            hintContainer.appendChild(hintText);
            container.appendChild(hintContainer);
        }

        function checkAnswer(index) {
            const q = currentData[index];
            let isCorrect = false;
            
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (!selected) {
                showAlert("è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼");
                quizContainer.classList.add('animate-shake');
                setTimeout(() => quizContainer.classList.remove('animate-shake'), 300);
                playSound('wrong');
                return;
            }
            const userAnswer = selected.value;
            isCorrect = (userAnswer === q.answer);

            controlsContainer.innerHTML = ''; 
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `mt-6 p-6 rounded-2xl border-2 animate-pop ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
            
            if (isCorrect) {
                score++;
                playSound('correct');
                resultDiv.innerHTML = `
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-2xl shadow-sm">ğŸ‰</div>
                        <div>
                            <p class="text-green-800 font-bold text-lg">ç­”å°äº†ï¼Great Job!</p>
                            <p class="text-green-600 text-sm">æ­£ç¢ºç­”æ¡ˆï¼š${q.answer}</p>
                        </div>
                    </div>
                `;
                const correctIndex = q.answer.charCodeAt(0) - 65;
                const speakText = q.options[correctIndex];
                if (speakText !== 'X') setTimeout(() => speak(speakText), 500);

            } else {
                playSound('wrong');
                const correctIndex = q.answer.charCodeAt(0) - 65;
                const correctText = q.options[correctIndex];
                
                resultDiv.innerHTML = `
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-2xl shadow-sm">âŒ</div>
                        <div>
                            <p class="text-red-800 font-bold text-lg">å†æ¥å†å²ï¼Try Again!</p>
                            <p class="text-red-600 text-sm">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<span class="font-bold">${createInteractiveText(correctText)}</span></p>
                        </div>
                    </div>
                `;
            }

            document.querySelectorAll(`input[name="q${index}"]`).forEach(el => el.disabled = true);
            document.querySelectorAll(`div[role="button"]`).forEach(el => el.classList.add('cursor-not-allowed', 'opacity-70'));

            questionsWrapper.appendChild(resultDiv);

            const nextButton = document.createElement('button');
            nextButton.className = 'w-full sm:w-auto bg-slate-800 text-white font-bold py-3 px-10 rounded-xl hover:bg-slate-700 hover:scale-105 transition-all shadow-lg mt-6';
            
            if (currentQuestionIndex < currentData.length - 1) {
                nextButton.textContent = 'ä¸‹ä¸€é¡Œ Next â†’';
                nextButton.onclick = () => {
                    currentQuestionIndex++;
                    displayQuestion(currentQuestionIndex);
                };
            } else {
                nextButton.textContent = 'æŸ¥çœ‹æˆç¸¾ Finish ğŸ†';
                nextButton.onclick = showFinalScore;
            }
            controlsContainer.appendChild(nextButton);
        }

        function showFinalScore() {
            progressBar.style.width = '100%';
            questionsWrapper.innerHTML = '';
            controlsContainer.innerHTML = '';
            sectionTitle.textContent = 'æ¸¬é©—å®Œæˆ';
            sectionTag.textContent = 'Score Report';
            questionCounter.textContent = '';

            if (score === currentData.length) {
                playSound('correct');
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            scoreDisplay.innerHTML = `
                <div class="py-10 animate-fade-in">
                    <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center text-5xl shadow-lg mx-auto mb-6 border-4 ${score === currentData.length ? 'border-amber-400' : 'border-slate-200'}">
                        ${score === currentData.length ? 'ğŸ†' : (score > currentData.length/2 ? 'ğŸŒŸ' : 'ğŸ’ª')}
                    </div>
                    <p class="text-slate-500 uppercase tracking-wider font-bold text-sm mb-2">Total Score</p>
                    <p class="text-6xl font-extrabold my-2 text-slate-800">${score} <span class="text-3xl text-slate-300">/ ${currentData.length}</span></p>
                    
                    <p class="text-lg text-slate-600 mt-4 font-medium">
                        ${score === currentData.length ? 'å¤ªæ£’äº†ï¼å…¨å°ï¼Outstanding!' : (score > currentData.length/2 ? 'åšå¾—å¾ˆå¥½ï¼Good Job!' : 'ç¹¼çºŒåŠ æ²¹ï¼Keep Trying!')}
                    </p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4 mt-10">
                        <button onclick="location.reload()" class="px-8 py-3 border-2 border-slate-200 rounded-xl hover:bg-slate-50 text-slate-600 font-bold transition-colors">
                            å›é¦–é  Home
                        </button>
                        <button onclick="switchSection('${currentSectionId}')" class="px-8 py-3 bg-amber-500 text-white rounded-xl hover:bg-amber-600 font-bold shadow-lg shadow-amber-500/30 hover:-translate-y-1 transition-all">
                            å†è©¦ä¸€æ¬¡ Retry
                        </button>
                    </div>
                </div>
            `;
            scoreDisplay.classList.remove('hidden');
        }

        function showAlert(msg) {
            alertMessage.textContent = msg;
            alertModal.classList.remove('hidden');
        }

        closeAlertBtn.addEventListener('click', () => {
            alertModal.classList.add('hidden');
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            switchSection('A');
        });
    </script>
</body>
</html>