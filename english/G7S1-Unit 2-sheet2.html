<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 2 - Grammar Focus 1</title>    
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff; /* light blue background */
        }
        .exercise-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 24px;
            margin-bottom: 24px;
            transition: box-shadow 0.3s ease;
        }
        .exercise-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px;
            background-color: #f1f5f9;
            border-radius: 8px;
            min-height: 50px;
        }
        .drop-zone {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px;
            background-color: #ffffff;
            border: 2px dashed #94a3b8;
            border-radius: 8px;
            min-height: 50px;
            margin-top: 12px;
        }
        .word-item {
            padding: 8px 16px;
            background-color: #e0f2fe;
            border: 1px solid #7dd3fc;
            color: #075985;
            border-radius: 9999px; /* pill shape */
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        .word-item:hover {
            background-color: #bae6fd;
            transform: scale(1.05);
        }
        .speaker-icon {
            cursor: pointer;
            display: inline-block;
            margin-left: 8px;
            color: #3b82f6;
            font-size: 1.2em;
            vertical-align: middle;
        }
        .speaker-icon:hover {
            color: #2563eb;
        }
        #tooltip {
            position: absolute;
            display: none;
            background-color: #1f2937;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            pointer-events: none; /* So it doesn't interfere with mouse events */
            z-index: 100;
        }
        .option-item {
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .option-item:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        .correct {
            background-color: #dcfce7 !important;
            border-color: #4ade80 !important;
        }
        .incorrect {
            background-color: #fee2e2 !important;
            border-color: #f87171 !important;
        }
        .prompt-text {
            color: #475569;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1em;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="tooltip"></div>

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800">Unit 2: Grammar Focus 1</h1>
            <p class="text-slate-600 mt-2">指示代名詞 these, those</p>
        </header>

        <!-- Exercise Section 1 -->
        <div class="exercise-card">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">一、請依提示寫出肯定句</h2>
            <p class="text-slate-500 mb-6">請點擊下方的單字，完成句子重組。</p>
            <div id="section1-container" class="space-y-8"></div>
        </div>

        <!-- Exercise Section 2 -->
        <div class="exercise-card">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">二、請單數句改成複數句</h2>
            <p class="text-slate-500 mb-6">請選擇正確的複數句子。</p>
            <div id="section2-container" class="space-y-8"></div>
        </div>
        
        <!-- Exercise Section 3 -->
        <div class="exercise-card">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">三、請依提示作答</h2>
            <p class="text-slate-500 mb-6">請根據問題和括號中的提示，點擊單字完成答句。</p>
            <div id="section3-container" class="space-y-8"></div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const translations = {
            'These': '這些', 'are': '是', 'rulers': '尺(複數)', 'They': '它們/他們', 'notebooks': '筆記本(複數)',
            'Those': '那些', 'pencil': '鉛筆', 'cases': '盒子(複數)', 'my': '我的', 'watches': '手錶(複數)',
            'He': '他', 'is': '是', 'a': '一個', 'police': '警察', 'officer': '官員', 'That': '那個', 'brush': '刷子',
            'It': '它', 'not': '不', 'your': '你的', 'comic': '漫畫', 'book': '書', 'She': '她', 'woman': '女人',
            'leaf': '葉子', 'What': '什麼', 'these': '這些', 'our': '我們的', 'lunch': '午餐', 'boxes': '盒子(複數)',
            'brushes': '刷子(複數)', 'officers': '官員(複數)', 'women': '女人(複數)', 'leaves': '葉子(複數)',
            'books': '書(複數)', '.': '。'
        };

        const exercises = {
            section1: [
                { id: 's1q1', prompt: ['These', 'be', 'rulers'], answer: 'These are rulers.' },
                { id: 's1q2', prompt: ['They', 'be', 'notebooks'], answer: 'They are notebooks.' },
                { id: 's1q3', prompt: ['Those', 'be', 'pencil', 'cases'], answer: 'Those are pencil cases.' },
                { id: 's1q4', prompt: ['These', 'be', 'my', 'watches'], answer: 'These are my watches.' }
            ],
            section2: [
                { id: 's2q1', question: 'He is a police officer.', options: ['He are police officers.', 'They are police officers.', 'They is a police officers.'], answer: 'They are police officers.' },
                { id: 's2q2', question: 'That is a brush.', options: ['These are brushes.', 'Those are brushes.', 'That is brushes.'], answer: 'Those are brushes.' },
                { id: 's2q3', question: 'It is not your comic book.', options: ['They are not your comic books.', 'It is not your comic books.', 'They is not your comic books.'], answer: 'They are not your comic books.' },
                { id: 's2q4', question: 'She is a woman.', options: ['They are women.', 'She are women.', 'They are woman.'], answer: 'They are women.' },
                { id: 's2q5', question: 'It is a leaf.', options: ['It is leaves.', 'They are leaf.', 'They are leaves.'], answer: 'They are leaves.' }
            ],
            section3: [
                { id: 's3q1', question: 'What are these?', prompt: '(用 my brushes 回答)', answer: 'These are my brushes.' },
                { id: 's3q2', question: 'What are these?', prompt: '(用 our lunch boxes 回答)', answer: 'These are our lunch boxes.' }
            ]
        };

        // --- CORE FUNCTIONS ---
        const synth = window.speechSynthesis;
        function speak(text) {
            synth.cancel();
            if (text !== '') {
                const utterThis = new SpeechSynthesisUtterance(text.replace(/\./g, ''));
                utterThis.lang = 'en-US';
                utterThis.rate = 0.9;
                synth.speak(utterThis);
            }
        }

        function wrapTextWithTranslation(text) {
            const words = text.split(' ');
            return words.map(word => {
                const cleanWord = word.replace(/[.?]/g, '');
                const punctuation = word.substring(cleanWord.length);
                const translation = translations[cleanWord] || '';
                return `<span class="word" data-chinese="${translation}">${cleanWord}</span>${punctuation}`;
            }).join(' ');
        }
        
        function formatSection2Question(question) {
            const words = question.split(' ');
            if (words.length < 2) {
                return wrapTextWithTranslation(question); // Fallback for short questions
            }
            
            const part1 = words.slice(0, 2).join(' ');
            const part2 = words.slice(2).join(' ');

            const boldHTML = `<strong>${wrapTextWithTranslation(part1)}</strong>`;
            const regularHTML = wrapTextWithTranslation(part2);
            
            return `${boldHTML} ${regularHTML}`;
        }
        
        // FIX: This function now returns an HTML string with a data-attribute for event delegation.
        // This is more reliable than attaching .onclick events that get lost when using innerHTML.
        function createSpeakerIcon(textToSpeak) {
            const safeText = textToSpeak.replace(/"/g, '&quot;'); // Escape quotes for HTML attribute
            return `<span class="speaker-icon" data-speak="${safeText}">🔊</span>`;
        }
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const section1Container = document.getElementById('section1-container');
            const section2Container = document.getElementById('section2-container');
            const section3Container = document.getElementById('section3-container');

            // Render Sections 1 & 3 (Click-to-unscramble)
            const renderUnscrambleSection = (container, sectionData) => {
                sectionData.forEach((ex, index) => {
                    const qDiv = document.createElement('div');
                    qDiv.id = `question-container-${ex.id}`;
                    const words = ex.answer.split(' ').map(w => w.replace('.', ''));
                    if (ex.answer.endsWith('.')) words.push('.');

                    const questionHTML = ex.question ? `<div class="question-text">${wrapTextWithTranslation(ex.question)}</div>` : '';
                    
                    let promptHTML = '';
                    if (ex.prompt && typeof ex.prompt.join === 'function') {
                        const translatedPrompt = ex.prompt.map(pWord => {
                            const cleanWord = pWord.replace(/[.?]/g, '');
                            const translation = translations[cleanWord] || '';
                            return `<span class="word" data-chinese="${translation}">${cleanWord}</span>`;
                        }).join(' / ');
                        promptHTML = `<p class="prompt-text">${translatedPrompt}</p>`;
                    } else if (ex.prompt) {
                        promptHTML = `<span class="ml-4 text-gray-500">${ex.prompt}</span>`;
                    }

                    const speakerText = ex.question || (ex.prompt.join ? ex.prompt.join(' ') : '');

                    qDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <p class="mr-2 text-lg">${index + 1}.</p>
                            ${questionHTML}
                            ${promptHTML}
                            ${createSpeakerIcon(speakerText)}
                        </div>
                        <div class="word-bank" id="word-bank-${ex.id}">
                            ${[...words].sort(() => Math.random() - 0.5).map((word, idx) => `<div class="word-item" data-word-id="${ex.id}-${idx}">${word}</div>`).join('')}
                        </div>
                        <div class="drop-zone mt-3" id="drop-zone-${ex.id}"></div>
                        <div class="flex gap-3 mt-4">
                             <button class="check-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded" data-answer="${ex.answer}" data-id="${ex.id}">檢查答案</button>
                             <button class="reset-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded" data-id="${ex.id}">重新作答</button>
                        </div>
                        <p class="feedback mt-2 text-sm font-bold"></p>
                    `;
                    container.appendChild(qDiv);
                });
            };

            renderUnscrambleSection(section1Container, exercises.section1);
            renderUnscrambleSection(section3Container, exercises.section3);
            
            // Render Section 2 (Multiple Choice)
            exercises.section2.forEach((ex, index) => {
                const qDiv = document.createElement('div');
                const questionHTML = formatSection2Question(ex.question);

                qDiv.innerHTML = `
                    <div class="flex items-center mb-4">
                        <p class="mr-2 text-lg">${index + 1}.</p>
                        <div class="question-text">${questionHTML}</div>
                        ${createSpeakerIcon(ex.question)}
                    </div>
                    <div class="options-container space-y-2" data-answer="${ex.answer}">
                        ${ex.options.map(opt => `
                            <div class="option-item flex justify-between items-center">
                                <span>${formatSection2Question(opt)}</span>
                                ${createSpeakerIcon(opt)}
                            </div>
                        `).join('')}
                    </div>
                `;
                section2Container.appendChild(qDiv);
            });

            // Add event listeners after rendering
            addEventListeners();
        });

        function addEventListeners() {
            // Tooltip
            const tooltip = document.getElementById('tooltip');
            document.querySelectorAll('.word').forEach(wordEl => {
                wordEl.addEventListener('mouseenter', (e) => {
                    const chinese = e.target.dataset.chinese;
                    if (chinese) {
                        tooltip.textContent = chinese;
                        tooltip.style.display = 'block';
                    }
                });
                wordEl.addEventListener('mousemove', (e) => {
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY + 10}px`;
                });
                wordEl.addEventListener('mouseleave', () => {
                    tooltip.style.display = 'none';
                });
            });

            // FIX: Use event delegation for all speaker icons. This is more reliable.
            document.body.addEventListener('click', (e) => {
                if (e.target.classList.contains('speaker-icon')) {
                    e.stopPropagation(); // Prevent triggering other events on parent elements
                    const textToSpeak = e.target.dataset.speak;
                    if (textToSpeak) {
                        speak(textToSpeak);
                    }
                }
            });
            
            // --- CLICK-TO-MOVE LOGIC ---
            // Event listener for clicking words in the word bank
            document.querySelectorAll('.word-bank').forEach(bank => {
                bank.addEventListener('click', e => {
                    if (e.target.classList.contains('word-item')) {
                        const wordItem = e.target;
                        const dropZone = bank.nextElementSibling;
                        if(dropZone && dropZone.classList.contains('drop-zone')){
                           speak(wordItem.textContent);
                           dropZone.appendChild(wordItem);
                        }
                    }
                });
            });
            // Event listener for clicking words in the drop zone (to return them)
             document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('click', e => {
                    if (e.target.classList.contains('word-item')) {
                        const wordItem = e.target;
                        const wordBank = zone.previousElementSibling;
                         if(wordBank && wordBank.classList.contains('word-bank')){
                           wordBank.appendChild(wordItem);
                        }
                    }
                });
            });

            // --- CHECK & RESET BUTTONS LOGIC ---
            // Check Click-to-unscramble Answers
            document.querySelectorAll('.check-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const exId = btn.dataset.id;
                    const dropZone = document.getElementById(`drop-zone-${exId}`);
                    const feedbackEl = dropZone.parentElement.querySelector('.feedback');
                    const words = Array.from(dropZone.children).map(child => child.textContent);
                    const userAnswer = words.join(' ').replace(/ \./g, '.').trim();
                    const correctAnswer = btn.dataset.answer;

                    if (userAnswer === correctAnswer) {
                        feedbackEl.textContent = '太棒了，答對了！';
                        feedbackEl.className = 'feedback mt-2 text-sm font-bold text-green-600';
                        dropZone.style.borderColor = '#4ade80';
                    } else {
                        feedbackEl.textContent = '再試一次看看！';
                        feedbackEl.className = 'feedback mt-2 text-sm font-bold text-red-600';
                        dropZone.style.borderColor = '#f87171';
                    }
                });
            });
            
            // Reset Click-to-unscramble Questions
            document.querySelectorAll('.reset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const exId = btn.dataset.id;
                    const container = document.getElementById(`question-container-${exId}`);
                    const dropZone = container.querySelector('.drop-zone');
                    const wordBank = container.querySelector('.word-bank');
                    const feedbackEl = container.querySelector('.feedback');
                    
                    // Move all words from dropzone back to wordbank
                    Array.from(dropZone.children).forEach(child => wordBank.appendChild(child));
                    
                    // Reset styles and text
                    feedbackEl.textContent = '';
                    dropZone.style.borderColor = '#94a3b8'; // reset to default color
                });
            });

            // Check Multiple-Choice Answers
            document.querySelectorAll('.options-container').forEach(container => {
                const correctAnswer = container.dataset.answer;
                container.querySelectorAll('.option-item').forEach(option => {
                    option.addEventListener('click', (e) => {
                        // --- MODIFICATION START ---
                        // If the clicked element is the speaker icon, do nothing.
                        // The body's event listener will handle the speaking part.
                        if (e.target.classList.contains('speaker-icon')) {
                            return;
                        }
                        // --- MODIFICATION END ---

                        // Prevent multiple clicks
                        if (container.dataset.answered) return;
                        container.dataset.answered = 'true';

                        const selectedAnswer = e.currentTarget.querySelector('span').textContent.trim();
                        if (selectedAnswer === correctAnswer) {
                            e.currentTarget.classList.add('correct');
                        } else {
                            e.currentTarget.classList.add('incorrect');
                            // Highlight correct answer
                            Array.from(container.children).forEach(child => {
                                if (child.querySelector('span').textContent.trim() === correctAnswer) {
                                    child.classList.add('correct');
                                }
                            });
                        }
                    });
                });
            });
        }
    </script>
</body>
</html>



