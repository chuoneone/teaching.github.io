<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUU1習作C</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .clickable-word {
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            padding: 2px 4px;
            border-radius: 4px;
            position: relative; /* For tooltip positioning */
            border-bottom: 1px dotted #6b7280; /* Dotted underline for interactivity hint */
        }
        .clickable-word:hover {
            background-color: #e0f2fe; /* light-blue-100 */
            color: #0c4a6e; /* light-blue-900 */
        }
        /* Tooltip styles */
        .clickable-word::after {
            content: attr(data-zh);
            position: absolute;
            background-color: #1f2937; /* gray-800 */
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            white-space: nowrap;
            z-index: 10;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none; /* Prevent tooltip from interfering with mouse events */
        }
        .clickable-word:hover::after {
            opacity: 1;
            visibility: visible;
        }
        .correct-answer {
            background-color: #dcfce7; /* green-100 */
        }
        .incorrect-answer {
            background-color: #fee2e2; /* red-100 */
        }
        .correct-label::after {
            content: ' ✔️';
            color: #16a34a; /* green-600 */
        }
        .incorrect-label::after {
            content: ' ❌';
            color: #dc2626; /* red-600 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center p-4">

    <div class="container mx-auto max-w-2xl bg-white rounded-2xl shadow-xl p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">BUU1習作C-互動選擇題測驗</h1>
            <p class="text-gray-500 mt-2">點擊單字可聽發音，滑鼠懸停可看中文翻譯</p>
        </header>

        <main id="quiz-container">
            <!-- 測驗題目將由 JavaScript 動態生成 -->
        </main>

        <footer class="text-center mt-8">
            <button id="check-answers-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 transform hover:scale-105 shadow-lg">
                檢查答案
            </button>
            <div id="result" class="mt-6 text-2xl font-bold"></div>
        </footer>
    </div>

    <script>
        const quizData = [
            {
                id: 1,
                dialog: {
                    A: "Hi, I am Kelly Coleman. Nice to meet you.",
                    B: "I'm Nigel Ford."
                },
                options: {
                    A: "I see.",
                    B: "You are welcome.",
                    C: "Nice to meet you, too."
                },
                correctAnswer: "C",
                hint: "當別人說「很高興認識你」時，你應該如何回應？",
                vocab: {
                    "Hi": "嗨", "I'm": "我是", "Nice": "高興的", "to": "去", "meet": "遇見", "you": "你",
                    "see": "了解", "You're": "你是", "welcome": "不客氣", "too": "也"
                }
            },
            {
                id: 2,
                dialog: {
                    A: "Excuse me. Are you Mr. Walker?",
                    B: ""
                },
                options: {
                    A: "Yes, he is.",
                    B: "Yes, I am Larry Walker.",
                    C: "No, I am not Mr. Walker's friend."
                },
                correctAnswer: "B",
                hint: "A 在問你是不是 Walker 先生，你應該如何回答？",
                vocab: {
                    "Excuse": "打擾", "me": "我", "Are": "是", "you": "你", "Mr.": "先生",
                    "Yes": "是的", "he": "他", "is": "是", "I'm": "我是", "No": "不", "not": "不是", "friend": "朋友"
                }
            },
            {
                id: 3,
                dialog: {
                    A: "Who is that girl?",
                    B: ""
                },
                options: {
                    A: "She is really tall.",
                    B: "She is a happy girl.",
                    C: "She is Ariel, our new classmate."
                },
                correctAnswer: "C",
                hint: "A 在問「那個女孩是誰？」，你應該回答她的身分。",
                vocab: {
                    "Who's": "是誰", "that": "那個", "girl": "女孩", "She": "她", "is": "是", "really": "真的",
                    "tall": "高的", "happy": "快樂的", "She's": "她是", "our": "我們的", "new": "新的", "classmate": "同學"
                }
            },
            {
                id: 4,
                dialog: {
                    A: "Is Eric's aunt a writer?",
                    B: ""
                },
                options: {
                    A: "Yes, and she is a doctor, too.",
                    B: "No, she is not. She is a writer.",
                    C: "Yes, she is. She is a housewife."
                },
                correctAnswer: "A",
                hint: "A 在問 Eric 的阿姨是不是作家。選項中哪個回答是合理的？",
                vocab: {
                    "Is": "是", "Eric is": "Eric的", "aunt": "阿姨", "a": "一個", "writer": "作家", "Yes": "是的",
                    "and": "而且", "she is": "她是", "doctor": "醫生", "too": "也", "No": "不", "not": "不是", "housewife": "家庭主婦"
                }
            },
            {
                id: 5,
                dialog: {
                    A: "How old are Alice and Brad?",
                    B: ""
                },
                options: {
                    A: "They are my family.",
                    B: "Alice is ten, and Brad is twelve.",
                    C: "Alice is a cook, and Brad is a nurse."
                },
                correctAnswer: "B",
                hint: "A 在問 Alice 和 Brad 的年齡。",
                vocab: {
                    "How": "如何", "old": "老的", "are": "是", "They": "他們", "my": "我的", "family": "家人",
                    "is": "是", "ten": "十歲", "and": "和", "twelve": "十二歲", "a": "一個", "cook": "廚師", "nurse": "護士"
                }
            }
        ];

        const quizContainer = document.getElementById('quiz-container');

        // 語音合成功能
        function speak(text, lang) {
            // 如果有正在朗讀的，先停止
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        // 將句子轉換為可點擊的單字
        function createClickableSentence(sentence, vocab) {
            if (!sentence) return '';
            return sentence.split(/(\s+|[.,?'])/).filter(word => word.trim().length > 0).map(word => {
                const cleanWord = word.replace(/[.,?']/g, '');
                const translation = vocab[cleanWord] || vocab[cleanWord.charAt(0).toUpperCase() + cleanWord.slice(1)] || vocab[cleanWord.toLowerCase()];
                if (translation) {
                    return `<span class="clickable-word" data-en="${cleanWord}" data-zh="${translation}">${word}</span>`;
                }
                return `<span>${word}</span>`;
            }).join(' ');
        }
        
        // 渲染測驗題目
        quizData.forEach(q => {
            const questionElement = document.createElement('div');
            questionElement.className = 'bg-gray-50 border border-gray-200 rounded-lg p-6 mb-6';
            questionElement.innerHTML = `
                <div class="mb-4">
                    <p class="font-semibold text-lg text-gray-700">
                        <span class="font-bold text-blue-600 mr-2">${q.id}.</span>
                        <span class="font-normal">A: ${createClickableSentence(q.dialog.A, q.vocab)}</span>
                    </p>
                    <p class="font-semibold text-lg text-gray-700 ml-6">
                        <span class="font-normal">B: ${createClickableSentence(q.dialog.B, q.vocab)} __________</span>
                    </p>
                </div>
                <div class="space-y-3" id="options-${q.id}">
                    ${Object.entries(q.options).map(([key, value]) => `
                        <div>
                            <label for="q${q.id}-${key}" class="flex items-center p-3 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-100 transition duration-200">
                                <input type="radio" name="q${q.id}" id="q${q.id}-${key}" value="${key}" class="mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300">
                                <span class="text-base">${createClickableSentence(value, q.vocab)}</span>
                            </label>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-4 text-right">
                    <button class="hint-btn text-sm text-blue-500 hover:text-blue-700 font-semibold">提示</button>
                    <p class="hint-text hidden mt-2 text-sm text-gray-600 bg-yellow-100 p-2 rounded">${q.hint}</p>
                </div>
            `;
            quizContainer.appendChild(questionElement);
        });
        
        // 為所有可點擊單字添加事件監聽器
        document.querySelectorAll('.clickable-word').forEach(wordEl => {
            wordEl.addEventListener('click', () => {
                const englishWord = wordEl.dataset.en;
                speak(englishWord, 'en-US');
            });
        });

        // 提示按鈕功能
        document.querySelectorAll('.hint-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const hintText = btn.nextElementSibling;
                hintText.classList.toggle('hidden');
            });
        });

        // 檢查答案按鈕功能
        document.getElementById('check-answers-btn').addEventListener('click', () => {
            let score = 0;
            quizData.forEach(q => {
                const optionsContainer = document.getElementById(`options-${q.id}`);
                const selectedOption = optionsContainer.querySelector(`input[name="q${q.id}"]:checked`);
                const labels = optionsContainer.querySelectorAll('label');

                labels.forEach(label => {
                    const input = label.querySelector('input');
                    label.classList.remove('correct-answer', 'incorrect-answer');
                    label.classList.remove('correct-label', 'incorrect-label');
                    input.disabled = true; // 檢查後禁用選項
                });
                
                if (selectedOption) {
                    const selectedLabel = selectedOption.parentElement;
                    if (selectedOption.value === q.correctAnswer) {
                        score++;
                        selectedLabel.classList.add('correct-answer', 'correct-label');
                    } else {
                        selectedLabel.classList.add('incorrect-answer', 'incorrect-label');
                        const correctLabel = optionsContainer.querySelector(`input[value="${q.correctAnswer}"]`).parentElement;
                        correctLabel.classList.add('correct-answer', 'correct-label');
                    }
                } else {
                    // 如果未作答，也標示出正確答案
                     const correctLabel = optionsContainer.querySelector(`input[value="${q.correctAnswer}"]`).parentElement;
                     correctLabel.classList.add('correct-answer');
                }
            });

            const resultEl = document.getElementById('result');
            resultEl.textContent = `你的分數: ${score} / ${quizData.length}`;
            if(score === quizData.length){
                resultEl.textContent += " 🎉 全部答對了，真厲害！";
                resultEl.style.color = '#16a34a';
            } else {
                 resultEl.style.color = '#dc2626';
            }

            // 滾動到結果位置
            resultEl.scrollIntoView({ behavior: 'smooth' });
        });
    </script>
</body>
</html>

