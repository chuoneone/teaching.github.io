<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNI4ç¿’ä½œE-H</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter for English, Noto Sans TC for Chinese -->
    <link rel="icon" href="dog.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }

        /* äº’å‹•å–®å­—æ¨£å¼ */
        .word {
            position: relative;
            cursor: pointer;
            border-bottom: 1px dotted #a8a29e; /* stone-400 */
            transition: color 0.2s;
        }

        .word:hover {
            color: #d97706; /* amber-600 */
        }

        /* ä¸­æ–‡ç¿»è­¯æç¤ºæ¡† (Tooltip) */
        .word .tooltip {
            visibility: hidden;
            width: max-content;
            background-color: #1f2937; /* gray-800 */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 10;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none; /* é¿å…æç¤ºæ¡†å¹²æ“¾æ»‘é¼ äº‹ä»¶ */
            font-size: 0.875rem;
        }

        .word:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        /* å´é‚Šæ¬„é¸å–®é …ç›®æ¿€æ´»ç‹€æ…‹ */
        .nav-item.active {
            background-color: #f59e0b; /* amber-500 */
            color: white;
        }
        
        /* è¡¨æ ¼æ¨£å¼ */
        .schedule-table th, .schedule-table td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body class="bg-amber-50 min-h-screen flex flex-col md:flex-row">

    <!-- å´é‚Šå°è¦½åˆ— (Desktop) / é ‚éƒ¨å°è¦½åˆ— (Mobile) -->
    <nav class="bg-white shadow-md w-full md:w-64 md:min-h-screen flex-shrink-0 md:flex md:flex-col z-10">
        <div class="p-4 border-b md:border-b-0 md:border-r border-gray-200 flex items-center justify-between md:block">
            <h1 class="text-xl font-bold text-stone-800">UNI4ç¿’ä½œE-H</h1>
        </div>
        <div class="flex md:flex-col overflow-x-auto md:overflow-visible">
            <button onclick="switchSection('E')" id="nav-E" class="nav-item active whitespace-nowrap flex-1 md:flex-none text-left px-6 py-4 md:py-3 hover:bg-amber-100 transition-colors border-b-4 border-transparent md:border-l-4 md:border-b-0 focus:outline-none">
                <span class="font-bold block text-sm text-stone-500 mb-1">Part E</span>
                <span class="font-semibold">ç¾åœ¨é€²è¡Œå¼</span>
            </button>
            <button onclick="switchSection('F')" id="nav-F" class="nav-item whitespace-nowrap flex-1 md:flex-none text-left px-6 py-4 md:py-3 hover:bg-amber-100 transition-colors border-b-4 border-transparent md:border-l-4 md:border-b-0 focus:outline-none">
                <span class="font-bold block text-sm text-stone-500 mb-1">Part F</span>
                <span class="font-semibold">ä¾ç•«ç·šé€ å•å¥</span>
            </button>
            <button onclick="switchSection('G')" id="nav-G" class="nav-item whitespace-nowrap flex-1 md:flex-none text-left px-6 py-4 md:py-3 hover:bg-amber-100 transition-colors border-b-4 border-transparent md:border-l-4 md:border-b-0 focus:outline-none">
                <span class="font-bold block text-sm text-stone-500 mb-1">Part G</span>
                <span class="font-semibold">çœ‹è¡¨å›ç­”å•é¡Œ</span>
            </button>
             <button onclick="switchSection('H')" id="nav-H" class="nav-item whitespace-nowrap flex-1 md:flex-none text-left px-6 py-4 md:py-3 hover:bg-amber-100 transition-colors border-b-4 border-transparent md:border-l-4 md:border-b-0 focus:outline-none">
                <span class="font-bold block text-sm text-stone-500 mb-1">Part H</span>
                <span class="font-semibold">é–±è®€æ¸¬é©—</span>
            </button>
        </div>
        <div class="mt-auto p-6 hidden md:block">
            <div class="text-xs text-stone-400 text-center">
                Interactive English Quiz<br>v5.0 (Final)
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="flex-1 p-4 md:p-8 flex items-start justify-center overflow-y-auto">
        <div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg w-full max-w-4xl transition-all duration-300">
            <div class="flex justify-between items-center mb-6">
                <h2 id="section-title" class="text-2xl font-bold text-stone-800">Part E: ç¾åœ¨é€²è¡Œå¼</h2>
                <span id="question-counter" class="text-stone-500 font-mono">1/3</span>
            </div>
            
            <!-- é€²åº¦æ¢ -->
            <div class="w-full bg-stone-200 rounded-full h-2.5 mb-8">
                <div id="progress-bar" class="bg-amber-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            
            <!-- é¡Œç›®å€åŸŸ -->
            <div id="questions-wrapper"></div>

            <!-- æ§åˆ¶å€ -->
            <div id="controls" class="mt-8 text-center"></div>
            
            <!-- åˆ†æ•¸é¡¯ç¤º -->
            <div id="score-display" class="mt-6 text-center hidden"></div>
        </div>
    </main>

    <!-- æç¤ºè¨Šæ¯ Modal -->
    <div id="alert-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center transform transition-all scale-100">
            <p id="alert-message" class="text-lg text-gray-800 mb-4"></p>
            <button id="close-alert-btn" class="bg-amber-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-amber-600 transition-colors">çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // --- è³‡æ–™å®šç¾©å€ ---
        const translations = {
            // åŸºç¤å–®å­—
            "the": "é€™å€‹", "in": "åœ¨...è£¡é¢", "under": "åœ¨...ä¸‹é¢", "on": "åœ¨...ä¸Šé¢", "at": "åœ¨",
            "a": "ä¸€å€‹", "is": "æ˜¯", "are": "æ˜¯(è¤‡æ•¸)", "and": "å’Œ", "with": "å’Œ...ä¸€èµ·",
            "old": "å¹´è€çš„", "tree": "æ¨¹", "boys": "ç”·å­©å€‘", "books": "æ›¸æœ¬", 
            "man": "ç”·äºº", "his": "ä»–çš„", "dog": "ç‹—", "park": "å…¬åœ’", "her": "å¥¹çš„",

            // Part E
            "lady": "å¥³å£«", "dancing": "æ­£åœ¨è·³èˆ", "dance": "è·³èˆ",
            "sitting": "æ­£åœ¨åè‘—", "sit": "å", "bench": "é•·æ¤…", "reading": "æ­£åœ¨é–±è®€", 
            "shaking": "æ­£åœ¨æ¡æ‰‹/æ–å‹•", "shake": "æ¡æ‰‹/æ–å‹•", "hands": "æ‰‹(è¤‡æ•¸)",
            "taking": "æ­£åœ¨é€²è¡Œ", "walk": "æ•£æ­¥",

            // Part F
            "may": "æ¢… (äººå)", "sleeping": "æ­£åœ¨ç¡è¦º", "sofa": "æ²™ç™¼",
            "where": "å“ªè£¡", "what": "ä»€éº¼", "who": "èª°", "doing": "æ­£åœ¨åš",
            "ken": "è‚¯ (äººå)", "jumping": "æ­£åœ¨è·³", "rope": "ç¹©å­", "jump": "è·³",
            "vicky": "ç¶­åŸº (äººå)", "talking": "æ­£åœ¨èªªè©±", "father": "çˆ¶è¦ª",

            // Part G
            "rachel": "ç‘ç§‹ (äººå)", "dennis": "ä¸¹å°¼æ–¯ (äººå)", "tiffany": "è’‚èŠ¬å¦® (äººå)",
            "saturday": "æ˜ŸæœŸå…­", "sunday": "æ˜ŸæœŸæ—¥", "afternoon": "ä¸‹åˆ", "now": "ç¾åœ¨",
            "listen": "è½", "music": "éŸ³æ¨‚", "play": "ç©/æ‰“", "basketball": "ç±ƒçƒ", "baseball": "æ£’çƒ",
            "study": "ç ”è®€", "english": "è‹±æ–‡", "watch": "è§€çœ‹", "tv": "é›»è¦–",
            "two": "äºŒ", "three": "ä¸‰", "ten": "å", "o'clock": "é»é˜",

            // Part H æ–°å¢å–®å­—
            "morning": "æ—©ä¸Š", "harry": "å“ˆåˆ© (äººå)", "white": "æ‡·ç‰¹ (å§“æ°)", "friend": "æœ‹å‹",
            "ron": "æ¦®æ© (äººå)", "brown": "å¸ƒæœ— (å§“æ°)", "sister": "å§Šå¦¹", "mary": "ç‘ªéº— (äººå)",
            "singing": "æ­£åœ¨å”±æ­Œ", "grandpa": "çˆºçˆº/å¤–å…¬", "family": "å®¶åº­/å®¶äºº", "farm": "è¾²å ´",
            "rabbit": "å…”å­", "some": "ä¸€äº›", "riding": "æ­£åœ¨é¨", "horse": "é¦¬", "parents": "çˆ¶æ¯",
            "grandma": "å¥¶å¥¶/å¤–å©†", "feeding": "æ­£åœ¨é¤µé£Ÿ", "feed": "é¤µ", "pig": "è±¬", "near": "åœ¨...é™„è¿‘",
            "evening": "å‚æ™š/æ™šä¸Š", "home": "å®¶", "having": "æ­£åœ¨èˆ‰è¡Œ/åƒ", "party": "æ´¾å°",
            "front": "å‰é¢", "house": "æˆ¿å­", "very": "éå¸¸", "happy": "å¿«æ¨‚çš„", "zoo": "å‹•ç‰©åœ’"
        };

        // é¡Œåº«è³‡æ–™
        const quizSections = {
            'E': {
                title: "Part E: ç¾åœ¨é€²è¡Œå¼å¡«ç©º",
                data: [
                    {
                        type: "choice",
                        question: "An old lady ______ (dance) under the tree.",
                        options: ["is dancing", "are dancing", "is danceing", "dancing"],
                        answer: "A",
                        hint: "ä¸»è© An old lady æ˜¯å–®æ•¸ï¼Œbeå‹•è©ç”¨ isã€‚dance å» e åŠ  ingã€‚"
                    },
                    {
                        type: "choice",
                        question: "Three boys ______ (sit) on the bench and reading their books.",
                        options: ["is sitting", "are siting", "are sitting", "sitting"],
                        answer: "C",
                        hint: "ä¸»è© Three boys æ˜¯è¤‡æ•¸ï¼Œbeå‹•è©ç”¨ areã€‚sit æ˜¯çŸ­æ¯éŸ³+å­éŸ³ï¼Œè¦é‡è¤‡å­—å°¾ t å†åŠ  ingã€‚"
                    },
                    {
                        type: "choice",
                        question: "A man ______ (shake) hands with his dog.",
                        options: ["is shaking", "are shaking", "is shakeing", "shaking"],
                        answer: "A",
                        hint: "ä¸»è© A man æ˜¯å–®æ•¸ï¼Œbeå‹•è©ç”¨ isã€‚shake å­—å°¾æœ‰ eï¼Œè¦å» e åŠ  ingã€‚"
                    }
                ]
            },
            'F': {
                title: "Part F: ä¾ç•«ç·šé€ å•å¥",
                data: [
                    {
                        type: "choice",
                        question: "May is sleeping <u>on the sofa</u>.",
                        options: ["Where is May sleeping?", "What is May doing?", "Who is sleeping?", "Is May sleeping?"],
                        answer: "A",
                        hint: "ç•«ç·šéƒ¨åˆ† 'on the sofa' æ˜¯åœ°é»ï¼Œè©¢å•åœ°é»è¦ç”¨ Where é–‹é ­ã€‚"
                    },
                    {
                        type: "choice",
                        question: "Ken is <u>jumping rope</u> at the park.",
                        options: ["Where is Ken jumping rope?", "What is Ken doing at the park?", "Who is jumping rope?", "Is Ken at the park?"],
                        answer: "B",
                        hint: "ç•«ç·šéƒ¨åˆ† 'jumping rope' æ˜¯å‹•ä½œï¼Œè©¢å•æ­£åœ¨åšä»€éº¼è¦ç”¨ What ... doingã€‚"
                    },
                    {
                        type: "choice",
                        question: "Vicky is talking with <u>her father</u>.",
                        options: ["What is Vicky doing?", "Where is Vicky talking?", "Who is Vicky talking with?", "Is Vicky talking?"],
                        answer: "C",
                        hint: "ç•«ç·šéƒ¨åˆ† 'her father' æ˜¯äººï¼Œè©¢å•è·Ÿèª°èªªè©±è¦ç”¨ Who é–‹é ­ã€‚"
                    }
                ]
            },
            'G': {
                title: "Part G: çœ‹è¡¨å›ç­”å•é¡Œ",
                data: [
                    {
                        type: "choice",
                        visualType: "schedule",
                        question: "Who is playing basketball at two o'clock on Saturday afternoon?",
                        options: ["Rachel is.", "Dennis is.", "Tiffany is."],
                        answer: "A",
                        hint: "æŸ¥çœ‹è¡¨æ ¼ä¸­ Saturday çš„ 14:00~16:30 æ¬„ä½ï¼ˆåŒ…å«ä¸‹åˆå…©é»ï¼‰ã€‚èª°çš„åœ–ç¤ºæ˜¯ç±ƒçƒ ğŸ€ï¼Ÿ"
                    },
                    {
                        type: "choice",
                        visualType: "schedule",
                        question: "It is 3 p.m. on Saturday. What is Dennis doing now?",
                        options: ["He is watching TV.", "He is playing basketball.", "He is studying English."],
                        answer: "A",
                        hint: "æŸ¥çœ‹ Dennis åœ¨ Saturday ä¸‹åˆ 3é» (14:00~16:30) çš„æ´»å‹•åœ–ç¤ºæ˜¯é›»è¦– ğŸ“ºã€‚"
                    },
                    {
                        type: "choice",
                        visualType: "schedule",
                        question: "It is 10 a.m., and Tiffany is studying English. What day is it?",
                        options: ["It is Sunday.", "It is Saturday.", "It is Friday."],
                        answer: "A",
                        hint: "æ‰¾åˆ° Tiffany è®€è‹±æ–‡ (ğŸ“–) çš„åœ–ç¤ºã€‚å®ƒæ˜¯åœ¨ Sunday çš„ 10:00~12:00 æ¬„ä½ã€‚"
                    }
                ]
            },
             'H': {
                title: "Part H: é–±è®€æ¸¬é©—",
                visualType: "article",
                articleContent: `
                    <div class="mb-6 text-lg leading-relaxed text-stone-700 space-y-4 bg-stone-50 p-6 rounded-lg border border-stone-200">
                        <p>
                            It is morning now. Harry White is at the park. He is playing basketball with his friend, Ron Brown. Harry's sister, Mary, is singing and dancing with her grandpa.
                        </p>
                        <p>
                            It is afternoon. Harry and his family are on a farm. Mary is playing with some rabbits, and Harry is riding a horse. Their parents are sitting under a tree and talking to an old man. Their grandma and grandpa are feeding the pigs near the tree.
                        </p>
                        <p>
                            It is evening now. The White family is at home. They are having a party under the tree in front of their house. They are very happy.
                        </p>
                    </div>
                `,
                data: [
                    {
                        type: "choice",
                        question: "Who is Harry playing with in the morning?",
                        options: ["His sister.", "His friend.", "His parents.", "His grandma and grandpa."],
                        answer: "B",
                        hint: "æ–‡ç« ç¬¬ä¸€æ®µæåˆ°ï¼šHe is playing basketball with his friend, Ron Brown."
                    },
                    {
                        type: "choice",
                        question: "Where is the White family's party?",
                        options: ["In a zoo.", "On a farm.", "At a park.", "In front of their house."],
                        answer: "D",
                        hint: "æ–‡ç« æœ€å¾Œä¸€æ®µæåˆ°ï¼šThey are having a party... in front of their house."
                    },
                    {
                        type: "choice",
                        question: "What is Harry's father doing on the farm?",
                        options: ["He is having a party with his family.", "He is singing and dancing with Mary.", "He is feeding the pigs with his parents.", "He is sitting under a tree and talking to a man."],
                        answer: "D",
                        hint: "æ–‡ç« ç¬¬äºŒæ®µæåˆ°ï¼šTheir parents are sitting under a tree and talking to an old man."
                    }
                ]
            }
        };

        // --- å…¨åŸŸè®Šæ•¸ ---
        let currentSectionId = 'E';
        let currentData = quizSections['E'].data;
        let currentQuestionIndex = 0;
        let score = 0;

        // --- DOM å…ƒç´  ---
        const questionsWrapper = document.getElementById('questions-wrapper');
        const controlsContainer = document.getElementById('controls');
        const scoreDisplay = document.getElementById('score-display');
        const progressBar = document.getElementById('progress-bar');
        const sectionTitle = document.getElementById('section-title');
        const questionCounter = document.getElementById('question-counter');
        const alertModal = document.getElementById('alert-modal');
        const alertMessage = document.getElementById('alert-message');
        const closeAlertBtn = document.getElementById('close-alert-btn');

        // --- è¼”åŠ©è¦–è¦ºç”¢ç”Ÿå‡½å¼ ---

        function createScheduleVisual() {
            return `
                <div class="overflow-x-auto mb-6 border rounded-lg shadow-sm">
                    <table class="w-full text-sm text-left text-gray-500 schedule-table">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th class="bg-white border-0"></th>
                                <th colspan="2" class="bg-red-100 text-red-800 text-center text-lg">Saturday</th>
                                <th colspan="2" class="bg-purple-100 text-purple-800 text-center text-lg">Sunday</th>
                            </tr>
                            <tr>
                                <th class="bg-gray-100">Name</th>
                                <th class="bg-red-50">9:30~11:30</th>
                                <th class="bg-red-50">14:00~16:30</th>
                                <th class="bg-purple-50">10:00~12:00</th>
                                <th class="bg-purple-50">14:00~17:00</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-white border-b">
                                <th class="font-medium text-gray-900 bg-gray-50">
                                    <div class="flex flex-col items-center">
                                        <span class="text-2xl">ğŸ‘§ğŸ»</span>
                                        <span>Rachel</span>
                                    </div>
                                </th>
                                <td class="text-center"><span class="text-3xl" title="Listen to music">ğŸ§</span></td>
                                <td class="text-center"><span class="text-3xl" title="Play basketball">ğŸ€</span></td>
                                <td class="text-center"><span class="text-3xl" title="Watch TV">ğŸ“º</span></td>
                                <td class="text-center"><span class="text-3xl" title="Study English">ğŸ“–</span></td>
                            </tr>
                            <tr class="bg-white border-b">
                                <th class="font-medium text-gray-900 bg-gray-50">
                                    <div class="flex flex-col items-center">
                                        <span class="text-2xl">ğŸ‘¦ğŸ»</span>
                                        <span>Dennis</span>
                                    </div>
                                </th>
                                <td class="text-center"><span class="text-3xl" title="Study English">ğŸ“–</span></td>
                                <td class="text-center"><span class="text-3xl" title="Watch TV">ğŸ“º</span></td>
                                <td class="text-center"><span class="text-3xl" title="Play basketball">ğŸ€</span></td>
                                <td class="text-center"><span class="text-3xl" title="Listen to music">ğŸ§</span></td>
                            </tr>
                            <tr class="bg-white">
                                <th class="font-medium text-gray-900 bg-gray-50">
                                    <div class="flex flex-col items-center">
                                        <span class="text-2xl">ğŸ‘§ğŸ½</span>
                                        <span>Tiffany</span>
                                    </div>
                                </th>
                                <td class="text-center"><span class="text-3xl" title="Play basketball">ğŸ€</span></td>
                                <td class="text-center"><span class="text-3xl" title="Listen to music">ğŸ§</span></td>
                                <td class="text-center"><span class="text-3xl" title="Study English">ğŸ“–</span></td>
                                <td class="text-center"><span class="text-3xl" title="Play baseball">âš¾</span></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="flex flex-wrap gap-4 justify-center p-3 bg-gray-50 text-xs text-gray-600">
                        <div class="flex items-center gap-1">ğŸ§ listen to music</div>
                        <div class="flex items-center gap-1">ğŸ€ play basketball</div>
                        <div class="flex items-center gap-1">ğŸ“– study English</div>
                        <div class="flex items-center gap-1">âš¾ play baseball</div>
                        <div class="flex items-center gap-1">ğŸ“º watch TV</div>
                    </div>
                </div>
            `;
        }

        // --- æ ¸å¿ƒåŠŸèƒ½å‡½å¼ ---

        function createInteractiveText(text) {
            const parts = text.split(/([a-zA-Z'â€™\-]+)/);
            return parts.map(part => {
                if (part.match(/[<>]/)) return part;

                const cleanPart = part.toLowerCase().replace(/â€™/g, "'").replace(/[^a-z\-]/g, "");
                if (translations[cleanPart]) {
                    return `<span class="word" onclick="event.stopPropagation(); speak('${part}')">${part}<span class="tooltip">${translations[cleanPart]}</span></span>`;
                }
                return part;
            }).join('');
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const cleanText = text.replace(/<[^>]*>/g, "");
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        }

        function createSpeakerIcon(textToSpeak) {
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "h-5 w-5 text-amber-600 hover:text-amber-800 cursor-pointer flex-shrink-0");
            svg.setAttribute("viewBox", "0 0 20 20");
            svg.setAttribute("fill", "currentColor");
            
            const path = document.createElementNS(svgNS, "path");
            path.setAttribute("fill-rule", "evenodd");
            path.setAttribute("d", "M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.016 5.39a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 11-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026zM14.07 3.33a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 01-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026z");
            path.setAttribute("clip-rule", "evenodd");
            svg.appendChild(path);
            
            svg.onclick = (e) => { 
                e.stopPropagation(); 
                speak(textToSpeak); 
            };
            return svg;
        }

        // --- å°è¦½èˆ‡ç‹€æ…‹åˆ‡æ› ---

        window.switchSection = function(sectionId) {
            currentSectionId = sectionId;
            
            if (!quizSections[sectionId]) return;

            currentData = quizSections[sectionId].data;
            currentQuestionIndex = 0;
            score = 0;
            
            sectionTitle.textContent = quizSections[sectionId].title;
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
                el.classList.remove('bg-amber-500', 'text-white');
            });
            
            const activeBtn = document.getElementById(`nav-${sectionId}`);
            if(activeBtn) activeBtn.classList.add('active');

            scoreDisplay.classList.add('hidden');
            questionsWrapper.classList.remove('hidden');
            
            displayQuestion(0);
        };

        function displayQuestion(index) {
            questionsWrapper.innerHTML = '';
            controlsContainer.innerHTML = '';
            questionCounter.textContent = `${index + 1}/${currentData.length}`;
            
            const progressPercentage = (index / currentData.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;

            const q = currentData[index];
            const currentSection = quizSections[currentSectionId]; // Get the current section object

            const questionBlock = document.createElement('div');
            questionBlock.className = 'animate-fade-in';
            
            // æ’å…¥è¦–è¦ºè¼”åŠ© 
            if (q.visualType === 'schedule') {
                questionBlock.innerHTML += createScheduleVisual();
            } else if (currentSection.visualType === 'article') { // Check section type for article
                 // Apply createInteractiveText to the article content as well!
                 questionBlock.innerHTML += `<div class="article-container">${createInteractiveText(currentSection.articleContent)}</div>`;
            }


            // é¡Œç›®æ–‡å­—
            const questionText = document.createElement('p');
            questionText.className = 'text-lg text-stone-700 mb-4 flex items-center gap-2 flex-wrap';
            
            let cleanQText = q.question.replace(/<br>/g, ' ').replace(/______/g, 'blank');
            const speaker = createSpeakerIcon(cleanQText);
            
            const textSpan = document.createElement('span');
            textSpan.innerHTML = `<strong>${index + 1}.</strong> ${createInteractiveText(q.question)}`;
            
            questionText.appendChild(speaker);
            questionText.appendChild(textSpan);
            questionBlock.appendChild(questionText);

            // æ¸²æŸ“é¸é …
            renderChoiceOptions(q, index, questionBlock);

            // æç¤ºæŒ‰éˆ•
            renderHint(q, questionBlock);

            questionsWrapper.appendChild(questionBlock);

            // æäº¤æŒ‰éˆ•
            const submitButton = document.createElement('button');
            submitButton.className = 'w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-600 transition-colors focus:outline-none focus:ring-2 focus:ring-amber-400 focus:ring-opacity-50';
            submitButton.textContent = 'æª¢æŸ¥ç­”æ¡ˆ';
            submitButton.onclick = () => checkAnswer(index);
            controlsContainer.appendChild(submitButton);
        }

        function renderChoiceOptions(q, index, container) {
            const optionsGrid = document.createElement('div');
            // å¦‚æœæ˜¯é–±è®€æ¸¬é©—ï¼Œé¸é …å¯èƒ½è¼ƒé•·ï¼Œå¼·åˆ¶å–®åˆ—é¡¯ç¤º
            const isLongOption = q.options.some(opt => opt.length > 25);
            optionsGrid.className = `grid ${isLongOption ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-1 md:grid-cols-2'} gap-3 mb-4`;
            
            q.options.forEach((option, i) => {
                const optionChar = String.fromCharCode(65 + i);
                const optionContainer = document.createElement('div');
                optionContainer.className = 'flex items-center p-3 border border-stone-300 rounded-lg transition-all cursor-pointer hover:bg-amber-50';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.id = `q${index}-opt${optionChar}`;
                radio.name = `q${index}`;
                radio.value = optionChar;
                radio.className = 'h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300';

                const label = document.createElement('label');
                label.htmlFor = `q${index}-opt${optionChar}`;
                label.className = 'ml-3 block text-md text-stone-900 flex-1 cursor-pointer flex items-center gap-2';
                
                label.appendChild(createSpeakerIcon(option));
                const textSpan = document.createElement('span');
                textSpan.innerHTML = `(${optionChar}) ${createInteractiveText(option)}`;
                label.appendChild(textSpan);

                optionContainer.onclick = () => { radio.checked = true; };
                optionContainer.appendChild(radio);
                optionContainer.appendChild(label);
                optionsGrid.appendChild(optionContainer);
            });
            container.appendChild(optionsGrid);
        }

        function renderHint(q, container) {
            const hintContainer = document.createElement('div');
            hintContainer.className = 'mt-2';
            const hintButton = document.createElement('button');
            hintButton.className = 'text-sm text-amber-600 hover:text-amber-800 flex items-center gap-1';
            hintButton.innerHTML = '<span>ğŸ’¡</span> æç¤º';
            
            const hintText = document.createElement('p');
            hintText.className = 'hint-content hidden mt-2 text-sm text-stone-600 bg-yellow-50 border border-yellow-100 p-3 rounded-md';
            hintText.textContent = q.hint;
            
            hintButton.onclick = () => hintText.classList.toggle('hidden');
            hintContainer.appendChild(hintButton);
            hintContainer.appendChild(hintText);
            container.appendChild(hintContainer);
        }

        function checkAnswer(index) {
            const q = currentData[index];
            let isCorrect = false;
            
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (!selected) {
                showAlert("è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼");
                return;
            }
            const userAnswer = selected.value;
            isCorrect = (userAnswer === q.answer);

            controlsContainer.innerHTML = ''; 
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `mt-4 p-4 rounded-lg ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`;
            
            if (isCorrect) {
                score++;
                resultDiv.innerHTML = `
                    <p class="text-green-700 font-bold flex items-center gap-2">
                        <span class="text-xl">âœ”ï¸</span> ç­”å°äº†ï¼
                    </p>
                    <p class="text-green-600 mt-1">${q.answer}</p>
                `;
                let speakText = q.answer;
                const correctIndex = q.answer.charCodeAt(0) - 65;
                if (q.options[correctIndex]) {
                    speakText = q.options[correctIndex];
                }
                speak(speakText);
            } else {
                let correctText = q.answer;
                const correctIndex = q.answer.charCodeAt(0) - 65;
                correctText = q.options[correctIndex];
                
                resultDiv.innerHTML = `
                    <p class="text-red-700 font-bold flex items-center gap-2">
                        <span class="text-xl">âŒ</span> ç­”éŒ¯äº†
                    </p>
                    <p class="text-stone-600 mt-1">æ­£ç¢ºç­”æ¡ˆï¼š<span class="font-bold text-stone-800">${createInteractiveText(correctText)}</span></p>
                `;
            }

            document.querySelectorAll(`input[name="q${index}"]`).forEach(el => el.disabled = true);

            questionsWrapper.appendChild(resultDiv);

            const nextButton = document.createElement('button');
            nextButton.className = 'w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-600 transition-colors mt-4';
            
            if (currentQuestionIndex < currentData.length - 1) {
                nextButton.textContent = 'ä¸‹ä¸€é¡Œ';
                nextButton.onclick = () => {
                    currentQuestionIndex++;
                    displayQuestion(currentQuestionIndex);
                };
            } else {
                nextButton.textContent = 'æŸ¥çœ‹æˆç¸¾';
                nextButton.onclick = showFinalScore;
            }
            controlsContainer.appendChild(nextButton);
        }

        function showFinalScore() {
            progressBar.style.width = '100%';
            questionsWrapper.innerHTML = '';
            controlsContainer.innerHTML = '';
            sectionTitle.textContent = 'æ¸¬é©—å®Œæˆ';

            scoreDisplay.innerHTML = `
                <div class="py-8">
                    <p class="text-xl text-stone-600">ä½ çš„æœ€çµ‚åˆ†æ•¸</p>
                    <p class="text-6xl font-bold my-4 text-amber-500">${score} <span class="text-2xl text-stone-400">/ ${currentData.length}</span></p>
                    <div class="flex justify-center gap-4 mt-6">
                        <button onclick="location.reload()" class="px-6 py-2 border border-stone-300 rounded-lg hover:bg-stone-50 text-stone-600">é‡ç½®æ¸¬é©—</button>
                        <button onclick="switchSection('${currentSectionId}')" class="px-6 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 shadow-md">å†ç·´ç¿’ä¸€æ¬¡</button>
                    </div>
                </div>
            `;
            scoreDisplay.classList.remove('hidden');
        }

        function showAlert(msg) {
            alertMessage.textContent = msg;
            alertModal.classList.remove('hidden');
        }

        closeAlertBtn.addEventListener('click', () => {
            alertModal.classList.add('hidden');
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // é è¨­é¡¯ç¤º Part Eï¼Œä¸¦æ¨™è¨˜å°è¦½åˆ—
            switchSection('E');
        });
    </script>
</body>
</html>