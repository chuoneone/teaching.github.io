<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 3 æ–‡æ³•é¸æ“‡ç·´ç¿’</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter for English, Noto Sans TC for Chinese -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="dog.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }

        /* äº’å‹•å–®å­—æ¨£å¼ */
        .word {
            position: relative;
            cursor: pointer;
            border-bottom: 1px dotted #a8a29e; /* stone-400 */
            transition: color 0.2s;
        }

        .word:hover {
            color: #d97706; /* amber-600 */
        }

        /* ä¸­æ–‡ç¿»è­¯æç¤ºæ¡† (Tooltip) */
        .word .tooltip {
            visibility: hidden;
            width: max-content;
            background-color: #1f2937; /* gray-800 */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 10;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none; /* é¿å…æç¤ºæ¡†å¹²æ“¾æ»‘é¼ äº‹ä»¶ */
        }

        .word:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-amber-50 flex items-center justify-center min-h-screen p-4">

    <!-- æ¸¬é©—ä¸»å®¹å™¨ -->
    <div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg w-full max-w-3xl">
        <h1 class="text-2xl sm:text-3xl font-bold text-stone-800 text-center mb-2">Unit 3 æ–‡æ³•é¸æ“‡ç·´ç¿’</h1>
        <p class="text-center text-stone-600 mb-4">Class: _____&nbsp;&nbsp;&nbsp; Name: __________</p>
        
        <!-- é€²åº¦æ¢ -->
        <div class="w-full bg-stone-200 rounded-full h-2.5 mb-6">
            <div id="progress-bar" class="bg-amber-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
        
        <!-- é¡Œç›®å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆæ–¼æ­¤ -->
        <div id="questions-wrapper"></div>

        <!-- åŠŸèƒ½æŒ‰éˆ•èˆ‡åˆ†æ•¸é¡¯ç¤ºå€ -->
        <div id="controls" class="mt-8 text-center">
            <!-- æŒ‰éˆ•å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
        <div id="score-display" class="mt-6 text-center hidden"></div>
    </div>

    <!-- æç¤ºè¨Šæ¯ Modal -->
    <div id="alert-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-20">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
            <p id="alert-message" class="text-lg text-gray-800 mb-4"></p>
            <button id="close-alert-btn" class="bg-amber-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-amber-600 transition-colors">çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- è³‡æ–™å®šç¾©å€ ---
            // æ›´æ–°çš„ç¿»è­¯å­—å…¸
            const translations = {
                // åŸæœ‰å–®å­—
                "what's": "ä»€éº¼æ˜¯", "what": "ä»€éº¼", "the": "é€™å€‹", "today": "ä»Šå¤©", "it's": "å®ƒæ˜¯", "may": "äº”æœˆ",
                "time": "æ™‚é–“", "day": "å¤©", "month": "æœˆä»½", "date": "æ—¥æœŸ", "when": "ä½•æ™‚", "is": "æ˜¯", "her": "å¥¹çš„/å¥¹(å—æ ¼)",
                "school": "å­¸æ ¡", "november": "åä¸€æœˆ", "on": "åœ¨", "in": "åœ¨...è£¡é¢", "your": "ä½ çš„", "birthday": "ç”Ÿæ—¥",
                "oh": "å“¦", "also": "ä¹Ÿ", "new": "æ–°çš„", "year's": "å¹´çš„", "at": "åœ¨", "nine": "ä¹", "thirty": "ä¸‰å",
                "january": "ä¸€æœˆ", "first": "ç¬¬ä¸€", "december": "åäºŒæœˆ", "this": "é€™å€‹", "boy": "ç”·å­©", "has": "æœ‰",
                "beautiful": "ç¾éº—çš„", "eyes": "çœ¼ç›", "and": "å’Œ", "long": "é•·çš„", "hair": "é ­é«®", "i": "æˆ‘",
                "like": "å–œæ­¡", "him": "ä»–(å—æ ¼)", "very": "éå¸¸", "much": "å¾ˆå¤š", "he": "ä»–(ä¸»æ ¼)", "his": "ä»–çš„", "he's": "ä»–æ˜¯",
                "hi": "å—¨", "i'm": "æˆ‘æ˜¯", "nice": "é«˜èˆˆçš„", "to": "å»", "meet": "é‡è¦‹", "you": "ä½ ", "too": "ä¹Ÿ", "see": "çœ‹åˆ°",
                "you're": "ä½ æ˜¯", "welcome": "ä¸å®¢æ°£", "excuse": "è«‹å•", "me": "æˆ‘(å—æ ¼)", "are": "æ˜¯", "mr.": "å…ˆç”Ÿ", "walker": "æ²ƒå…‹",
                "yes": "æ˜¯çš„", "larry": "è³´ç‘", "no": "ä¸æ˜¯", "not": "ä¸", "friend": "æœ‹å‹", "who's": "èª°æ˜¯", "that": "é‚£å€‹",
                "girl": "å¥³å­©", "she": "å¥¹(ä¸»æ ¼)", "really": "çœŸçš„", "tall": "é«˜çš„", "a": "ä¸€å€‹", "happy": "å¿«æ¨‚çš„", "she's": "å¥¹æ˜¯",
                "ariel": "æ„›éº—å…’", "our": "æˆ‘å€‘çš„", "classmate": "åŒå­¸", "eric's": "è‰¾ç‘å…‹çš„", "aunt": "é˜¿å§¨", "writer": "ä½œå®¶",
                "doctor": "é†«ç”Ÿ", "housewife": "å®¶åº­ä¸»å©¦", "how": "å¦‚ä½•", "old": "å¹´è€çš„", "alice": "æ„›éº—çµ²", "brad": "å¸ƒèŠå¾·",
                "they": "ä»–å€‘(ä¸»æ ¼)", "my": "æˆ‘çš„", "family": "å®¶åº­", "ten": "å", "twelve": "åäºŒ", "cook": "çƒ¹é£ª/å»šå¸«", "nurse": "è­·å£«",
                "they're": "ä»–å€‘æ˜¯", "erasers": "æ©¡çš®æ“¦", "where": "åœ¨å“ªè£¡", "those": "é‚£äº›", "these": "é€™äº›", "pens": "ç­†(è¤‡æ•¸)", 
                "aren't": "ä¸æ˜¯", "for": "çµ¦/ç‚ºäº†", "desk": "æ›¸æ¡Œ", "where's": "åœ¨å“ªè£¡", "notebook": "ç­†è¨˜æœ¬", "from": "å¾", 
                "uncle": "å”å”/ä¼¯ä¼¯", "under": "åœ¨...ä¸‹é¢", "chair": "æ¤…å­", "enough": "è¶³å¤ çš„", "one": "ä¸€", "person": "äºº", 
                "favorite": "æœ€å–œæ­¡çš„", "color": "é¡è‰²", "gray": "ç°è‰²", "purple": "ç´«è‰²", "table": "æ¡Œå­", "isn't": "ä¸æ˜¯", 
                "red": "ç´…è‰²", "watch": "æ‰‹éŒ¶", "special": "ç‰¹åˆ¥çš„", "parents": "çˆ¶æ¯", "home": "å®¶", "we": "æˆ‘å€‘(ä¸»æ ¼)", "park": "å…¬åœ’", 
                "house": "æˆ¿å­", "maybe": "ä¹Ÿè¨±", "kitchen": "å»šæˆ¿", "jenny": "çå¦®", "bag": "åŒ…åŒ…", "sofa": "æ²™ç™¼", 
                "sure": "ç•¶ç„¶/ç¢ºå®šçš„", "look": "çœ‹", "sign": "æ¨™ç¤º", "now": "ç¾åœ¨", "please": "è«‹", "write": "å¯«", "down": "ä¸‹", 
                "name": "åå­—", "sorry": "æŠ±æ­‰", "can't": "ä¸èƒ½", "turn": "è¼ªæµ", "can": "èƒ½", "wait": "ç­‰å¾…", "here": "é€™è£¡", 
                "wash": "æ´—", "dog": "ç‹—",
                
                // --- Unit 3 æ–°å¢å–®å­— ---
                "nick": "å°¼å…‹", "be": "æ˜¯(åŸå½¢)", "let's": "è®“æˆ‘å€‘", "play": "ç©", "game": "éŠæˆ²", "ok": "å¥½çš„", "don't": "ä¸è¦",
                "sing": "å”±æ­Œ", "library": "åœ–æ›¸é¤¨", "close": "é—œä¸Š", "book": "æ›¸", "lily": "è‰è‰", "run": "è·‘", 
                "living room": "å®¢å»³", "boys": "ç”·å­©å€‘", "john": "ç´„ç¿°", "stand up": "ç«™èµ·ä¾†", "eat": "åƒ", "talk": "èªªè©±",
                "clean": "æ‰“æƒ", "room": "æˆ¿é–“", "dirty": "é«’çš„", "students": "å­¸ç”Ÿå€‘", "song": "æ­Œæ›²", "mother": "åª½åª½",
                "father": "çˆ¸çˆ¸", "bird": "é³¥", "hello": "å“ˆå›‰", "people": "äººå€‘", "speak": "èªª", "say": "èªª",
                "bob": "é®‘ä¼¯", "jump": "è·³", "tennis": "ç¶²çƒ", "spell": "æ‹¼å­—", "tony": "æ¹¯å°¼", "in front of": "åœ¨...å‰é¢",
                "kelly's": "å‡±è‰çš„", "gift": "ç¦®ç‰©", "two": "äºŒ", "dolls": "å¨ƒå¨ƒ(è¤‡æ•¸)", "them": "ä»–å€‘(å—æ ¼)",
                "their": "ä»–å€‘çš„", "sister": "å§Šå¦¹", "with": "å’Œ...ä¸€èµ·", "us": "æˆ‘å€‘(å—æ ¼)"
            };

            // æ›´æ–°çš„é¡Œç›®è³‡æ–™
            const quizData = [
                {
                    question: "Nick, _____ happy.",
                    options: ["X", "be", "is", "do"],
                    answer: "B",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚ç¥ˆä½¿å¥ä¸­è¦æ±‚å°æ–¹ã€Œè¦ï¼ˆä¿æŒï¼‰å¿«æ¨‚ã€æ™‚ï¼Œå‹•è©è¦ç”¨åŸå½¢ beã€‚'happy' æ˜¯å½¢å®¹è©ï¼Œå‰é¢è¦ç”¨ be å‹•è©ã€‚"
                },
                {
                    question: "A: Letâ€™s _____ play the game now. B: OK.",
                    options: ["no", "not", "be not", "donâ€™t"],
                    answer: "B",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚Let's çš„å¦å®šå¥å‹ç‚ºã€ŒLet's not + åŸå½¢å‹•è©ã€ã€‚"
                },
                {
                    question: "_____ sing in the library.",
                    options: ["Not", "Letâ€™s", "Donâ€™t", "Please"],
                    answer: "C",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚å¦å®šçš„ç¥ˆä½¿å¥ï¼ˆå«äººä¸è¦åšæŸäº‹ï¼‰é–‹é ­è¦ç”¨ Don't + åŸå½¢å‹•è©ã€‚"
                },
                {
                    question: "Close your book, _____.",
                    options: ["please Lily", "Lily", "Lily please", "please to"],
                    answer: "B",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚ç¥ˆä½¿å¥ä¸­å‘¼å«å°æ–¹ï¼ˆäººåï¼‰æ™‚ï¼Œäººåè¦ç”¨é€—è™Ÿéš”é–‹ã€‚'Close your book, Lily.' æ˜¯æ­£ç¢ºçš„ç”¨æ³•ã€‚"
                },
                {
                    question: "_____ run in the living room, boys.",
                    options: ["Not", "Donâ€™t be", "No", "Donâ€™t"],
                    answer: "D",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚å¦å®šçš„ç¥ˆä½¿å¥ï¼ˆå«äººä¸è¦åšæŸäº‹ï¼‰é–‹é ­è¦ç”¨ Don't + åŸå½¢å‹•è© (run)ã€‚"
                },
                {
                    question: "_____, stand up.",
                    options: ["John", "Please", "Donâ€™t", "Letâ€™s"],
                    answer: "A",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚'Please' æ”¾åœ¨å¥é¦–ï¼Œå¾Œé¢åŠ ä¸Šé€—è™Ÿï¼Œç”¨ä¾†è¡¨ç¤ºç¦®è²Œçš„è«‹æ±‚ã€‚"
                },
                {
                    question: "_____ not eat or talk here.",
                    options: ["No", "Letâ€™s", "Be", "Donâ€™t"],
                    answer: "B",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚'Let's not...' æ˜¯ç”¨ä¾†å»ºè­°ã€Œæˆ‘å€‘ä¸è¦ã€åšæŸäº‹ã€‚å¥å‹ç‚º Let's + not + åŸå½¢å‹•è©ã€‚"
                },
                {
                    question: "_____ your room. Itâ€™s very dirty.",
                    options: ["Be", "Letâ€™s", "Clean", "Not clean"],
                    answer: "C",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚'Clean' (æ‰“æƒ) æ˜¯åŸå½¢å‹•è©ï¼Œç”¨åœ¨ç¥ˆä½¿å¥å¥é¦–ï¼Œè¡¨ç¤ºå‘½ä»¤æˆ–è«‹æ±‚ã€‚"
                },
                {
                    question: "é¸å‡ºéŒ¯èª¤çš„å¥å­ã€‚",
                    options: ["Please sing the song, students.", "Please, students sing the song.", "Students, please sing the song.", "Students, sing the song, please."],
                    answer: "B",
                    hint: "å¥å‹ä¸€: ç¥ˆä½¿å¥ã€‚é¸é … (B) æ˜¯éŒ¯èª¤çš„ã€‚'Please' å’Œäººå 'students' éƒ½æ˜¯ç¥ˆä½¿å¥çš„é™„åŠ èªï¼Œäººå 'students' æ‡‰è©²ç”¨é€—è™Ÿéš”é–‹ï¼Œä¸” 'students' ä¸è©²æ”¾åœ¨ 'Please' å’Œå‹•è©ä¹‹é–“è€Œä¸åŠ é€—è™Ÿã€‚"
                },
                {
                    question: "A: Can your mother cook? B: No, but my father _____.",
                    options: ["cook", "is", "can", "canâ€™t"],
                    answer: "C",
                    hint: "å¥å‹äºŒ: cançš„ç”¨æ³•ã€‚å•å¥ç”¨ Canï¼Œå›ç­”ä¹Ÿç”¨ canã€‚B å›ç­”ã€Œä¸ï¼Œä½†æˆ‘çˆ¸çˆ¸ *æœƒ*ã€‚ã€ï¼Œ'can' æ‰¿æ¥äº† 'can cook' çš„æ„æ€ã€‚"
                },
                {
                    question: "The bird can _____ hello to people.",
                    options: ["speak", "speaking", "saying", "say"],
                    answer: "D",
                    hint: "å¥å‹äºŒ: cançš„ç”¨æ³•ã€‚åŠ©å‹•è© 'can' å¾Œé¢å¿…é ˆæ¥åŸå½¢å‹•è©ã€‚'say hello' (èªªå“ˆå›‰) æ˜¯å›ºå®šç”¨æ³•ã€‚"
                },
                {
                    question: "A: Can you jump? B: Yes, I _____.",
                    options: ["am", "can", "jump", "do"],
                    answer: "B",
                    hint: "å¥å‹äºŒ: cançš„ç”¨æ³•ã€‚ç”¨ 'Can' å•ï¼Œå°±ç”¨ 'can' (æˆ– 'can't') å›ç­”ã€‚'Yes, I can.'"
                },
                {
                    question: "A: Can they play tennis? B: No, ______________.",
                    options: ["they canâ€™t", "they canâ€™t play", "I can", "we canâ€™t"],
                    answer: "A",
                    hint: "å¥å‹äºŒ: cançš„ç”¨æ³•ã€‚å•å¥çš„ä¸»è©æ˜¯ 'they'ï¼Œæ‰€ä»¥ç°¡ç­”çš„ä¸»è©ä¹Ÿæ˜¯ 'they'ã€‚å¦å®šç°¡ç­”ç‚º 'No, they canâ€™t.'"
                },
                {
                    question: "A: Can you spell â€œhappyâ€? B: Sure, I _____. â€œH-A-P-P-Y.â€",
                    options: ["can", "do", "may", "am"],
                    answer: "A",
                    hint: "å¥å‹äºŒ: cançš„ç”¨æ³•ã€‚ç”¨ 'Can' å•èƒ½åŠ›ï¼Œå›ç­”æ™‚ä¹Ÿç”¨ 'can' è¡¨ç¤ºã€Œæˆ‘èƒ½ã€ã€‚"
                },
                {
                    question: "Tony is in front of _____.",
                    options: ["I", "am", "my", "me"],
                    answer: "D",
                    hint: "å¥å‹ä¸‰: å—æ ¼çš„ç”¨æ³•ã€‚'in front of' (åœ¨...å‰é¢) æ˜¯ä»‹ä¿‚è©ç‰‡èªï¼Œä»‹ä¿‚è© (of) å¾Œé¢è¦ä½¿ç”¨å—æ ¼ä»£åè© 'me'ã€‚"
                },
                {
                    question: "Today is Kellyâ€™s birthday. I have a gift for_____.",
                    options: ["she", "her", "his", "he"],
                    answer: "B",
                    hint: "å¥å‹ä¸‰: å—æ ¼çš„ç”¨æ³•ã€‚ä»‹ä¿‚è© 'for' (çµ¦) å¾Œé¢è¦ä½¿ç”¨å—æ ¼ä»£åè©ã€‚Kelly æ˜¯å¥³æ€§ï¼Œæ‰€ä»¥ç”¨ 'her'ã€‚"
                },
                {
                    question: "I have two dolls. I like _____.",
                    options: ["them", "they", "their", "we"],
                    answer: "A",
                    hint: "å¥å‹ä¸‰: å—æ ¼çš„ç”¨æ³•ã€‚å‹•è© 'like' (å–œæ­¡) å¾Œé¢è¦æ¥å—è©ã€‚'two dolls' (å…©å€‹å¨ƒå¨ƒ) æ˜¯è¤‡æ•¸ï¼Œä»£åè©å—æ ¼ç”¨ 'them'ã€‚"
                },
                {
                    question: "A: Are you and your sister in the living room? B: Yes, my parents are with _____.",
                    options: ["we", "our", "us", "the"],
                    answer: "C",
                    hint: "å¥å‹ä¸‰: å—æ ¼çš„ç”¨æ³•ã€‚ä»‹ä¿‚è© 'with' (å’Œ...ä¸€èµ·) å¾Œé¢è¦ä½¿ç”¨å—æ ¼ä»£åè©ã€‚'you and your sister' æŒ‡çš„æ˜¯ã€Œæˆ‘å€‘ã€ï¼Œå—æ ¼æ˜¯ 'us'ã€‚"
                }
            ];


            // --- ç‹€æ…‹è®Šæ•¸ ---
            let currentQuestionIndex = 0;
            let score = 0;

            // --- DOM å…ƒç´  ---
            const questionsWrapper = document.getElementById('questions-wrapper');
            const controlsContainer = document.getElementById('controls');
            const scoreDisplay = document.getElementById('score-display');
            const progressBar = document.getElementById('progress-bar');
            const quizTitle = document.querySelector('#quiz-container h1');
            const alertModal = document.getElementById('alert-modal');
            const alertMessage = document.getElementById('alert-message');
            const closeAlertBtn = document.getElementById('close-alert-btn');

            // --- åŠŸèƒ½å‡½å¼å€ ---

            /**
             * å°‡æ–‡å­—è½‰æ›ç‚ºåŒ…å«äº’å‹•å¼å–®å­—çš„ HTML
             */
            function createInteractiveText(text) {
                // æ›´æ–°æ­£å‰‡è¡¨é”å¼ä»¥è™•ç† 'in front of'
                const parts = text.split(/(\bin front of\b|[a-zA-Z'â€™]+)/i);
                return parts.map(part => {
                    if (!part) return ''; // å¿½ç•¥ç©ºå­—ä¸²
                    const cleanPart = part.toLowerCase().replace(/â€™/g, "'");
                    if (translations[cleanPart]) {
                        return `<span class="word">${part}<span class="tooltip">${translations[cleanPart]}</span></span>`;
                    }
                    return part;
                }).join('');
            }

            /**
             * ä½¿ç”¨ç€è¦½å™¨ API æœ—è®€æ–‡å­—
             */
            function speak(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                } else {
                    console.error("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åˆæˆåŠŸèƒ½ã€‚");
                }
            }

            /**
             * å»ºç«‹å–‡å­åœ–ç¤º (SVG)
             */
            function createSpeakerIcon(textToSpeak) {
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, "svg");
                svg.setAttribute("class", "h-5 w-5 text-amber-600 hover:text-amber-800 cursor-pointer flex-shrink-0");
                svg.setAttribute("viewBox", "0 0 20 20");
                svg.setAttribute("fill", "currentColor");
                
                const path = document.createElementNS(svgNS, "path");
                path.setAttribute("fill-rule", "evenodd");
                path.setAttribute("d", "M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.016 5.39a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 11-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026zM14.07 3.33a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 01-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026z");
                path.setAttribute("clip-rule", "evenodd");
                
                svg.appendChild(path);
                
                // é»æ“Šåœ–ç¤ºæ™‚æœ—è®€æ–‡å­—ï¼Œä¸¦åœæ­¢äº‹ä»¶å†’æ³¡
                svg.onclick = (e) => { 
                    e.stopPropagation(); 
                    speak(textToSpeak); 
                };
                
                return svg;
            }

            /**
             * é¡¯ç¤ºæŒ‡å®šç´¢å¼•çš„é¡Œç›®
             */
            function displayQuestion(index) {
                questionsWrapper.innerHTML = '';
                controlsContainer.innerHTML = '';

                const progressPercentage = (index / quizData.length) * 100;
                progressBar.style.width = `${progressPercentage}%`;

                const q = quizData[index];
                const questionBlock = document.createElement('div');
                questionBlock.id = `q-${index}`;

                const questionText = document.createElement('p');
                // æ”¹ç‚º flex ä½ˆå±€ä»¥å®¹ç´å–‡å­
                questionText.className = 'text-lg text-stone-700 mb-4 flex items-center gap-2'; 
                
                // å»ºç«‹å•é¡Œçš„å–‡å­åœ–ç¤º (æœ—è®€æ™‚ç§»é™¤ä¸­æ–‡å’Œåº•ç·š)
                const cleanQuestionForSpeech = q.question.replace(/______/g, '').replace(/ï¼ˆ.*ï¼‰/g, '');
                const questionSpeakerIcon = createSpeakerIcon(cleanQuestionForSpeech);
                
                // å»ºç«‹å•é¡Œæ–‡å­—çš„ span
                const questionTextSpan = document.createElement('span');
                // è™•ç†ä¸­æ–‡é¡Œç›®
                if (q.question.includes('é¸å‡ºéŒ¯èª¤çš„å¥å­')) {
                     questionTextSpan.innerHTML = `<strong>${index + 1}.</strong> ${q.question}`;
                } else {
                     questionTextSpan.innerHTML = `<strong>${index + 1}.</strong> ${createInteractiveText(q.question)}`;
                }
                
                // ä¾åºåŠ å…¥
                questionText.appendChild(questionSpeakerIcon);
                questionText.appendChild(questionTextSpan);
                
                const optionsGrid = document.createElement('div');
                optionsGrid.className = 'grid grid-cols-1 sm:grid-cols-2 gap-3';
                
                q.options.forEach((option, i) => {
                    const optionChar = String.fromCharCode(65 + i);
                    const optionContainer = document.createElement('div');
                    optionContainer.className = 'flex items-center p-3 border border-stone-300 rounded-lg transition-all cursor-pointer hover:bg-amber-50';
                    
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.id = `q${index}-opt${optionChar}`;
                    radio.name = `q${index}`;
                    radio.value = optionChar;
                    radio.className = 'h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300';

                    const label = document.createElement('label');
                    label.htmlFor = `q${index}-opt${optionChar}`;
                    // æ”¹ç‚º flex ä½ˆå±€ä»¥å®¹ç´å–‡å­
                    label.className = 'ml-3 block text-md text-stone-900 flex-1 cursor-pointer flex items-center gap-2';

                    // å»ºç«‹é¸é …çš„å–‡å­åœ–ç¤º
                    const optionSpeakerIcon = createSpeakerIcon(option);

                    // å»ºç«‹é¸é …æ–‡å­—çš„ span
                    const optionTextSpan = document.createElement('span');
                    optionTextSpan.innerHTML = `(${optionChar}) ${createInteractiveText(option)}`;

                    // ä¾åºåŠ å…¥
                    label.appendChild(optionSpeakerIcon);
                    label.appendChild(optionTextSpan);

                    optionContainer.onclick = () => { radio.checked = true; };
                    optionContainer.appendChild(radio);
                    optionContainer.appendChild(label);
                    optionsGrid.appendChild(optionContainer);
                });

                const hintContainer = document.createElement('div');
                hintContainer.className = 'mt-4';
                const hintButton = document.createElement('button');
                hintButton.className = 'text-sm text-amber-600 hover:text-amber-800';
                hintButton.textContent = 'ğŸ’¡ æç¤º';
                const hintText = document.createElement('p');
                hintText.className = 'hint-content hidden mt-2 text-sm text-stone-600 bg-yellow-100 p-2 rounded-md';
                hintText.textContent = q.hint;
                hintButton.onclick = () => hintText.classList.toggle('hidden');
                hintContainer.appendChild(hintButton);
                hintContainer.appendChild(hintText);
                
                questionBlock.appendChild(questionText);
                questionBlock.appendChild(optionsGrid);
                questionBlock.appendChild(hintContainer);
                questionsWrapper.appendChild(questionBlock);

                const submitButton = document.createElement('button');
                submitButton.className = 'w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-600 transition-colors focus:outline-none focus:ring-2 focus:ring-amber-400 focus:ring-opacity-50';
                submitButton.textContent = 'æª¢æŸ¥ç­”æ¡ˆ';
                submitButton.onclick = () => checkCurrentAnswer(index);
                controlsContainer.appendChild(submitButton);
            }

            /**
             * æª¢æŸ¥ç•¶å‰é¡Œç›®çš„ç­”æ¡ˆ
             */
            function checkCurrentAnswer(index) {
                const selectedRadio = document.querySelector(`input[name="q${index}"]:checked`);

                if (!selectedRadio) {
                    alertMessage.textContent = 'è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼';
                    alertModal.classList.remove('hidden');
                    return;
                }

                const q = quizData[index];
                const questionBlock = document.getElementById(`q-${index}`);
                questionBlock.querySelectorAll('input[type="radio"]').forEach(radio => { radio.disabled = true; });
                questionBlock.querySelectorAll('div.flex.items-center').forEach(div => { div.onclick = null; div.classList.remove('hover:bg-amber-50'); div.style.cursor = 'default'; });


                const correctOptionValue = q.answer;
                const correctLabel = document.querySelector(`label[for="q${index}-opt${correctOptionValue}"]`);
                const userLabel = selectedRadio.nextElementSibling;
                
                if (selectedRadio.value === correctOptionValue) {
                    score++;
                    userLabel.parentElement.classList.add('bg-yellow-100', 'border-yellow-400', 'ring-2', 'ring-yellow-300');
                    userLabel.innerHTML += ' <span class="text-green-600 font-bold">âœ”ï¸</span>';
                } else {
                    userLabel.parentElement.classList.add('bg-red-100', 'border-red-400', 'ring-2', 'ring-red-300');
                    userLabel.innerHTML += ' <span class="text-red-600 font-bold">âŒ</span>';
                    correctLabel.parentElement.classList.add('bg-yellow-100', 'border-yellow-400');
                }

                controlsContainer.innerHTML = '';
                const nextButton = document.createElement('button');
                nextButton.className = 'w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-600 transition-colors';

                if (currentQuestionIndex < quizData.length - 1) {
                    nextButton.textContent = 'ä¸‹ä¸€é¡Œ';
                    nextButton.onclick = () => {
                        currentQuestionIndex++;
                        displayQuestion(currentQuestionIndex);
                    };
                } else {
                    nextButton.textContent = 'å®Œæˆæ¸¬é©—';
                    nextButton.onclick = showFinalScore;
                }
                controlsContainer.appendChild(nextButton);
            }

            /**
             * é¡¯ç¤ºæœ€çµ‚åˆ†æ•¸
             */
            function showFinalScore() {
                progressBar.style.width = '100%';
                questionsWrapper.innerHTML = '';
                controlsContainer.innerHTML = '';
                quizTitle.textContent = 'æ¸¬é©—å®Œæˆï¼';

                scoreDisplay.innerHTML = `
                    <p class="text-xl text-stone-600">ä½ çš„æœ€çµ‚åˆ†æ•¸</p>
                    <p class="text-5xl my-4 text-stone-800">${score} / ${quizData.length}</p>
                `;
                scoreDisplay.classList.remove('hidden');

                const restartButton = document.createElement('button');
                restartButton.className = 'mt-6 w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-600 transition-colors';
                restartButton.textContent = 'é‡æ–°æ¸¬é©—';
                restartButton.onclick = () => window.location.reload();
                scoreDisplay.appendChild(restartButton);
            }

            // --- äº‹ä»¶ç›£è½å€ ---
            questionsWrapper.addEventListener('click', (e) => {
                // ç¢ºä¿é»æ“Šçš„æ˜¯ .word å…ƒç´ æœ¬èº«
                let targetWord = e.target.closest('.word');
                if (targetWord) {
                    // å–å¾— .word å…ƒç´ çš„ç¬¬ä¸€å€‹å­ç¯€é» (å³æ–‡å­—ç¯€é»)
                    const textNode = targetWord.childNodes[0];
                    if (textNode && textNode.nodeValue) {
                        speak(textNode.nodeValue.trim().replace(/[.,!?]$/, '')); // æœ—è®€æ–‡å­—ä¸¦ç§»é™¤å°¾éš¨æ¨™é»
                    }
                }
            });

            closeAlertBtn.addEventListener('click', () => {
                alertModal.classList.add('hidden');
            });

            // --- ç¨‹å¼é€²å…¥é» ---
            displayQuestion(currentQuestionIndex);
        });
    </script>
</body>

</html>
