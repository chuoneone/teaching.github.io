<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZ Review Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Nunito:wght@400;600;700;900&display=swap');
        
        body {
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal Animation */
        .modal-enter { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #facc15;
            color: #facc15;
        }
        .nav-item.active span.num-badge {
            background-color: #facc15;
            color: #0f172a;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-white transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 shadow-2xl flex flex-col shrink-0">
        <div class="p-6 border-b border-slate-700 flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-black tracking-tighter text-yellow-400 flex items-center gap-2">
                    EZ Review
                </h1>
                <p class="text-slate-400 text-xs mt-1">Interactive Workbook</p>
            </div>
            <button id="closeSidebar" class="md:hidden text-slate-400 hover:text-white">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>
        </div>

        <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
            <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 px-2 mt-4">Unit 3</div>
            
            <button onclick="app.renderUnit('U3Vocab')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-left hover:bg-slate-800 text-slate-300" id="nav-U3Vocab">
                <span class="num-badge font-mono font-bold bg-white/10 px-2 rounded text-xs">03</span>
                <span>Unit 3 ç¿’ä½œå¿…è€ƒé¡Œ</span>
            </button>

            <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 px-2 mt-6">Unit 4</div>
            
            <button onclick="app.renderUnit('U4Review')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-left hover:bg-slate-800 text-slate-300" id="nav-U4Review">
                <span class="num-badge font-mono font-bold bg-white/10 px-2 rounded text-xs">04</span>
                <span>Unit 4 ç¿’ä½œå¿…è€ƒé¡Œ</span>
            </button>
        </nav>

        <div class="p-4 bg-slate-950 text-xs text-slate-500 text-center border-t border-slate-800">
            <p>Workbook Only</p>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0 bg-slate-50 h-full w-full relative">
        <!-- Mobile Header -->
        <header class="md:hidden bg-white border-b p-4 flex items-center justify-between shadow-sm z-40 shrink-0">
            <span class="font-bold text-slate-700 text-lg">Review Hub</span>
            <button id="openSidebar" class="p-2 bg-slate-100 rounded-lg text-slate-600 hover:bg-slate-200">
                <i class="fa-solid fa-bars text-xl"></i>
            </button>
        </header>

        <!-- Content Area -->
        <div id="appContent" class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth bg-gradient-to-br from-blue-50 to-indigo-50">
            <!-- Dynamic content -->
        </div>
    </main>

    <!-- Custom Modal -->
    <div id="warningModal" class="fixed inset-0 z-[100] hidden" role="dialog">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity" onclick="app.closeModal()"></div>
        <!-- Modal Content -->
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl w-11/12 max-w-md p-6 modal-enter border-2 border-red-100">
            <div class="flex flex-col items-center text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4 text-red-500">
                    <i class="fa-solid fa-triangle-exclamation text-3xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-slate-800 mb-2">é‚„æœ‰é¡Œç›®æ²’å®Œæˆå–”ï¼</h3>
                <p id="modalMessage" class="text-slate-500 mb-6">è«‹æª¢æŸ¥æ˜¯å¦æœ‰ç©ºç™½æœªå¡«ã€‚</p>
                <div class="flex gap-3 w-full">
                    <button onclick="app.closeModal()" class="flex-1 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300 transition-colors">
                        å›å»æª¢æŸ¥
                    </button>
                    <button onclick="app.forceSubmit()" id="forceSubmitBtn" class="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 transition-colors hidden">
                        ä»è¦äº¤å·
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Data ---
        const AppData = {
            U3Vocab: {
                type: 'vocab',
                title: "Unit 3 ç¿’ä½œå¿…è€ƒé¡Œ",
                partA: {
                    title: "A. Fill in the blanks (çœ‹åœ–å¡«ç©º)",
                    color: "orange",
                    words: ["use", "hurry", "talk", "follow", "fight", "wash"],
                    questions: [
                        { id: 'A1', pre: "Please", post: "me.", ans: "follow", emoji: "ğŸ‘©â€ğŸ« ğŸš¶â€â™‚ï¸", bg: "bg-orange-100" },
                        { id: 'A2', pre: "The bus is here. Let's", post: ".", ans: "hurry", emoji: "ğŸšŒ ğŸƒ", bg: "bg-blue-100" },
                        { id: 'A3', pre: "Please don't", post: ".", ans: "fight", emoji: "ğŸ¤¼ âŒ", bg: "bg-red-50" },
                        { id: 'A4', pre: "Don't", post: "the phone in class.", ans: "use", emoji: "ğŸ“± ğŸš«", bg: "bg-green-100" }
                    ]
                },
                partB: {
                    title: "B. Read and write (é»æ“Šæ­£ç¢ºçš„å®Œæ•´å–®å­—)",
                    color: "blue",
                    words: ["Wake", "careful", "guys", "men"], 
                    questions: [
                        { id: 'B1', text: "____ up, George.", hint: "W____ke (é†’ä¾†)", ans: "Wake" },
                        { id: 'B2', text: "Be ____. Don't go near that dog.", hint: "c____l (å°å¿ƒ)", ans: "careful" },
                        { id: 'B3', text: "Hey, ____. Welcome.", hint: "g____ys (å¤§å®¶)", ans: "guys" },
                        { id: 'B4', text: "Who are the two ____?", hint: "m____n (ç”·äºº)", ans: "men" }
                    ]
                },
                partH: {
                    title: "H. Make sentences (é‡çµ„æ”¹å¯«å¥å­)",
                    color: "purple",
                    questions: [
                        { id: 'H1', context: "Write your name here. (æ”¹å¦å®š)", parts: ["Don't", "write", "your", "name", "here", "."] },
                        { id: 'H2', context: "Please don't listen to him. (æ”¹è‚¯å®š)", parts: ["Please", "listen", "to", "him", "."] },
                        { id: 'H3', context: "Let's draw on the wall. (æ”¹å¦å®š)", parts: ["Let's", "not", "draw", "on", "the", "wall", "."] },
                        { id: 'H4', context: "Let's not read the picture book. (æ”¹è‚¯å®š)", parts: ["Let's", "read", "the", "picture", "book", "."] }
                    ]
                }
            },
            U4Review: {
                type: 'vocab',
                title: "Unit 4 ç¿’ä½œå¿…è€ƒé¡Œ",
                partA: {
                    title: "A. Read and Choose (æ–‡æ„å­—å½™)",
                    color: "sky",
                    words: ["ready", "fan", "popular", "weekend", "video", "band"],
                    questions: [
                        { id: 'U4A1', pre: "Joseph is a big", post: "of the band.", ans: "fan" },
                        { id: 'U4A2', pre: "I'm watching a music", post: ".", ans: "video" },
                        { id: 'U4A3', pre: "The shop is really", post: ".", ans: "popular" },
                        { id: 'U4A4', pre: "Are you", post: "for the movie?", ans: "ready" },
                        { id: 'U4A5', pre: "Is the event this", post: "?", ans: "weekend" }
                    ]
                },
                partF: {
                    title: "F. Make Sentences (é€ åŸå•å¥)",
                    color: "purple",
                    questions: [
                        { id: 'U4F1', context: "May is sleeping <u>on the sofa</u>.", parts: ["Where", "is", "May", "sleeping", "?"] },
                        { id: 'U4F2', context: "Ken is <u>jumping rope</u>.", parts: ["What", "is", "Ken", "doing", "?"] },
                        { id: 'U4F3', context: "Vicky is talking with <u>her father</u>.", parts: ["Who", "is", "Vicky", "talking", "with", "?"] }
                    ]
                }
            }
        };

        // --- App Class ---
        class App {
            constructor() {
                this.state = {
                    unit: 'U3Vocab', // Default to first unit
                    selectedWord: null,
                    answers: {},
                    sentenceBuilder: {},
                    checked: false
                };
                this.init();
            }

            init() {
                this.bindEvents();
                this.renderUnit(this.state.unit);
            }

            bindEvents() {
                document.getElementById('openSidebar').onclick = () => {
                    document.getElementById('sidebar').classList.remove('-translate-x-full');
                };
                document.getElementById('closeSidebar').onclick = () => {
                    document.getElementById('sidebar').classList.add('-translate-x-full');
                };
            }

            updateNav(unit) {
                document.querySelectorAll('.nav-item').forEach(el => {
                    el.classList.remove('active', 'text-white');
                    el.classList.add('text-slate-300');
                });
                const active = document.getElementById(`nav-${unit}`);
                if (active) {
                    active.classList.add('active', 'text-white');
                    active.classList.remove('text-slate-300');
                }
            }

            resetState() {
                this.state = {
                    ...this.state,
                    selectedWord: null,
                    answers: {},
                    sentenceBuilder: {},
                    checked: false
                };
            }

            renderUnit(unit) {
                this.state.unit = unit;
                this.resetState();
                this.updateNav(unit);
                
                if(window.innerWidth < 768) {
                    document.getElementById('sidebar').classList.add('-translate-x-full');
                }

                const container = document.getElementById('appContent');
                container.innerHTML = '';

                const data = AppData[unit];
                if (data.type === 'vocab') this.renderVocabPage(container, data);
            }

            // --- Incomplete Check Logic ---
            closeModal() {
                document.getElementById('warningModal').classList.add('hidden');
            }

            forceSubmit() {
                document.getElementById('warningModal').classList.add('hidden');
                this.performVocabCheck(true);
            }

            showWarning(count) {
                const modal = document.getElementById('warningModal');
                const msg = document.getElementById('modalMessage');
                const forceBtn = document.getElementById('forceSubmitBtn');
                
                msg.innerHTML = `æ‚¨é‚„æœ‰ <span class="text-red-500 font-bold text-2xl mx-1">${count}</span> é¡Œå°šæœªä½œç­”ã€‚`;
                forceBtn.classList.remove('hidden'); // Allow force submit
                modal.classList.remove('hidden');
            }

            // ============================================================
            // RENDER: Vocab Page
            // ============================================================
            renderVocabPage(container, data) {
                const createHeader = (title, subtitle) => `<div class="bg-white border-b-4 border-yellow-400 p-8 mb-8 rounded-3xl shadow-sm fade-in text-center md:text-left"><h2 class="text-4xl font-black text-slate-800 tracking-tight">${title}</h2><p class="text-slate-500 font-bold mt-2 text-lg">${subtitle}</p></div>`;
                const createSectionHeader = (title, color) => {
                    const colorMap = { orange: 'bg-orange-50 text-orange-700 border-orange-200', blue: 'bg-blue-50 text-blue-700 border-blue-200', purple: 'bg-purple-50 text-purple-700 border-purple-200', sky: 'bg-sky-50 text-sky-700 border-sky-200' };
                    return `<div class="flex items-center gap-3 p-5 rounded-t-2xl border-b-2 ${colorMap[color]} mt-8 first:mt-0"><h3 class="font-bold text-xl">${title}</h3></div>`;
                };

                let html = createHeader(data.title, "Class_____ Name_________");

                if (data.partA) {
                    html += `<div class="bg-white rounded-3xl shadow-lg border border-slate-100 overflow-hidden mb-10 fade-in">`;
                    html += createSectionHeader(data.partA.title, data.partA.color);
                    html += `<div class="p-8">`;
                    const wordBankHtml = data.partA.words.map(w => `<button onclick="app.handleWordClick('${w}')" class="word-btn px-5 py-3 bg-white border-2 border-slate-200 rounded-2xl font-bold text-lg text-slate-600 hover:border-blue-400 hover:text-blue-600 transition-all shadow-sm transform active:scale-95" data-word="${w}">${w}</button>`).join('');
                    html += `<div class="bg-slate-50 p-6 rounded-2xl mb-8 flex flex-wrap justify-center gap-4 border-2 border-dashed border-slate-200">${wordBankHtml}</div>`;
                    html += `<div class="grid grid-cols-1 md:grid-cols-1 gap-6 text-xl leading-loose">`;
                    data.partA.questions.forEach((q, i) => {
                         if(q.emoji) {
                             html += `<div class="border-2 rounded-2xl p-6 bg-white flex flex-col items-center text-center shadow-sm"><div class="text-6xl mb-4">${q.emoji}</div><div>${q.pre} <button id="blank-${q.id}" onclick="app.handleBlankClick('${q.id}')" data-ans="${q.ans}" class="inline-block min-w-[100px] h-10 border-b-4 border-slate-300 bg-slate-50 mx-2 rounded text-center font-bold text-blue-600 transition-colors"></button> ${q.post}</div></div>`;
                         } else {
                             html += `<div class="pl-6 border-l-4 border-sky-200 py-3 hover:bg-sky-50 transition-colors rounded-r-xl"><span class="font-bold text-sky-500 mr-4">${i+1}.</span>${q.pre} <button id="blank-${q.id}" onclick="app.handleBlankClick('${q.id}')" data-ans="${q.ans}" class="inline-block min-w-[120px] h-10 border-b-4 border-slate-300 bg-slate-50 mx-2 rounded text-center font-bold text-sky-600 align-middle"></button> ${q.post}</div>`;
                         }
                    });
                    html += `</div></div></div>`;
                }

                if (data.partB) {
                     html += `<div class="bg-white rounded-3xl shadow-lg border border-slate-100 overflow-hidden mb-10 fade-in">`;
                     html += createSectionHeader(data.partB.title, data.partB.color);
                     html += `<div class="p-8 space-y-6">`;
                     const wordBankB = data.partB.words.map(w => `<button onclick="app.handleWordClick('${w}')" class="word-btn px-5 py-3 bg-white border-2 border-slate-200 rounded-2xl font-bold text-lg text-slate-600 hover:border-blue-400 hover:text-blue-600 transition-all shadow-sm transform active:scale-95" data-word="${w}">${w}</button>`).join('');
                     html += `<div class="bg-slate-50 p-6 rounded-2xl mb-8 flex flex-wrap justify-center gap-4 border-2 border-dashed border-slate-200">${wordBankB}</div>`;
                     data.partB.questions.forEach(q => {
                         html += `<div class="flex flex-col md:flex-row md:items-center gap-4 border-b border-slate-100 pb-6 last:border-0"><div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold shrink-0 text-lg">${q.id.replace('B','')}</div><div class="flex-1 text-xl">${q.text.replace('____', `<button id="blank-${q.id}" onclick="app.handleBlankClick('${q.id}')" data-ans="${q.ans}" class="inline-block min-w-[120px] h-10 border-b-4 border-slate-300 bg-slate-50 mx-2 rounded text-center font-bold text-blue-600 align-middle transition-all"></button>`)}<div class="text-sm text-slate-400 mt-2 font-medium bg-slate-50 inline-block px-2 py-1 rounded">${q.hint}</div></div></div>`;
                     });
                     html += `</div></div>`;
                }

                if (data.partF || data.partH) {
                    const sentencePart = data.partF || data.partH;
                    html += `<div class="bg-white rounded-3xl shadow-lg border border-slate-100 overflow-hidden mb-10 fade-in">`;
                    html += createSectionHeader(sentencePart.title, sentencePart.color);
                    html += `<div class="p-8 space-y-10">`;
                    sentencePart.questions.forEach((q, i) => {
                        this.initSentence(q.id, q.parts);
                        html += `<div><div class="flex items-center gap-4 mb-4"><span class="bg-purple-600 text-white w-8 h-8 rounded-lg flex items-center justify-center text-lg font-bold shadow-sm">${i+1}</span><div class="font-bold text-slate-700 text-xl border-l-4 border-purple-300 pl-4 py-1">${q.context || q.question}</div></div><div id="sentence-${q.id}"></div></div>`;
                    });
                    html += `</div></div>`;
                }

                html += `<div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t md:static md:bg-transparent md:border-0 md:p-0 mt-12 flex justify-center z-30"><button onclick="app.checkAnswers()" id="checkBtn" class="flex items-center gap-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-16 py-5 rounded-full font-black text-2xl shadow-xl hover:scale-105 transition-transform w-full md:w-auto justify-center"><i class="fa-solid fa-check-double"></i> Check Answers (äº¤å·)</button></div><div class="h-24 md:hidden"></div>`;
                
                container.innerHTML = html;
                if (data.partF || data.partH) (data.partF || data.partH).questions.forEach(q => this.renderSentenceInterface(q.id));
            }
            
            handleWordClick(word) {
                if (this.state.checked) return;
                this.state.selectedWord = (this.state.selectedWord === word) ? null : word;
                this.updateWordBankUI();
            }
            
            updateWordBankUI() {
                document.querySelectorAll('.word-btn').forEach(btn => {
                    const w = btn.dataset.word;
                    if (w === this.state.selectedWord) {
                        btn.classList.remove('bg-white', 'text-slate-600', 'border-slate-200');
                        btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600', 'scale-110');
                    } else {
                        btn.classList.add('bg-white', 'text-slate-600', 'border-slate-200');
                        btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600', 'scale-110');
                    }
                    if (Object.values(this.state.answers).includes(w) && w !== this.state.selectedWord) {
                        btn.classList.add('opacity-40', 'scale-90');
                    } else {
                        btn.classList.remove('opacity-40', 'scale-90');
                    }
                });
            }

            handleBlankClick(id) {
                if (this.state.checked) return;
                const btn = document.getElementById(`blank-${id}`);
                if (this.state.selectedWord) {
                    this.state.answers[id] = this.state.selectedWord;
                    btn.innerText = this.state.selectedWord;
                    btn.classList.remove('bg-slate-50', 'border-slate-300');
                    btn.classList.add('bg-blue-50', 'border-blue-500', 'text-blue-700');
                    this.state.selectedWord = null;
                    this.updateWordBankUI();
                } else {
                    delete this.state.answers[id];
                    btn.innerText = '';
                    btn.classList.add('bg-slate-50', 'border-slate-300');
                    btn.classList.remove('bg-blue-50', 'border-blue-500', 'text-blue-700');
                    this.updateWordBankUI();
                }
            }
            
            initSentence(id, parts) {
                if (!this.state.sentenceBuilder[id]) {
                    const shuffled = [...parts].sort(() => Math.random() - 0.5);
                    this.state.sentenceBuilder[id] = { pool: shuffled, built: [] };
                }
            }

            renderSentenceInterface(id) {
                const data = this.state.sentenceBuilder[id];
                const poolHtml = data.pool.map((w, idx) => `<button onclick="app.moveSentenceWord('${id}', ${idx}, 'toBuilt')" class="px-4 py-2 bg-white border-2 border-slate-200 rounded-xl shadow-sm hover:bg-slate-50 font-bold text-slate-600 transition-all transform active:scale-95">${w}</button>`).join('');
                const builtHtml = data.built.map((w, idx) => `<button onclick="app.moveSentenceWord('${id}', ${idx}, 'toPool')" class="px-4 py-2 bg-indigo-100 border-2 border-indigo-300 text-indigo-700 rounded-xl font-bold hover:bg-red-100 hover:text-red-600 hover:border-red-300 transition-all flex items-center gap-2 group">${w} <i class="fa-solid fa-xmark text-xs opacity-0 group-hover:opacity-100"></i></button>`).join('');
                const container = document.getElementById(`sentence-${id}`);
                const isCorrect = this.checkSentence(id);
                container.innerHTML = `<div class="min-h-[80px] bg-white border-2 border-indigo-50 rounded-2xl p-4 flex flex-wrap gap-3 items-center mb-4 shadow-inner ${this.state.checked ? (isCorrect ? 'border-green-400 bg-green-50' : 'border-red-400 bg-red-50') : ''}">${builtHtml || '<span class="text-slate-300 font-medium italic flex items-center gap-2"><i class="fa-regular fa-hand-pointer"></i> é»æ“Šä¸‹æ–¹å–®å­—çµ„å¥...</span>'}</div><div class="flex flex-wrap gap-3 p-2">${this.state.checked ? '' : poolHtml}</div>`;
            }

            moveSentenceWord(id, idx, direction) {
                if (this.state.checked) return;
                const sb = this.state.sentenceBuilder[id];
                if (direction === 'toBuilt') {
                    sb.built.push(sb.pool.splice(idx, 1)[0]);
                } else {
                    sb.pool.push(sb.built.splice(idx, 1)[0]);
                }
                this.renderSentenceInterface(id);
            }

            checkSentence(id) {
                let correctArr = [];
                const unitData = AppData[this.state.unit];
                let q;
                if(unitData.partH) q = unitData.partH.questions.find(x => x.id === id);
                if(unitData.partF) q = unitData.partF.questions.find(x => x.id === id);
                if(q) correctArr = q.parts;
                return this.state.sentenceBuilder[id].built.join('') === correctArr.join('');
            }

            checkAnswers() {
                if(this.state.checked) {
                    this.state.checked = false;
                    this.renderUnit(this.state.unit);
                    return;
                }

                // Check for incomplete questions
                const unitData = AppData[this.state.unit];
                let incomplete = 0;
                
                if(unitData.partA) unitData.partA.questions.forEach(q => { if(!this.state.answers[q.id]) incomplete++; });
                if(unitData.partB) unitData.partB.questions.forEach(q => { if(!this.state.answers[q.id]) incomplete++; });
                if(unitData.partF) unitData.partF.questions.forEach(q => { if(this.state.sentenceBuilder[q.id].built.length === 0) incomplete++; });
                if(unitData.partH) unitData.partH.questions.forEach(q => { if(this.state.sentenceBuilder[q.id].built.length === 0) incomplete++; });

                if(incomplete > 0) {
                    this.showWarning(incomplete);
                    return;
                }

                this.performVocabCheck();
            }

            performVocabCheck(force = false) {
                this.state.checked = true;
                const unitData = AppData[this.state.unit];

                document.querySelectorAll('[id^="blank-"]').forEach(btn => {
                    const id = btn.id.replace('blank-', '');
                    const userAns = this.state.answers[id];
                    const trueAns = btn.dataset.ans;
                    if (userAns === trueAns) {
                        btn.classList.remove('bg-blue-50', 'border-blue-500', 'text-blue-700'); btn.classList.add('bg-green-100', 'border-green-500', 'text-green-800'); btn.innerHTML += ' <i class="fa-solid fa-check ml-1"></i>';
                    } else {
                        btn.classList.remove('bg-blue-50', 'border-blue-500', 'text-blue-700', 'bg-slate-50', 'border-slate-300'); btn.classList.add('bg-red-100', 'border-red-500', 'text-red-800', 'line-through', 'opacity-60');
                        btn.insertAdjacentHTML('afterend', `<span class="ml-2 text-green-600 font-bold bg-green-50 px-2 py-1 rounded border border-green-200 shadow-sm">${trueAns}</span>`);
                    }
                });
                
                Object.keys(this.state.sentenceBuilder).forEach(id => {
                    this.renderSentenceInterface(id);
                    if (!this.checkSentence(id)) {
                        let q;
                        if(unitData.partH) q = unitData.partH.questions.find(x => x.id === id);
                        if(unitData.partF) q = unitData.partF.questions.find(x => x.id === id);
                        const ans = q ? q.parts.join(' ') : '';
                        document.getElementById(`sentence-${id}`).parentNode.insertAdjacentHTML('beforeend', `<div class="mt-3 p-3 bg-green-50 text-green-800 rounded-xl text-sm font-bold border border-green-200 flex items-center gap-2"><i class="fa-solid fa-key"></i> Answer: ${ans}</div>`);
                    }
                });

                const btn = document.getElementById('checkBtn');
                btn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Try Again (é‡ç½®)';
                btn.classList.remove('from-blue-600', 'to-indigo-600');
                btn.classList.add('from-slate-700', 'to-slate-800');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        const app = new App();
    </script>
</body>
</html>