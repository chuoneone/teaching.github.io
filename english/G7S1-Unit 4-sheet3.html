<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- æ¨™é¡Œå·²æ›´æ–° -->
    <title>Unit 4 Grammar Focus3(ç¾åœ¨é€²è¡Œå¼)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="dog.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff; /* light blue background */
        }
        .exercise-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 24px;
            margin-bottom: 24px;
            transition: box-shadow 0.3s ease;
        }
        .exercise-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        .example-box {
            background-color: #f8faff;
            border: 1px solid #dbeafe;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            font-family: 'Noto Sans TC', sans-serif;
            line-height: 1.8;
            color: #1e3a8a;
        }
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px;
            background-color: #f1f5f9;
            border-radius: 8px;
            min-height: 50px;
        }
        .drop-zone {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px;
            background-color: #ffffff;
            border: 2px dashed #94a3b8;
            border-radius: 8px;
            min-height: 50px;
            margin-top: 12px;
            transition: all 0.3s ease;
        }
        .word-item {
            padding: 8px 16px;
            background-color: #e0f2fe;
            border: 1px solid #7dd3fc;
            color: #075985;
            border-radius: 9999px; /* pill shape */
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        .word-item:hover {
            background-color: #bae6fd;
            transform: scale(1.05);
        }
        .speaker-icon {
            cursor: pointer;
            display: inline-block;
            margin-left: 8px;
            color: #3b82f6;
            font-size: 1.2em;
            vertical-align: middle;
        }
        .speaker-icon:hover {
            color: #2563eb;
        }
        #tooltip {
            position: absolute;
            display: none;
            background-color: #1f2937;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            pointer-events: none; /* So it doesn't interfere with mouse events */
            z-index: 100;
        }
        .drop-zone.correct {
            border-color: #22c55e;
            background-color: #f0fdf4;
        }
        .drop-zone.incorrect {
            border-color: #ef4444;
            background-color: #fef2f2;
        }
        .question-prompt {
             font-size: 1.1em;
             font-weight: 600;
             color: #1f2937;
        }
        .question-text {
            font-size: 1.0em;
            color: #4b5563;
        }

        @keyframes card-correct-glow {
            0% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
            50% { box-shadow: 0 8px 30px rgba(34, 197, 94, 0.4); }
            100% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        }

        .card-glow-animation {
            animation: card-correct-glow 1s ease-out;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="tooltip"></div>

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800">Unit 4 Grammar Focus3(ç¾åœ¨é€²è¡Œå¼)</h1>
            <p class="text-lg text-slate-600 mt-2">èª²æœ¬p.75-76</p>
        </header>

        <!-- Section 1: ä¾æç¤ºå®Œæˆå¥å­ -->
        <div class="exercise-section mb-8">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">ä¸€ã€è«‹ä¾æç¤ºå®Œæˆå¥å­ (be+V.ing)</h2>
            <div class="example-box">
                <b>ä¾‹ï¼š</b>Teddy / be / cry / .<br>
                â” Teddy is crying.
            </div>
            <div id="exercise-container-1">
                <!-- JS will inject exercises here -->
            </div>
        </div>

        <!-- Section 2: Yes/No æˆ– Wh- ç–‘å•å¥ -->
        <div class="exercise-section mb-8">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">äºŒã€è«‹å›ç­”ä»¥ä¸‹Yes/Noæˆ–Wh-ç–‘å•å¥</h2>
             <div class="example-box">
                <b>æç¤ºï¼š</b>è«‹æ ¹æ“šæ‹¬è™Ÿä¸­çš„æç¤ºï¼Œé‡çµ„æ­£ç¢ºçš„ç­”å¥ã€‚
            </div>
            <div id="exercise-container-2">
                <!-- JS will inject exercises here -->
            </div>
        </div>

    </div>

    <script>
        // --- DATA (é‡çµ„å¥å­) ---
        const translations = {
            'Teddy': 'æ³°è¿ª', 'is': 'æ˜¯', 'crying': 'å“­æ³£',
            'Joe': 'å–¬', 'cooking': 'çƒ¹é£ª', 'at': 'åœ¨', 'six': 'å…­', 'p.m.': 'ä¸‹åˆ', 'in': 'åœ¨', 'the': 'é€™/é‚£', 'kitchen': 'å»šæˆ¿',
            'Joeâ€™s': 'å–¬çš„', 'son': 'å…’å­', 'running': 'è·‘æ­¥', 'school': 'å­¸æ ¡',
            'Peter': 'å½¼å¾—', 'singing': 'å”±æ­Œ', 'in': 'åœ¨', 'the': 'é€™/é‚£', 'park': 'å…¬åœ’',
            'We': 'æˆ‘å€‘', 'are': 'æ˜¯', 'listening': 'è½', 'to': 'åˆ°', 'music': 'éŸ³æ¨‚',
            'Are': '...å—', 'you': 'ä½ ', 'watching': 'çœ‹', 'TV': 'é›»è¦–',
            'Yes': 'æ˜¯', 'I': 'æˆ‘', 'am': 'æ˜¯',
            'they': 'ä»–å€‘', 'playing': 'ç©', 'baseball': 'æ£’çƒ',
            'No': 'ä¸', 'arenâ€™t': 'ä¸æ˜¯',
            'What': 'ä»€éº¼', 'Kelly': 'å‡±è‰', 'doing': 'åš',
            'She': 'å¥¹', 'talking': 'èªªè©±',
            'They': 'ä»–å€‘', 'sleeping': 'ç¡è¦º',
            '.': 'ã€‚', '?': 'ï¼Ÿ', ',': 'ï¼Œ'
        };

        const exercises = [
            // Section 1
            // --- ä¿®æ­£ç¬¬ä¸€é¡Œ: ç§»é™¤ in the kitchen ---
            { id: 's1q1', section: 1, prompt: '1. Joe / be / cook / at six p.m.', question: 'è«‹é‡çµ„å¥å­:', answer: 'Joe is cooking at six p.m..', chunks: ['Joe', 'is', 'cooking', 'at', 'six', 'p.m.', '.'] },
            { id: 's1q2', section: 1, prompt: '2. Joeâ€™s son / be / run / at school / .', question: 'è«‹é‡çµ„å¥å­:', answer: 'Joeâ€™s son is running at school.', chunks: ['Joeâ€™s', 'son', 'is', 'running', 'at', 'school', '.'] },
            { id: 's1q3', section: 1, prompt: '3. Peter / be / sing / in the park / .', question: 'è«‹é‡çµ„å¥å­:', answer: 'Peter is singing in the park.', chunks: ['Peter', 'is', 'singing', 'in', 'the', 'park', '.'] },
            { id: 's1q4', section: 1, prompt: '4. We / be / listen to music / .', question: 'è«‹é‡çµ„å¥å­:', answer: 'We are listening to music.', chunks: ['We', 'are', 'listening', 'to', 'music', '.'] },
            
            // Section 2
            { id: 's2q1', section: 2, prompt: '1. Are you watching TV? (è‚¯å®šç°¡ç­”)', question: 'è«‹é‡çµ„å›ç­”:', answer: 'Yes, I am.', chunks: ['Yes', ',', 'I', 'am', '.'] },
            { id: 's2q2', section: 2, prompt: '2. Are they playing baseball? (å¦å®šç°¡ç­”)', question: 'è«‹é‡çµ„å›ç­”:', answer: 'No, they arenâ€™t.', chunks: ['No', ',', 'they', 'arenâ€™t', '.'] },
            { id: 's2q3', section: 2, prompt: '3. What is Kelly doing? (talk)', question: 'è«‹é‡çµ„å›ç­”:', answer: 'She is talking.', chunks: ['She', 'is', 'talking', '.'] },
            { id: 's2q4', section: 2, prompt: '4. What are they doing? (sleep)', question: 'è«‹é‡çµ„å›ç­”:', answer: 'They are sleeping.', chunks: ['They', 'are', 'sleeping', '.'] }
        ];

        // --- CORE FUNCTIONS ---
        const synth = window.speechSynthesis;
        
        function speak(text, rate = 0.9) {
            synth.cancel();
            if (text !== '') {
                const cleanText = text.replace(/[.?]/g, '')
                                     .replace('a.m.', 'A M')
                                     .replace('p.m.', 'P M');
                const utterThis = new SpeechSynthesisUtterance(cleanText);
                utterThis.lang = 'en-US';
                utterThis.rate = rate;
                synth.speak(utterThis);
            }
        }
        
        function createSpeakerIcon(textToSpeak) {
            const safeText = textToSpeak.replace(/<[^>]*>/g, '').replace(/"/g, '&quot;');
            const speakText = safeText.replace(':', ' ').replace('?', '');
            return `<span class="speaker-icon" data-speak="${speakText}">ğŸ”Š</span>`;
        }

        // --- INITIALIZATION (ç¶²é è¼‰å…¥) ---
        document.addEventListener('DOMContentLoaded', () => {
            const container1 = document.getElementById('exercise-container-1');
            const container2 = document.getElementById('exercise-container-2'); 

            exercises.forEach((ex, index) => {
                const card = document.createElement('div');
                card.className = 'exercise-card';
                card.id = `exercise-${ex.id}`;

                const words = ex.chunks;
                
                // --- ä¿®æ­£: åªåœ¨ Section 2 (å•é¡Œ) æ‰åŠ å…¥å–‡å­åœ–ç¤º ---
                let promptText = ex.prompt;
                if (ex.section === 2) {
                     // å–å¾—æ‹¬è™Ÿå‰çš„æ–‡å­—ä¾†æœ—è®€
                     const speakablePrompt = ex.prompt.split('(')[0].trim();
                     promptText = `${ex.prompt} ${createSpeakerIcon(speakablePrompt)}`;
                }

                const contentHTML = `
                    <div class="flex items-center mb-2">
                        <div class="question-prompt">${promptText}</div>
                    </div>
                    <p class="question-text mb-3">${ex.question}</p>
                    <div class="word-bank mt-4">
                        ${[...words].sort(() => Math.random() - 0.5).map((word, idx) => `<div class="word-item" data-word-id="${ex.id}-${idx}">${word}</div>`).join('')}
                    </div>
                    <div class="drop-zone mt-3"></div>
                    <div class="flex flex-wrap gap-3 mt-4">
                         <button class="check-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded" data-answer="${ex.answer}" data-id="${ex.id}">æª¢æŸ¥ç­”æ¡ˆ</button>
                         <button class="reset-btn bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded" data-id="${ex.id}">é‡æ–°ä½œç­”</button>
                         <button class="hint-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded" data-speak-hint="${ex.answer}">ğŸ’¡ æç¤º (è½ç­”æ¡ˆ)</button>
                    </div>
                    <p class="feedback mt-2 text-sm font-bold"></p>
                `;
                card.innerHTML = contentHTML;
                
                // Append to correct container
                if (ex.section === 1) {
                    container1.appendChild(card);
                } else if (ex.section === 2) {
                    container2.appendChild(card);
                }
            });

            addEventListeners();
        });

        // --- ç¶å®šé‡çµ„å¥å­çš„äº‹ä»¶ ---
        function addEventListeners() {
            // Tooltip (å…±ç”¨)
            const tooltip = document.getElementById('tooltip');
            document.body.addEventListener('mouseover', (e) => {
                if (e.target.classList.contains('word') || e.target.closest('.word-item')) {
                     const wordElement = e.target.closest('.word-item') || e.target;
                     const text = wordElement.textContent.trim().replace(/[.?,]/g, '');
                     const chinese = translations[text];
                    if (chinese) {
                        tooltip.textContent = chinese;
                        tooltip.style.display = 'block';
                    }
                }
            });
             document.body.addEventListener('mousemove', (e) => {
                if (tooltip.style.display === 'block') {
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY + 10}px`;
                }
            });
            document.body.addEventListener('mouseout', (e) => {
                if (e.target.classList.contains('word') || e.target.closest('.word-item')) {
                    tooltip.style.display = 'none';
                }
            });

            // Speaker Icon & Hint Button clicks (é‡çµ„å¥å­)
            document.body.addEventListener('click', (e) => {
                if (e.target.classList.contains('speaker-icon')) {
                    e.stopPropagation();
                    const textToSpeak = e.target.dataset.speak;
                    if (textToSpeak) speak(textToSpeak); // é è¨­ 0.9 é€Ÿåº¦
                }
                if (e.target.classList.contains('hint-btn')) {
                    const textToSpeak = e.target.dataset.speakHint;
                    if (textToSpeak) speak(textToSpeak, 0.5); // æç¤º 0.5 é€Ÿåº¦
                }
            });
            
            // --- UN SCRAMBLE LOGIC (é‡çµ„å¥å­) ---
            document.body.addEventListener('click', e => {
                const target = e.target;
                if (target.classList.contains('word-item')) {
                    const card = target.closest('.exercise-card');
                    if (!card) return;
                    const wordBank = card.querySelector('.word-bank');
                    const dropZone = card.querySelector('.drop-zone');
                    
                    if (target.parentElement === wordBank) {
                        speak(target.textContent); // å–®å­— 0.9 é€Ÿåº¦
                        dropZone.appendChild(target);
                    } else if (target.parentElement === dropZone) {
                        wordBank.appendChild(target);
                    }
                }
            });

            // Check unscramble answers (é‡çµ„å¥å­)
            document.querySelectorAll('.check-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const exId = btn.dataset.id;
                    const card = document.getElementById(`exercise-${exId}`);
                    const dropZone = card.querySelector('.drop-zone');
                    const feedbackEl = card.querySelector('.feedback');
                    const words = Array.from(dropZone.children).map(child => child.textContent);
                    
                    let userAnswer = '';
                    for (let i = 0; i < words.length; i++) {
                        // è‡ªå‹•åœ¨å–®å­—é–“æ·»åŠ ç©ºæ ¼ (é™¤éæ˜¯æ¨™é»ç¬¦è™Ÿ)
                        // --- ä¿®æ­£: ç§»é™¤ 'a.m.' å’Œ 'p.m.'ï¼Œè®“å®ƒå€‘å‰é¢å¯ä»¥åŠ ç©ºæ ¼ ---
                        if (i > 0 && ![',', '.', '?', 'arenâ€™t'].includes(words[i]) && !words[i].startsWith('(')) {
                            userAnswer += ' ';
                        }
                        userAnswer += words[i];
                    }
                    // ç‰¹åˆ¥è™•ç† 'aren't' (å› ç‚º 't å‰ä¸æ‡‰æœ‰ç©ºæ ¼)
                    userAnswer = userAnswer.replace("aren â€™t", "arenâ€™t").trim();

                    const correctAnswer = btn.dataset.answer;

                    if (userAnswer === correctAnswer) {
                        feedbackEl.textContent = 'ğŸ‰ å¤ªæ£’äº†ï¼Œç­”å°äº†ï¼';
                        feedbackEl.className = 'feedback mt-2 text-sm font-bold text-green-600';
                        dropZone.classList.remove('incorrect');
                        dropZone.classList.add('correct');
                        card.classList.add('card-glow-animation');
                        setTimeout(() => card.classList.remove('card-glow-animation'), 1000);
                    } else {
                        feedbackEl.textContent = 'ğŸ¤” å†è©¦ä¸€æ¬¡çœ‹çœ‹ï¼';
                        feedbackEl.className = 'feedback mt-2 text-sm font-bold text-red-600';
                        dropZone.classList.remove('correct');
                        dropZone.classList.add('incorrect');
                    }
                });
            });
            
            // Reset unscramble questions (é‡çµ„å¥å­)
            document.querySelectorAll('.reset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const exId = btn.dataset.id;
                    const card = document.getElementById(`exercise-${exId}`);
                    const dropZone = card.querySelector('.drop-zone');
                    const wordBank = card.querySelector('.word-bank');
                    const feedbackEl = card.querySelector('.feedback');
                    
                    // å°‡æ‰€æœ‰å–®å­—ç§»å› word-bank
                    Array.from(dropZone.children).forEach(child => wordBank.appendChild(child));
                    
                    // (å¯é¸) é‡æ–°æ‰“äº‚ word-bank ä¸­çš„é †åº
                    const items = Array.from(wordBank.children);
                    items.sort(() => Math.random() - 0.5);
                    items.forEach(item => wordBank.appendChild(item));

                    feedbackEl.textContent = '';
                    dropZone.classList.remove('correct', 'incorrect');
                });
            });
        }
    </script>
</body>
</html>