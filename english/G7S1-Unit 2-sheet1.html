<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英文名詞複數學習</title>
    <link rel="icon" href="dog.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: none; /* Disable panning and zooming on touch devices for better drag-and-drop */
        }
        .drop-zone {
            transition: background-color 0.3s, transform 0.3s;
        }
        .drop-zone.drag-over {
            background-color: #cceeff;
            transform: scale(1.03);
        }
        .word-card {
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .word-card:not([draggable="true"]) {
            cursor: default;
        }
        .word-card.dragging {
            cursor: grabbing;
            opacity: 0.5;
            transform: scale(1.1);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .feedback {
            font-weight: 700;
            font-size: 1.5rem;
            text-align: center;
            height: 40px;
            transition: opacity 0.3s, transform 0.3s;
        }
        .feedback.correct {
            color: #10B981; /* Emerald 500 */
        }
        .feedback.incorrect {
            color: #EF4444; /* Red 500 */
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .progress-bar-inner {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-blue-50 min-h-screen flex flex-col items-center justify-center p-4">

    <div id="game-container" class="w-full max-w-6xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">名詞變複數・規則挑戰</h1>
            <p class="text-gray-500 mt-2 text-lg">將下方的單字拖曳到正確的規則框吧！</p>
        </header>

        <!-- Drop Zones -->
        <main class="grid grid-cols-1 md:grid-cols-5 gap-4 md:gap-6 mb-6">
            <div id="rule-1" class="drop-zone border-2 border-dashed border-blue-400 bg-blue-100 rounded-xl p-4 text-center flex flex-col justify-center" data-rule="1">
                <h2 class="text-xl font-bold text-blue-800">規則一</h2>
                <p class="text-blue-600 mt-1">字尾直接加 <span class="font-mono font-bold text-red-500">s</span></p>
            </div>
            <div id="rule-2" class="drop-zone border-2 border-dashed border-green-400 bg-green-100 rounded-xl p-4 text-center flex flex-col justify-center" data-rule="2">
                <h2 class="text-xl font-bold text-green-800">規則二</h2>
                <p class="text-green-600 mt-1">去 <span class="font-mono font-bold text-red-500">y</span> 加 <span class="font-mono font-bold text-red-500">ies</span></p>
            </div>
            <div id="rule-3" class="drop-zone border-2 border-dashed border-yellow-400 bg-yellow-100 rounded-xl p-4 text-center flex flex-col justify-center" data-rule="3">
                <h2 class="text-xl font-bold text-yellow-800">規則三</h2>
                <p class="text-yellow-600 mt-1">字尾加 <span class="font-mono font-bold text-red-500">es</span></p>
                <p class="text-xs text-yellow-500">(s, x, ch, sh結尾)</p>
            </div>
            <div id="rule-4" class="drop-zone border-2 border-dashed border-purple-400 bg-purple-100 rounded-xl p-4 text-center flex flex-col justify-center" data-rule="4">
                <h2 class="text-xl font-bold text-purple-800">規則四</h2>
                <p class="text-purple-600 mt-1">去 <span class="font-mono font-bold text-red-500">f/fe</span> 加 <span class="font-mono font-bold text-red-500">ves</span></p>
            </div>
            <div id="rule-5" class="drop-zone border-2 border-dashed border-orange-400 bg-orange-100 rounded-xl p-4 text-center flex flex-col justify-center" data-rule="5">
                <h2 class="text-xl font-bold text-orange-800">不規則</h2>
                <p class="text-orange-600 mt-1">沒有規則的變化</p>
            </div>
        </main>
        
        <!-- Draggable Word Area -->
        <div class="h-40 flex items-center justify-center">
            <div id="word-card" draggable="true" class="word-card bg-white p-6 rounded-lg shadow-md text-4xl font-bold text-gray-700 select-none border-4 border-gray-200">
                <!-- Word will be inserted by JS -->
            </div>
             <div id="completion-message" class="hidden text-center">
                <h2 class="text-3xl font-bold text-green-600">恭喜你，全部完成了！</h2>
                <p class="text-gray-600 mt-2">你真是太棒了！</p>
                <button id="reset-button" class="mt-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">
                    再玩一次
                </button>
            </div>
        </div>

        <!-- Feedback & Progress -->
        <footer class="mt-4 text-center">
            <div id="feedback-message" class="feedback mb-4"></div>
             <button id="next-question-button" class="hidden mb-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-transform transform hover:scale-105">
                下一題
            </button>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div id="progress-bar" class="progress-bar-inner bg-gradient-to-r from-green-400 to-blue-500 h-4 rounded-full" style="width: 0%"></div>
            </div>
            <div class="text-center text-gray-500 mt-2">
                <span id="score">0</span> / <span id="total-words">0</span>
            </div>
        </footer>

    </div>

    <footer class="py-4 text-gray-500 text-sm text-center">
        @spedmix2025
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const words = [
                // Rule 1
                { singular: 'cat', plural: 'cats', rule: 1 },
                { singular: 'book', plural: 'books', rule: 1 },
                { singular: 'apple', plural: 'apples', rule: 1 },
                { singular: 'picture', plural: 'pictures', rule: 1 },
                { singular: 'daughter', plural: 'daughters', rule: 1 },
                // Rule 2
                { singular: 'party', plural: 'parties', rule: 2 },
                { singular: 'family', plural: 'families', rule: 2 },
                { singular: 'baby', plural: 'babies', rule: 2 },
                // Rule 3
                { singular: 'box', plural: 'boxes', rule: 3 },
                { singular: 'bus', plural: 'buses', rule: 3 },
                { singular: 'class', plural: 'classes', rule: 3 },
                { singular: 'brush', plural: 'brushes', rule: 3 },
                { singular: 'watch', plural: 'watches', rule: 3 },
                // Rule 4
                { singular: 'wife', plural: 'wives', rule: 4 },
                { singular: 'leaf', plural: 'leaves', rule: 4 },
                // Rule 5 (Irregular)
                { singular: 'person', plural: 'people', rule: 5 },
                { singular: 'woman', plural: 'women', rule: 5 }
            ];

            let availableWords = [];
            let currentWord = null;
            let score = 0;
            
            const wordCard = document.getElementById('word-card');
            const dropZones = document.querySelectorAll('.drop-zone');
            const feedbackMessage = document.getElementById('feedback-message');
            const scoreDisplay = document.getElementById('score');
            const totalWordsDisplay = document.getElementById('total-words');
            const progressBar = document.getElementById('progress-bar');
            const completionMessage = document.getElementById('completion-message');
            const resetButton = document.getElementById('reset-button');
            const nextQuestionButton = document.getElementById('next-question-button');

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
            
            function startGame() {
                availableWords = [...words];
                shuffleArray(availableWords);
                score = 0;
                currentWord = null;
                
                scoreDisplay.textContent = score;
                totalWordsDisplay.textContent = words.length;
                progressBar.style.width = '0%';
                
                completionMessage.classList.add('hidden');
                nextQuestionButton.classList.add('hidden');
                wordCard.classList.remove('hidden');

                loadNextWord();
            }

            function loadNextWord() {
                feedbackMessage.textContent = '';
                if (availableWords.length > 0) {
                    currentWord = availableWords.pop();
                    wordCard.textContent = currentWord.singular;
                    wordCard.dataset.rule = currentWord.rule;
                    wordCard.setAttribute('draggable', 'true');
                } else {
                    endGame();
                }
            }

            function endGame() {
                wordCard.classList.add('hidden');
                completionMessage.classList.remove('hidden');
            }
            
            function updateProgress() {
                score++;
                scoreDisplay.textContent = score;
                const progressPercentage = (score / words.length) * 100;
                progressBar.style.width = `${progressPercentage}%`;
            }

            function showFeedback(message, isCorrect) {
                feedbackMessage.textContent = message;
                feedbackMessage.className = 'feedback'; // Reset classes
                if (isCorrect) {
                    feedbackMessage.classList.add('correct');
                } else {
                    feedbackMessage.classList.add('incorrect');
                }
                // We keep the feedback until the next question is loaded
            }

            // Drag events
            wordCard.addEventListener('dragstart', (e) => {
                 if (e.target.getAttribute('draggable') === 'true') {
                    e.target.classList.add('dragging');
                } else {
                    e.preventDefault();
                }
            });
            
            wordCard.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });
            
            // Touch events for mobile
            let touchStartX, touchStartY;
            wordCard.addEventListener('touchstart', (e) => {
                if (wordCard.getAttribute('draggable') !== 'true') return;
                wordCard.classList.add('dragging');
                const touch = e.targetTouches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
            }, { passive: true });

            wordCard.addEventListener('touchend', (e) => {
                 if (wordCard.getAttribute('draggable') !== 'true') return;
                wordCard.classList.remove('dragging');
                const touch = e.changedTouches[0];
                const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
                if (dropTarget && dropTarget.closest('.drop-zone')) {
                    handleDrop(dropTarget.closest('.drop-zone'));
                }
            });


            // Drop Zone events
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    if (wordCard.getAttribute('draggable') === 'true') {
                        e.preventDefault();
                        zone.classList.add('drag-over');
                    }
                });
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('drag-over');
                });
                zone.addEventListener('drop', (e) => {
                    if (wordCard.getAttribute('draggable') === 'true') {
                        e.preventDefault();
                        zone.classList.remove('drag-over');
                        handleDrop(zone);
                    }
                });
            });

            function handleDrop(zone) {
                const droppedRule = zone.dataset.rule;
                const correctRule = wordCard.dataset.rule;

                if (droppedRule === correctRule) {
                    showFeedback(`正確！ ${currentWord.singular} -> ${currentWord.plural}`, true);
                    updateProgress();
                    wordCard.setAttribute('draggable', 'false');
                    if (score < words.length) {
                         nextQuestionButton.classList.remove('hidden');
                    } else {
                        endGame(); // Call endGame right after the last correct answer
                    }
                } else {
                    showFeedback('不對喔，再想一想！', false);
                }
            }

            nextQuestionButton.addEventListener('click', () => {
                nextQuestionButton.classList.add('hidden');
                loadNextWord();
            });

            resetButton.addEventListener('click', startGame);

            // Initial game start
            startGame();
        });
    </script>
</body>
</html>

