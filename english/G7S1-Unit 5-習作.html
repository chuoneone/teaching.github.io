<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G7s1-unit5ç¿’ä½œ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Canvas Confetti CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* åŸºç¤è¨­å®š */
        body {
            font-family: 'Nunito', 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }

        /* äº’å‹•å–®å­—æ¨£å¼ - æ›´æ˜é¡¯çš„äº’å‹•æ„Ÿ */
        .word {
            position: relative;
            cursor: pointer;
            border-bottom: 2px dotted #cbd5e1; /* slate-300 */
            transition: all 0.2s ease;
            padding-bottom: 1px;
        }

        .word:hover {
            color: #ea580c; /* orange-600 */
            border-bottom-color: #ea580c;
            background-color: rgba(255, 237, 213, 0.3); /* orange-100 with opacity */
        }

        /* Tooltip å„ªåŒ– */
        .word .tooltip {
            visibility: hidden;
            width: max-content;
            background-color: #1e293b; /* slate-800 */
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 6px 12px;
            position: absolute;
            z-index: 20;
            bottom: 140%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: none;
            font-size: 0.9rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .word .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }

        .word:hover .tooltip {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* å°è¦½åˆ—æ¨£å¼ */
        .nav-item {
            transition: all 0.2s;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .nav-item:hover:not(.active) {
            background-color: #f1f5f9; /* slate-100 */
        }
        .nav-item.active {
            background-color: #f59e0b; /* amber-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.3);
        }

        /* å‹•ç•«ç‰¹æ•ˆ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .animate-pop {
            animation: pop 0.2s ease-out;
        }

        /* è¡¨æ ¼å„ªåŒ– */
        .schedule-table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        .schedule-table th, .schedule-table td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: center;
            background-color: white;
        }
        .schedule-table th {
            font-weight: 600;
        }

        /* è‡ªå®šç¾©æ²è»¸ (é‡å° Chrome/Safari) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        /* äººç‰©æ’éšŠæ¨£å¼ */
        .person-card {
            min-width: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.8rem;
        }
        .person-icon {
            font-size: 2rem;
            transition: transform 0.2s;
        }
        .person-card:hover .person-icon {
            transform: scale(1.2) translateY(-5px);
        }
        .person-name {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
            font-weight: bold;
            color: #475569;
        }
        .person-order {
            color: #94a3b8;
            font-size: 0.7rem;
            margin-bottom: 2px;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col md:flex-row text-slate-800">

    <!-- å´é‚Šå°è¦½åˆ— -->
    <nav class="bg-white shadow-lg w-full md:w-72 md:min-h-screen flex-shrink-0 md:flex md:flex-col z-20 sticky top-0 md:fixed md:h-screen">
        <div class="p-5 border-b border-slate-100 flex items-center justify-between bg-white z-30">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ğŸ“</span>
                <div>
                    <h1 class="text-lg font-bold text-slate-800 leading-tight">G7S1-Unit5ç¿’ä½œ</h1>
                    <p class="text-xs text-slate-500">Learning English is Fun</p>
                </div>
            </div>
        </div>
        
        <!-- å°è¦½æŒ‰éˆ•å€ -->
        <div class="flex md:flex-col overflow-x-auto md:overflow-y-auto p-3 gap-2 hide-scrollbar">
            <button onclick="switchSection('PartA')" id="nav-PartA" class="nav-item active flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">A</span>
                <div>
                    <span class="block text-sm font-bold">å–®å­—å¡«ç©º</span>
                    <span class="block text-xs opacity-80">Vocabulary</span>
                </div>
            </button>
            <button onclick="switchSection('PartB')" id="nav-PartB" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-purple-100 text-purple-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">B</span>
                <div>
                    <span class="block text-sm font-bold">ä»‹ç³»è©å¡«ç©º</span>
                    <span class="block text-xs opacity-80">Prepositions</span>
                </div>
            </button>
            <button onclick="switchSection('PartC')" id="nav-PartC" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-green-100 text-green-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">C</span>
                <div>
                    <span class="block text-sm font-bold">åºæ•¸å¡«ç©º</span>
                    <span class="block text-xs opacity-80">Ordinal Numbers</span>
                </div>
            </button>
            <button onclick="switchSection('PartD')" id="nav-PartD" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-yellow-100 text-yellow-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">D</span>
                <div>
                    <span class="block text-sm font-bold">æ—¥æœŸç·´ç¿’</span>
                    <span class="block text-xs opacity-80">Dates</span>
                </div>
            </button>
            <button onclick="switchSection('PartE')" id="nav-PartE" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-rose-100 text-rose-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">E</span>
                <div>
                    <span class="block text-sm font-bold">ç¯€æ—¥èˆ‡å•ç­”</span>
                    <span class="block text-xs opacity-80">Holidays & Q/A</span>
                </div>
            </button>
            <button onclick="switchSection('PartF')" id="nav-PartF" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-indigo-100 text-indigo-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">F</span>
                <div>
                    <span class="block text-sm font-bold">é–±è®€åˆ¤æ–·</span>
                    <span class="block text-xs opacity-80">True or False</span>
                </div>
            </button>
            <button onclick="switchSection('PartG')" id="nav-PartG" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-orange-100 text-orange-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">G</span>
                <div>
                    <span class="block text-sm font-bold">å•ç­”é¡Œ</span>
                    <span class="block text-xs opacity-80">Q & A</span>
                </div>
            </button>
            <button onclick="switchSection('PartH')" id="nav-PartH" class="nav-item flex-shrink-0 w-auto md:w-full text-left px-4 py-3 focus:outline-none flex items-center gap-3">
                <span class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold">H</span>
                <div>
                    <span class="block text-sm font-bold">é–±è®€é¸æ“‡</span>
                    <span class="block text-xs opacity-80">Reading Comp.</span>
                </div>
            </button>
        </div>
        
        <div class="mt-auto p-5 hidden md:block border-t border-slate-100">
            <div class="flex items-center justify-between text-xs text-slate-400">
                <span>Version 4.0</span>
                <span>Pro Edition âœ¨</span>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="flex-1 p-4 md:p-8 md:ml-72 flex flex-col items-center min-h-screen">
        <div id="quiz-container" class="bg-white p-6 sm:p-10 rounded-3xl shadow-xl w-full max-w-4xl transition-all duration-300 border border-slate-100 relative overflow-hidden mb-8">
            
            <!-- é ‚éƒ¨è³‡è¨Šåˆ— -->
            <div class="flex justify-between items-end mb-8 border-b border-slate-100 pb-4">
                <div>
                    <p class="text-sm text-amber-500 font-bold uppercase tracking-wider mb-1" id="section-tag">Section A</p>
                    <h2 id="section-title" class="text-3xl font-extrabold text-slate-800">å–®å­—å¡«ç©º</h2>
                </div>
                <div class="text-right">
                    <span id="question-counter" class="text-2xl font-bold text-slate-700">1</span>
                    <span class="text-slate-400 text-lg">/5</span>
                </div>
            </div>
            
            <!-- é€²åº¦æ¢ -->
            <div class="w-full bg-slate-100 rounded-full h-3 mb-8 overflow-hidden">
                <div id="progress-bar" class="bg-amber-500 h-full rounded-full transition-all duration-700 ease-out shadow-[0_0_10px_rgba(245,158,11,0.5)]" style="width: 0%"></div>
            </div>
            
            <!-- é¡Œç›®å€åŸŸ -->
            <div id="questions-wrapper" class="min-h-[200px]"></div>

            <!-- æ§åˆ¶å€ -->
            <div id="controls" class="mt-10 text-center"></div>
            
            <!-- åˆ†æ•¸é¡¯ç¤ºå€ -->
            <div id="score-display" class="mt-6 text-center hidden animate-fade-in"></div>
        </div>

        <!-- é å°¾ -->
        <footer class="container mx-auto px-4 py-6 text-center text-gray-500 text-xs mt-auto">
            <p>&copy; 2025 ç±³å…‹å¸«</p>
            <p>æœ¬ä½œå“æ¡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank" class="underline hover:text-amber-500 transition-colors">CC BY-NC-SA 4.0 å‰µç”¨CCæˆæ¬Š</a>ã€‚</p>
            <p>æ­¡è¿éå•†æ¥­ç”¨é€”è½‰è¼‰ã€å¼•ç”¨æˆ–æ”¹ç·¨ï¼Œè«‹ä¿ç•™ã€Œç±³å…‹å¸«ã€ç½²åï¼Œä¸¦é™„ä¸Šæœ¬ä½œå“åŸå§‹é€£çµã€‚</p>
        </footer>
    </main>

    <!-- æç¤º Modal -->
    <div id="alert-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-sm text-center transform scale-100 transition-transform duration-300 animate-pop">
            <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-3xl">âš ï¸</span>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">æç¤º</h3>
            <p id="alert-message" class="text-slate-600 mb-6">è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼</p>
            <button id="close-alert-btn" class="w-full bg-amber-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-amber-600 active:scale-95 transition-all shadow-lg shadow-amber-500/30">çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // --- éŸ³æ•ˆç³»çµ± (Web Audio API) ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1046.5, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'wrong') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'click') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.05);
            }
        }

        // --- è³‡æ–™å®šç¾©å€ ---
        const translations = {
            // Part A
            "september": "ä¹æœˆ", "confucius": "å­”å­", "birthday": "ç”Ÿæ—¥", "family": "å®¶äºº",
            "friends": "æœ‹å‹", "important": "é‡è¦çš„", "cow": "ç‰›", "animal": "å‹•ç‰©",
            "christmas": "è–èª•ç¯€", "dinner": "æ™šé¤", "turkey": "ç«é›", "mother's": "æ¯è¦ªçš„",
            "holiday": "ç¯€æ—¥", 
            
            // Part B
            "wednesday": "æ˜ŸæœŸä¸‰", "fourth": "ç¬¬å››", "week": "é€±", "party": "æ´¾å°",
            "evening": "å‚æ™š", "december": "åäºŒæœˆ", "father's": "çˆ¶è¦ªçš„", "japan": "æ—¥æœ¬",
            "third": "ç¬¬ä¸‰", "sunday": "æ˜ŸæœŸæ—¥", "june": "å…­æœˆ", "baseball": "æ£’çƒ", "game": "æ¯”è³½",
            
            // Part C
            "person": "äºº", "line": "éšŠä¼", "lisa": "éº—è", "ted": "æ³°å¾·", "yuki": "ç”±ç´€",
            "doris": "å¤šè‰çµ²", "neil": "å°¼çˆ¾", "first": "ç¬¬ä¸€", "second": "ç¬¬äºŒ",
            "third": "ç¬¬ä¸‰", "fourth": "ç¬¬å››", "fifth": "ç¬¬äº”", "sixth": "ç¬¬å…­",
            "seventh": "ç¬¬ä¸ƒ", "eighth": "ç¬¬å…«", "ninth": "ç¬¬ä¹", "tenth": "ç¬¬å",

            // Part D & E
            "march": "ä¸‰æœˆ", "thirtieth": "ç¬¬30", "fourteenth": "ç¬¬14", "twentieth": "ç¬¬20",
            "july": "ä¸ƒæœˆ", "eighth": "ç¬¬8", "april": "å››æœˆ", "fifth": "ç¬¬5",
            "what's": "æ˜¯ä»€éº¼", "date": "æ—¥æœŸ", "today": "ä»Šå¤©", "it's": "å®ƒæ˜¯",
            "eve": "å‰å¤•", "august": "å…«æœˆ", "november": "åä¸€æœˆ", "thanksgiving": "æ„Ÿæ©ç¯€",

            // Part F, G, H
            "pete": "å½¼ç‰¹", "dad": "çˆ¸çˆ¸", "thursday": "æ˜ŸæœŸå››", "year": "å¹´",
            "tomorrow": "æ˜å¤©", "month": "æœˆä»½", "right": "æ­£å¥½/å³é‚Š", "after": "åœ¨...ä¹‹å¾Œ",
            "january": "ä¸€æœˆ", "february": "äºŒæœˆ", "favorite": "æœ€å–œæ„›çš„",
            "sarah": "èæ‹‰", "jasper": "è³ˆæ–¯æŸ", "living": "å±…ä½/å®¢å»³", "room": "æˆ¿é–“",
            "hanging": "æ­£åœ¨æ›", "balls": "çƒ", "tree": "æ¨¹", "sure": "ç•¶ç„¶",
            "together": "ä¸€èµ·", "minutes": "åˆ†é˜", "break": "ä¼‘æ¯", "hurry": "å¿«é»",
            "husband": "ä¸ˆå¤«", "wife": "å¦»å­", "learn": "å­¸ç¿’/å¾—çŸ¥", "dialogue": "å°è©±"
        };

        const quizSections = {
            'PartA': {
                title: "å–®å­—å¡«ç©º",
                subtitle: "Part A: Vocabulary",
                data: [
                    {
                        type: "choice",
                        question: "September 28 is Confucius' ______.",
                        options: ["birthday", "teacher", "student", "book"],
                        answer: "A",
                        hint: "9æœˆ28æ—¥æ˜¯å­”å­çš„... (èª•ç”Ÿ)"
                    },
                    {
                        type: "choice",
                        question: "My family and friends are ______ to me.",
                        options: ["busy", "important", "hungry", "angry"],
                        answer: "B",
                        hint: "å®¶äººå’Œæœ‹å‹å°æˆ‘ä¾†èªªéå¸¸... (é‡è¦)"
                    },
                    {
                        type: "choice",
                        question: "A cow is an ______.",
                        options: ["animal", "apple", "ant", "arm"],
                        answer: "A",
                        hint: "ç‰›æ˜¯ä¸€ç¨®..."
                    },
                    {
                        type: "choice",
                        question: "Our Christmas dinner is a big ______.",
                        options: ["turtle", "tiger", "turkey", "table"],
                        answer: "C",
                        hint: "è–èª•æ™šé¤é€šå¸¸æœƒåƒä¸€éš»å¤§... (é³¥é¡)"
                    },
                    {
                        type: "choice",
                        question: "Mother's Day is a ______.",
                        options: ["holiday", "hobby", "horse", "hour"],
                        answer: "A",
                        hint: "æ¯è¦ªç¯€æ˜¯ä¸€å€‹..."
                    }
                ]
            },
            'PartB': {
                title: "ä»‹ç³»è©å¡«ç©º",
                subtitle: "Part B: Prepositions",
                data: [
                    {
                        type: "choice",
                        question: "Wednesday is the fourth day ______ the week.",
                        options: ["of", "in", "at", "on"],
                        answer: "A",
                        hint: "é€™é€±çš„ç¬¬å››å¤© (the fourth day ... the week)ã€‚è¡¨ç¤ºã€Œ...çš„ã€ç”¨ ofã€‚"
                    },
                    {
                        type: "choice",
                        question: "The party is ______ the evening ______ December 31.",
                        options: ["in / of", "on / of", "at / in", "on / in"],
                        answer: "B",
                        hint: "ç‰¹å®šæ—¥æœŸçš„æ™šä¸Šè¦ç”¨ onï¼›...æœˆ...æ—¥çš„æ—¥æœŸçµæ§‹å¯ä»¥ç”¨ of (the evening of Date)ã€‚"
                    },
                    {
                        type: "choice",
                        question: "Father's Day in Japan is ______ the third Sunday ______ June.",
                        options: ["in / in", "on / of", "at / of", "on / in"],
                        answer: "B",
                        hint: "ç‰¹å®šçš„æ˜ŸæœŸå¹¾ (Sunday) ç”¨ onï¼›å…­æœˆçš„ç¬¬ä¸‰å€‹ (of June)ã€‚"
                    },
                    {
                        type: "choice",
                        question: "The baseball game is ______ five ______ Sunday afternoon.",
                        options: ["at / in", "in / on", "at / on", "on / at"],
                        answer: "C",
                        hint: "æ™‚é–“é» (five) ç”¨ atï¼›ç‰¹å®šæ—¥æœŸçš„ä¸‹åˆ (Sunday afternoon) ç”¨ onã€‚"
                    }
                ]
            },
            'PartC': {
                title: "åºæ•¸å¡«ç©º",
                subtitle: "Part C: Ordinal Numbers",
                visualType: "line",
                data: [
                    {
                        type: "choice",
                        question: "Lisa is the ______ person in the line.",
                        options: ["first", "second", "third", "two"],
                        answer: "B",
                        hint: "çœ‹ä¸Šé¢çš„åœ–ï¼ŒLisa æ’åœ¨ç¬¬å¹¾å€‹ä½ç½®ï¼Ÿ"
                    },
                    {
                        type: "choice",
                        question: "The ______ person is Ted.",
                        options: ["ninth", "tenth", "ten", "eighth"],
                        answer: "B",
                        hint: "æ‰¾åˆ° Tedï¼Œæ•¸æ•¸çœ‹ä»–åœ¨ç¬¬å¹¾å€‹ä½ç½®ã€‚"
                    },
                    {
                        type: "choice",
                        question: "Yuki is the ______ person in the line.",
                        options: ["six", "fifth", "sixth", "seventh"],
                        answer: "C",
                        hint: "æ‰¾åˆ° Yukiï¼Œå¥¹åœ¨ç¬¬å¹¾å€‹ä½ç½®ï¼Ÿ(æ³¨æ„ spelling: six + th)"
                    },
                    {
                        type: "choice",
                        question: "Doris is the ______ person in the line.",
                        options: ["one", "first", "second", "third"],
                        answer: "B",
                        hint: "Doris æ’åœ¨æœ€å‰é¢ï¼Œæ‰€ä»¥å¥¹æ˜¯...?"
                    },
                    {
                        type: "choice",
                        question: "The ______ person is Neil.",
                        options: ["three", "third", "thirteenth", "second"],
                        answer: "B",
                        hint: "æ‰¾åˆ° Neilï¼Œä»–åœ¨ç¬¬å¹¾å€‹ä½ç½®ï¼Ÿ"
                    }
                ]
            },
            'PartD': {
                title: "æ—¥æœŸç·´ç¿’",
                subtitle: "Part D: Look and Write Dates",
                data: [
                    {
                        type: "choice",
                        visualType: "calendar",
                        date: { month: "March", day: "30" },
                        question: "3/30",
                        options: ["March three", "March thirtieth", "May thirtieth", "March thirteen"],
                        answer: "B",
                        hint: "3æœˆæ˜¯ Marchï¼Œ30æ—¥çš„åºæ•¸æ˜¯ thirtiethã€‚"
                    },
                    {
                        type: "choice",
                        visualType: "calendar",
                        date: { month: "June", day: "14" },
                        question: "6/14",
                        options: ["June four", "July fourteenth", "June fourteenth", "June forty"],
                        answer: "C",
                        hint: "6æœˆæ˜¯ Juneï¼Œ14æ—¥çš„åºæ•¸æ˜¯ fourteenthã€‚"
                    },
                    {
                        type: "choice",
                        visualType: "calendar",
                        date: { month: "September", day: "20" },
                        question: "9/20",
                        options: ["September twentieth", "September twelfth", "September two", "October twentieth"],
                        answer: "A",
                        hint: "9æœˆæ˜¯ Septemberï¼Œ20æ—¥çš„åºæ•¸æ˜¯ twentieth (å»yåŠ ieth)ã€‚"
                    },
                    {
                        type: "choice",
                        visualType: "calendar",
                        date: { month: "July", day: "8" },
                        question: "7/8",
                        options: ["July eight", "June eighth", "July eighty", "July eighth"],
                        answer: "D",
                        hint: "7æœˆæ˜¯ Julyï¼Œ8æ—¥çš„åºæ•¸æ˜¯ eighth (eightåŠ h)ã€‚"
                    },
                    {
                        type: "choice",
                        visualType: "calendar",
                        date: { month: "April", day: "5" },
                        question: "4/5",
                        options: ["April five", "April fifth", "August fifth", "April fifteen"],
                        answer: "B",
                        hint: "4æœˆæ˜¯ Aprilï¼Œ5æ—¥çš„åºæ•¸æ˜¯ fifth (æ³¨æ„æ‹¼å¯«è®Šç‚º f)ã€‚"
                    }
                ]
            },
            'PartE': {
                title: "ç¯€æ—¥èˆ‡å•ç­”",
                subtitle: "Part E: Holidays & Q/A",
                data: [
                    {
                        type: "choice",
                        visualType: "holiday",
                        date: { month: "Dec.", day: "24", icon: "ğŸ„", label: "Christmas Eve" },
                        question: "Q: What's the date today?<br>A: It's ______.<br>It's ______.",
                        options: [
                            "December twenty-five / Christmas",
                            "December twenty-fourth / Christmas Eve",
                            "November twenty-fourth / Thanksgiving",
                            "December four / Christmas Eve"
                        ],
                        answer: "B",
                        hint: "12æœˆ24æ—¥æ˜¯ December twenty-fourthï¼Œç¯€æ—¥æ˜¯è–èª•å¤œ (Christmas Eve)ã€‚"
                    },
                    {
                        type: "choice",
                        visualType: "holiday",
                        date: { month: "Aug.", day: "8", icon: "ğŸ‘”", label: "Father's Day" },
                        question: "Q: What's the date today?<br>A: It's ______.<br>It's ______.",
                        options: [
                            "August eighth / Father's Day",
                            "August eighteen / Father's Day",
                            "April eighth / Mother's Day",
                            "August eight / Father's Day"
                        ],
                        answer: "A",
                        hint: "8æœˆ8æ—¥æ˜¯ August eighthï¼Œç¯€æ—¥æ˜¯çˆ¶è¦ªç¯€ (Father's Day)ã€‚"
                    },
                    {
                        type: "choice",
                        visualType: "holiday",
                        date: { month: "Nov.", day: "28", icon: "ğŸ¦ƒ", label: "Thanksgiving" },
                        question: "Q: What's the date today?<br>A: It's ______.<br>It's ______.",
                        options: [
                            "November twenty / Thanksgiving",
                            "November twenty-eighth / Thanksgiving",
                            "November twelve / Teacher's Day",
                            "October twenty-eighth / Halloween"
                        ],
                        answer: "B",
                        hint: "11æœˆ28æ—¥æ˜¯ November twenty-eighthï¼Œç¯€æ—¥æ˜¯æ„Ÿæ©ç¯€ (Thanksgiving)ã€‚"
                    }
                ]
            },
            'PartF': {
                title: "é–±è®€åˆ¤æ–·",
                subtitle: "Part F: Read and Circle (True/False)",
                visualType: "article",
                articleContent: `
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 mb-6 text-lg leading-relaxed shadow-sm">
                        <p><span class="font-bold text-blue-600">Pete:</span> What's the date today, Dad?</p>
                        <p><span class="font-bold text-slate-600">Dad:</span> It's November 20.</p>
                        <p><span class="font-bold text-blue-600">Pete:</span> Hey, today is Thursday. It's Thanksgiving today.</p>
                        <p><span class="font-bold text-slate-600">Dad:</span> No. Thanksgiving is not this week.</p>
                        <p><span class="font-bold text-blue-600">Pete:</span> When is it then?</p>
                        <p><span class="font-bold text-slate-600">Dad:</span> It is on the fourth Thursday of November. It's on November 27 this year.</p>
                        <p><span class="font-bold text-blue-600">Pete:</span> I see.</p>
                    </div>
                `,
                data: [
                    {
                        type: "choice",
                        question: "Tomorrow is November 22.",
                        options: ["True (T)", "False (F)"],
                        answer: "B",
                        hint: "å°è©±ä¸­çˆ¸çˆ¸èªªä»Šå¤©æ˜¯ November 20 (11æœˆ20æ—¥)ï¼Œæ‰€ä»¥æ˜å¤©æ˜¯21æ—¥ï¼Œä¸æ˜¯22æ—¥ã€‚"
                    },
                    {
                        type: "choice",
                        question: "Thanksgiving is this month.",
                        options: ["True (T)", "False (F)"],
                        answer: "A",
                        hint: "çˆ¸çˆ¸èªª Thanksgiving æ˜¯åœ¨ November 27 (é€™å€‹æœˆçš„27æ—¥)ï¼Œæ‰€ä»¥æ˜¯å°çš„ã€‚"
                    },
                    {
                        type: "choice",
                        question: "Today is not Thanksgiving.",
                        options: ["True (T)", "False (F)"],
                        answer: "A",
                        hint: "Pete èª¤ä»¥ç‚ºä»Šå¤©æ˜¯ Thanksgivingï¼Œä½†çˆ¸çˆ¸èªª Noã€‚æ‰€ä»¥ä»Šå¤©ä¸æ˜¯ã€‚"
                    },
                    {
                        type: "choice",
                        question: "Thanksgiving is in the fourth month of the year.",
                        options: ["True (T)", "False (F)"],
                        answer: "B",
                        hint: "Thanksgiving åœ¨ November (11æœˆ)ï¼Œä¸æ˜¯ç¬¬å››å€‹æœˆä»½ (April)ã€‚"
                    }
                ]
            },
            'PartG': {
                title: "å•ç­”é¡Œ",
                subtitle: "Part G: Answer the questions",
                data: [
                    {
                        type: "choice",
                        question: "Which month is right after January?",
                        options: ["February is right after January.", "March is right after January.", "December is right after January."],
                        answer: "A",
                        hint: "January æ˜¯1æœˆï¼Œright after (ç·Šæ¥åœ¨å¾Œ) çš„æ˜¯2æœˆ (February)ã€‚"
                    },
                    {
                        type: "choice",
                        question: "When is your birthday?",
                        options: ["My birthday is on March fourth.", "My birthday is at March fourth.", "My birthday is in March four."],
                        answer: "A",
                        hint: "ç‰¹å®šæ—¥æœŸ (March fourth) å‰é¢ä»‹ç³»è©ç”¨ onã€‚æ­£ç¢ºèªªæ³•æ˜¯ My birthday is on March fourth."
                    },
                    {
                        type: "choice",
                        question: "What is your favorite holiday?",
                        options: ["My favorite holiday is Christmas.", "My favorite holiday is on Christmas.", "I favorite holiday is Christmas."],
                        answer: "A",
                        hint: "ä¸»è©æ˜¯ My favorite holidayï¼Œå‹•è© isï¼Œå¾Œé¢ç›´æ¥æ¥ç¯€æ—¥åç¨± (Christmas)ã€‚ä¸ç”¨åŠ  onã€‚"
                    }
                ]
            },
            'PartH': {
                title: "é–±è®€é¸æ“‡",
                subtitle: "Part H: Read and Choose",
                visualType: "article",
                articleContent: `
                    <div class="bg-green-50 p-6 rounded-xl border border-green-100 mb-6 text-lg leading-relaxed shadow-sm">
                        <div class="text-sm text-gray-500 italic mb-2">(In the living room)</div>
                        <p><span class="font-bold text-pink-600">Sarah:</span> What are you doing, Jasper?</p>
                        <p><span class="font-bold text-teal-600">Jasper:</span> I'm hanging balls on the tree. Can you help?</p>
                        <p><span class="font-bold text-pink-600">Sarah:</span> Sure. Let's do it together.</p>
                        <div class="text-sm text-gray-500 italic my-2">(After ten minutes)</div>
                        <p><span class="font-bold text-pink-600">Sarah:</span> Can we take a break?</p>
                        <p><span class="font-bold text-teal-600">Jasper:</span> No. Tomorrow is Christmas Eve. Let's hurry.</p>
                        <p><span class="font-bold text-pink-600">Sarah:</span> OK. Wait! Tomorrow is December 23. It's not Christmas Eve.</p>
                        <p><span class="font-bold text-teal-600">Jasper:</span> OK. Maybe we can do it tomorrow.</p>
                        <div class="mt-4 pt-4 border-t border-green-200 text-sm text-slate-600 grid grid-cols-2 gap-2">
                            <span>hang: åŠæ›</span>
                            <span>help: å¹«å¿™</span>
                            <span>minute: åˆ†é˜</span>
                            <span>take a break: ä¼‘æ¯ä¸€ä¸‹</span>
                            <span>tomorrow: æ˜å¤©</span>
                        </div>
                    </div>
                `,
                data: [
                    {
                        type: "choice",
                        question: "What's the date today?",
                        options: ["December 22.", "December 23.", "December 24.", "December 25."],
                        answer: "A",
                        hint: "Sarah èªªæ˜å¤©æ˜¯ December 23 (12æœˆ23æ—¥)ï¼Œæ‰€ä»¥ä»Šå¤©æ˜¯ 12æœˆ22æ—¥ã€‚"
                    },
                    {
                        type: "choice",
                        question: "What can we learn from the dialogue?",
                        options: [
                            "Christmas is an important day to Jasper.",
                            "Jasper and Sarah are husband and wife.",
                            "Jasper and Sarah are talking under a tree outside.",
                            "Today is Christmas Eve."
                        ],
                        answer: "A",
                        hint: "Jasper æ€¥è‘—ä½ˆç½®è–èª•æ¨¹ï¼Œç”šè‡³ä¸æƒ³ä¼‘æ¯ï¼Œé¡¯ç¤ºè–èª•ç¯€å°ä»–å¾ˆé‡è¦ã€‚Sarah èªªä»Šå¤©ä¸æ˜¯ Christmas Eveï¼Œä»–å€‘æ˜¯åœ¨å®¢å»³ (living room) ä¸æ˜¯æˆ¶å¤–ã€‚"
                    }
                ]
            }
        };

        // --- å…¨åŸŸè®Šæ•¸ ---
        let currentSectionId = 'PartA';
        let currentData = quizSections['PartA'].data;
        let currentQuestionIndex = 0;
        let score = 0;

        // --- DOM å…ƒç´  ---
        const questionsWrapper = document.getElementById('questions-wrapper');
        const controlsContainer = document.getElementById('controls');
        const scoreDisplay = document.getElementById('score-display');
        const progressBar = document.getElementById('progress-bar');
        const sectionTitle = document.getElementById('section-title');
        const sectionTag = document.getElementById('section-tag');
        const questionCounter = document.getElementById('question-counter');
        const alertModal = document.getElementById('alert-modal');
        const alertMessage = document.getElementById('alert-message');
        const closeAlertBtn = document.getElementById('close-alert-btn');
        const quizContainer = document.getElementById('quiz-container');

        // --- è¦–è¦ºç”¢ç”Ÿå‡½å¼ ---
        function createLineVisual() {
            // å®šç¾© 10 å€‹äººçš„è³‡æ–™
            const people = [
                { name: "Doris", gender: "girl", color: "text-pink-500" }, // 1st
                { name: "Lisa", gender: "girl", color: "text-purple-500" }, // 2nd
                { name: "Neil", gender: "boy", color: "text-blue-500" },   // 3rd
                { name: "Ben", gender: "boy", color: "text-slate-400" },
                { name: "Ann", gender: "girl", color: "text-slate-400" },
                { name: "Yuki", gender: "girl", color: "text-rose-500" }, // 6th
                { name: "Ken", gender: "boy", color: "text-slate-400" },
                { name: "Sam", gender: "boy", color: "text-slate-400" },
                { name: "Ivy", gender: "girl", color: "text-slate-400" },
                { name: "Ted", gender: "boy", color: "text-indigo-500" }   // 10th
            ];

            let html = `<div class="flex flex-wrap justify-center gap-2 mb-8 bg-slate-50 p-4 rounded-xl border border-slate-200 overflow-x-auto">`;
            
            people.forEach((p, index) => {
                const order = ["1st", "2nd", "3rd", "4th", "5th", "6th", "7th", "8th", "9th", "10th"][index];
                const icon = p.gender === 'girl' ? 'ğŸ‘§' : 'ğŸ‘¦';
                html += `
                    <div class="person-card">
                        <span class="person-order">${order}</span>
                        <div class="person-icon ${p.color}">${icon}</div>
                        <span class="person-name">${p.name}</span>
                    </div>
                `;
                // åŠ ç®­é ­
                if (index < 9) {
                     html += `<div class="flex items-center text-slate-300">âœ</div>`;
                }
            });
            html += `</div>`;
            return html;
        }

        function createCalendarVisual(month, day, isSmall = false) {
            return `
                <div class="flex justify-center mb-6">
                    <div class="bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden w-32 text-center transform hover:scale-105 transition-transform">
                        <div class="bg-red-500 text-white font-bold py-1 uppercase tracking-wider text-sm">
                            ${month}
                        </div>
                        <div class="py-4">
                            <span class="text-5xl font-extrabold text-slate-800">${day}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function createHolidayVisual(month, day, icon, label) {
            return `
                <div class="flex justify-center mb-6 gap-6 items-center">
                    <div class="bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden w-32 text-center">
                        <div class="bg-indigo-600 text-white font-bold py-1 uppercase tracking-wider text-sm">
                            ${month}
                        </div>
                        <div class="py-4">
                            <span class="text-5xl font-extrabold text-slate-800">${day}</span>
                        </div>
                    </div>
                    <div class="text-center animate-pop">
                        <div class="text-6xl mb-2 drop-shadow-md">${icon}</div>
                        <div class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs font-bold">${label}</div>
                    </div>
                </div>
            `;
        }

        // --- æ ¸å¿ƒåŠŸèƒ½å‡½å¼ ---
        function createInteractiveText(text) {
            const parts = text.split(/([a-zA-Z'â€™\-]+)/);
            return parts.map(part => {
                if (part.match(/[<>]/)) return part;

                const cleanPart = part.toLowerCase().replace(/â€™/g, "'").replace(/[^a-z\-]/g, "");
                if (translations[cleanPart]) {
                    return `<span class="word" onclick="event.stopPropagation(); speak('${part}')">${part}<span class="tooltip">${translations[cleanPart]}</span></span>`;
                }
                return part;
            }).join('');
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                let cleanText = text.replace(/<[^>]*>/g, "");
                // è™•ç†é¸é …ä¸­çš„æ–œç·š
                cleanText = cleanText.replace(/\//g, ". It's ");
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                const voices = window.speechSynthesis.getVoices();
                const enVoice = voices.find(v => v.lang.includes('en-US') || v.lang.includes('en-GB'));
                if (enVoice) utterance.voice = enVoice;
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function createSpeakerIcon(textToSpeak) {
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "h-6 w-6 text-amber-500 hover:text-amber-600 cursor-pointer flex-shrink-0 transition-transform hover:scale-110");
            svg.setAttribute("viewBox", "0 0 20 20");
            svg.setAttribute("fill", "currentColor");
            
            const path = document.createElementNS(svgNS, "path");
            path.setAttribute("fill-rule", "evenodd");
            path.setAttribute("d", "M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.016 5.39a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 11-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026zM14.07 3.33a.75.75 0 01.016 1.046l-1.04 1.04a.75.75 0 01-1.06-1.06l1.04-1.04a.75.75 0 011.044-.026z");
            path.setAttribute("clip-rule", "evenodd");
            svg.appendChild(path);
            
            svg.onclick = (e) => { 
                e.stopPropagation(); 
                speak(textToSpeak); 
            };
            return svg;
        }

        // --- å°è¦½èˆ‡ç‹€æ…‹åˆ‡æ› ---
        window.switchSection = function(sectionId) {
            currentSectionId = sectionId;
            
            if (!quizSections[sectionId]) return;

            currentData = quizSections[sectionId].data;
            currentQuestionIndex = 0;
            score = 0;
            
            // æ›´æ–°æ¨™é¡Œ
            sectionTitle.textContent = quizSections[sectionId].title;
            sectionTag.textContent = quizSections[sectionId].subtitle;
            
            // æ›´æ–°é¸å–®ç‹€æ…‹
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
            });
            
            const activeBtn = document.getElementById(`nav-${sectionId}`);
            if(activeBtn) activeBtn.classList.add('active');

            // é‡ç½®é¡¯ç¤º
            scoreDisplay.classList.add('hidden');
            questionsWrapper.classList.remove('hidden');
            controlsContainer.classList.remove('hidden');
            
            displayQuestion(0);
            playSound('click');
        };

        function displayQuestion(index) {
            questionsWrapper.innerHTML = '';
            controlsContainer.innerHTML = '';
            questionCounter.textContent = `${index + 1}`;
            
            // å¹³æ»‘é€²åº¦æ¢
            const progressPercentage = (index / currentData.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;

            const q = currentData[index];
            const currentSection = quizSections[currentSectionId];

            const questionBlock = document.createElement('div');
            questionBlock.className = 'animate-fade-in';
            
            // æ’å…¥è¦–è¦ºè¼”åŠ©
            if (currentSection.visualType === 'line') {
                questionBlock.innerHTML += createLineVisual();
            } else if (currentSection.visualType === 'article') {
                questionBlock.innerHTML += `<div class="article-container">${createInteractiveText(currentSection.articleContent)}</div>`;
            } else if (q.visualType === 'calendar') {
                questionBlock.innerHTML += createCalendarVisual(q.date.month, q.date.day);
            } else if (q.visualType === 'holiday') {
                questionBlock.innerHTML += createHolidayVisual(q.date.month, q.date.day, q.date.icon, q.date.label);
            }

            // é¡Œç›®å¡ç‰‡
            const card = document.createElement('div');
            card.className = "bg-white border border-slate-200 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow duration-300";

            // é¡Œç›®æ–‡å­—
            const questionText = document.createElement('div');
            questionText.className = 'flex items-start gap-4 mb-6';
            
            let cleanQText = q.question.replace(/<br>/g, ' ').replace(/______/g, 'blank');
            const speaker = createSpeakerIcon(cleanQText);
            
            const textSpan = document.createElement('h3');
            textSpan.className = "text-xl text-slate-800 font-semibold leading-relaxed mt-1";
            textSpan.innerHTML = `${createInteractiveText(q.question)}`;
            
            questionText.appendChild(speaker);
            questionText.appendChild(textSpan);
            card.appendChild(questionText);

            // æ¸²æŸ“é¸é …
            renderChoiceOptions(q, index, card);

            // æç¤ºæŒ‰éˆ•
            renderHint(q, card);

            questionBlock.appendChild(card);
            questionsWrapper.appendChild(questionBlock);

            // æäº¤æŒ‰éˆ•
            const submitButton = document.createElement('button');
            submitButton.className = 'w-full sm:w-auto bg-amber-500 text-white font-bold py-3 px-10 rounded-xl hover:bg-amber-600 hover:scale-105 active:scale-95 transition-all shadow-lg shadow-amber-500/30 text-lg';
            submitButton.textContent = 'æª¢æŸ¥ç­”æ¡ˆ';
            submitButton.onclick = () => checkAnswer(index);
            controlsContainer.appendChild(submitButton);
        }

        function renderChoiceOptions(q, index, container) {
            const optionsGrid = document.createElement('div');
            const isLongOption = q.options.some(opt => opt.length > 25);
            optionsGrid.className = `grid ${isLongOption ? 'grid-cols-1' : 'grid-cols-1 sm:grid-cols-1 md:grid-cols-2'} gap-4 mb-6`;
            
            q.options.forEach((option, i) => {
                const optionChar = String.fromCharCode(65 + i);
                const optionContainer = document.createElement('div');
                optionContainer.className = 'group relative flex items-center p-4 border-2 border-slate-200 rounded-xl transition-all cursor-pointer hover:border-amber-400 hover:bg-amber-50';
                optionContainer.setAttribute('role', 'button');
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.id = `q${index}-opt${optionChar}`;
                radio.name = `q${index}`;
                radio.value = optionChar;
                radio.className = 'opacity-0 absolute w-0 h-0'; // éš±è—åŸç”Ÿ radio ä½†ä¿ç•™åŠŸèƒ½

                // è‡ªå®šç¾© Radio UI
                const radioUI = document.createElement('div');
                radioUI.className = "w-6 h-6 rounded-full border-2 border-slate-300 group-hover:border-amber-500 mr-4 flex items-center justify-center flex-shrink-0 transition-colors";
                const radioDot = document.createElement('div');
                radioDot.className = "w-3 h-3 rounded-full bg-amber-500 transform scale-0 transition-transform duration-200";
                radioUI.appendChild(radioDot);

                const label = document.createElement('label');
                label.htmlFor = `q${index}-opt${optionChar}`;
                label.className = 'block text-lg text-slate-700 flex-1 cursor-pointer flex items-center gap-3';
                
                // é¸é …æ–‡å­—ä¹ŸåŠ å…¥ç™¼éŸ³æŒ‰éˆ•
                label.appendChild(createSpeakerIcon(option));
                const textSpan = document.createElement('span');
                textSpan.innerHTML = option; // é¸é …é€šå¸¸ä¸éœ€äº’å‹•ç¿»è­¯ï¼Œç›´æ¥é¡¯ç¤º
                label.appendChild(textSpan);

                // é»æ“Šäº‹ä»¶
                optionContainer.onclick = () => { 
                    // æ¸…é™¤å…¶ä»–é¸é …æ¨£å¼
                    container.querySelectorAll('.border-amber-500').forEach(el => {
                        el.classList.remove('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
                        el.classList.add('border-slate-200');
                    });
                    container.querySelectorAll('.scale-100').forEach(el => el.classList.remove('scale-100'));

                    // é¸ä¸­ç•¶å‰
                    radio.checked = true; 
                    optionContainer.classList.remove('border-slate-200');
                    optionContainer.classList.add('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
                    radioDot.classList.add('scale-100');
                    playSound('click');
                };

                optionContainer.appendChild(radio);
                optionContainer.appendChild(radioUI);
                optionContainer.appendChild(label);
                optionsGrid.appendChild(optionContainer);
            });
            container.appendChild(optionsGrid);
        }

        function renderHint(q, container) {
            const hintContainer = document.createElement('div');
            hintContainer.className = 'mt-4';
            
            const hintButton = document.createElement('button');
            hintButton.className = 'text-sm text-amber-600 hover:text-amber-800 flex items-center gap-2 font-bold transition-colors';
            hintButton.innerHTML = '<span class="bg-amber-100 rounded-full w-6 h-6 flex items-center justify-center">ğŸ’¡</span> æŸ¥çœ‹æç¤º';
            
            const hintText = document.createElement('div');
            hintText.className = 'hint-content hidden mt-3 text-base text-slate-600 bg-amber-50 border border-amber-100 p-4 rounded-xl animate-fade-in';
            hintText.innerHTML = `<p>${q.hint}</p>`;
            
            hintButton.onclick = () => {
                hintText.classList.toggle('hidden');
                playSound('click');
            };
            
            hintContainer.appendChild(hintButton);
            hintContainer.appendChild(hintText);
            container.appendChild(hintContainer);
        }

        function checkAnswer(index) {
            const q = currentData[index];
            let isCorrect = false;
            
            const selected = document.querySelector(`input[name="q${index}"]:checked`);
            if (!selected) {
                showAlert("è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼");
                quizContainer.classList.add('animate-shake');
                setTimeout(() => quizContainer.classList.remove('animate-shake'), 300);
                playSound('wrong');
                return;
            }
            const userAnswer = selected.value;
            isCorrect = (userAnswer === q.answer);

            // ç§»é™¤æŒ‰éˆ•
            controlsContainer.innerHTML = ''; 
            
            // çµæœå›é¥‹å€
            const resultDiv = document.createElement('div');
            resultDiv.className = `mt-6 p-6 rounded-2xl border-2 animate-pop ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
            
            if (isCorrect) {
                score++;
                playSound('correct');
                resultDiv.innerHTML = `
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-2xl shadow-sm">ğŸ‰</div>
                        <div>
                            <p class="text-green-800 font-bold text-lg">ç­”å°äº†ï¼Great Job!</p>
                            <p class="text-green-600 text-sm">æ­£ç¢ºç­”æ¡ˆï¼š${q.answer}</p>
                        </div>
                    </div>
                `;
                // è‡ªå‹•æœ—è®€æ­£ç¢ºç­”æ¡ˆï¼ˆé¸é …å…§å®¹ï¼‰
                const correctIndex = q.answer.charCodeAt(0) - 65;
                const speakText = q.options[correctIndex];
                setTimeout(() => speak(speakText), 500); // ç¨å¾®å»¶é²é¿å…å’ŒéŸ³æ•ˆé‡ç–Š

            } else {
                playSound('wrong');
                // å–å¾—æ­£ç¢ºç­”æ¡ˆæ–‡å­—
                const correctIndex = q.answer.charCodeAt(0) - 65;
                const correctText = q.options[correctIndex];
                
                resultDiv.innerHTML = `
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-2xl shadow-sm">âŒ</div>
                        <div>
                            <p class="text-red-800 font-bold text-lg">å†æ¥å†å²ï¼Try Again!</p>
                            <p class="text-red-600 text-sm">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<span class="font-bold">${correctText}</span></p>
                        </div>
                    </div>
                `;
            }

            // é–å®šé¸é …
            document.querySelectorAll(`input[name="q${index}"]`).forEach(el => el.disabled = true);
            document.querySelectorAll(`div[role="button"]`).forEach(el => el.classList.add('cursor-not-allowed', 'opacity-70'));

            questionsWrapper.appendChild(resultDiv);

            // ä¸‹ä¸€é¡ŒæŒ‰éˆ•
            const nextButton = document.createElement('button');
            nextButton.className = 'w-full sm:w-auto bg-slate-800 text-white font-bold py-3 px-10 rounded-xl hover:bg-slate-700 hover:scale-105 transition-all shadow-lg mt-6';
            
            if (currentQuestionIndex < currentData.length - 1) {
                nextButton.textContent = 'ä¸‹ä¸€é¡Œ Next â†’';
                nextButton.onclick = () => {
                    currentQuestionIndex++;
                    displayQuestion(currentQuestionIndex);
                };
            } else {
                nextButton.textContent = 'æŸ¥çœ‹æˆç¸¾ Finish ğŸ†';
                nextButton.onclick = showFinalScore;
            }
            controlsContainer.appendChild(nextButton);
        }

        function showFinalScore() {
            progressBar.style.width = '100%';
            questionsWrapper.innerHTML = '';
            controlsContainer.innerHTML = '';
            sectionTitle.textContent = 'æ¸¬é©—å®Œæˆ';
            sectionTag.textContent = 'Score Report';
            questionCounter.textContent = '';

            // æ»¿åˆ†ç‰¹æ•ˆ
            if (score === currentData.length) {
                playSound('correct');
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            // é¡¯ç¤ºåˆ†æ•¸
            scoreDisplay.innerHTML = `
                <div class="py-10 animate-fade-in">
                    <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center text-5xl shadow-lg mx-auto mb-6 border-4 ${score === currentData.length ? 'border-amber-400' : 'border-slate-200'}">
                        ${score === currentData.length ? 'ğŸ†' : (score > currentData.length/2 ? 'ğŸŒŸ' : 'ğŸ’ª')}
                    </div>
                    <p class="text-slate-500 uppercase tracking-wider font-bold text-sm mb-2">Total Score</p>
                    <p class="text-6xl font-extrabold my-2 text-slate-800">${score} <span class="text-3xl text-slate-300">/ ${currentData.length}</span></p>
                    
                    <p class="text-lg text-slate-600 mt-4 font-medium">
                        ${score === currentData.length ? 'å¤ªæ£’äº†ï¼å…¨å°ï¼Outstanding!' : (score > currentData.length/2 ? 'åšå¾—å¾ˆå¥½ï¼Good Job!' : 'ç¹¼çºŒåŠ æ²¹ï¼Keep Trying!')}
                    </p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4 mt-10">
                        <button onclick="location.reload()" class="px-8 py-3 border-2 border-slate-200 rounded-xl hover:bg-slate-50 text-slate-600 font-bold transition-colors">
                            å›é¦–é  Home
                        </button>
                        <button onclick="switchSection('${currentSectionId}')" class="px-8 py-3 bg-amber-500 text-white rounded-xl hover:bg-amber-600 font-bold shadow-lg shadow-amber-500/30 hover:-translate-y-1 transition-all">
                            å†è©¦ä¸€æ¬¡ Retry
                        </button>
                    </div>
                </div>
            `;
            scoreDisplay.classList.remove('hidden');
        }

        function showAlert(msg) {
            alertMessage.textContent = msg;
            alertModal.classList.remove('hidden');
        }

        closeAlertBtn.addEventListener('click', () => {
            alertModal.classList.add('hidden');
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            switchSection('PartA');
        });
    </script>
</body>
</html>