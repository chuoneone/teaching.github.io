<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B1U1習作C</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter for English, Noto Sans TC for Chinese -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* 自定義樣式 */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }

        /* 互動單字樣式 */
        .word {
            position: relative;
            cursor: pointer;
            border-bottom: 1px dotted #6b7280; /* gray-500 */
            transition: color 0.2s;
        }

        .word:hover {
            color: #2563eb; /* blue-600 */
        }

        /* 中文翻譯提示框 (Tooltip) */
        .word .tooltip {
            visibility: hidden;
            width: max-content;
            background-color: #1f2937; /* gray-800 */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 10;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none; /* 避免提示框干擾滑鼠事件 */
        }

        .word:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- 測驗主容器 -->
    <div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg w-full max-w-3xl">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 text-center mb-6">B1U1習作C</h1>
        
        <!-- 題目將由 JavaScript 動態生成於此 -->
        <div id="questions-wrapper"></div>

        <!-- 功能按鈕與分數顯示區 -->
        <div class="mt-8 text-center">
            <button id="check-btn" class="w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 disabled:bg-gray-400 disabled:cursor-not-allowed">
                檢查答案
            </button>
            <div id="score-display" class="mt-6 text-2xl font-bold text-gray-800 hidden"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 資料定義區 ---

            // 單字翻譯字典
            const translations = {
                "what's": "什麼是", "what": "什麼", "the": "這個", "today": "今天", "it's": "它是", "may": "五月",
                "time": "時間", "day": "天", "month": "月份", "date": "日期", "when": "何時", "is": "是", "her": "她的",
                "school": "學校", "november": "十一月", "on": "在", "in": "在...裡面", "your": "你的", "birthday": "生日",
                "oh": "哦", "also": "也", "new": "新的", "year's": "年的", "at": "在", "nine": "九", "thirty": "三十",
                "january": "一月", "first": "第一", "december": "十二月", "this": "這個", "boy": "男孩", "has": "有",
                "beautiful": "美麗的", "eyes": "眼睛", "and": "和", "long": "長的", "hair": "頭髮", "i": "我",
                "like": "喜歡", "him": "他(受格)", "very": "非常", "much": "很多", "he": "他(主格)", "his": "他的", "he's": "他是",
                "hi": "嗨", "i'm": "我是", "nice": "高興的", "to": "去", "meet": "遇見", "you": "你", "too": "也", "see": "看到",
                "you're": "你是", "welcome": "不客氣", "excuse": "請問", "me": "我", "are": "是", "mr.": "先生", "walker": "沃克",
                "yes": "是的", "larry": "賴瑞", "no": "不是", "not": "不", "friend": "朋友", "who's": "誰是", "that": "那個",
                "girl": "女孩", "she": "她", "really": "真的", "tall": "高的", "a": "一個", "happy": "快樂的", "she's": "她是",
                "ariel": "愛麗兒", "our": "我們的", "classmate": "同學", "eric's": "艾瑞克的", "aunt": "阿姨", "writer": "作家",
                "doctor": "醫生", "housewife": "家庭主婦", "how": "如何", "old": "年老的", "alice": "愛麗絲", "brad": "布萊德",
                "they": "他們", "my": "我的", "family": "家庭", "ten": "十", "twelve": "十二", "cook": "廚師", "nurse": "護士"
            };

            // 測驗題目資料
            const quizData = [
                {
                    question: "A: Hi, I'm Kelly Coleman. Nice to meet you. B: I'm Nigel Ford. __________",
                    options: ["I see.", "You're welcome.", "Nice to meet you, too."],
                    answer: "C",
                    hint: "當別人說「很高興認識你」，禮貌的回應是「我也很高興認識你」。"
                },
                {
                    question: "A: Excuse me. Are you Mr. Walker? B: __________",
                    options: ["Yes, he is.", "Yes, I'm Larry Walker.", "No, I'm not Mr. Walker's friend."],
                    answer: "B",
                    hint: "問句是「你是...嗎？」，所以回答應該用第一人稱「我是...」來回答。"
                },
                {
                    question: "A: Who's that girl? B: __________",
                    options: ["She is really tall.", "She is a happy girl.", "She's Ariel, our new classmate."],
                    answer: "C",
                    hint: "問句是「那個女孩是誰？」，所以回答應該要介紹她的身分。"
                },
                {
                    question: "A: Is Eric's aunt a writer? B: __________",
                    options: ["Yes, and she's a doctor, too.", "No, she's not. She is a writer.", "Yes, she is. She is a housewife."],
                    answer: "A",
                    hint: "選項 B 和 C 的回答前後矛盾，只有選項 A 在邏輯上是合理的。"
                },
                {
                    question: "A: How old are Alice and Brad? B: __________",
                    options: ["They are my family.", "Alice is ten, and Brad is twelve.", "Alice is a cook, and Brad is a nurse."],
                    answer: "B",
                    hint: "問句是「他們幾歲了？」，所以回答應該要說明他們的年齡。"
                }
            ];

            // --- 功能函式區 ---

            /**
             * 將文字轉換為包含互動式單字的 HTML
             * @param {string} text - 輸入的文字
             * @returns {string} - 轉換後的 HTML 字串
             */
            function createInteractiveText(text) {
                // 使用正則表達式分割文字，保留空格和標點符號
                const parts = text.split(/([a-zA-Z'’]+)/);
                return parts.map(part => {
                    const cleanPart = part.toLowerCase().replace(/’/g, "'");
                    if (translations[cleanPart]) {
                        return `<span class="word">${part}<span class="tooltip">${translations[cleanPart]}</span></span>`;
                    }
                    return part;
                }).join('');
            }

            /**
             * 使用瀏覽器 API 朗讀文字
             * @param {string} text - 要朗讀的文字
             */
            function speak(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel(); // 中斷先前的朗讀
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US'; // 設定美式口音
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                } else {
                    console.error("此瀏覽器不支援語音合成功能。");
                }
            }
            
            /**
             * 建立整個測驗的 HTML 結構
             */
            function buildQuiz() {
                const questionsWrapper = document.getElementById('questions-wrapper');
                quizData.forEach((q, index) => {
                    // 問題區塊容器
                    const questionBlock = document.createElement('div');
                    questionBlock.id = `q-${index}`;
                    questionBlock.className = 'mb-8 border-b border-gray-200 pb-8';

                    // 題目文字
                    const questionText = document.createElement('p');
                    questionText.className = 'text-lg text-gray-700 mb-4';
                    questionText.innerHTML = `<strong>${index + 1}.</strong> ${createInteractiveText(q.question)}`;
                    
                    // 選項區塊
                    const optionsGrid = document.createElement('div');
                    optionsGrid.className = 'grid grid-cols-1 sm:grid-cols-2 gap-3';
                    
                    q.options.forEach((option, i) => {
                        const optionChar = String.fromCharCode(65 + i); // A, B, C, D
                        const optionContainer = document.createElement('div');
                        optionContainer.className = 'flex items-center p-3 border border-gray-300 rounded-lg transition-all';
                        
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.id = `q${index}-opt${optionChar}`;
                        radio.name = `q${index}`;
                        radio.value = optionChar;
                        radio.className = 'h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300';

                        const label = document.createElement('label');
                        label.htmlFor = `q${index}-opt${optionChar}`;
                        label.className = 'ml-3 block text-md text-gray-900 flex-1 cursor-pointer';
                        label.innerHTML = `(${optionChar}) ${createInteractiveText(option)}`;

                        optionContainer.appendChild(radio);
                        optionContainer.appendChild(label);
                        optionsGrid.appendChild(optionContainer);
                    });

                    // 提示按鈕與提示內容
                    const hintContainer = document.createElement('div');
                    hintContainer.className = 'mt-4';

                    const hintButton = document.createElement('button');
                    hintButton.className = 'text-sm text-blue-600 hover:text-blue-800';
                    hintButton.textContent = '💡 提示';
                    
                    const hintText = document.createElement('p');
                    hintText.className = 'hint-content hidden mt-2 text-sm text-gray-600 bg-yellow-100 p-2 rounded-md';
                    hintText.textContent = q.hint;
                    
                    hintButton.onclick = () => hintText.classList.toggle('hidden');

                    hintContainer.appendChild(hintButton);
                    hintContainer.appendChild(hintText);
                    
                    questionBlock.appendChild(questionText);
                    questionBlock.appendChild(optionsGrid);
                    questionBlock.appendChild(hintContainer);
                    questionsWrapper.appendChild(questionBlock);
                });
            }

            /**
             * 檢查答案、計分並顯示結果
             */
            function checkAnswers() {
                let score = 0;
                const totalQuestions = quizData.length;

                quizData.forEach((q, index) => {
                    const questionBlock = document.getElementById(`q-${index}`);
                    const selectedRadio = questionBlock.querySelector(`input[name="q${index}"]:checked`);
                    
                    // 停用所有選項
                    questionBlock.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.disabled = true;
                    });

                    const correctOptionValue = q.answer; // e.g., 'D'
                    const correctOptionId = `q${index}-opt${correctOptionValue}`;
                    const correctLabel = document.querySelector(`label[for="${correctOptionId}"]`);

                    if (selectedRadio) {
                        const userLabel = selectedRadio.nextElementSibling;
                        if (selectedRadio.value === correctOptionValue) {
                            score++;
                            userLabel.parentElement.classList.add('bg-green-100', 'border-green-500', 'ring-2', 'ring-green-300');
                            userLabel.innerHTML += ' <span class="text-green-600 font-bold">✔️</span>';
                        } else {
                            userLabel.parentElement.classList.add('bg-red-100', 'border-red-500', 'ring-2', 'ring-red-300');
                            userLabel.innerHTML += ' <span class="text-red-600 font-bold">❌</span>';
                            // 標示出正確答案
                            correctLabel.parentElement.classList.add('bg-green-100', 'border-green-500');
                        }
                    } else {
                        // 如果使用者未作答，只標示正確答案
                         correctLabel.parentElement.classList.add('bg-green-100', 'border-green-500');
                    }
                });

                // 顯示分數
                const scoreDiv = document.getElementById('score-display');
                scoreDiv.textContent = `你的分數: ${score} / ${totalQuestions}`;
                scoreDiv.classList.remove('hidden');

                // 停用檢查按鈕
                const checkBtn = document.getElementById('check-btn');
                checkBtn.disabled = true;
            }

            // --- 事件監聽區 ---

            // 點擊單字發音（事件委派）
            document.getElementById('questions-wrapper').addEventListener('click', (e) => {
                if (e.target.classList.contains('word')) {
                    speak(e.target.childNodes[0].nodeValue); // 只朗讀文字節點，忽略 tooltip
                }
            });

            // 點擊檢查答案按鈕
            document.getElementById('check-btn').addEventListener('click', checkAnswers);

            // --- 程式進入點 ---
            buildQuiz();
        });
    </script>
</body>
</html>

