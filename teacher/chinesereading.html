<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文朗讀練習工具</title>
    <link rel="icon" href="dog.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* 簡單的淡入淡出效果 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        
        <!-- 設定頁面 -->
        <div id="setup-screen" class="p-6 md:p-8 space-y-6 fade-in">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-gray-800">中文朗讀練習</h1>
            </div>

            <div id="warning-box" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md" role="alert">
                <p class="font-bold">溫馨提示</p>
                <p>您的瀏覽器不支援語音功能，建議使用最新版 Chrome 或 Edge 瀏覽器。</p>
            </div>

            <div>
                <label for="text-input" class="block text-sm font-medium text-gray-700 mb-2">請在此貼上文章：</label>
                <textarea id="text-input" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="在這裡輸入或貼上您想練習的中文文章..."></textarea>
            </div>

            <button id="start-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                <span>開始練習</span>
            </button>
        </div>

        <!-- 練習頁面 -->
        <div id="practice-screen" class="hidden p-6 md:p-8 space-y-6 bg-gray-50">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold text-gray-800">練習中</h2>
                <button id="stop-btn" class="text-gray-500 hover:text-gray-800 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </button>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-inner min-h-[120px] flex items-center justify-center">
                 <p id="current-sentence" class="text-center text-2xl text-gray-800 font-semibold leading-relaxed">&nbsp;</p>
            </div>

            <div class="min-h-[50px] flex items-center justify-center p-3 bg-indigo-50 border border-indigo-200 rounded-lg">
                <p id="status-text" class="text-center text-lg text-indigo-800 font-medium">準備開始...</p>
            </div>
            
            <!-- 互動按鈕區 -->
            <div id="action-buttons" class="hidden grid grid-cols-2 gap-4 pt-4">
                <button id="listen-again-btn" class="w-full bg-white border border-gray-300 text-gray-700 font-bold py-3 px-4 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.885-.666A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566z" clip-rule="evenodd" /></svg>
                    <span>再聽一次</span>
                </button>
                <button id="next-sentence-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition flex items-center justify-center gap-2">
                    <span>下一句</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                </button>
            </div>
        </div>
            <footer style="font-size:12px; color:gray; text-align:center;">
        © 2025 特教米克師  
        本作品採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW" target="_blank">CC BY-NC-SA 4.0 創用CC授權</a>。
        </footer>
    </div>




    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM 元素
            const setupScreen = document.getElementById('setup-screen');
            const practiceScreen = document.getElementById('practice-screen');
            const textInput = document.getElementById('text-input');
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const currentSentenceEl = document.getElementById('current-sentence');
            const statusTextEl = document.getElementById('status-text');
            const warningBox = document.getElementById('warning-box');
            const actionButtons = document.getElementById('action-buttons');
            const listenAgainBtn = document.getElementById('listen-again-btn');
            const nextSentenceBtn = document.getElementById('next-sentence-btn');

            const SpeechSynthesis = window.speechSynthesis || window.webkitSpeechSynthesis;

            if (!SpeechSynthesis) {
                warningBox.classList.remove('hidden');
                startBtn.disabled = true;
                return;
            }

            const synth = SpeechSynthesis;
            let sentences = [];
            let currentSentenceIndex = 0;
            let isReading = false;

            // --- 事件監聽 ---
            startBtn.addEventListener('click', startReading);
            stopBtn.addEventListener('click', stopReading);
            listenAgainBtn.addEventListener('click', speakCurrentSentence);
            nextSentenceBtn.addEventListener('click', () => {
                currentSentenceIndex++;
                processNextSentence();
            });

            // --- 核心功能函數 ---

            function splitText(text) {
                // 按標點符號分割句子，保留標點
                const regex = /[^。！？；]+[。！？；]?/g;
                const result = text.match(regex);
                return result ? result.filter(s => s.trim() !== '') : [];
            }

            function startReading() {
                // 中斷任何可能正在播放的語音
                synth.cancel(); 
                
                const text = textInput.value.trim();
                if (text === '') {
                    alert('請先輸入或貼上文章！');
                    return;
                }
                
                sentences = splitText(text);
                
                if (sentences.length === 0) {
                    alert('無法將輸入的內容分割成句子。請檢查文章格式。');
                    return;
                }
                
                isReading = true;
                currentSentenceIndex = 0;
                
                setupScreen.classList.add('hidden');
                practiceScreen.classList.remove('hidden');
                practiceScreen.classList.add('fade-in');

                processNextSentence();
            }

            function stopReading() {
                isReading = false;
                synth.cancel();

                practiceScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');
                setupScreen.classList.add('fade-in');
                
                updateStatus('準備開始...');
            }
            
            function speakSentence(sentence) {
                const utterance = new SpeechSynthesisUtterance(sentence);
                utterance.lang = 'zh-TW';
                utterance.rate = 0.9;

                // 確保在開始新一句朗讀前，清除之前的佇列
                synth.cancel();

                // 找一個中文的聲音
                const voices = synth.getVoices();
                utterance.voice = voices.find(voice => voice.lang === 'zh-TW' || voice.lang === 'zh-CN') || voices[0];
                
                updateStatus('系統朗讀中...');
                actionButtons.classList.add('hidden');

                utterance.onend = () => {
                    if (!isReading) return;
                    updateStatus('朗讀完畢');
                    actionButtons.classList.remove('hidden');
                    actionButtons.classList.add('fade-in');
                };
                
                synth.speak(utterance);
            }
            
            function speakCurrentSentence() {
                if(currentSentenceIndex < sentences.length){
                    const sentence = sentences[currentSentenceIndex].trim();
                    speakSentence(sentence);
                }
            }

            function processNextSentence() {
                if (!isReading) return;
                
                if (currentSentenceIndex < sentences.length) {
                    const sentence = sentences[currentSentenceIndex].trim();
                    currentSentenceEl.textContent = sentence;
                    speakSentence(sentence);
                } else {
                    updateStatus('恭喜！已完成所有練習！');
                    isReading = false;
                    currentSentenceEl.textContent = '練習結束';
                    setTimeout(stopReading, 3000); 
                }
            }
            
            function updateStatus(message) {
                statusTextEl.textContent = message;
            }

            // 瀏覽器可能需要一些時間來載入語音列表，這個監聽器可以確保我們能拿到最新的聲音清單
            if (synth.onvoiceschanged !== undefined) {
                 synth.onvoiceschanged = () => {
                    const voices = synth.getVoices();
                    console.log("可用聲音列表:", voices.filter(v => v.lang.startsWith('zh')));
                 };
            }
        });
    </script>
</body>
</html>

